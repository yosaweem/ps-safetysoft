&ANALYZE-SUSPEND _VERSION-NUMBER UIB_v9r12 GUI
&ANALYZE-RESUME
/* Connected Databases 
*/
&Scoped-define WINDOW-NAME C-Win
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CUSTOM _DEFINITIONS C-Win 
/*------------------------------------------------------------------------
/* Connected Databases : sic_test         PROGRESS                      */
  File:   Description: 
  Input Parameters:  <none>
  Output Parameters: <none>
  Author:  Created: 
  ------------------------------------------------------------------------*/
/*          This .W file was created with the Progress AppBuilder.      */
/*----------------------------------------------------------------------*/
/* Create an unnamed pool to store all the widgets created 
     by this procedure. This is a good default which assures
     that this procedure's triggers and internal procedures 
     will execute in this procedure's storage, and that proper
     cleanup will occur on deletion of the procedure. */
CREATE WIDGET-POOL.
/* ***************************  Definitions  **************************    */  
/* Parameters Definitions ---                                              */  
/* Local Variable Definitions ---                                          */  
/*******************************/                                          
/*programid   : wgwloademp.w                                               */  
/*programname : load text file standard Format to GW                       */  
/*Copyright  : Safety Insurance Public Company Limited                     */  
/*Create by  : Ranu I. A63-0449 โหลดไฟล์ข้อมูลตามฟอร์แมตกลาง               */ 
/*Modify by  : Ranu I. A64-0044 แก้ไขการโหลดงานรถไฟฟ้า                     */
/*Modify by  : Ranu I. A64-0257 แก้ไข memo งานต่ออายุ และค่าคอมมิชชั่น     */
/*Modify by  : Ranu I. A64-0309 เพิ่มการเช็คเบี้ย รย.                      */
/*Modify by  : Ranu I. A64-0138 แก้ไขการคำนวณเบี้ยที่โปรแกรมกลาง           */
/*Modify by  : Ranu I. A64-0355 เพิ่มเงื่อนไข co-broker และ ความคุ้มครอง unlimited */
/*Modify by  : Ranu I. A65-0043 เพิ่มเงื่อนไขการเช็ค Branch policy ,Policy type กับ
               policy no ตรงกันหรือไม่ และเพิ่มการเช็ค Class ที่ไม่ต้องระบุที่นั่ง  */
/*Modify by  : Naphasint C. A65-0271 Upload Renew แก้ไขเงื่อนไขการอัพโหลด    
               ข้อมูลช่อง Accessories                                      */
/*Modify by : kridtiya i. A66-0018 Date. 16/01/2023 V72 no Garage ,Append 70/72 
                          DSPC <=33% */
/*Modify by : Ranu I. A66-0202 แก้ไข benefit code ส่วนลด 72 เป็น DSPC และเพิ่มการเก็บ kilowatt */
/* Modify by   : Ranu I. A67-0029 เพิ่มการเก็บข้อมูลของรถไฟฟ้า      */
/* Modify by   : Ranu I. F67-0001 เพิ่มการเก็บข้อมูลวันที่คุ้มครอง และวันที่หมดอายุของ พรบ. 
                และเก็บเบี้ย Stamp , Vat ตามไฟล์   */
/* Modify by  : Ranu I. A67-0212 แก้ไขการเก็บข้อมูลผู้ขับขี่งานต่ออายุ   */
/* Modify by  : Ranu I. A68-0044  เพิ่มเงื่อนไข ICE */
/*-------------------------------------------------------------------------*/
SESSION:MULTITASKING-INTERVAL = 1 .                                        
DEF VAR gv_id AS CHAR FORMAT "X(15)" NO-UNDO.     /*A53-0220*/
DEF VAR nv_pwd AS CHAR  FORMAT "x(15)" NO-UNDO.   /*A53-0220*/
DEF VAR nv_total AS INT INIT 0.                   
DEF VAR n_chkvat AS LOGICAL INIT NO.
DEF VAR nv_instot AS INT INIT 0.
DEF VAR n_addr AS CHAR FORMAT "x(250)" .
DEF VAR n_yr AS INT INIT 0. /*A64-0044*/
DEF VAR re_base3 AS DECI.
/* A64-0138 : caculate deduct OD  */
DEF VAR dod0 AS INTEGER init 0.
DEF VAR dod1 AS INTEGER init 0.
DEF VAR dod2 AS INTEGER init 0.
DEF VAR dpd0 AS INTEGER init 0.
/* A64-0138 */
{wgw\wgwlempire.i}      /*ประกาศตัวแปร*/
/* A64-0309 */
DEFINE VAR nv_mv411 AS DECIMAL.
DEFINE VAR nv_mv412 AS DECIMAL.
DEFINE VAR nv_mv42  AS DECIMAL.
DEFINE VAR nv_mv43  AS DECIMAL.
DEF VAR nv_411t   AS DECIMAL.    
DEF VAR nv_412t   AS DECIMAL.    
DEF VAR nv_42t    AS DECIMAL.    
DEF VAR nv_43t   AS DECIMAL.
DEF VAR nv_ry31  AS DECIMAL. /*A68-0044*/

/* add by : A67-0029 */
DEF VAR n_count AS INTE INIT 0.
DEF VAR no_policy   AS CHAR FORMAT "x(20)" .
DEF VAR no_rencnt   AS CHAR FORMAT "99".
DEF VAR no_endcnt   AS CHAR FORMAT "999".
DEF VAR no_riskno   AS CHAR FORMAT "999".
DEF VAR no_itemno   AS CHAR FORMAT "999".
def var nv_drivage1 as inte init 0 .
def var nv_drivage2 as inte init 0 .
def var nv_drivage3 as inte init 0 .
def var nv_drivage4 as inte init 0 .
def var nv_drivage5 as inte init 0 .
def var nv_drivbir1 as char init  "" .
def var nv_drivbir2 as char init  "" .
def var nv_drivbir3 as char init  "" .
def var nv_drivbir4 as char init  "" .
def var nv_drivbir5 as char init  "" .
def var nv_ntitle   as char init "" .
def var nv_name     as char init "" .
def var nv_lname    as char init "" .
def var nv_drinam   as char init "" .
def var nv_dicno    as char init "" .
def var nv_dgender  as char init "" .
def var nv_dbirth   as char init "" .
def var nv_dage     as INTE init 0 .
def var nv_doccup   as char init "" .
def var nv_ddriveno as char init "" .
def var nv_drivexp  as char init "" .
DEF VAR nv_dlevel   AS INTE INIT 0.
DEF VAR nv_dlevper  AS INTE INIT 0.
DEF VAR nv_dribirth AS CHAR INIT "" .
DEF VAR nv_dconsent AS CHAR INIT "" .
/* end A67-0029 */

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-PREPROCESSOR-BLOCK 

/* ********************  Preprocessor Definitions  ******************** */

&Scoped-define PROCEDURE-TYPE Window
&Scoped-define DB-AWARE no

/* Name of designated FRAME-NAME and/or first browse and/or first query */
&Scoped-define FRAME-NAME fr_main
&Scoped-define BROWSE-NAME br_wdetail

/* Internal Tables (found by Frame, Query & Browse Queries)             */
&Scoped-define INTERNAL-TABLES wdetail

/* Definitions for BROWSE br_wdetail                                    */
&Scoped-define FIELDS-IN-QUERY-br_wdetail wdetail.comment wdetail.redbook wdetail.policyno wdetail.poltyp wdetail.appenno wdetail.comdat wdetail.expdat wdetail.packcod wdetail.covcod wdetail.garage wdetail.nv_insref wdetail.tiname wdetail.insnam wdetail.lastname wdetail.name2 wdetail.name3 wdetail.addr wdetail.tambon wdetail.amper wdetail.country wdetail.post   
&Scoped-define ENABLED-FIELDS-IN-QUERY-br_wdetail   
&Scoped-define SELF-NAME br_wdetail
&Scoped-define QUERY-STRING-br_wdetail FOR EACH wdetail
&Scoped-define OPEN-QUERY-br_wdetail OPEN QUERY br_wdetail FOR EACH wdetail.
&Scoped-define TABLES-IN-QUERY-br_wdetail wdetail
&Scoped-define FIRST-TABLE-IN-QUERY-br_wdetail wdetail


/* Definitions for FRAME fr_main                                        */
&Scoped-define OPEN-BROWSERS-IN-QUERY-fr_main ~
    ~{&OPEN-QUERY-br_wdetail}

/* Standard List Definitions                                            */
&Scoped-Define ENABLED-OBJECTS br_wdetail tg_flag ra_poltyp ra_type ~
fi_loaddat fi_pack fi_bchno fi_prevbat fi_bchyr fi_filename bu_file ~
fi_output1 fi_output2 fi_output3 buok bu_exit fi_outputpro ra_match ~
RECT-370 RECT-372 RECT-374 RECT-376 RECT-377 RECT-378 
&Scoped-Define DISPLAYED-OBJECTS tg_flag ra_poltyp ra_type fi_loaddat ~
fi_pack fi_bchno fi_prevbat fi_bchyr fi_filename fi_output1 fi_output2 ~
fi_output3 fi_process fi_outputpro fi_impcnt fi_completecnt fi_premtot ~
fi_premsuc ra_match 

/* Custom List Definitions                                              */
/* List-1,List-2,List-3,List-4,List-5,List-6                            */

/* _UIB-PREPROCESSOR-BLOCK-END */
&ANALYZE-RESUME



/* ***********************  Control Definitions  ********************** */

/* Define the widget handle for the window                              */
DEFINE VAR C-Win AS WIDGET-HANDLE NO-UNDO.

/* Definitions of the field level widgets                               */
DEFINE BUTTON buok 
     LABEL "OK" 
     SIZE 12 BY 1.14
     FONT 6.

DEFINE BUTTON bu_exit 
     LABEL "EXIT" 
     SIZE 12 BY 1.14
     FONT 6.

DEFINE BUTTON bu_file 
     LABEL "...." 
     SIZE 5 BY .95.

DEFINE VARIABLE fi_bchno AS CHARACTER FORMAT "X(20)":U 
     VIEW-AS FILL-IN 
     SIZE 23 BY 1
     BGCOLOR 19 FGCOLOR 2  NO-UNDO.

DEFINE VARIABLE fi_bchyr AS INTEGER FORMAT "9999":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 10 BY .95
     BGCOLOR 15 FGCOLOR 0  NO-UNDO.

DEFINE VARIABLE fi_completecnt AS INTEGER FORMAT ">,>>>,>>9":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 11.5 BY 1.05
     BGCOLOR 19 FGCOLOR 1 FONT 6 NO-UNDO.

DEFINE VARIABLE fi_filename AS CHARACTER FORMAT "X(100)":U 
     VIEW-AS FILL-IN 
     SIZE 60 BY .95
     BGCOLOR 15 FGCOLOR 0  NO-UNDO.

DEFINE VARIABLE fi_impcnt AS INTEGER FORMAT ">,>>>,>>9":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 11.5 BY 1.05
     BGCOLOR 19 FGCOLOR 1 FONT 6 NO-UNDO.

DEFINE VARIABLE fi_loaddat AS DATE FORMAT "99/99/9999":U 
     VIEW-AS FILL-IN 
     SIZE 13 BY .95
     BGCOLOR 15 FGCOLOR 0  NO-UNDO.

DEFINE VARIABLE fi_output1 AS CHARACTER FORMAT "X(256)":U 
     VIEW-AS FILL-IN 
     SIZE 60 BY .95
     BGCOLOR 15  NO-UNDO.

DEFINE VARIABLE fi_output2 AS CHARACTER FORMAT "X(256)":U 
     VIEW-AS FILL-IN 
     SIZE 60 BY .95
     BGCOLOR 15  NO-UNDO.

DEFINE VARIABLE fi_output3 AS CHARACTER FORMAT "X(256)":U 
     VIEW-AS FILL-IN 
     SIZE 60 BY .95
     BGCOLOR 15  NO-UNDO.

DEFINE VARIABLE fi_outputpro AS CHARACTER FORMAT "X(256)":U 
     VIEW-AS FILL-IN 
     SIZE 60 BY .95
     BGCOLOR 15  NO-UNDO.

DEFINE VARIABLE fi_pack AS CHARACTER FORMAT "X(1)":U 
     VIEW-AS FILL-IN 
     SIZE 3.5 BY .95
     BGCOLOR 15 FGCOLOR 0 FONT 6 NO-UNDO.

DEFINE VARIABLE fi_premsuc AS DECIMAL FORMAT "->,>>>,>>>,>>9.99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 18 BY 1.05
     BGCOLOR 19 FGCOLOR 1 FONT 6 NO-UNDO.

DEFINE VARIABLE fi_premtot AS DECIMAL FORMAT "->,>>>,>>>,>>9.99":U INITIAL 0 
     VIEW-AS FILL-IN 
     SIZE 18 BY 1.05
     BGCOLOR 19 FGCOLOR 1 FONT 6 NO-UNDO.

DEFINE VARIABLE fi_prevbat AS CHARACTER FORMAT "X(20)":U 
     VIEW-AS FILL-IN 
     SIZE 18.5 BY .95
     BGCOLOR 15 FGCOLOR 0 FONT 6 NO-UNDO.

DEFINE VARIABLE fi_process AS CHARACTER FORMAT "X(256)":U 
     VIEW-AS FILL-IN 
     SIZE 60.17 BY .95
     BGCOLOR 10 FGCOLOR 2 FONT 6 NO-UNDO.

DEFINE VARIABLE ra_match AS INTEGER 
     VIEW-AS RADIO-SET VERTICAL
     RADIO-BUTTONS 
          "1", 1,
"2", 2
     SIZE 2.5 BY 2.48
     BGCOLOR 1 FGCOLOR 7  NO-UNDO.

DEFINE VARIABLE ra_poltyp AS INTEGER 
     VIEW-AS RADIO-SET VERTICAL
     RADIO-BUTTONS 
          "กรมธรรม์ภาคสมัครใจ V70", 1,
"กรมธรรม์ภาคบังคับ  V72", 2,
"กรมธรรม์พ่วง พรบ. (V70 + V72)", 3
     SIZE 39 BY 3
     BGCOLOR 21  NO-UNDO.

DEFINE VARIABLE ra_type AS INTEGER 
     VIEW-AS RADIO-SET HORIZONTAL
     RADIO-BUTTONS 
          "NEW", 1,
"RENEW", 2
     SIZE 39 BY 1.19
     BGCOLOR 19  NO-UNDO.

DEFINE RECTANGLE RECT-370
     EDGE-PIXELS 2 GRAPHIC-EDGE    
     SIZE 132.5 BY 1.43
     BGCOLOR 1 .

DEFINE RECTANGLE RECT-372
     EDGE-PIXELS 2 GRAPHIC-EDGE    ROUNDED 
     SIZE 130.5 BY 14.05
     BGCOLOR 10 FGCOLOR 1 .

DEFINE RECTANGLE RECT-374
     EDGE-PIXELS 2 GRAPHIC-EDGE    
     SIZE 130.5 BY 8.05
     BGCOLOR 23 .

DEFINE RECTANGLE RECT-376
     EDGE-PIXELS 2 GRAPHIC-EDGE    
     SIZE 128.5 BY 2.52
     BGCOLOR 8 .

DEFINE RECTANGLE RECT-377
     EDGE-PIXELS 2 GRAPHIC-EDGE    
     SIZE 15 BY 2
     BGCOLOR 1 .

DEFINE RECTANGLE RECT-378
     EDGE-PIXELS 2 GRAPHIC-EDGE    
     SIZE 15 BY 2
     BGCOLOR 6 FGCOLOR 1 .

DEFINE VARIABLE tg_flag AS LOGICAL INITIAL no 
     LABEL "" 
     VIEW-AS TOGGLE-BOX
     SIZE 2.5 BY 1
     BGCOLOR 19 FGCOLOR 2  NO-UNDO.

/* Query definitions                                                    */
&ANALYZE-SUSPEND
DEFINE QUERY br_wdetail FOR 
      wdetail SCROLLING.
&ANALYZE-RESUME

/* Browse definitions                                                   */
DEFINE BROWSE br_wdetail
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _DISPLAY-FIELDS br_wdetail C-Win _FREEFORM
  QUERY br_wdetail DISPLAY
      wdetail.comment     COLUMN-LABEL "Comment "        format "x(75)"     
wdetail.redbook     COLUMN-LABEL "Redbook"         FORMAT "x(15)"
wdetail.policyno    column-label "Policy no"       format "x(18)"
wdetail.poltyp      column-label "Poltyp"          format "x(3)"
wdetail.appenno     column-label "Notification"    format "x(20)"
wdetail.comdat      column-label "Comm.date"       format "99/99/9999"
wdetail.expdat      column-label "Exp date"        format "99/99/9999"
wdetail.packcod     column-label "Package "        format "x(15)"
wdetail.covcod      column-label "Cover"           format "x(3)"
wdetail.garage      column-label "Garage"          format "x(10)"
wdetail.nv_insref   column-label "Insured no."     format "x(12)"
wdetail.tiname      column-label "Title"           format "x(20)"
wdetail.insnam      column-label "Name"            format "x(50)"
wdetail.lastname    column-label "Last Name"       format "x(50)"
wdetail.name2       column-label "Name 2"          format "x(50)"
wdetail.name3       column-label "Name 3 "         format "x(50)"
wdetail.addr        column-label "Address1"        format "x(50)"
wdetail.tambon      column-label "Address2"        format "x(50)"
wdetail.amper       column-label "Address3"        format "x(50)"
wdetail.country     column-label "Address4"        format "x(50)"
wdetail.post        column-label "Post code"       format "x(50)"
/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME
    WITH NO-ROW-MARKERS SEPARATORS SIZE 128.5 BY 4.91
         BGCOLOR 15 FGCOLOR 1 FONT 6 ROW-HEIGHT-CHARS .57 FIT-LAST-COLUMN.


/* ************************  Frame Definitions  *********************** */

DEFINE FRAME fr_main
     br_wdetail AT ROW 16.95 COL 3 WIDGET-ID 100
     tg_flag AT ROW 8.62 COL 104 WIDGET-ID 40
     ra_poltyp AT ROW 4.91 COL 34.67 NO-LABEL WIDGET-ID 14
     ra_type AT ROW 3.57 COL 34.67 NO-LABEL WIDGET-ID 18
     fi_loaddat AT ROW 8.05 COL 32.67 COLON-ALIGNED NO-LABEL
     fi_pack AT ROW 8 COL 65.83 COLON-ALIGNED NO-LABEL
     fi_bchno AT ROW 22.81 COL 16 COLON-ALIGNED NO-LABEL NO-TAB-STOP 
     fi_prevbat AT ROW 9.1 COL 32.5 COLON-ALIGNED NO-LABEL
     fi_bchyr AT ROW 9.1 COL 65.67 COLON-ALIGNED NO-LABEL
     fi_filename AT ROW 10.14 COL 32.5 COLON-ALIGNED NO-LABEL
     bu_file AT ROW 10.14 COL 95
     fi_output1 AT ROW 11.14 COL 32.5 COLON-ALIGNED NO-LABEL
     fi_output2 AT ROW 12.14 COL 32.5 COLON-ALIGNED NO-LABEL
     fi_output3 AT ROW 14.14 COL 32.5 COLON-ALIGNED NO-LABEL
     buok AT ROW 10.48 COL 105.67
     bu_exit AT ROW 12.76 COL 105.67
     fi_process AT ROW 15.29 COL 32.33 COLON-ALIGNED NO-LABEL
     fi_outputpro AT ROW 13.14 COL 32.5 COLON-ALIGNED NO-LABEL
     fi_impcnt AT ROW 22.24 COL 60.33 COLON-ALIGNED NO-LABEL NO-TAB-STOP 
     fi_completecnt AT ROW 23.24 COL 60.33 COLON-ALIGNED NO-LABEL NO-TAB-STOP 
     fi_premtot AT ROW 22.24 COL 98.17 NO-LABEL NO-TAB-STOP 
     fi_premsuc AT ROW 23.29 COL 96.17 COLON-ALIGNED NO-LABEL NO-TAB-STOP 
     ra_match AT ROW 2.86 COL 105.5 NO-LABEL WIDGET-ID 26
     "     Total Record :":60 VIEW-AS TEXT
          SIZE 17.5 BY 1.05 AT ROW 22.24 COL 58.83 RIGHT-ALIGNED
          BGCOLOR 8 FGCOLOR 1 FONT 6
     "Success Net Premium :" VIEW-AS TEXT
          SIZE 22.33 BY 1.05 AT ROW 23.24 COL 96 RIGHT-ALIGNED
          BGCOLOR 8 FGCOLOR 1 FONT 6
     " Load Text File" VIEW-AS TEXT
          SIZE 23.5 BY 1.24 AT ROW 2.86 COL 108 WIDGET-ID 34
          BGCOLOR 1 FGCOLOR 7 FONT 2
     "Batch File Name :" VIEW-AS TEXT
          SIZE 17.5 BY .95 AT ROW 14.14 COL 16.33
          BGCOLOR 10 FGCOLOR 1 
     "ประเภทงาน :":35 VIEW-AS TEXT
          SIZE 12.33 BY .95 AT ROW 3.71 COL 21.67 WIDGET-ID 22
          BGCOLOR 10 FGCOLOR 1 FONT 6
     "Batch Year :" VIEW-AS TEXT
          SIZE 12.83 BY .95 AT ROW 9.1 COL 65.83 RIGHT-ALIGNED
          BGCOLOR 10 FGCOLOR 1 FONT 6
     "   Total Net Premium  :" VIEW-AS TEXT
          SIZE 21.5 BY 1.05 AT ROW 22.24 COL 95.83 RIGHT-ALIGNED
          BGCOLOR 8 FGCOLOR 1 FONT 6
     "BHT.":60 VIEW-AS TEXT
          SIZE 6 BY 1.05 AT ROW 22.24 COL 117.17
          BGCOLOR 8 FGCOLOR 1 FONT 6
     "แพ็คเกจ :" VIEW-AS TEXT
          SIZE 9.17 BY .95 AT ROW 8 COL 57.5
          BGCOLOR 10 FGCOLOR 1 FONT 6
     "ประเภทไฟล์โหลด :":35 VIEW-AS TEXT
          SIZE 16.33 BY .95 AT ROW 4.81 COL 17.5 WIDGET-ID 24
          BGCOLOR 10 FGCOLOR 1 FONT 6
     "Input File Name Load :" VIEW-AS TEXT
          SIZE 22.17 BY .95 AT ROW 10.14 COL 11.83
          BGCOLOR 10 FGCOLOR 1 FONT 6
     "Previous Batch No.  :" VIEW-AS TEXT
          SIZE 21.17 BY .95 AT ROW 9.1 COL 13.17
          BGCOLOR 10 FGCOLOR 1 FONT 6
     "Success Record :" VIEW-AS TEXT
          SIZE 17.5 BY 1.05 AT ROW 23.24 COL 58.83 RIGHT-ALIGNED
          BGCOLOR 8 FGCOLOR 1 FONT 6
     "    IMPORT TEXT FILE MOTOR [STANDARD FORMAT]" VIEW-AS TEXT
          SIZE 130.17 BY .95 AT ROW 1.19 COL 2.33
          BGCOLOR 1 FGCOLOR 7 FONT 6
     "์New Tariff Calculate" VIEW-AS TEXT
          SIZE 21.67 BY 1 AT ROW 8.62 COL 106.5 WIDGET-ID 42
          BGCOLOR 19 FGCOLOR 6 
    WITH 1 DOWN NO-BOX KEEP-TAB-ORDER OVERLAY 
         SIDE-LABELS NO-UNDERLINE THREE-D 
         AT COL 1 ROW 1
         SIZE 133 BY 24
         BGCOLOR 3 FONT 6.

/* DEFINE FRAME statement is approaching 4K Bytes.  Breaking it up   */
DEFINE FRAME fr_main
     "Output Data Load :" VIEW-AS TEXT
          SIZE 18.5 BY .95 AT ROW 11.14 COL 15.17
          BGCOLOR 10 FGCOLOR 1 
     " Match Policy No." VIEW-AS TEXT
          SIZE 23.67 BY 1.24 AT ROW 4.1 COL 107.83 WIDGET-ID 36
          BGCOLOR 1 FGCOLOR 7 FONT 2
     "Batch No. :" VIEW-AS TEXT
          SIZE 11.5 BY .95 AT ROW 22.81 COL 6.5
          BGCOLOR 8 FGCOLOR 1 FONT 6
     "Output Check Producer :" VIEW-AS TEXT
          SIZE 23.5 BY .95 AT ROW 13.14 COL 10
          BGCOLOR 10 FGCOLOR 4 
     " วันที่โหลด :":35 VIEW-AS TEXT
          SIZE 11.83 BY .95 AT ROW 8.05 COL 22.5
          BGCOLOR 10 FGCOLOR 1 FONT 6
     "Output Data Not Load :" VIEW-AS TEXT
          SIZE 22.83 BY .95 AT ROW 12.14 COL 11
          BGCOLOR 10 FGCOLOR 1 
     "BHT.":60 VIEW-AS TEXT
          SIZE 6 BY 1.05 AT ROW 23.24 COL 117.17
          BGCOLOR 8 FGCOLOR 1 FONT 6
     RECT-370 AT ROW 1.05 COL 1
     RECT-372 AT ROW 2.62 COL 2
     RECT-374 AT ROW 16.71 COL 2.17
     RECT-376 AT ROW 22 COL 3.17
     RECT-377 AT ROW 10.05 COL 104
     RECT-378 AT ROW 12.38 COL 104
    WITH 1 DOWN NO-BOX KEEP-TAB-ORDER OVERLAY 
         SIDE-LABELS NO-UNDERLINE THREE-D 
         AT COL 1 ROW 1
         SIZE 133 BY 24
         BGCOLOR 3 FONT 6.


/* *********************** Procedure Settings ************************ */

&ANALYZE-SUSPEND _PROCEDURE-SETTINGS
/* Settings for THIS-PROCEDURE
   Type: Window
   Allow: Basic,Browse,DB-Fields,Window,Query
   Other Settings: COMPILE
 */
&ANALYZE-RESUME _END-PROCEDURE-SETTINGS

/* *************************  Create Window  ************************** */

&ANALYZE-SUSPEND _CREATE-WINDOW
IF SESSION:DISPLAY-TYPE = "GUI":U THEN
  CREATE WINDOW C-Win ASSIGN
         HIDDEN             = YES
         TITLE              = "Load Text file Format Empire"
         HEIGHT             = 23.91
         WIDTH              = 132.67
         MAX-HEIGHT         = 45.76
         MAX-WIDTH          = 213.33
         VIRTUAL-HEIGHT     = 45.76
         VIRTUAL-WIDTH      = 213.33
         RESIZE             = yes
         SCROLL-BARS        = no
         STATUS-AREA        = no
         BGCOLOR            = 139
         FGCOLOR            = 133
         KEEP-FRAME-Z-ORDER = yes
         THREE-D            = yes
         MESSAGE-AREA       = no
         SENSITIVE          = yes.
ELSE {&WINDOW-NAME} = CURRENT-WINDOW.

&IF '{&WINDOW-SYSTEM}' NE 'TTY' &THEN
IF NOT C-Win:LOAD-ICON("wimage/safety.ico":U) THEN
    MESSAGE "Unable to load icon: wimage/safety.ico"
            VIEW-AS ALERT-BOX WARNING BUTTONS OK.
&ENDIF
/* END WINDOW DEFINITION                                                */
&ANALYZE-RESUME



/* ***********  Runtime Attributes and AppBuilder Settings  *********** */

&ANALYZE-SUSPEND _RUN-TIME-ATTRIBUTES
/* SETTINGS FOR WINDOW C-Win
  VISIBLE,,RUN-PERSISTENT                                               */
/* SETTINGS FOR FRAME fr_main
   FRAME-NAME Custom                                                    */
/* BROWSE-TAB br_wdetail 1 fr_main */
ASSIGN 
       br_wdetail:SEPARATOR-FGCOLOR IN FRAME fr_main      = 18.

ASSIGN 
       bu_file:AUTO-RESIZE IN FRAME fr_main      = TRUE.

ASSIGN 
       fi_bchno:READ-ONLY IN FRAME fr_main        = TRUE.

/* SETTINGS FOR FILL-IN fi_completecnt IN FRAME fr_main
   NO-ENABLE                                                            */
/* SETTINGS FOR FILL-IN fi_impcnt IN FRAME fr_main
   NO-ENABLE                                                            */
/* SETTINGS FOR FILL-IN fi_premsuc IN FRAME fr_main
   NO-ENABLE                                                            */
/* SETTINGS FOR FILL-IN fi_premtot IN FRAME fr_main
   NO-ENABLE ALIGN-L                                                    */
/* SETTINGS FOR FILL-IN fi_process IN FRAME fr_main
   NO-ENABLE                                                            */
/* SETTINGS FOR TEXT-LITERAL "Batch Year :"
          SIZE 12.83 BY .95 AT ROW 9.1 COL 65.83 RIGHT-ALIGNED          */

/* SETTINGS FOR TEXT-LITERAL "     Total Record :"
          SIZE 17.5 BY 1.05 AT ROW 22.24 COL 58.83 RIGHT-ALIGNED        */

/* SETTINGS FOR TEXT-LITERAL "   Total Net Premium  :"
          SIZE 21.5 BY 1.05 AT ROW 22.24 COL 95.83 RIGHT-ALIGNED        */

/* SETTINGS FOR TEXT-LITERAL "Success Record :"
          SIZE 17.5 BY 1.05 AT ROW 23.24 COL 58.83 RIGHT-ALIGNED        */

/* SETTINGS FOR TEXT-LITERAL "Success Net Premium :"
          SIZE 22.33 BY 1.05 AT ROW 23.24 COL 96 RIGHT-ALIGNED          */

IF SESSION:DISPLAY-TYPE = "GUI":U AND VALID-HANDLE(C-Win)
THEN C-Win:HIDDEN = no.

/* _RUN-TIME-ATTRIBUTES-END */
&ANALYZE-RESUME


/* Setting information for Queries and Browse Widgets fields            */

&ANALYZE-SUSPEND _QUERY-BLOCK BROWSE br_wdetail
/* Query rebuild information for BROWSE br_wdetail
     _START_FREEFORM
OPEN QUERY br_wdetail FOR EACH wdetail.
     _END_FREEFORM
     _Query            is OPENED
*/  /* BROWSE br_wdetail */
&ANALYZE-RESUME

 



/* ************************  Control Triggers  ************************ */

&Scoped-define SELF-NAME C-Win
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL C-Win C-Win
ON END-ERROR OF C-Win /* Load Text file Format Empire */
OR ENDKEY OF {&WINDOW-NAME} ANYWHERE DO:
  /* This case occurs when the user presses the "Esc" key.
     In a persistently run window, just ignore this.  If we did not, the
     application would exit. */
  IF THIS-PROCEDURE:PERSISTENT THEN RETURN NO-APPLY.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL C-Win C-Win
ON WINDOW-CLOSE OF C-Win /* Load Text file Format Empire */
DO:
  /* This event will close the window and terminate the procedure.  */
  APPLY "CLOSE":U TO THIS-PROCEDURE.
  RETURN NO-APPLY.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define BROWSE-NAME br_wdetail
&Scoped-define SELF-NAME br_wdetail
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL br_wdetail C-Win
ON ROW-DISPLAY OF br_wdetail IN FRAME fr_main
DO:
    DEF VAR z AS INTE  INIT 0.
    DEF VAR s AS INTE  INIT 0.
    s = 1.
    z = 28.
    IF WDETAIL.comment <> "" THEN DO:
        wdetail.redbook     :BGCOLOR IN BROWSE BR_WDETAIL = z NO-ERROR.
        wdetail.policyno    :BGCOLOR IN BROWSE BR_WDETAIL = z NO-ERROR.  
        wdetail.poltyp      :BGCOLOR IN BROWSE BR_WDETAIL = z NO-ERROR.  
        wdetail.appenno     :BGCOLOR IN BROWSE BR_WDETAIL = z NO-ERROR.  
        wdetail.comdat      :BGCOLOR IN BROWSE BR_WDETAIL = z NO-ERROR.  
        wdetail.expdat      :BGCOLOR IN BROWSE BR_WDETAIL = z NO-ERROR.  
        wdetail.packcod     :BGCOLOR IN BROWSE BR_WDETAIL = z NO-ERROR. 
        wdetail.covcod      :BGCOLOR IN BROWSE BR_WDETAIL = z NO-ERROR.
        wdetail.garage      :BGCOLOR IN BROWSE BR_WDETAIL = z NO-ERROR. 
        wdetail.nv_insref   :BGCOLOR IN BROWSE BR_WDETAIL = z NO-ERROR.   
        wdetail.tiname      :BGCOLOR IN BROWSE BR_WDETAIL = z NO-ERROR.   
        wdetail.insnam      :BGCOLOR IN BROWSE BR_WDETAIL = z NO-ERROR. 
        wdetail.lastname    :BGCOLOR IN BROWSE BR_WDETAIL = z NO-ERROR.
        wdetail.name2       :BGCOLOR IN BROWSE BR_WDETAIL = z NO-ERROR.      
        wdetail.name3       :BGCOLOR IN BROWSE BR_WDETAIL = z NO-ERROR.  
        wdetail.addr        :BGCOLOR IN BROWSE BR_WDETAIL = z NO-ERROR.
        wdetail.tambon      :BGCOLOR IN BROWSE BR_WDETAIL = z NO-ERROR.  
        wdetail.amper       :BGCOLOR IN BROWSE BR_WDETAIL = z NO-ERROR.   
        wdetail.country     :BGCOLOR IN BROWSE BR_WDETAIL = z NO-ERROR.  
        wdetail.post        :BGCOLOR IN BROWSE BR_WDETAIL = z NO-ERROR. 
        wdetail.comment     :BGCOLOR IN BROWSE BR_WDETAIL = z NO-ERROR.

        wdetail.redbook     :FGCOLOR IN BROWSE BR_WDETAIL = s NO-ERROR. 
        wdetail.policyno    :FGCOLOR IN BROWSE BR_WDETAIL = s NO-ERROR. 
        wdetail.poltyp      :FGCOLOR IN BROWSE BR_WDETAIL = s NO-ERROR. 
        wdetail.appenno     :FGCOLOR IN BROWSE BR_WDETAIL = s NO-ERROR. 
        wdetail.comdat      :FGCOLOR IN BROWSE BR_WDETAIL = s NO-ERROR. 
        wdetail.expdat      :FGCOLOR IN BROWSE BR_WDETAIL = s NO-ERROR. 
        wdetail.packcod     :FGCOLOR IN BROWSE BR_WDETAIL = s NO-ERROR. 
        wdetail.covcod      :FGCOLOR IN BROWSE BR_WDETAIL = s NO-ERROR. 
        wdetail.garage      :FGCOLOR IN BROWSE BR_WDETAIL = s NO-ERROR. 
        wdetail.nv_insref   :FGCOLOR IN BROWSE BR_WDETAIL = s NO-ERROR. 
        wdetail.tiname      :FGCOLOR IN BROWSE BR_WDETAIL = s NO-ERROR. 
        wdetail.insnam      :FGCOLOR IN BROWSE BR_WDETAIL = s NO-ERROR. 
        wdetail.lastname    :FGCOLOR IN BROWSE BR_WDETAIL = s NO-ERROR. 
        wdetail.name2       :FGCOLOR IN BROWSE BR_WDETAIL = s NO-ERROR. 
        wdetail.name3       :FGCOLOR IN BROWSE BR_WDETAIL = s NO-ERROR. 
        wdetail.addr        :FGCOLOR IN BROWSE BR_WDETAIL = s NO-ERROR. 
        wdetail.tambon      :FGCOLOR IN BROWSE BR_WDETAIL = s NO-ERROR. 
        wdetail.amper       :FGCOLOR IN BROWSE BR_WDETAIL = s NO-ERROR. 
        wdetail.country     :FGCOLOR IN BROWSE BR_WDETAIL = s NO-ERROR.   
        wdetail.post        :FGCOLOR IN BROWSE BR_WDETAIL = s NO-ERROR. 
        wdetail.comment     :FGCOLOR IN BROWSE BR_WDETAIL = s NO-ERROR. 
         
    END.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME buok
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL buok C-Win
ON CHOOSE OF buok IN FRAME fr_main /* OK */
DO:
    IF ra_match = 2  THEN RUN proc_runningpol.
    ELSE DO:
        ASSIGN
            fi_completecnt:FGCOLOR = 2
            fi_premsuc:FGCOLOR     = 2 
            fi_bchno:FGCOLOR       = 2
            fi_completecnt         = 0
            fi_premsuc             = 0
            fi_bchno               = ""
            fi_premtot             = 0
            fi_impcnt              = 0.
        DISP  fi_impcnt fi_completecnt fi_premtot fi_premsuc fi_impcnt fi_premtot WITH FRAME fr_main.
        /* A68-0044 
        IF ra_type = 1 AND tg_flag = NO AND DATE(TODAY) >= 06/01/2025 THEN DO:
            MESSAGE "งานป้ายแดงต้องเลือก New Tariff Calculate " VIEW-AS ALERT-BOX.
            APPLY "entry" TO tg_flag .
            RETURN NO-APPLY.
        END.
         end A68-0044 */
        IF fi_loaddat = ? THEN DO:
            MESSAGE "Load Date Is Mandatory" VIEW-AS ALERT-BOX .
            APPLY "entry" to fi_loaddat.
            RETURN NO-APPLY.
        END.
        IF fi_bchyr <= 0 THEN DO:
            MESSAGE "Batch Year Can't be 0" VIEW-AS ALERT-BOX.
            APPLY "entry" to fi_bchyr.
            RETURN NO-APPLY.
        END.
        ASSIGN fi_output1 = INPUT fi_output1
            fi_output2    = INPUT fi_output2
            fi_output3    = INPUT fi_output3
            fi_outputpro  = INPUT fi_outputpro .  /*A55-0151*/
        IF fi_output1 = "" THEN DO:
            MESSAGE "Plese Input File Data Load...!!!" VIEW-AS ALERT-BOX ERROR.
            APPLY "Entry" TO fi_output1.
            RETURN NO-APPLY.
        END.
        IF fi_output2 = "" THEN DO:
            MESSAGE "Plese Input File Data Not Load...!!!" VIEW-AS ALERT-BOX ERROR.
            APPLY "Entry" TO fi_output2.
            RETURN NO-APPLY.
        END.
        IF fi_output3 = "" THEN DO:
            MESSAGE "Plese Input Batch File Name...!!!" VIEW-AS ALERT-BOX ERROR.
            APPLY "Entry" TO fi_output3.
            RETURN NO-APPLY.
        END.
        ASSIGN
            fi_loaddat   = INPUT fi_loaddat     
            
            fi_bchyr     = INPUT fi_bchyr       fi_prevbat      = INPUT fi_prevbat
            /*fi_usrcnt    = INPUT fi_usrcnt      fi_usrprem      = INPUT fi_usrprem*/ 
            nv_imppol    = 0                    nv_impprem      = 0 
            nv_tmppolrun = 0                    nv_daily        = ""
            nv_reccnt    = 0                    nv_completecnt  = 0
            nv_netprm_t  = 0                    nv_netprm_s     = 0 
            nv_total     = 0 .

        OUTPUT TO Log_LoadMitsu.txt APPEND.
        PUT " " TODAY FORMAT "99/99/9999" ";" STRING(TIME,"HH:MM:SS") "." SUBSTR(STRING(MTIME,">>>>99999999"),10,3) 
              " start proc_assign_ex"   FORMAT "X(150)" SKIP.
        OUTPUT CLOSE.
            
        RUN proc_assign_ex.

        FOR EACH wdetail .
          IF (WDETAIL.POLTYP = "V70" OR WDETAIL.POLTYP = "V72")  THEN DO:
              ASSIGN
                  nv_reccnt      = nv_reccnt   + 1
                  nv_netprm_t    = nv_netprm_t + decimal(wdetail.premt) + DECI(wdetail.premt72).
                  /*wdetail.pass   = "Y". */
             IF wdetail.comment = "" THEN DO: 
                 ASSIGN nv_total = nv_total + 1 
                        wdetail.pass   = "Y".
             END.
             ELSE wdetail.pass = "N" .
          END.
        END.

        OUTPUT TO Log_LoadMitsu.txt APPEND.
        PUT " " TODAY FORMAT "99/99/9999" ";" STRING(TIME,"HH:MM:SS") "." SUBSTR(STRING(MTIME,">>>>99999999"),10,3) 
              " end proc_assign_ex"   FORMAT "X(150)" SKIP.
        OUTPUT CLOSE.

        IF  nv_reccnt = 0 THEN DO: 
            MESSAGE "No Record Can Gen " VIEW-AS ALERT-BOX.       
            RETURN NO-APPLY.
        END.
        IF nv_total <> nv_reccnt THEN DO:
             MESSAGE "Has Record Error Not Gen Data " VIEW-AS ALERT-BOX. 
             RUN proc_report1 .
             ASSIGN fi_output1    = ""
                    fi_output3    = ""
                    fi_outputpro  = "" . 
             DISP fi_output1    fi_output3  fi_outputpro WITH FRAME fr_main.
             RETURN NO-APPLY.
        END.

        nv_imppol   = nv_total    .
        nv_impprem  = nv_netprm_t .
         
        ASSIGN nv_batchyr = INPUT fi_bchyr.
        IF nv_batprev = "" THEN DO:  
            FIND LAST sic_bran.uzm700 USE-INDEX uzm70001 WHERE 
                uzm700.bchyr   = nv_batchyr          AND
                uzm700.branch  = "EM"     AND
                uzm700.acno    = "EMP" + STRING(nv_batchyr,"9999") NO-LOCK NO-ERROR .
            IF AVAIL sic_bran.uzm700 THEN DO:   
                nv_batrunno = uzm700.runno.
                FIND LAST sic_bran.uzm701 USE-INDEX uzm70102      WHERE
                    uzm701.bchyr   = nv_batchyr          AND
                    uzm701.bchno   = "EMP" + STRING(nv_batchyr,"9999") + "EM" + string(nv_batrunno,"99999")  NO-LOCK NO-ERROR.
                IF AVAIL sic_bran.uzm701 THEN DO:
                    nv_batcnt = uzm701.bchcnt .
                    nv_batrunno = nv_batrunno + 1.
                END.
            END.
            ELSE DO:  
                ASSIGN
                    nv_batcnt = 1
                    nv_batrunno = 1.
            END.
            nv_batchno = "EMP" + STRING(nv_batchyr,"9999") + "EM" + STRING(nv_batrunno,"99999").
        END.
        ELSE DO:  
            nv_batprev = INPUT fi_prevbat.
            FIND LAST sic_bran.uzm701 USE-INDEX uzm70102 
                WHERE uzm701.bchyr   = nv_batchyr       AND 
                      uzm701.bchno = CAPS(nv_batprev)   NO-LOCK NO-ERROR NO-WAIT.
            IF NOT AVAIL sic_bran.uzm701 THEN DO:
                MESSAGE "Not found Batch File Master : " + CAPS (nv_batprev)
                    + " on file uzm701" .
                APPLY "entry" TO fi_prevbat.
                RETURN NO-APPLY.
            END.
            IF AVAIL sic_bran.uzm701 THEN DO:
                nv_batcnt  = uzm701.bchcnt + 1.
                nv_batchno = CAPS(TRIM(nv_batprev)).
            END.
        END.
        RUN wgw\wgwbatch.p    (INPUT            fi_loaddat ,     /* DATE  */
                               INPUT            nv_batchyr ,     /* INT   */
                               INPUT            "EMP" + STRING(nv_batchyr,"9999") ,     /* CHAR  */ 
                               INPUT            "EM"     ,     /* CHAR  */
                               INPUT            fi_prevbat ,     /* CHAR  */ /*Previous Batch*/
                               INPUT            "WGWloadem" ,     /* CHAR  */
                               INPUT-OUTPUT     nv_batchno ,     /* CHAR  */
                               INPUT-OUTPUT     nv_batcnt  ,     /* INT   */
                               INPUT            nv_imppol  ,     /* INT   */
                               INPUT            nv_impprem       /* DECI  */
                               ).
        ASSIGN fi_bchno = CAPS(nv_batchno + "." + STRING(nv_batcnt,"99")).
        DISP  fi_bchno   WITH FRAME fr_main.

        OUTPUT TO Log_LoadMitsu.txt APPEND.
        PUT " " TODAY FORMAT "99/99/9999" ";" STRING(TIME,"HH:MM:SS") "." SUBSTR(STRING(MTIME,">>>>99999999"),10,3) 
              " start create data "   FORMAT "X(150)" SKIP.
        OUTPUT CLOSE.

        RUN proc_chktest1.  

        OUTPUT TO Log_LoadMitsu.txt APPEND.
        PUT " " TODAY FORMAT "99/99/9999" ";" STRING(TIME,"HH:MM:SS") "." SUBSTR(STRING(MTIME,">>>>99999999"),10,3) 
              " end create data "   FORMAT "X(150)" SKIP.
        OUTPUT CLOSE.

        FOR EACH wdetail WHERE wdetail.pass = "y" : 
            ASSIGN
            nv_completecnt = nv_completecnt + 1
            nv_netprm_s    = nv_netprm_s    + decimal(wdetail.premt) + DECI(wdetail.premt72).
        END.
        nv_rectot = nv_reccnt.      
        nv_recsuc = nv_completecnt. 
        IF  nv_rectot <> nv_recsuc   THEN DO:
            nv_batflg = NO.
        END.
        ELSE 
        IF nv_netprm_t <> nv_netprm_s THEN DO:
            nv_batflg = NO.
        END.
        ELSE 
            nv_batflg = YES.
        FIND LAST sic_bran.uzm701 USE-INDEX uzm70102  
            WHERE uzm701.bchyr = nv_batchyr AND
                  uzm701.bchno = nv_batchno AND
                  uzm701.bchcnt  = nv_batcnt NO-ERROR.
        IF AVAIL sic_bran.uzm701 THEN DO:
            ASSIGN
              uzm701.recsuc      = nv_recsuc     
              uzm701.premsuc     = nv_netprm_s   
              uzm701.rectot      = nv_rectot     
              uzm701.premtot     = nv_netprm_t   
              uzm701.impflg      = nv_batflg    
              uzm701.cnfflg      = nv_batflg .   
        END.  
        ASSIGN
        fi_impcnt      = nv_rectot
        fi_premtot     = nv_netprm_t
        fi_completecnt = nv_recsuc
        fi_premsuc     = nv_netprm_s .
        IF nv_rectot <> nv_recsuc  THEN nv_txtmsg = " have record error..!! ".
        ELSE nv_txtmsg = "      have batch file error..!! ".
        RELEASE sic_bran.uzm700.
        RELEASE sic_bran.uzm701.
        RELEASE sic_bran.uwm100.
        RELEASE sic_bran.uwm120.
        RELEASE sic_bran.uwm130.
        RELEASE sic_bran.uwm301.
        RELEASE brstat.detaitem.
        RELEASE sicsyac.xzm056.
        RELEASE sicsyac.xmm600.
        RELEASE sicsyac.xtm600.

        IF CONNECTED("sic_exp") THEN DISCONNECT sic_exp.  
        RUN   proc_open.    
        IF nv_batflg = NO THEN DO:  
            ASSIGN
                fi_completecnt:FGCOLOR = 6
                fi_premsuc    :FGCOLOR = 6 
                fi_bchno      :FGCOLOR = 6. 
        END.
        ELSE IF nv_batflg = YES THEN DO: 
            ASSIGN
                fi_completecnt:FGCOLOR = 2
                fi_premsuc:FGCOLOR     = 2 
                fi_bchno:FGCOLOR       = 2.
           
        END.
        DISP  fi_impcnt fi_completecnt fi_premtot fi_premsuc WITH FRAME fr_main.
        RUN proc_report1 .   
        RUN PROC_REPORT2 .
        RUN PROC_REPORT3 .   /*add A55-0151 */
        RUN proc_screen  . 
        OUTPUT TO Log_LoadMitsu.txt APPEND.
        PUT " " TODAY FORMAT "99/99/9999" ";" STRING(TIME,"HH:MM:SS") "." SUBSTR(STRING(MTIME,">>>>99999999"),10,3) 
              " end loop "   FORMAT "X(150)" SKIP.
        OUTPUT CLOSE.

        IF nv_batflg = YES THEN DO:
            MESSAGE "Process Complete" VIEW-AS ALERT-BOX INFORMATION TITLE "INFORMATION".
            ASSIGN fi_process = "Import Text file Process Complete."  .
                    DISP fi_process WITH FRAM fr_main.
        END.
        ELSE DO:
            ASSIGN fi_process = "Process data file....error !!!!"  .
            DISP fi_process fi_completecnt fi_premsuc WITH FRAME fr_main.
            MESSAGE "Batch Year  : " STRING(nv_batchyr)     SKIP
                    "Batch No.   : " nv_batchno             SKIP
                    "Batch Count : " STRING(nv_batcnt,"99") SKIP(1)
                    TRIM(nv_txtmsg)                         SKIP
                    "Please check Data again."      
            VIEW-AS ALERT-BOX ERROR TITLE "WARNING MESSAGE".  
        END.
    END.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME bu_exit
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL bu_exit C-Win
ON CHOOSE OF bu_exit IN FRAME fr_main /* EXIT */
DO:
  IF CONNECTED("sic_exp") THEN DISCONNECT sic_exp. 
  APPLY "close" TO THIS-PROCEDURE.
      RETURN NO-APPLY.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME bu_file
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL bu_file C-Win
ON CHOOSE OF bu_file IN FRAME fr_main /* .... */
DO:
    DEFINE VARIABLE cvData     AS CHARACTER NO-UNDO.
    DEFINE VARIABLE OKpressed  AS LOGICAL INITIAL TRUE.
    DEF VAR no_add AS CHAR FORMAT "x(8)" .    /*08/11/2006*/

 
   SYSTEM-DIALOG GET-FILE cvData
   TITLE      "Choose Data File to Import ..."
   FILTERS    "CSV (Comma Delimited)"   "*.csv",
              "Text Files (*.txt)" "*.txt"
                     /*  "Data Files (*.dat)"     "*.dat",*/
               /*"Text Files (*.txt)" "*.txt"*/             /*A58-0198*/
   MUST-EXIST
   USE-FILENAME
   UPDATE OKpressed.
    
   
    IF OKpressed = TRUE THEN DO:
         /***--- 08/11/2006 ---***/
         no_add =           STRING(MONTH(TODAY),"99")    + 
                            STRING(DAY(TODAY),"99")      + 
                  SUBSTRING(STRING(TIME,"HH:MM:SS"),1,2) + 
                  SUBSTRING(STRING(TIME,"HH:MM:SS"),4,2) .

         /***---a490166 ---***/
         IF ra_match = 1 THEN DO:
         ASSIGN
            fi_filename  = cvData
            fi_output1   = SUBSTRING(cvData,1,(LENGTH(fi_filename) - 4))  /* + "_SUCCESS" */ + no_add + ".fuw"   /*.csv*/
            fi_output2   = SUBSTRING(cvData,1,(LENGTH(fi_filename) - 4))  /* + "_ERROR"   */ + no_add + ".err"
            fi_output3   = SUBSTRING(cvData,1,(LENGTH(fi_filename) - 4))  /* + "_SCREEN"  */ + no_add + ".sce"   /*txt*/
            fi_outputpro = SUBSTRING(cvData,1,(LENGTH(fi_filename) - 4))  /* + "_SUCCESS" */ + no_add + ".slk" .  /*.csv*//*A55-0151*/
         END.
         ELSE DO: 
             ASSIGN
             fi_filename  = cvData
             fi_output1   = SUBSTRING(cvData,1,(LENGTH(fi_filename) - 4)) + "_Polno" + no_add + ".CSV"   /*.csv*/
             fi_output2   = "" 
             fi_output3   = "" 
             fi_outputpro = "" .
         END.
         DISP fi_filename fi_output1 fi_output2 fi_output3 fi_outputpro  WITH FRAME {&FRAME-NAME}. 
         APPLY "Entry" TO fi_output3.
         RETURN NO-APPLY.
    END.

    

END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME fi_bchyr
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL fi_bchyr C-Win
ON LEAVE OF fi_bchyr IN FRAME fr_main
DO:
        nv_batchyr = INPUT fi_bchyr.
        IF nv_batchyr <= 0 THEN DO:
           MESSAGE "Batch Year Error...!!!".
           APPLY "entry" TO fi_bchyr.
           RETURN NO-APPLY.
        END.

END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME fi_loaddat
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL fi_loaddat C-Win
ON LEAVE OF fi_loaddat IN FRAME fr_main
DO:
    fi_loaddat  =  Input  fi_loaddat.
    Disp  fi_loaddat  with  frame  fr_main.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME fi_pack
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL fi_pack C-Win
ON LEAVE OF fi_pack IN FRAME fr_main
DO:
    fi_pack  =  Input  fi_pack.
    Disp  fi_pack  with  frame  fr_main.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME fi_prevbat
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL fi_prevbat C-Win
ON LEAVE OF fi_prevbat IN FRAME fr_main
DO:
    fi_prevbat = caps(INPUT fi_prevbat).
    nv_batprev = fi_prevbat.
    IF nv_batprev <> " "  THEN DO:
        IF LENGTH(nv_batprev) <> 13 THEN DO:
             MESSAGE "Length Of Batch no. Must Be 13 Character " SKIP
                     "Please Check Batch No. Again             " view-as alert-box.
             APPLY "entry" TO fi_prevbat.
             RETURN NO-APPLY.
        END.
    END. /*nv_batprev <> " "*/
    
    DISPLAY fi_prevbat WITH FRAME fr_main.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME ra_match
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL ra_match C-Win
ON VALUE-CHANGED OF ra_match IN FRAME fr_main
DO:
    ra_match = INPUT ra_match .
    DISP ra_match WITH FRAME fr_main.
    IF ra_match = 2  THEN DO:
        DISABLE fi_loaddat fi_pack fi_bchyr WITH FRAME fr_main.
    END.
    ELSE DO:
        ENABLE fi_loaddat  fi_pack fi_bchyr WITH FRAME fr_main.
    END.
    DISP fi_loaddat fi_pack fi_process ra_type ra_poltyp fi_bchyr  WITH FRAME fr_main. 
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME ra_poltyp
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL ra_poltyp C-Win
ON VALUE-CHANGED OF ra_poltyp IN FRAME fr_main
DO:
    ra_poltyp = INPUT ra_poltyp .
    DISP ra_poltyp WITH FRAME fr_main.
  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME ra_type
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL ra_type C-Win
ON VALUE-CHANGED OF ra_type IN FRAME fr_main
DO:
    ra_type = INPUT ra_type .
    DISP ra_type WITH FRAME fr_main.


    IF ra_type = 2  THEN DO:
       IF TODAY < 01/01/2026 THEN ASSIGN tg_flag = NO.
       ELSE ASSIGN tg_flag = YES.
    END.
    ELSE ASSIGN tg_flag = YES.
    DISP tg_flag WITH FRAME fr_main.
  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&Scoped-define SELF-NAME tg_flag
&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CONTROL tg_flag C-Win
ON VALUE-CHANGED OF tg_flag IN FRAME fr_main
DO:
    tg_flag = INPUT tg_flag .
    DISP tg_flag WITH FRAME fr_main.
  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


&UNDEFINE SELF-NAME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _CUSTOM _MAIN-BLOCK C-Win 


/* ***************************  Main Block  *************************** */
/* Set CURRENT-WINDOW: this will parent dialog-boxes and frames.        */
ASSIGN CURRENT-WINDOW                = {&WINDOW-NAME} 
       THIS-PROCEDURE:CURRENT-WINDOW = {&WINDOW-NAME}.

/* The CLOSE event can be used from inside or outside the procedure to  */
/* terminate it.                                                        */
ON CLOSE OF THIS-PROCEDURE 
   RUN disable_UI.
/* (NOTE: handle ERROR and END-KEY so cleanup code will always fire.    */
MAIN-BLOCK:
DO ON ERROR   UNDO MAIN-BLOCK, LEAVE MAIN-BLOCK
    ON END-KEY UNDO MAIN-BLOCK, LEAVE MAIN-BLOCK:
    RUN enable_UI.
/********************  T I T L E   F O R  C - W I N  ****************/
DEF  VAR  gv_prgid   AS   CHAR  FORMAT "X(8)"   NO-UNDO.
DEF  VAR  gv_prog    AS   CHAR  FORMAT "X(40)" NO-UNDO.
ASSIGN 
    gv_prgid    = "Wgwloadem"
    gv_prog     = "Load Text & Generate Data" .
    
RUN  WUT\WUTHEAD (c-win:handle,gv_prgid,gv_prog).  /*28/11/2006*/
ASSIGN
    fi_pack     = "T" 
    fi_bchyr    = YEAR(TODAY)
    ra_match    = 1
    ra_type     = 1 
    ra_poltyp   = 1 
    fi_loaddat  = TODAY
    tg_flag     = YES  /*A68-0044*/
    fi_process  = "Load Text file ..." .
   DISP fi_loaddat fi_pack fi_process ra_type ra_poltyp fi_bchyr tg_flag  WITH FRAME fr_main.
/*********************************************************************/  
    RUN  WUT\WUTWICEN (c-win:handle).  
    Session:data-Entry-Return = Yes.
    IF NOT THIS-PROCEDURE:PERSISTENT THEN
        WAIT-FOR CLOSE OF THIS-PROCEDURE.
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME


/* **********************  Internal Procedures  *********************** */

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE 00-proc_assigndata C-Win 
PROCEDURE 00-proc_assigndata :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
/* Comment by :A67-0029..
DO:
INPUT FROM VALUE(fi_FileName).
    REPEAT:
    IMPORT DELIMITER "|" 
        wf_riskno    /* risk no */  /*--A64-0355--*/
        wf_num       /*ItemNo                     */                  
        wf_policyno  /*Policy No (เลขที่กรมธรรม์ภาคสมัครใจ)     */      
        wf_n_branch  /*Branch (สาขา)              */      
        wf_agent     /*Agent Code (รหัสตัวแทน)    */      
        wf_producer  /*Producer Code              */      
        wf_n_delercode /*Dealer Code (รหัสดีเลอร์)  */      
        wf_fincode   /*Finance Code (รหัสไฟแนนซ์) */      
        wf_appenno   /*Notification Number (เลขที่รับแจ้ง)*/      
        wf_salename  /*Notification Name (ชื่อผู้แจ้ง)    */      
        wf_srate     /*Short Rate                 */      
        wf_comdat    /*Effective Date (วันที่เริ่มความคุ้มครอง) */      
        wf_expdat    /*Expiry Date (วันที่สิ้นสุดความคุ้มครอง)  */      
        wf_agreedat  /*Agree Date    */      
        wf_firstdat  /*First Date    */      
        wf_packcod   /*รหัส Package  */          
        wf_camp_no   /*Campaign Code (รหัสแคมเปญ) */      
        wf_campen    /*Campaign Text */      
        wf_specon    /*Spec Con      */      
        wf_product   /*Product Type  */      
        wf_promo     /*Promotion Code*/      
        wf_rencnt    /*Renew Count   */      
        wf_prepol    /*Previous Policy (เลขทีกรมธรรม์ภาคสมัครใจเดิม)*/  
        wf_txt1      /*Policy Text 1  */                                
        wf_txt2      /*Policy Text 2  */                                
        wf_txt3      /*Policy Text 3  */                                
        wf_txt4      /*Policy Text 4  */                                
        wf_txt5      /*Policy Text 5  */                                
        wf_txt6      /*Policy Text 6  */                                
        wf_txt7      /*Policy Text 7  */                                
        wf_txt8      /*Policy Text 8  */                                
        wf_txt9      /*Policy Text 9  */                                
        wf_txt10     /*Policy Text 10 */                                
        wf_memo1     /*Memo Text 1    */                                
        wf_memo2     /*Memo Text 2    */                                
        wf_memo3     /*Memo Text 3    */                                
        wf_memo4     /*Memo Text 4    */                                
        wf_memo5     /*Memo Text 5    */                                
        wf_memo6     /*Memo Text 6    */                                
        wf_memo7     /*Memo Text 7    */                                
        wf_memo8     /*Memo Text 8    */                                
        wf_memo9     /*Memo Text 9    */                                
        wf_memo10    /*Memo Text 10   */                                
        wf_accdata1  /*Accessory Text 1 */                              
        wf_accdata2  /*Accessory Text 2 */                              
        wf_accdata3  /*Accessory Text 3 */                              
        wf_accdata4  /*Accessory Text 4 */                                  
        wf_accdata5  /*Accessory Text 5 */                                  
        wf_accdata6  /*Accessory Text 6 */                                  
        wf_accdata7  /*Accessory Text 7 */                                  
        wf_accdata8  /*Accessory Text 8 */                                  
        wf_accdata9  /*Accessory Text 9 */                                  
        wf_accdata10 /*Accessory Text 10*/                                  
        wf_compul   /*กรมธรรม์ซื้อควบ (Y/N)  */ 
        wf_insref   /* insured code */ /* A64-0355 */
        wf_instyp   /*ประเภทบุคคล            */                            
        wf_inslang  /*ภาษาที่ใช้สร้าง Cilent Code */         
        wf_tiname   /*คำนำหน้า   */         
        wf_insnam   /*ชื่อ       */         
        wf_lastname /*นามสกุล    */                            
        wf_icno     /*เลขที่บัตรประชาชน / เลขที่นิติบุคคล*/         
        wf_insbr    /*ลำดับที่สาขา      */                            
        wf_occup    /*อาชีพ             */                            
        wf_addr     /*ที่อยู่บรรทัดที่ 1*/                            
        wf_tambon   /*ที่อยู่บรรทัดที่ 2*/                            
        wf_amper    /*ที่อยู่บรรทัดที่ 3*/                            
        wf_country  /*ที่อยู่บรรทัดที่ 4*/                            
        wf_post     /*รหัสไปรษณีย์      */                            
        wf_provcod  /*province code     */                            
        wf_distcod  /*district code     */                            
        wf_sdistcod /*sub district code */   
        wf_ae       /* ae  new Xmm600 งาน Japanes */  /*A64-0355*/
        wf_jtl      /* jtl new Xmm600 งาน Japanes */  /*A64-0355*/
        wf_ts       /* ts  new Xmm600 งาน Japanes */  /*A64-0355*/
        wf_gender   /*Gender (Male/Female/Other) */         
        wf_tele1    /*Telephone 1*/                            
        wf_tele2    /*Telephone 2*/                            
        wf_mail1    /*E-Mail 1   */                            
        wf_mail2    /*E-Mail 2   */                            
        wf_mail3    /*E-Mail 3   */                            
        wf_mail4    /*E-Mail 4   */                            
        wf_mail5    /*E-Mail 5   */                            
        wf_mail6    /*E-Mail 6   */                            
        wf_mail7    /*E-Mail 7   */                            
        wf_mail8    /*E-Mail 8   */                            
        wf_mail9    /*E-Mail 9   */                            
        wf_mail10   /*E-Mail 10  */                            
        wf_fax      /*Fax      */                            
        wf_lineID   /*Line ID  */                            
        wf_name2    /*CareOf1  */                            
        wf_name3    /*CareOf2  */                            
        wf_benname  /*Benefit Name*/                            
        wf_payercod /*Payer Code  */                            
        wf_vatcode  /*VAT Code    */                            
        wf_instcod1 /*Client Code */                            
        wf_insttyp1 /*ประเภทบุคคล */                            
        wf_insttitle1 /*คำนำหน้า    */                            
        wf_instname1  /*ชื่อ        */                            
        wf_instlname1 /*นามสกุล     */                            
        wf_instic1    /*เลขที่บัตรประชาชน / เลขที่นิติบุคคล       */         
        wf_instbr1    /*ลำดับที่สาขา       */                           
        wf_instaddr11 /*ที่อยู่บรรทัดที่ 1 */                 
        wf_instaddr21 /*ที่อยู่บรรทัดที่ 2 */                 
        wf_instaddr31 /*ที่อยู่บรรทัดที่ 3 */                 
        wf_instaddr41 /*ที่อยู่บรรทัดที่ 4 */                 
        wf_instpost1  /* รหัสไปรษณีย์      */                 
        wf_instprovcod1  /*province code      */                 
        wf_instdistcod1  /*district code      */                 
        wf_instsdistcod1 /*sub district code  */                 
        wf_instprm1       /*เบี้ยก่อนภาษีอากร  */                 
        wf_instrstp1      /*อากร         */                 
        wf_instrtax1      /*ภาษี         */                 
        wf_instcomm01     /*คอมมิชชั่น 1 */                 
        wf_instcomm12     /*คอมมิชชั่น 2 (co-broker) */           
        wf_instcod2       /*Client Code  */                 
        wf_insttyp2       /*ประเภทบุคคล  */                 
        wf_insttitle2     /*คำนำหน้า     */                 
        wf_instname2      /*ชื่อ         */                 
        wf_instlname2     /*นามสกุล      */                 
        wf_instic2        /*เลขที่บัตรประชาชน / เลขที่นิติบุคคล*/     
        wf_instbr2        /*ลำดับที่สาขา      */                 
        wf_instaddr12     /*ที่อยู่บรรทัดที่ 1*/                 
        wf_instaddr22     /*ที่อยู่บรรทัดที่ 2*/                 
        wf_instaddr32     /*ที่อยู่บรรทัดที่ 3*/                 
        wf_instaddr42     /*ที่อยู่บรรทัดที่ 4*/                 
        wf_instpost2      /*รหัสไปรษณีย์      */                 
        wf_instprovcod2  /*province code     */                 
        wf_instdistcod2  /*district code     */                 
        wf_instsdistcod2 /*sub district code */                 
        wf_instprm2       /*เบี้ยก่อนภาษีอากร */                 
        wf_instrstp2      /*อากร              */                 
        wf_instrtax2      /*ภาษี              */                 
        wf_instcomm02     /*คอมมิชชั่น 1      */                 
        wf_instcomm22     /*คอมมิชชั่น 2 (co-broker)     */           
        wf_instcod3       /*Client Code       */                 
        wf_insttyp3       /*ประเภทบุคคล       */                 
        wf_insttitle3     /*คำนำหน้า          */                 
        wf_instname3      /*ชื่อ              */                 
        wf_instlname3     /*นามสกุล           */                 
        wf_instic3        /*เลขที่บัตรประชาชน/เลขที่นิติบุคคล  */   
        wf_instbr3        /*ลำดับที่สาขา      */                
        wf_instaddr13     /*ที่อยู่บรรทัดที่ 1*/                
        wf_instaddr23     /*ที่อยู่บรรทัดที่ 2*/                
        wf_instaddr33     /*ที่อยู่บรรทัดที่ 3*/                
        wf_instaddr43     /*ที่อยู่บรรทัดที่ 4*/                
        wf_instpost3      /*รหัสไปรษณีย์      */                
        wf_instprovcod3  /*province code     */                
        wf_instdistcod3  /*district code     */                
        wf_instsdistcod3 /*sub district code */                
        wf_instprm3     /*เบี้ยก่อนภาษีอากร*/                
        wf_instrstp3    /*อากร             */                
        wf_instrtax3    /*ภาษี             */                
        wf_instcomm03   /*คอมมิชชั่น 1     */          
        wf_instcomm23   /*คอมมิชชั่น 2 (co-broker)          */
        wf_covcod       /*Cover Type (ประเภทความคุ้มครอง)   */
        wf_garage      /*Garage (ประเภทการซ่อม ซ่อมอู่/ซ่อมห้าง)  */
        wf_special     /*Spacial EquipmentFlag(A/Blank)*/       
        wf_inspec      /*Inspection       */                
        wf_class70     /*รหัสรถภาคสมัครใจ (110/120/)   */ 
        wf_vehuse      /* A64-0355 : vehuse 15/12/2021 */
        wf_redbook     /*A65-0079*/
        wf_brand       /*ยี่ห้อรถ         */                
        wf_model       /*ชื่อรุ่นรถ       */                
        wf_submodel     /*ชื่อรุ่นย่อยรถ   */                
        wf_caryear     /*ปีรุ่นรถ         */                
        wf_chasno      /*หมายเลขตัวถัง    */                
        wf_eng         /*หมายเลขเครื่อง   */ 
        wf_eng_no2     /*หมายเลขเครื่อง 2 */ /*A67-0029*/
        wf_seat        /*จำนวนที่นั่ง (รวมผู้ขับขี่)    */       
        wf_engcc       /*ปริมาตรกระบอกสูบ (CC) */                
        wf_weight      /*น้ำหนัก (ตัน)    */ 
        wf_watt        /*Kilowatt         */ 
        wf_body        /*รหัสแบบตัวถัง    */ 
        wf_type        /*ป้ายแดง (Y/N)    */ 
        wf_re_year     /*ปีที่จดทะเบียน   */ 
        wf_vehreg      /*เลขทะเบียนรถ     */ 
        wf_re_country  /*จังหวัดที่จดทะเบียน*/ 
        wf_cargrp       /*Group Car (กลุ่มรถ)*/ 
        wf_colorcar     /*Color (สี)        */ 
        wf_fule         /*Fule (เชื้อเพลิง) */ 
        wf_drivnam      /*Driver Number     */
        wf_ntitle1      /*คำนำหน้า          */ 
        wf_drivername1 /*ชื่อ              */ 
        wf_dname2       /*นามสกุล           */  
        wf_dicno        /*เลขที่บัตรประชาชน */  
        wf_dgender1     /*เพศ               */  
        wf_dbirth       /*วันเกิด           */  
        wf_docoup       /*ชื่ออาชีพ         */  
        wf_ddriveno     /*เลขที่ใบอนุญาตขับขี่  */ 
        wf_drivexp1     /*วันที่ใบอนุญาต หมดอายุ */  /*A67-0029*/
        wf_dlevel1      /*ระดับพฤติกรรมการขับขี่ */  /*A67-0029*/
        wf_ntitle2      /*คำนำหน้า          */  
        wf_drivername2 /*ชื่อ              */  
        wf_ddname1      /*นามสกุล           */  
        wf_ddicno       /*เลขที่บัตรประชาชน */  
        wf_dgender2     /*เพศ               */  
        wf_ddbirth      /*วันเกิด           */  
        wf_ddocoup      /*ชื่ออาชีพ         */  
        wf_dddriveno     /*เลขที่ใบอนุญาตขับขี่  */ 
        wf_baseplus     /*Base Premium Plus */  
        wf_maksi        /* ทุนประกันรถ EV */ /*A67-0029*/
        wf_siplus       /*Sum Insured Plus  */  
        wf_rs10         /*RS10 Amount       */  
        wf_comper       /*TPBI / person     */  
        wf_comacc       /*TPBI / occurrence */  
        wf_deductpd     /*TPPD              */  
        wf_DOD          /*Deduct / OD       */  
        wf_DPD          /*Deduct / PD       */  
        wf_tpfire       /*Theft & Fire      */  
        wf_NO_41        /*PA1.1 / driver    */  
        wf_ac2          /*PA1.1 no.of passenger */  
        wf_ac4          /*PA1.1 / passenger */  
        wf_ac5          /*PA1.2 / driver    */  
        wf_ac6          /*PA1.2 no.of passenger */  
        wf_ac7          /*PA1.2 / passenger*/  
        wf_NO_42        /*PA2          */  
        wf_NO_43        /*PA3          */  
        wf_base         /*Base Premium */  
        wf_unname       /*Unname       */  
        wf_nname        /*Name         */  
        wf_tpbi         /*TPBI Amount  */  
        wf_tppd         /*TPPD Amount  */  
        wf_ry01         /*RY01 Amount  */  
        wf_ry02         /*RY02 Amount  */  
        wf_ry03         /*RY03 Amount  */  
        wf_fleet        /*Fleet%       */  
        wf_ncb          /*NCB%         */  
        wf_claim        /*Load Claim%  */  
        wf_dspc         /*Other Disc.% */  
        wf_cctv         /*CCTV%        */  
        wf_dstf         /*Walkin Disc.%*/  
        wf_fleetprem    /*Fleet Amount */  
        wf_ncbprem      /*NCB Amount   */  
        wf_clprem       /*Load Claim Amount*/  
        wf_dspcprem     /*Other Disc. Amount */ 
        wf_cctvprem     /*CCTV Amount  */  
        wf_dstfprem     /*Walk in Disc.Amount */ 
        wf_premt        /*เบี้ยสุทธิ   */  
        wf_rstp_t       /*Stamp Duty   */  
        wf_rtax_t       /*VAT          */  
        wf_comper70     /*Commission % */  
        wf_comprem70    /*Commission Amount*/  
        wf_agco70       /*Agent Code co-broker (รหัสตัวแทน)*/      
        wf_comco_per70     /*Commission % co-broker*/              
        wf_comco_prem70    /*Commission Amount co-broker*/         
        wf_dgpackge     /*Package (Attach Coverage)  */         
        wf_danger1      /*Dangerous Object 1    */              
        wf_danger2      /*Dangerous Object 2    */              
        wf_dgsi         /*Sum Insured           */              
        wf_dgrate       /*Rate%                 */              
        wf_dgfeet       /*Fleet%                */              
        wf_dgncb        /*NCB%                  */              
        wf_dgdisc       /*Discount%             */            
        wf_dgwdisc      /*Walkin Discount%        */          
        wf_dgatt        /*Premium Attach Coverage */            
        wf_dgfeetprm    /*Discount Fleet        */              
        wf_dgncbprm     /*Discount NCB          */              
        wf_dgdiscprm    /*Other Discount        */ 
        wf_dgWdiscprm      /*walkin Discount        */ 
        wf_dgprem       /*Net Premium           */              
        wf_dgrstp_t     /*Stamp Duty            */              
        wf_dgrtax_t     /*VAT                   */              
        wf_dgcomper     /*Commission %          */              
        wf_dgcomprem    /*Commission Amount     */                                                   
        wf_cltxt        /*Claim Text            */                           
        wf_clamount     /*Claim Amount          */                           
        wf_faultno      /*Claim Count Fault     */                           
        wf_faultprm     /*Claim Count Fault Amount   */                      
        wf_goodno       /*Claim Count Good           */                      
        wf_goodprm      /*Claim Count Good Amount    */                      
        wf_loss         /*Loss Ratio % (Not TP)      */                      
        wf_compolusory     /*Compulsory Policy Number (เลขที่กรมธรรม์ พรบ.)*/   
        wf_barcode  /*Barcode No.                    */                  
        wf_class72  /*Compulsory Class (รหัส พรบ.)   */                  
        wf_dstf72   /*Compulsory Walk In Discount %  */                  
        wf_dstfprem72      /*Compulsory Walk In Discount Amount      */         
        wf_premt72  /*เบี้ยสุทธิ พ.ร.บ. กรณี "กรมธรรม์ซื้อควบ"*/       
        wf_rstp_t72 /*Stamp Duty            */                         
        wf_rtax_t72 /*VAT                   */                         
        wf_comper72 /*Commission %          */                         
        wf_comprem72     /*Commission Amount     */
        
   
        IF TRIM(wf_num) = ""           THEN RUN proc_initdataex.
        ELSE IF index(TRIM(wf_num),"no")     <> 0 THEN RUN proc_initdataex.
        ELSE IF index(TRIM(wf_num),"เลขที่") <> 0 THEN RUN proc_initdataex.
        ELSE IF index(TRIM(wf_num),"item")   <> 0 THEN RUN proc_initdataex.
        ELSE DO:
            IF ra_match = 2 THEN RUN proc_runningpol_2 .
            ELSE DO:
                        IF      ra_poltyp = 1 THEN RUN proc_assigninit70.
                ELSE IF ra_poltyp = 2 THEN RUN proc_assigninit72.
                ELSE DO:
                    IF wf_compul = "Y"  THEN DO:
                        RUN proc_assigninit70.
                        RUN proc_assigninit72.
                    END.
                    ELSE RUN proc_assigninit70.
                END.
            END.
            RUN proc_initdataex.
        END.
    END.         /* repeat   */
END.*/
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE 00-proc_assigninit70 C-Win 
PROCEDURE 00-proc_assigninit70 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
/*DO:
    ASSIGN fi_process = "Create data text file " + wf_chasno + " to wdetail ....." .
    DISP fi_process WITH FRAM fr_main.
    CREATE wdetail.
    CREATE wtxt.
    CREATE wmemo.
    CREATE wacces.
    CREATE winst.
    ASSIGN
        wdetail.riskno        =  trim(wf_riskno)  /* A64-0355*/
        wdetail.itemno        =  trim(wf_num)
        /*wdetail.policyno      =  " " /*trim(wf_policyno) */ */ /*A64-0355*/   
        wdetail.policyno      =  trim(wf_policyno)  /*A64-0355*/  
        wdetail.n_branch      =  trim(wf_n_branch)        
        wdetail.agent         =  trim(wf_agent)           
        wdetail.producer      =  trim(wf_producer)        
        wdetail.n_delercode   =  trim(wf_n_delercode)   
        wdetail.fincode       =  trim(wf_fincode)   
        wdetail.appenno       =  trim(wf_appenno)   
        wdetail.salename      =  trim(wf_salename)   
        wdetail.srate         =  trim(wf_srate ) 
        wdetail.comdat        =  date(wf_comdat)                                        
        wdetail.expdat        =  date(wf_expdat)                                        
        wdetail.agreedat      =  if trim(wf_agreedat) = "" and wdetail.prepol = "" then date(wf_comdat) else if trim(wf_agreedat) <> "" then date(wf_agreedat)  ELSE ? 
        wdetail.firstdat      =  if trim(wf_firstdat) = "" and wdetail.prepol = "" then date(wf_comdat) else if trim(wf_firstdat) <> "" then date(wf_firstdat)  ELSE ? 
        wdetail.packcod       =  trim(wf_packcod)   
        wdetail.camp_no       =  trim(wf_camp_no)   
        wdetail.campen        =  trim(wf_campen) 
        wdetail.specon        =  trim(wf_specon) 
        wdetail.product       =  trim(wf_product )   
        wdetail.promo         =  trim(wf_promo )   
        wdetail.rencnt        =  TRIM(wf_rencnt)   
        wdetail.prepol        =  trim(wf_prepol)
        wdetail.compul        =  trim(wf_compul) 
        wdetail.instyp        =  trim(wf_instyp) 
        wdetail.nv_insref     =  TRIM(wf_insref)   /*A64-0355*/
        wdetail.inslang       =  trim(wf_inslang )  
        wdetail.tiname        =  trim(wf_tiname) 
        wdetail.insnam        =  trim(wf_insnam) 
        wdetail.lastname      =  trim(wf_lastname)  
        wdetail.icno          =  trim(wf_icno)  
        wdetail.insbr         =  trim(wf_insbr) 
        wdetail.occup         =  trim(wf_occup) 
        wdetail.addr          =  trim(wf_addr)
        wdetail.tambon        =  trim(wf_tambon) 
        wdetail.amper         =  trim(wf_amper) 
        wdetail.country       =  trim(wf_country )  
        wdetail.post          =  trim(wf_post ) 
        wdetail.provcod       =  trim(wf_provcod)  
        wdetail.distcod       =  trim(wf_distcod)  
        wdetail.sdistcod      =  IF trim(wf_sdistcod) <> "" AND LENGTH(wf_sdistcod) > 2 THEN SUBSTR(wf_sdistcod,1,2) ELSE TRIM(wf_sdistcod) 
        wdetail.jpae          =  trim(wf_ae)         /* ae  new Xmm600 งาน Japanes */  /*A64-0355*/
        wdetail.jpjtl         =  trim(wf_jtl)        /* jtl new Xmm600 งาน Japanes */  /*A64-0355*/
        wdetail.jpts          =  trim(wf_ts)         /* ts  new Xmm600 งาน Japanes */  /*A64-0355*/
        wdetail.gender        =  trim(wf_gender) 
        wdetail.tele1         =  trim(wf_tele1) 
        wdetail.tele2         =  trim(wf_tele2) 
        wdetail.mail1         =  trim(wf_mail1) 
        wdetail.mail2         =  trim(wf_mail2) 
        wdetail.mail3         =  trim(wf_mail3) 
        wdetail.mail4         =  trim(wf_mail4) 
        wdetail.mail5         =  trim(wf_mail5) 
        wdetail.mail6         =  trim(wf_mail6)  
        wdetail.mail7         =  trim(wf_mail7)  
        wdetail.mail8         =  trim(wf_mail8)  
        wdetail.mail9         =  trim(wf_mail9)  
        wdetail.mail10        =  trim(wf_mail10)  
        wdetail.fax           =  trim(wf_fax)  
        wdetail.lineID        =  trim(wf_lineID)  
        wdetail.name2         =  trim(wf_name2)  
        wdetail.name3         =  trim(wf_name3)  
        wdetail.benname       =  /*IF trim(wf_benname) = "-" THEN "" ELSE A64-0309 */ trim(wf_benname) 
        wdetail.payercod      =  trim(wf_payercod)  
        wdetail.vatcode       =  trim(wf_vatcode )
        wdetail.covcod        =  trim(wf_covcod )  
        wdetail.ddbirth       =  if trim(wf_ddbirth)    = "-" then "" else trim(wf_ddbirth)
        wdetail.garage        =  trim(wf_garage )  
        wdetail.special       =  trim(wf_special)  
        wdetail.inspec        =  trim(wf_inspec )  
        wdetail.class70       =  trim(wf_class70)  
        wdetail.brand         =  trim(wf_brand)  
        wdetail.model         =  trim(wf_model)  
        wdetail.submodel      =  trim(wf_submodel)  
        wdetail.yrmanu        =  trim(wf_caryear)  
        wdetail.chasno        =  trim(wf_chasno )  
        wdetail.eng           =  trim(wf_eng)  
        wdetail.seat          =  INTE(wf_seat)  
        wdetail.engcc         =  INTE(wf_engcc)  
        wdetail.weight        =  DECI(wf_weight) 
        wdetail.watt          =  INTE(wf_watt)  
        wdetail.body          =  trim(wf_body )  
        wdetail.typ           =  trim(wf_type )  
        wdetail.re_year       =  trim(wf_re_year)  
        wdetail.vehreg        =  trim(wf_vehreg )  
        wdetail.re_country    =  trim(wf_re_country)
        wdetail.cargrp        =  trim(wf_cargrp )   
        wdetail.colorcar      =  trim(wf_colorcar )
        wdetail.fule          =  trim(wf_fule) .
      ASSIGN 
        wdetail.drivnam       =  trim(wf_drivnam)   
        wdetail.ntitle1       =  if trim(wf_ntitle1)    = "-" then "" else trim(wf_ntitle1)   
        wdetail.drivername1   =  if trim(wf_drivername1)= "-" then "" else trim(wf_drivername1)
        wdetail.dname2        =  if trim(wf_dname2)     = "-" then "" else trim(wf_dname2)  
        wdetail.dicno         =  if trim(wf_dicno )     = "-" then "" else trim(wf_dicno )  
        wdetail.dgender1      =  if trim(wf_dgender1)   = "-" then "" else trim(wf_dgender1)  
        wdetail.dbirth        =  if trim(wf_dbirth)     = "-" then "" else trim(wf_dbirth)  
        wdetail.docoup        =  if trim(wf_docoup)     = "-" then "" else trim(wf_docoup)  
        wdetail.ddriveno      =  if trim(wf_ddriveno)   = "-" then "" else trim(wf_ddriveno)  
        wdetail.ntitle2       =  if trim(wf_ntitle2 )   = "-" then "" else trim(wf_ntitle2 )  
        wdetail.drivername2   =  if trim(wf_drivername2)= "-" then "" else trim(wf_drivername2)
        wdetail.ddname1       =  if trim(wf_ddname1)    = "-" then "" else trim(wf_ddname1)  
        wdetail.ddicno        =  if trim(wf_ddicno)     = "-" then "" else trim(wf_ddicno)  
        wdetail.dgender2      =  if trim(wf_dgender2)   = "-" then "" else trim(wf_dgender2)
        wdetail.ddocoup       =  if trim(wf_ddocoup)    = "-" then "" else trim(wf_ddocoup)
        wdetail.dddriveno     =  if trim(wf_dddriveno)  = "-" then "" else trim(wf_dddriveno)
        wdetail.baseplus      =  INTE(wf_baseplus)  
        wdetail.siplus        =  int(wf_siplus)
        wdetail.rs10          =  int(wf_rs10)   
        /*wdetail.comper        =  int(wf_comper)   */ /*A64-0355*/
        /*wdetail.comacc        =  int(wf_comacc)   */ /*A64-0355*/
        /*wdetail.deductpd      =  int(wf_deductpd) */ /*A64-0355*/ 
        wdetail.comper        =  if trim(wf_comper)  = "U" then 999999999 else  int(wf_comper)    /*A64-0355*/
        wdetail.comacc        =  if trim(wf_comacc)  = "U" then 999999999 else  int(wf_comacc)    /*A64-0355*/
        wdetail.deductpd      =  if trim(wf_deductpd)= "U" then 999999999 else  int(wf_deductpd)  /*A64-0355*/ 
        wdetail.DOD           =  int(wf_DOD)   
        wdetail.DPD           =  int(wf_DPD)   
        wdetail.si            =  int(wf_tpfire) 
        wdetail.NO_411        =  int(wf_NO_41 ) 
        /*wdetail.seat41        =  int(wf_ac2)  */ /*A64-0044*/
        wdetail.seat41        =  IF int(wf_ac2) <> 0 THEN int(wf_ac2) ELSE INTE(wf_seat) /*A64-0044*/
        wdetail.NO_412        =  int(wf_ac4)   
        wdetail.NO_413        =  int(wf_ac5)   
        wdetail.ac6           =  int(wf_ac6)   
        wdetail.NO_414        =  int(wf_ac7)   
        wdetail.NO_42         =  int(wf_NO_42) 
        wdetail.NO_43         =  int(wf_NO_43) 
        wdetail.base          =  int(wf_base)
        wdetail.unname        =  deci(wf_unname) 
        wdetail.nname         =  deci(wf_nname) 
        wdetail.tpbi          =  deci(wf_tpbi)   
        wdetail.tppd          =  deci(wf_tppd)   
        wdetail.ry01          =  deci(wf_ry01)   
        wdetail.ry02          =  deci(wf_ry02)   
        wdetail.ry03          =  deci(wf_ry03) 
        wdetail.fleet         =  trim(wf_fleet)   
        wdetail.ncb           =  trim(wf_ncb)
        wdetail.claim         =  trim(wf_claim)   
        wdetail.dspc          =  trim(wf_dspc)   
        wdetail.cctv          =  trim(wf_cctv)   
        wdetail.dstf          =  trim(wf_dstf)   
        wdetail.fleetprem     =  deci(wf_fleetprem)
        wdetail.ncbprem       =  deci(wf_ncbprem)   
        wdetail.clprem        =  deci(wf_clprem )   
        wdetail.dspcprem      =  deci(wf_dspcprem) 
        wdetail.cctvprem      =  deci(wf_cctvprem) 
        wdetail.dstfprem      =  deci(wf_dstfprem) 
        wdetail.premt         =  deci(wf_premt )   
        wdetail.rstp_t        =  deci(wf_rstp_t)   
        wdetail.rtax_t        =  deci(wf_rtax_t)   
        wdetail.comper70      =  IF trim(wf_comper70)  =  " " THEN (-1) ELSE deci(wf_comper70)    /* ค่าว่างใส่ -1 ดึง comm ตามระบบ  ถ้าระบุ 0 ไม่มีค่าคอม */
        wdetail.comprem70     =  IF trim(wf_comprem70) =  " " THEN (-1) ELSE deci(wf_comprem70)  /* ค่าว่างใส่ -1 คำนวณ comm ตามระบบ ถ้าระบุ 0 ไม่มีค่าคอม */
        wdetail.agco70        =  trim(wf_agco70 )  
        wdetail.comco_per70   =  IF trim(wf_comco_per70)  =  " " THEN (-1) ELSE deci(wf_comco_per70) 
        wdetail.comco_prem70  =  IF trim(wf_comco_prem70) =  " " THEN (-1) ELSE deci(wf_comco_prem70)
        wdetail.dgpackge      =  trim(wf_dgpackge)
        wdetail.danger1       =  trim(wf_danger1)   
        wdetail.danger2       =  trim(wf_danger2)   
        wdetail.dgsi          =  inte(wf_dgsi)
        wdetail.dgrate        =  trim(wf_dgrate)   
        wdetail.dgfeet        =  trim(wf_dgfeet)   
        wdetail.dgncb         =  trim(wf_dgncb )   
        wdetail.dgdisc        =  trim(wf_dgdisc)  
        wdetail.dgwdisc       =  trim(wf_dgwdisc) 
        wdetail.dgatt         =  INTE(wf_dgatt)    
        wdetail.dgfeetprm     =  deci(wf_dgfeetprm)
        wdetail.dgncbprm      =  deci(wf_dgncbprm) 
        wdetail.dgdiscprm     =  deci(wf_dgdiscprm) 
        wdetail.dgWdiscprm    =  deci(wf_dgWdiscprm) 
        wdetail.dgprem        =  deci(wf_dgprem)
        wdetail.dgrstp_t      =  deci(wf_dgrstp_t) 
        wdetail.dgrtax_t      =  deci(wf_dgrtax_t) 
        wdetail.dgcomper      =  deci(wf_dgcomper) 
        wdetail.dgcomprem     =  deci(wf_dgcomprem)
        wdetail.cltxt         =  trim(wf_cltxt )
        wdetail.clamount      =  inte(wf_clamount)
        wdetail.faultno       =  inte(wf_faultno)  
        wdetail.faultprm      =  inte(wf_faultprm)  
        wdetail.goodno        =  inte(wf_goodno)  
        wdetail.goodprm       =  inte(wf_goodprm)  
        wdetail.loss          =  inte(wf_loss)  
        wdetail.compolusory   =  trim(wf_compolusory)
        wdetail.stk           =  trim(wf_barcode)  
        wdetail.class72       =  trim(wf_class72)  
        wdetail.dstf72        =  trim(wf_dstf72 )  
        wdetail.dstfprem72    =  deci(wf_dstfprem72)
        wdetail.premt72       =  deci(wf_premt72 )  
        wdetail.rstp_t72      =  deci(wf_rstp_t72)  
        wdetail.rtax_t72      =  deci(wf_rtax_t72)  
        wdetail.comper72      =  deci(wf_comper72)  
        wdetail.comprem72     =  deci(wf_comprem72) 
        wdetail.vehuse        =  trim(wf_vehuse) .  /* ranu : vehuse 22/01/2021 */
        /*wdetail.vehuse        =  IF INDEX("12345",wf_vehuse) <> 0 THEN trim(wf_vehuse) ELSE "" .*/ /* ranu : vehuse 15/12/2021 */
    ASSIGN 
        wdetail.poltyp        = "V70"
        /*wdetail.prempa        = TRIM(fi_pack)         */ /*A64-0355*/
        /*wdetail.subclass      = trim(wdetail.class70) */ /*A64-0355*/
        /*wdetail.dspc          = IF int(wdetail.cctv) <> 0 AND INT(wdetail.dspc) = 0  THEN "10" ELSE TRIM(wdetail.dspc) */ /*A64-0355*/
        /*add by : A64-0355 */
        wdetail.prempa        = IF LENGTH(wdetail.class70) = 5 THEN SUBSTR(wdetail.class70,1,1)                                                       
                                ELSE IF LENGTH(wdetail.class70) = 4 AND SUBSTR(wdetail.class70,4,1) <> "E" THEN SUBSTR(wdetail.class70,1,1)                   
                                ELSE TRIM(fi_pack)                                                                                            
        wdetail.subclass      = IF LENGTH(wdetail.class70) = 5 THEN SUBSTR(wdetail.class70,2,4)                                                       
                                ELSE IF LENGTH(wdetail.class70) = 4 AND SUBSTR(wdetail.class70,4,1) <> "E" THEN SUBSTR(wdetail.class70,2,3) 
                                ELSE wdetail.class70 
        wdetail.dspc          = IF DECI(wdetail.dspc) = 0  THEN TRIM(wdetail.cctv) ELSE STRING(deci(wdetail.dspc) + DECI(wdetail.cctv))
        /* end : A64-0355 */
        wdetail.tariff        = "X"
        /*wdetail.vehuse        = IF trim(wdetail.subclass) <> "" THEN SUBSTR(wdetail.subclass,2,1) ELSE "" */      /* ranu : vehuse 15/12/2021 */
        /*wdetail.seat41        = INTE(wdetail.seat)*/ /*A64-0044*/
        wdetail.dgdisc        = IF deci(wdetail.dgwdisc) <> 0 THEN STRING(DECI(wdetail.dgdisc) + deci(wdetail.dgwdisc)) ELSE wdetail.dgdisc
        wdetail.comment       = ""
        wdetail.entdat        = string(TODAY)                /*entry date*/
        wdetail.enttim        = STRING(TIME, "HH:MM:SS")    /*entry time*/
        wdetail.trandat       = STRING(fi_loaddat)          /*tran date*/
        wdetail.trantim       = STRING(TIME, "HH:MM:SS")    /*tran time*/
        wdetail.n_IMPORT      = "IM"
        /*wdetail.n_EXPORT      = ""*/ . /*A64-0044*/
    /* Add : A64-0355 */    
    IF LENGTH(wdetail.policyno) < 12 THEN wdetail.policyno = "" . 
    ELSE DO:
        FIND LAST sicuw.uwm100 WHERE sicuw.uwm100.policy = TRIM(wdetail.policyno) NO-LOCK NO-ERROR .
        IF AVAIL sicuw.uwm100  THEN
            ASSIGN wdetail.comment  = wdetail.comment + "|เบอร์กรมธรรม์ " + wdetail.policyno + " มีข้อมูลในระบบพรีเมียมแล้ว " 
                   wdetail.pass     = "N" .
    END.
    /* end : A64-0355 */ 
    IF wdetail.policyno = ""  THEN DO:
        IF ra_type = 1  THEN DO:  
            IF LENGTH(wdetail.chasno) > 9  THEN DO:
             ASSIGN wdetail.policyno = "N70" + STRING(int(wdetail.itemno),"999") + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 9).
             /*IF wdetail.compul = "Y" THEN DO: */ /* A64-0309 */
             IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */
                 IF wdetail.compolusory <> "" THEN wdetail.cr_2 = wdetail.compolusory.
                 ELSE ASSIGN wdetail.cr_2 = "N72" + STRING(int(wdetail.itemno),"999") + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 9).
             END.
            END.
            ELSE DO:
                ASSIGN wdetail.policyno = "N70" + STRING(int(wdetail.itemno),"999") + TRIM(wdetail.chasno).
                 /*IF wdetail.compul = "Y" THEN DO: */ /* A64-0309 */
                IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */
                    IF wdetail.compolusory <> "" THEN wdetail.cr_2 = wdetail.compolusory.
                    ELSE ASSIGN wdetail.cr_2 = "N72" + STRING(int(wdetail.itemno),"999") + TRIM(wdetail.chasno).
                END.
            END.
        END.
        ELSE DO: 
            IF wdetail.chasno <> "" THEN DO: 
                IF LENGTH(wdetail.chasno) > 9  THEN DO:
                   ASSIGN wdetail.policyno = "R70" + STRING(int(wdetail.itemno),"999") + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 9).
                    /*IF wdetail.compul = "Y" THEN DO: */ /* A64-0309 */
                    IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */ 
                       IF wdetail.compolusory <> "" THEN wdetail.cr_2 = wdetail.compolusory.
                       ELSE ASSIGN wdetail.cr_2 = "R72" + STRING(int(wdetail.itemno),"999") + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 9).
                   END.
                END.
                ELSE DO:
                    ASSIGN wdetail.policyno = "R70" + STRING(int(wdetail.itemno),"999") + TRIM(wdetail.chasno).
                    /*IF wdetail.compul = "Y" THEN DO: */ /* A64-0309 */
                    IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */ 
                         IF wdetail.compolusory <> "" THEN wdetail.cr_2 = wdetail.compolusory.
                         ELSE ASSIGN wdetail.cr_2 = "R72" + STRING(int(wdetail.itemno),"999") + TRIM(wdetail.chasno).
                    END.
                END.
            END.
            ELSE DO: 
                ASSIGN /*wdetail.policyno = "R70" + STRING(int(wdetail.itemno),"999") + TRIM(wdetail.prepol).*/ /*A64-0355*/
                    wdetail.policyno = "R70" + STRING(int(wdetail.itemno),"999") + SUBSTRING(wdetail.prepol,LENGTH(wdetail.prepol) - 6). /*A64-0355*/
                /*IF wdetail.compul = "Y" THEN DO: */ /* A64-0309 */
                 IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */  
                     IF wdetail.compolusory <> "" THEN wdetail.cr_2 = wdetail.compolusory.
                     ELSE /*ASSIGN wdetail.cr_2 = "R72" + STRING(int(wdetail.itemno),"999") + TRIM(wdetail.prepol).  */ /*A64-0355*/
                          ASSIGN wdetail.cr_2 = "R72" + STRING(int(wdetail.itemno),"999") + SUBSTRING(wdetail.prepol,LENGTH(wdetail.prepol) - 6). /*A64-0355*/
                END.
            END.
        END.
    END.
    ELSE IF wdetail.compul = "Y" AND ra_poltyp = 3 AND wdetail.compolusory <> "" THEN wdetail.cr_2 = wdetail.compolusory. /*A64-0355*/
   
   RUN proc_assigninit70_2.
   RELEASE wdetail.
   RELEASE wtxt.
   RELEASE wmemo.
   RELEASE wacces.
   RELEASE winst.
   
END.*/
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE 00-proc_assigninit70-bk C-Win 
PROCEDURE 00-proc_assigninit70-bk :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:  comment : A65-0079      
------------------------------------------------------------------------------*/
/*DEF VAR n_chkbr AS CHAR FORMAT "x(2)" INIT "" . /* A65-0043 */
DO:
    ASSIGN fi_process = "Create data text file " + wf_chasno + " to wdetail ....." .
    DISP fi_process WITH FRAM fr_main.
    CREATE wdetail.
    CREATE wtxt.
    CREATE wmemo.
    CREATE wacces.
    CREATE winst.
    ASSIGN
        wdetail.riskno        =  trim(wf_riskno)  /* A64-0355*/
        wdetail.itemno        =  trim(wf_num)
        /*wdetail.policyno      =  " " /*trim(wf_policyno) */ */ /*A64-0355*/   
        wdetail.policyno      =  trim(wf_policyno)  /*A64-0355*/  
        wdetail.n_branch      =  trim(wf_n_branch)        
        wdetail.agent         =  trim(wf_agent)           
        wdetail.producer      =  trim(wf_producer)        
        wdetail.n_delercode   =  trim(wf_n_delercode)   
        wdetail.fincode       =  trim(wf_fincode)   
        wdetail.appenno       =  trim(wf_appenno)   
        wdetail.salename      =  trim(wf_salename)   
        wdetail.srate         =  trim(wf_srate ) 
        wdetail.comdat        =  date(wf_comdat)                                        
        wdetail.expdat        =  date(wf_expdat)                                        
        wdetail.agreedat      =  if trim(wf_agreedat) = "" and wdetail.prepol = "" then date(wf_comdat) else if trim(wf_agreedat) <> "" then date(wf_agreedat)  ELSE ? 
        wdetail.firstdat      =  if trim(wf_firstdat) = "" and wdetail.prepol = "" then date(wf_comdat) else if trim(wf_firstdat) <> "" then date(wf_firstdat)  ELSE ? 
        wdetail.packcod       =  trim(wf_packcod)   
        wdetail.camp_no       =  trim(wf_camp_no)   
        wdetail.campen        =  trim(wf_campen) 
        wdetail.specon        =  trim(wf_specon) 
        wdetail.product       =  trim(wf_product )   
        wdetail.promo         =  trim(wf_promo )   
        wdetail.rencnt        =  TRIM(wf_rencnt)   
        wdetail.prepol        =  trim(wf_prepol)
        wdetail.compul        =  trim(wf_compul) 
        wdetail.instyp        =  trim(wf_instyp) 
        wdetail.nv_insref     =  TRIM(wf_insref)   /*A64-0355*/
        wdetail.inslang       =  trim(wf_inslang)  
        wdetail.tiname        =  trim(wf_tiname) 
        wdetail.insnam        =  trim(wf_insnam) 
        wdetail.lastname      =  trim(wf_lastname)  
        wdetail.icno          =  trim(wf_icno)  
        wdetail.insbr         =  trim(wf_insbr) 
        wdetail.occup         =  trim(wf_occup) 
        wdetail.addr          =  trim(wf_addr)
        wdetail.tambon        =  trim(wf_tambon) 
        wdetail.amper         =  trim(wf_amper) 
        wdetail.country       =  trim(wf_country )  
        wdetail.post          =  trim(wf_post ) 
        wdetail.provcod       =  trim(wf_provcod)  
        wdetail.distcod       =  trim(wf_distcod)  
        wdetail.sdistcod      =  IF trim(wf_sdistcod) <> "" AND LENGTH(wf_sdistcod) > 2 THEN SUBSTR(wf_sdistcod,1,2) ELSE TRIM(wf_sdistcod) 
        wdetail.jpae          =  trim(wf_ae)         /* ae  new Xmm600 งาน Japanes */  /*A64-0355*/
        wdetail.jpjtl         =  trim(wf_jtl)        /* jtl new Xmm600 งาน Japanes */  /*A64-0355*/
        wdetail.jpts          =  trim(wf_ts)         /* ts  new Xmm600 งาน Japanes */  /*A64-0355*/
        wdetail.gender        =  trim(wf_gender) 
        wdetail.tele1         =  trim(wf_tele1) 
        wdetail.tele2         =  trim(wf_tele2) 
        wdetail.mail1         =  trim(wf_mail1) 
        wdetail.mail2         =  trim(wf_mail2) 
        wdetail.mail3         =  trim(wf_mail3) 
        wdetail.mail4         =  trim(wf_mail4) 
        wdetail.mail5         =  trim(wf_mail5) 
        wdetail.mail6         =  trim(wf_mail6)  
        wdetail.mail7         =  trim(wf_mail7)  
        wdetail.mail8         =  trim(wf_mail8)  
        wdetail.mail9         =  trim(wf_mail9)  
        wdetail.mail10        =  trim(wf_mail10)  
        wdetail.fax           =  trim(wf_fax)  
        wdetail.lineID        =  trim(wf_lineID)  
        wdetail.name2         =  trim(wf_name2)  
        wdetail.name3         =  trim(wf_name3)  
        wdetail.benname       =  /*IF trim(wf_benname) = "-" THEN "" ELSE A64-0309 */ trim(wf_benname) 
        wdetail.payercod      =  trim(wf_payercod)  
        wdetail.vatcode       =  trim(wf_vatcode )
        wdetail.covcod        =  trim(wf_covcod )  
        wdetail.garage        =  trim(wf_garage )  
        wdetail.special       =  trim(wf_special)  
        wdetail.inspec        =  trim(wf_inspec )  
        wdetail.class70       =  trim(wf_class70)
        wdetail.redbook       =  TRIM(wf_redbook)  /*A65-0079*/
        wdetail.brand         =  trim(wf_brand)  
        wdetail.model         =  trim(wf_model)  
        wdetail.submodel      =  trim(wf_submodel)  
        wdetail.yrmanu        =  trim(wf_caryear)  
        wdetail.chasno        =  trim(wf_chasno )  
        wdetail.eng           =  trim(wf_eng)  
        wdetail.seat          =  INTE(wf_seat)  
        wdetail.engcc         =  INTE(wf_engcc)  
        wdetail.weight        =  DECI(wf_weight) 
        wdetail.watt          =  INTE(wf_watt)  
        wdetail.body          =  trim(wf_body )  
        wdetail.typ           =  trim(wf_type )  
        wdetail.re_year       =  trim(wf_re_year)  
        wdetail.vehreg        =  trim(wf_vehreg )  
        wdetail.re_country    =  trim(wf_re_country)
        wdetail.cargrp        =  trim(wf_cargrp )   
        wdetail.colorcar      =  trim(wf_colorcar )
        wdetail.fule          =  trim(wf_fule) .
      ASSIGN 
        wdetail.drivnam       =  trim(wf_drivnam)   
        wdetail.ntitle1       =  if trim(wf_ntitle1)    = "-" then "" else trim(wf_ntitle1)   
        wdetail.drivername1   =  if trim(wf_drivername1)= "-" then "" else trim(wf_drivername1)
        wdetail.dname2        =  if trim(wf_dname2)     = "-" then "" else trim(wf_dname2)  
        wdetail.dicno         =  if trim(wf_dicno )     = "-" then "" else trim(wf_dicno )  
        wdetail.dgender1      =  if trim(wf_dgender1)   = "-" then "" else trim(wf_dgender1)  
        wdetail.dbirth        =  if trim(wf_dbirth)     = "-" then "" else trim(wf_dbirth)  
        wdetail.docoup        =  if trim(wf_docoup)     = "-" then "" else trim(wf_docoup)  
        wdetail.ddriveno      =  if trim(wf_ddriveno)   = "-" then "" else trim(wf_ddriveno)  
        wdetail.ntitle2       =  if trim(wf_ntitle2 )   = "-" then "" else trim(wf_ntitle2 )  
        wdetail.drivername2   =  if trim(wf_drivername2)= "-" then "" else trim(wf_drivername2)
        wdetail.ddname1       =  if trim(wf_ddname1)    = "-" then "" else trim(wf_ddname1)  
        wdetail.ddicno        =  if trim(wf_ddicno)     = "-" then "" else trim(wf_ddicno)  
        wdetail.dgender2      =  if trim(wf_dgender2)   = "-" then "" else trim(wf_dgender2)
        wdetail.ddbirth       =  if trim(wf_ddbirth)    = "-" then "" else trim(wf_ddbirth)
        wdetail.ddocoup       =  if trim(wf_ddocoup)    = "-" then "" else trim(wf_ddocoup)
        wdetail.dddriveno     =  if trim(wf_dddriveno)  = "-" then "" else trim(wf_dddriveno)
        wdetail.baseplus      =  INTE(wf_baseplus)  
        wdetail.siplus        =  int(wf_siplus)
        wdetail.rs10          =  int(wf_rs10)   
        /*wdetail.comper        =  int(wf_comper)   */ /*A64-0355*/
        /*wdetail.comacc        =  int(wf_comacc)   */ /*A64-0355*/
        /*wdetail.deductpd      =  int(wf_deductpd) */ /*A64-0355*/ 
        wdetail.comper        =  if trim(wf_comper)  = "U" then 999999999 else  int(wf_comper)    /*A64-0355*/
        wdetail.comacc        =  if trim(wf_comacc)  = "U" then 999999999 else  int(wf_comacc)    /*A64-0355*/
        wdetail.deductpd      =  if trim(wf_deductpd)= "U" then 999999999 else  int(wf_deductpd)  /*A64-0355*/ 
        wdetail.DOD           =  int(wf_DOD)   
        wdetail.DPD           =  int(wf_DPD)   
        wdetail.si            =  int(wf_tpfire) 
        wdetail.NO_411        =  int(wf_NO_41 ) 
        /*wdetail.seat41        =  int(wf_ac2)  */ /*A64-0044*/
        wdetail.seat41        =  IF int(wf_ac2) <> 0 THEN int(wf_ac2) + 1 ELSE INTE(wf_seat) /*A64-0044*/
        wdetail.NO_412        =  int(wf_ac4)   
        wdetail.NO_413        =  int(wf_ac5)   
        wdetail.ac6           =  int(wf_ac6)   
        wdetail.NO_414        =  int(wf_ac7)   
        wdetail.NO_42         =  int(wf_NO_42) 
        wdetail.NO_43         =  int(wf_NO_43) 
        wdetail.base          =  int(wf_base)
        wdetail.unname        =  deci(wf_unname) 
        wdetail.nname         =  deci(wf_nname) 
        wdetail.tpbi          =  deci(wf_tpbi)   
        wdetail.tppd          =  deci(wf_tppd)   
        wdetail.ry01          =  deci(wf_ry01)   
        wdetail.ry02          =  deci(wf_ry02)   
        wdetail.ry03          =  deci(wf_ry03) 
        wdetail.fleet         =  trim(wf_fleet)   
        wdetail.ncb           =  trim(wf_ncb)
        wdetail.claim         =  trim(wf_claim)   
        wdetail.dspc          =  trim(wf_dspc)   
        wdetail.cctv          =  trim(wf_cctv)   
        wdetail.dstf          =  trim(wf_dstf)   
        wdetail.fleetprem     =  deci(wf_fleetprem)
        wdetail.ncbprem       =  deci(wf_ncbprem)   
        wdetail.clprem        =  deci(wf_clprem )   
        wdetail.dspcprem      =  deci(wf_dspcprem) 
        wdetail.cctvprem      =  deci(wf_cctvprem) 
        wdetail.dstfprem      =  deci(wf_dstfprem) 
        wdetail.premt         =  deci(wf_premt )   
        wdetail.rstp_t        =  deci(wf_rstp_t)   
        wdetail.rtax_t        =  deci(wf_rtax_t)   
        wdetail.comper70      =  IF trim(wf_comper70)  =  " " THEN (-1) ELSE deci(wf_comper70)    /* ค่าว่างใส่ -1 ดึง comm ตามระบบ  ถ้าระบุ 0 ไม่มีค่าคอม */
        wdetail.comprem70     =  IF trim(wf_comprem70) =  " " THEN (-1) ELSE deci(wf_comprem70)  /* ค่าว่างใส่ -1 คำนวณ comm ตามระบบ ถ้าระบุ 0 ไม่มีค่าคอม */
        wdetail.agco70        =  trim(wf_agco70 )  
        wdetail.comco_per70   =  IF trim(wf_comco_per70)  =  " " THEN (-1) ELSE deci(wf_comco_per70) 
        wdetail.comco_prem70  =  IF trim(wf_comco_prem70) =  " " THEN (-1) ELSE deci(wf_comco_prem70)
        wdetail.dgpackge      =  trim(wf_dgpackge)
        wdetail.danger1       =  trim(wf_danger1)   
        wdetail.danger2       =  trim(wf_danger2)   
        wdetail.dgsi          =  inte(wf_dgsi)
        wdetail.dgrate        =  trim(wf_dgrate)   
        wdetail.dgfeet        =  trim(wf_dgfeet)   
        wdetail.dgncb         =  trim(wf_dgncb )   
        wdetail.dgdisc        =  trim(wf_dgdisc)  
        wdetail.dgwdisc       =  trim(wf_dgwdisc) 
        wdetail.dgatt         =  INTE(wf_dgatt)    
        wdetail.dgfeetprm     =  deci(wf_dgfeetprm)
        wdetail.dgncbprm      =  deci(wf_dgncbprm) 
        wdetail.dgdiscprm     =  deci(wf_dgdiscprm) 
        wdetail.dgWdiscprm    =  deci(wf_dgWdiscprm) 
        wdetail.dgprem        =  deci(wf_dgprem)
        wdetail.dgrstp_t      =  deci(wf_dgrstp_t) 
        wdetail.dgrtax_t      =  deci(wf_dgrtax_t) 
        wdetail.dgcomper      =  deci(wf_dgcomper) 
        wdetail.dgcomprem     =  deci(wf_dgcomprem)
        wdetail.cltxt         =  trim(wf_cltxt )
        wdetail.clamount      =  inte(wf_clamount)
        wdetail.faultno       =  inte(wf_faultno)  
        wdetail.faultprm      =  inte(wf_faultprm)  
        wdetail.goodno        =  inte(wf_goodno)  
        wdetail.goodprm       =  inte(wf_goodprm)  
        wdetail.loss          =  inte(wf_loss)  
        wdetail.compolusory   =  trim(wf_compolusory)
        wdetail.stk           =  trim(wf_barcode)  
        wdetail.class72       =  trim(wf_class72)  
        wdetail.dstf72        =  trim(wf_dstf72 )  
        wdetail.dstfprem72    =  deci(wf_dstfprem72)
        wdetail.premt72       =  deci(wf_premt72 )  
        wdetail.rstp_t72      =  deci(wf_rstp_t72)  
        wdetail.rtax_t72      =  deci(wf_rtax_t72)  
        wdetail.comper72      =  deci(wf_comper72)  
        wdetail.comprem72     =  deci(wf_comprem72) 
        wdetail.vehuse        =  trim(wf_vehuse) . /* ranu : vehuse 15/12/2021 */
    ASSIGN 
        wdetail.poltyp        = "V70"
       /*add by : A64-0355 */
        wdetail.prempa        = IF LENGTH(wdetail.class70) = 5 THEN SUBSTR(wdetail.class70,1,1)                                                       
                                ELSE IF LENGTH(wdetail.class70) = 4 AND SUBSTR(wdetail.class70,4,1) <> "E" THEN SUBSTR(wdetail.class70,1,1)                   
                                ELSE TRIM(fi_pack)                                                                                            
        wdetail.subclass      = IF LENGTH(wdetail.class70) = 5 THEN SUBSTR(wdetail.class70,2,4)                                                       
                                ELSE IF LENGTH(wdetail.class70) = 4 AND SUBSTR(wdetail.class70,4,1) <> "E" THEN SUBSTR(wdetail.class70,2,3) 
                                ELSE wdetail.class70 
        wdetail.dspc          = IF DECI(wdetail.dspc) = 0  THEN TRIM(wdetail.cctv)  ELSE string(DECI(wdetail.dspc) + DECI(wdetail.cctv))
        
        /* end : A64-0355 */
        wdetail.tariff        = "X"
        wdetail.dgdisc        = IF deci(wdetail.dgwdisc) <> 0 THEN STRING(DECI(wdetail.dgdisc) + deci(wdetail.dgwdisc)) ELSE wdetail.dgdisc
        wdetail.comment       = ""
        wdetail.entdat        = string(TODAY)                /*entry date*/
        wdetail.enttim        = STRING(TIME, "HH:MM:SS")    /*entry time*/
        wdetail.trandat       = STRING(fi_loaddat)          /*tran date*/
        wdetail.trantim       = STRING(TIME, "HH:MM:SS")    /*tran time*/
        wdetail.n_IMPORT      = "IM"
        /*wdetail.n_EXPORT      = ""*/ . /*A64-0044*/
    /* Add : A64-0355 */    
    n_chkbr   = "" .  /*A65-0043*/
    IF  wdetail.policyno <> "" THEN DO:
        IF  LENGTH(wdetail.policyno) <> 12 THEN   
            ASSIGN wdetail.comment  = wdetail.comment + "|เบอร์กรมธรรม์ " + wdetail.policyno + " ไม่ครบ 12 หลัก" 
               wdetail.pass     = "N" .
        IF SUBSTR(wdetail.policyno,3,2) <> "70" THEN 
            ASSIGN wdetail.comment  = wdetail.comment + "|เบอร์กรมธรรม์ " + wdetail.policyno + " หลักที่ 3-4 ไม่เท่ากับ 70 " 
                   wdetail.pass = "N" .
        /*A65-0043*/
        n_chkbr = TRIM(SUBSTR(wdetail.policyno,1,2)).
        IF SUBSTR(n_chkbr,1,1) = "D" THEN n_chkbr = trim(SUBSTR(n_chkbr,2,1)) . 
        IF  wdetail.n_branch <> n_chkbr  THEN
            ASSIGN wdetail.comment  = wdetail.comment +  "|สาขาเบอร์กรมธรรม์ " + wdetail.policyno + " ไม่ตรงกับสาขาของกรมธรรม์ "
                   wdetail.pass     = "N" .
        /* end : A65-0043*/
        FIND LAST sicuw.uwm100 WHERE sicuw.uwm100.policy = TRIM(wdetail.policyno) NO-LOCK NO-ERROR .
        IF AVAIL sicuw.uwm100  THEN
            ASSIGN wdetail.comment  = wdetail.comment + "|เบอร์กรมธรรม์ " + wdetail.policyno + " มีข้อมูลในระบบพรีเมียมแล้ว " 
                   wdetail.pass     = "N" .
    END.
    IF wdetail.compolusory <> ""  THEN DO:
        n_chkbr = "" .
        IF LENGTH(wdetail.compolusory) <> 12 THEN 
        ASSIGN wdetail.comment  = wdetail.comment + "|เบอร์กรมธรรม์ พรบ. " + wdetail.compolusory + " ไม่ครบ 12 หลัก" 
               wdetail.pass     = "N" .
        IF SUBSTR(wdetail.compolusory,3,2) <> "72" THEN 
        ASSIGN wdetail.comment  = wdetail.comment +  "|เบอร์กรมธรรม์ พรบ. " + wdetail.compolusory + " หลักที่ 3-4 ไม่เท่ากับ 72 "
               wdetail.pass     = "N" .
        /*A65-0043*/
        n_chkbr = TRIM(SUBSTR(wdetail.compolusory,1,2)).
        IF SUBSTR(n_chkbr,1,1) = "D" THEN n_chkbr = trim(SUBSTR(n_chkbr,2,1)) . 
        IF  wdetail.n_branch <> n_chkbr  THEN
            ASSIGN wdetail.comment  = wdetail.comment +  "|สาขาเบอร์กรมธรรม์ พรบ. " + wdetail.compolusory + " ไม่ตรงกับสาขาของกรมธรรม์ "
                   wdetail.pass     = "N" .
        /* end : A65-0043*/
    END.
    /* end : A64-0355 */ 
    IF wdetail.policyno = ""  THEN DO:
        IF ra_type = 1  THEN DO:  
            IF LENGTH(wdetail.chasno) > 9  THEN DO:
             ASSIGN wdetail.policyno = "N70" + STRING(int(wdetail.riskno),"999") + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 9).
             IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */
                 IF wdetail.compolusory <> "" THEN wdetail.cr_2 = wdetail.compolusory.
                 ELSE ASSIGN wdetail.cr_2 = "N72" + STRING(int(wdetail.riskno),"999") + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 9).
             END.
            END.
            ELSE DO:
                ASSIGN wdetail.policyno = "N70" + STRING(int(wdetail.riskno),"999") + TRIM(wdetail.chasno).
                IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */
                    IF wdetail.compolusory <> "" THEN wdetail.cr_2 = wdetail.compolusory.
                    ELSE ASSIGN wdetail.cr_2 = "N72" + STRING(int(wdetail.riskno),"999") + TRIM(wdetail.chasno).
                END.
            END.
        END.
        ELSE DO: 
            IF wdetail.chasno <> "" THEN DO: 
                IF LENGTH(wdetail.chasno) > 9  THEN DO:
                   ASSIGN wdetail.policyno = "R70" + STRING(int(wdetail.riskno),"999") + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 9).
                    IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */ 
                       IF wdetail.compolusory <> "" THEN wdetail.cr_2 = wdetail.compolusory.
                       ELSE ASSIGN wdetail.cr_2 = "R72" + STRING(int(wdetail.riskno),"999") + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 9).
                   END.
                END.
                ELSE DO:
                    ASSIGN wdetail.policyno = "R70" + STRING(int(wdetail.riskno),"999") + TRIM(wdetail.chasno).
                    IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */ 
                         IF wdetail.compolusory <> "" THEN wdetail.cr_2 = wdetail.compolusory.
                         ELSE ASSIGN wdetail.cr_2 = "R72" + STRING(int(wdetail.riskno),"999") + TRIM(wdetail.chasno).
                    END.
                END.
            END.
            ELSE DO: 
                ASSIGN /*wdetail.policyno = "R70" + STRING(int(wdetail.riskno),"999") + TRIM(wdetail.prepol).*/ /*A64-0355*/
                    wdetail.policyno = "R70" + STRING(int(wdetail.riskno),"999") + SUBSTRING(wdetail.prepol,LENGTH(wdetail.prepol) - 6). /*A64-0355*/
                /*IF wdetail.compul = "Y" THEN DO: */ /* A64-0309 */
                 IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */  
                     IF wdetail.compolusory <> "" THEN wdetail.cr_2 = wdetail.compolusory.
                     ELSE /*ASSIGN wdetail.cr_2 = "R72" + STRING(int(wdetail.riskno),"999") + TRIM(wdetail.prepol).  */ /*A64-0355*/
                          ASSIGN wdetail.cr_2 = "R72" + STRING(int(wdetail.riskno),"999") + SUBSTRING(wdetail.prepol,LENGTH(wdetail.prepol) - 6). /*A64-0355*/
                END.
            END.
        END.
    END.
    ELSE IF wdetail.compul = "Y" AND ra_poltyp = 3 AND wdetail.compolusory <> "" THEN wdetail.cr_2 = wdetail.compolusory. /*A64-0355*/
    RUN proc_assigninit70_2.
    IF TRIM(wdetail.nv_insref) <> "" THEN  RUN proc_chkinscode . /*A65-0043*/ 
    RELEASE wdetail.
    RELEASE wtxt.
    RELEASE wmemo.
    RELEASE wacces.
    RELEASE winst.
END.*/
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE 00-proc_assigninit72 C-Win 
PROCEDURE 00-proc_assigninit72 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
/*DO:
    ASSIGN fi_process = "Create data text file " + wf_chasno + " to wdetail ....." .
    DISP fi_process WITH FRAM fr_main.

    CREATE wdetail.
    CREATE wtxt.
    CREATE wmemo.
    CREATE wacces.
    CREATE winst.
    ASSIGN
        wdetail.riskno        =  TRIM(wf_riskno)   /*A64-0355*/
        wdetail.itemno        =  TRIM(wf_num)
        wdetail.policyno      =  " " /*trim(wf_policyno)*/        
        wdetail.n_branch      =  trim(wf_n_branch)        
        wdetail.agent         =  trim(wf_agent)           
        wdetail.producer      =  trim(wf_producer)        
        wdetail.n_delercode   =  trim(wf_n_delercode)   
        wdetail.fincode       =  trim(wf_fincode)   
        wdetail.appenno       =  trim(wf_appenno)   
        wdetail.salename      =  trim(wf_salename)   
        wdetail.srate         =  trim(wf_srate) 
        wdetail.comdat        =  date(wf_comdat)                                                        
        wdetail.expdat        =  date(wf_expdat)                                                        
        wdetail.agreedat      =  if trim(wf_agreedat) = "" and wdetail.prepol = "" then date(wf_comdat) 
                                 else if trim(wf_agreedat) <> "" then date(wf_agreedat)  ELSE ? 
        wdetail.firstdat      =  if trim(wf_firstdat) = "" and wdetail.prepol = "" then date(wf_comdat) 
                                 else if trim(wf_firstdat) <> "" then date(wf_firstdat)  ELSE ?  
        wdetail.packcod       =  trim(wf_packcod)   
        wdetail.camp_no       =  trim(wf_camp_no)   
        wdetail.campen        =  trim(wf_campen) 
        wdetail.specon        =  trim(wf_specon) 
        wdetail.product       =  trim(wf_product)   
        wdetail.promo         =  trim(wf_promo )   
        wdetail.rencnt        =  trim(wf_rencnt)   
        wdetail.prepol        =  trim(wf_prepol)
        wdetail.compul        =  trim(wf_compul) 
        wdetail.instyp        =  trim(wf_instyp)
        wdetail.nv_insref     =  TRIM(wf_insref)   /*A64-0355*/
        wdetail.inslang       =  trim(wf_inslang )  
        wdetail.tiname        =  trim(wf_tiname) 
        wdetail.insnam        =  trim(wf_insnam) 
        wdetail.lastname      =  trim(wf_lastname)  
        wdetail.icno          =  trim(wf_icno ) 
        wdetail.insbr         =  trim(wf_insbr) 
        wdetail.occup         =  trim(wf_occup) 
        wdetail.addr          =  trim(wf_addr ) 
        wdetail.tambon        =  trim(wf_tambon) 
        wdetail.amper         =  trim(wf_amper) 
        wdetail.country       =  trim(wf_country)  
        wdetail.post          =  trim(wf_post)  
        wdetail.provcod       =  trim(wf_provcod)  
        wdetail.distcod       =  trim(wf_distcod)  
        wdetail.jpae          =  trim(wf_ae)         /* ae  new Xmm600 งาน Japanes */  /*A64-0355*/
        wdetail.jpjtl         =  trim(wf_jtl)        /* jtl new Xmm600 งาน Japanes */  /*A64-0355*/
        wdetail.jpts          =  trim(wf_ts)         /* ts  new Xmm600 งาน Japanes */  /*A64-0355*/
        wdetail.sdistcod      =  IF trim(wf_sdistcod) <> "" AND LENGTH(wf_sdistcod) > 2 THEN SUBSTR(wf_sdistcod,1,2) ELSE TRIM(wf_sdistcod) 
        wdetail.gender        =  trim(wf_gender) 
        wdetail.tele1         =  trim(wf_tele1) 
        wdetail.tele2         =  trim(wf_tele2) 
        wdetail.mail1         =  trim(wf_mail1) 
        wdetail.mail2         =  trim(wf_mail2) 
        wdetail.mail3         =  trim(wf_mail3) 
        wdetail.mail4         =  trim(wf_mail4) 
        wdetail.mail5         =  trim(wf_mail5) 
        wdetail.mail6         =  trim(wf_mail6)  
        wdetail.mail7         =  trim(wf_mail7)  
        wdetail.mail8         =  trim(wf_mail8)  
        wdetail.mail9         =  trim(wf_mail9)  
        wdetail.mail10        =  trim(wf_mail10)  
        wdetail.fax           =  trim(wf_fax)  
        wdetail.lineID        =  trim(wf_lineID)  
        wdetail.name2         =  trim(wf_name2)  
        wdetail.name3         =  trim(wf_name3)  
        /*wdetail.benname     =  trim(wf_benname )  */
        wdetail.payercod      =  trim(wf_payercod)  
        wdetail.vatcode       =  trim(wf_vatcode )
        wdetail.covcod        =  trim(wf_covcod)  
        wdetail.garage        =  trim(wf_garage )  
        wdetail.special       =  trim(wf_special)  
        wdetail.inspec        =  trim(wf_inspec )  
        wdetail.class70       =  IF INDEX(wf_class70,".") <> 0 THEN trim(REPLACE(wf_class70,".","")) ELSE TRIM(wf_class70) 
        wdetail.brand         =  trim(wf_brand)  
        wdetail.model         =  trim(wf_model)  
        wdetail.submodel      =  trim(wf_submodel)  
        wdetail.yrmanu        =  trim(wf_caryear)  
        wdetail.chasno        =  trim(wf_chasno)  
        wdetail.eng           =  trim(wf_eng)  
        wdetail.seat          =  if trim(wf_seat)  = "" then 0 else INTE(wf_seat)    
        wdetail.engcc         =  if trim(wf_engcc) = "" then 0 else INTE(wf_engcc)   
        wdetail.weight        =  if trim(wf_weight)= "" then 0 else DECI(wf_weight)    
        wdetail.watt          =  if trim(wf_watt)= ""   then 0 ELSE INTE(wf_watt)    
        wdetail.body          =  trim(wf_body)  
        wdetail.typ           =  trim(wf_type)  
        wdetail.re_year       =  trim(wf_re_year)  
        wdetail.vehreg        =  trim(wf_vehreg)  
        wdetail.re_country    =  trim(wf_re_country)
        wdetail.cargrp        =  trim(wf_cargrp)   
        wdetail.colorcar      =  trim(wf_colorcar)
        wdetail.fule          =  trim(wf_fule)  
        wdetail.compolusory   =  trim(wf_compolusory)
        wdetail.stk           =  trim(wf_barcode)  
        wdetail.class72       =  IF INDEX(wf_class72,".") <> 0 THEN trim(REPLACE(wf_class72,".","")) ELSE TRIM(wf_class72)  
        wdetail.dstf72        =  trim(wf_dstf72 )  
        wdetail.dstfprem72    =  deci(wf_dstfprem72)   
        wdetail.premt72       =  deci(wf_premt72 )     
        wdetail.rstp_t72      =  deci(wf_rstp_t72)     
        wdetail.rtax_t72      =  deci(wf_rtax_t72)     
        wdetail.comper72      =  IF trim(wf_comper72)  =  " " THEN -1 ELSE deci(wf_comper72)          /* ค่าว่างใส่ -1 ดึง comm ตามระบบ  ถ้าระบุ 0 ไม่มีค่าคอม */                        
        wdetail.comprem72     =  IF trim(wf_comprem72) =  " " THEN -1 ELSE deci(wf_comprem72)        /* ค่าว่างใส่ -1 คำนวณ comm ตามระบบ ถ้าระบุ 0 ไม่มีค่าคอม */                      
        wdetail.vehuse        =  IF INDEX("1234",wf_vehuse) <> 0 THEN wf_vehuse ELSE "" .        /* A64-0355 : vehuse 15/12/2021 */
        
        ASSIGN 
        wdetail.CLASS72       = IF LENGTH(wdetail.class72) < 3 THEN TRIM(wdetail.class72) + "0" ELSE TRIM(wdetail.class72)
        wdetail.poltyp        = "V72"
        wdetail.covcod        = "T" 
        wdetail.subclass      = IF trim(wdetail.class72) <> "" THEN TRIM(wdetail.class72) ELSE TRIM(wdetail.class70)
        wdetail.tariff        = "9"
        /*wdetail.vehuse        = IF trim(wdetail.subclass) <> "" THEN SUBSTR(wdetail.subclass,1,1) ELSE ""*/ /* A64-0355 : vehuse 15/12/2021 */
        /*wdetail.seat41        = INTE(wdetail.seat) */ /*A64-0044*/
        wdetail.seat41        =  IF int(wf_ac2) <> 0 THEN int(wf_ac2) ELSE INTE(wf_seat) /*A64-0044*/
        wdetail.comment       = ""
        wdetail.entdat        = string(TODAY)                /*entry date*/
        wdetail.enttim        = STRING(TIME,"HH:MM:SS")    /*entry time*/
        wdetail.trandat       = STRING(fi_loaddat)          /*tran date*/
        wdetail.trantim       = STRING(TIME,"HH:MM:SS")    /*tran time*/
        wdetail.n_IMPORT      = "IM"
        /*wdetail.n_EXPORT      = "" */ . /*A64-0044*/
    
    IF wdetail.policyno = ""  THEN DO:
        IF ra_type = 1  THEN DO: 
            IF LENGTH(wdetail.chasno) > 10  THEN DO:
                IF wdetail.compolusory <> "" THEN ASSIGN wdetail.policyno = wdetail.compolusory. 
                ELSE ASSIGN wdetail.policyno = "N72" + STRING(int(wdetail.itemno),"999") + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 10).
                /*IF wdetail.compul = "Y" THEN  */ /* A64-0309 */
                IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */ 
                     ASSIGN wdetail.cr_2 = "N70" + STRING(int(wdetail.itemno),"999") + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 10).
                END. /* A64-0309 */ 
            END.
            ELSE DO:
                IF wdetail.compolusory <> "" THEN ASSIGN wdetail.policyno = wdetail.compolusory. 
                ELSE ASSIGN wdetail.policyno = "N72" + STRING(int(wdetail.itemno),"999") + TRIM(wdetail.chasno).
                /*IF wdetail.compul = "Y" THEN  */ /* A64-0309 */
                IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */ 
                    ASSIGN wdetail.cr_2 = "N70" + STRING(int(wdetail.itemno),"999") + TRIM(wdetail.chasno).
                END. /* A64-0309 */ 
            END.
        END.
        ELSE DO: 
            IF wdetail.chasno <> "" THEN DO: 
                IF LENGTH(wdetail.chasno) > 10 THEN DO:
                    IF wdetail.compolusory <> "" THEN ASSIGN wdetail.policyno = wdetail.compolusory. 
                    ELSE ASSIGN wdetail.policyno = "R72" + STRING(int(wdetail.itemno),"999") + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 10). 

                    /*IF wdetail.compul = "Y" THEN  */ /* A64-0309 */
                    IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */  
                            ASSIGN wdetail.cr_2 = "R70" + STRING(int(wdetail.itemno),"999") + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 10).
                    END.  /* A64-0309 */
                END.
                ELSE DO:
                    IF wdetail.compolusory <> "" THEN ASSIGN wdetail.policyno = wdetail.compolusory. 
                    ELSE ASSIGN wdetail.policyno = "R72" + STRING(int(wdetail.itemno),"999") + TRIM(wdetail.chasno). 

                    /*IF wdetail.compul = "Y" THEN  */ /* A64-0309 */
                    IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */
                        ASSIGN wdetail.cr_2 = "R70" + STRING(int(wdetail.itemno),"999") + TRIM(wdetail.chasno).
                    END.  /* A64-0309 */
                END.
            END.
            ELSE DO: 
                IF wdetail.compolusory <> "" THEN ASSIGN wdetail.policyno = wdetail.compolusory. 
                ELSE ASSIGN wdetail.policyno = "R72" + STRING(int(wdetail.itemno),"999") + TRIM(wdetail.prepol).

                /*IF wdetail.compul = "Y" THEN  */ /* A64-0309 */
                IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */ 
                    ASSIGN wdetail.cr_2 = "R70" + STRING(int(wdetail.itemno),"999") + TRIM(wdetail.prepol).
                END.  /* A64-0309 */
            END.
        END.
    END.
    /*IF wdetail.policyno = ""  THEN DO:
        IF ra_type = 1  THEN DO: 
            IF LENGTH(wdetail.chasno) > 10  THEN DO:
                IF wdetail.compolusory <> "" THEN ASSIGN wdetail.policyno = wdetail.compolusory. 
                ELSE ASSIGN wdetail.policyno = "N72" + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 10 ).
                /*IF wdetail.compul = "Y" THEN  */ /* A64-0309 */
                IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */ 
                     ASSIGN wdetail.cr_2 = "N70" + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 10).
                END. /* A64-0309 */ 
            END.
            ELSE DO:
                IF wdetail.compolusory <> "" THEN ASSIGN wdetail.policyno = wdetail.compolusory. 
                ELSE ASSIGN wdetail.policyno = "N72" + TRIM(wdetail.chasno).
                /*IF wdetail.compul = "Y" THEN  */ /* A64-0309 */
                IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */ 
                    ASSIGN wdetail.cr_2 = "N70" + TRIM(wdetail.chasno).
                END. /* A64-0309 */ 
            END.
        END.
        ELSE DO: 
            IF wdetail.chasno <> "" THEN DO: 
                IF LENGTH(wdetail.chasno) > 10 THEN DO:
                    IF wdetail.compolusory <> "" THEN ASSIGN wdetail.policyno = wdetail.compolusory. 
                    ELSE ASSIGN wdetail.policyno = "R72" + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 10). 

                    /*IF wdetail.compul = "Y" THEN  */ /* A64-0309 */
                    IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */  
                            ASSIGN wdetail.cr_2 = "R70" + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 10).
                    END.  /* A64-0309 */
                END.
                ELSE DO:
                    IF wdetail.compolusory <> "" THEN ASSIGN wdetail.policyno = wdetail.compolusory. 
                    ELSE ASSIGN wdetail.policyno = "R72" + TRIM(wdetail.chasno). 

                    /*IF wdetail.compul = "Y" THEN  */ /* A64-0309 */
                    IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */
                        ASSIGN wdetail.cr_2 = "R70" + TRIM(wdetail.chasno).
                    END.  /* A64-0309 */
                END.
            END.
            ELSE DO: 
                IF wdetail.compolusory <> "" THEN ASSIGN wdetail.policyno = wdetail.compolusory. 
                ELSE ASSIGN wdetail.policyno = "R72" + TRIM(wdetail.prepol).

                /*IF wdetail.compul = "Y" THEN  */ /* A64-0309 */
                IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */ 
                    ASSIGN wdetail.cr_2 = "R70" + TRIM(wdetail.prepol).
                END.  /* A64-0309 */
            END.
        END.
    END.*/
    RUN proc_assigninit70_2.
   RELEASE wdetail.
   RELEASE wtxt.
   RELEASE wmemo.
   RELEASE wacces.
   RELEASE winst.
END.*/
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE 00-proc_base2 C-Win 
PROCEDURE 00-proc_base2 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
/* comment by : A64-0355...
DEF VAR i       AS INTE.
DEF VAR per     AS DECI.
DEF VAR f       AS DECI.
DEF VAR chk     AS LOGICAL.
DEF VAR model   AS CHAR FORMAT "x(30)".
DEF VAR aa      AS DECI.
ASSIGN fi_process = "Check Base data Load Text ...." + wdetail.policyno .
DISP fi_process WITH FRAM fr_main.
FIND sic_bran.uwm100 WHERE RECID(sic_bran.uwm100) = s_recid1 NO-WAIT NO-ERROR.
FIND sic_bran.uwm120 WHERE RECID(sic_bran.uwm120) = s_recid2 NO-WAIT NO-ERROR.
FIND sic_bran.uwm130 WHERE RECID(sic_bran.uwm130) = s_recid3 NO-WAIT NO-ERROR.
FIND sic_bran.uwm301 WHERE RECID(sic_bran.uwm301) = s_recid4 NO-WAIT NO-ERROR.

IF wdetail.poltyp = "V70" THEN DO:
    IF wdetail.base = 0 THEN DO:
       RUN wgs\wgsfbas.
       ASSIGN aa = nv_baseprm.
    END.
    ELSE aa = wdetail.base .

    IF aa = 0 THEN DO:
       RUN wgs\wgsfbas.
       ASSIGN aa = nv_baseprm.
    END.
    ASSIGN
        chk = NO
        NO_basemsg = " "
        f = DECI(wdetail.premt)
        i = 1
        nv_baseprm = aa
        nv_dss_per = 0
        nv_dss_per = deci(wdetail.dspc).
        
  /*  DO i = 1 TO 10:*/
        /*-----nv_drivcod---------------------*/
     ASSIGN nv_drivvar = ""
            nv_drivvar1 = wdetail.drivername1.
            nv_drivvar2 = wdetail.drivername2.
        IF wdetail.drivnam = "N" THEN  nv_drivno = 0.
        ELSE DO:
            IF wdetail.prepol = ""  THEN DO:
                IF wdetail.drivername1 <> ""   THEN  wdetail.drivnam  = "y".
                ELSE wdetail.drivnam  = "N".
                IF wdetail.drivername2 <> ""   THEN  nv_drivno = 2. 
                ELSE IF wdetail.drivername1 <> "" AND wdetail.drivername2 = "" THEN  nv_drivno = 1.  
                ELSE IF wdetail.drivername1  = "" AND wdetail.drivername2 = "" THEN  nv_drivno = 0.   
            END.
        END.
        IF wdetail.prepol = ""  THEN DO:
            If wdetail.drivnam  = "N"  Then 
                Assign nv_drivvar   = " "
                nv_drivcod   = "A000"
                nv_drivvar1  =  "     Unname Driver"
                nv_drivvar2  = "0"
                Substr(nv_drivvar,1,30)   = nv_drivvar1
                Substr(nv_drivvar,31,30)  = nv_drivvar2.
            ELSE DO:
                IF  nv_drivno  > 2  Then do:
                    Message " Driver'S NO. must not over 2. "  View-as alert-box.
                    ASSIGN wdetail.pass    = "N"
                        wdetail.comment = wdetail.comment +  "| Driver'S NO. must not over 2. ".  
                END.
                RUN proc_usdcod.
                Assign  nv_drivvar  = ""
                nv_drivvar     = nv_drivcod
                nv_drivvar1    = "     Driver name person = "
                nv_drivvar2    = String(nv_drivno)
                Substr(nv_drivvar,1,30)  = nv_drivvar1
                Substr(nv_drivvar,31,30) = nv_drivvar2.
            END.
        END.
        /*-------nv_baseprm----------*/
        IF NO_basemsg <> " " THEN  wdetail.WARNING = no_basemsg.
        IF nv_baseprm = 0  Then 
            ASSIGN  wdetail.pass    = "N"
            wdetail.comment = wdetail.comment + "| Base Premium is Mandatory field. ".  
        ASSIGN nv_basevar = " "
            nv_prem1 = nv_baseprm
            nv_basecod  = "BASE"
            nv_basevar1 = "     Base Premium = "
            nv_basevar2 = STRING(nv_baseprm)
            SUBSTRING(nv_basevar,1,30)   = nv_basevar1
            SUBSTRING(nv_basevar,31,30)  = nv_basevar2.
        /*-------nv_add perils----------*/
       /* IF wdetail.prepol <> "" THEN  ASSIGN  wdetail.no_411  = n_41
                                              wdetail.no_42   = n_42
                                              wdetail.no_43   = n_43.*/
       /* ASSIGN nv_41     =  deci(wdetail.no_41) 
               nv_42     =  deci(wdetail.no_42)
               nv_43     =  deci(wdetail.no_43)
               nv_seat41 = integer(wdetail.seat41).*/
        RUN WGS\WGSOPER(INPUT nv_tariff,       
                              nv_class,
                              nv_key_b,
                              nv_comdat).

        Assign  nv_411var = ""   nv_412var = ""                                                  
            nv_41cod1   = "411"
            nv_411var1  = "     PA Driver = "
            nv_411var2  =  STRING(wdetail.no_411)
            SUBSTRING(nv_411var,1,30)    = nv_411var1
            SUBSTRING(nv_411var,31,30)   = nv_411var2

            nv_41cod2   = "412"
            nv_412var1  = "     PA Passengers = "
            nv_412var2  =  STRING(wdetail.NO_412)
            SUBSTRING(nv_412var,1,30)   = nv_412var1
            SUBSTRING(nv_412var,31,30)  = nv_412var2
            nv_411prm  = wdetail.no_411
            nv_412prm  = wdetail.no_412.
         /* -------fi_42---------*/
        ASSIGN nv_42var    = " "  
            nv_42cod   = "42".
            nv_42var1  = "     Medical Expense = ".
            nv_42var2  = STRING(wdetail.no_42).
            SUBSTRING(nv_42var,1,30)   = nv_42var1.
            SUBSTRING(nv_42var,31,30)  = nv_42var2.
          /*---------fi_43--------*/
        ASSIGN nv_43var    = " "
            nv_43prm = nv_43
            nv_43cod   = "43"
            nv_43var1  = "     Airfrieght = "
            nv_43var2  =  STRING(wdetail.no_43)
            SUBSTRING(nv_43var,1,30)   = nv_43var1
            SUBSTRING(nv_43var,31,30)  = nv_43var2.
        RUN WGS\WGSOPER(INPUT nv_tariff,   /*pass*/ /*a490166 note modi*/
                        nv_class,
                        nv_key_b,
                        nv_comdat).      /*  RUN US\USOPER(INPUT nv_tariff,*/
        /*------nv_usecod------------*/
        ASSIGN nv_usevar = ""
            nv_usecod  = "USE" + TRIM(wdetail.vehuse)
            nv_usevar1 = "     Vehicle Use = "
            nv_usevar2 =  wdetail.vehuse
            Substring(nv_usevar,1,30)   = nv_usevar1
            Substring(nv_usevar,31,30) = nv_usevar2.
        /*-----nv_engcod-----------------*/
        ASSIGN nv_sclass =  wdetail.subclass.       
        RUN wgs\wgsoeng.   
        /*-----nv_yrcod----------------------------*/  
        ASSIGN nv_yrvar = ""
            nv_caryr   = (Year(nv_comdat)) - integer(wdetail.yrmanu) + 1
            nv_yrvar1  = "     Vehicle Year = "
            nv_yrvar2  =  wdetail.yrmanu
            nv_yrcod   = If nv_caryr <= 10 Then "YR" + String(nv_caryr) Else "YR99"
            Substr(nv_yrvar,1,30)    = nv_yrvar1
            Substr(nv_yrvar,31,30)   = nv_yrvar2.  
     /*-----nv_sicod----------------------------*/  
                                                                           
     Assign  nv_sivar   = "" 
             nv_totsi     = 0
             nv_sicod     = "SI"
             nv_sivar1    = "     Own Damage = "
             nv_sivar2    =  STRING(wdetail.si)
             SUBSTRING(nv_sivar,1,30)  = nv_sivar1
             SUBSTRING(nv_sivar,31,30) = string(deci(nv_sivar2))
             nv_totsi     =  DECI(wdetail.si).
     /*----------nv_grpcod--------------------*/
     ASSIGN nv_grpvar  = "" 
         nv_grpcod      = "GRP" + wdetail.cargrp
         nv_grpvar1     = "     Vehicle Group = "
         nv_grpvar2     = wdetail.cargrp
         Substr(nv_grpvar,1,30)  = nv_grpvar1
         Substr(nv_grpvar,31,30) = nv_grpvar2.
     /*-------------nv_bipcod--------------------*/
     ASSIGN nv_bipvar  = ""
         nv_bipcod      = "BI1"
         nv_bipvar1     = "     BI per Person = "
         nv_bipvar2     = STRING(sic_bran.uwm130.uom1_v)
         SUBSTRING(nv_bipvar,1,30)   = nv_bipvar1
         SUBSTRING(nv_bipvar,31,30)  = nv_bipvar2.
     /*-------------nv_biacod--------------------*/
     Assign nv_biavar  = ""
         nv_biacod      = "BI2"
         nv_biavar1     = "     BI per Accident = "
         nv_biavar2     = STRING(sic_bran.uwm130.uom2_v)
         SUBSTRING(nv_biavar,1,30)  = nv_biavar1
         SUBSTRING(nv_biavar,31,30) = nv_biavar2.
     /*-------------nv_pdacod--------------------*/
     ASSIGN nv_pdavar  = ""
         nv_pdacod      = "PD"
         nv_pdavar1     = "     PD per Accident = "
         nv_pdavar2     = string(deci(sic_bran.uwm130.uom5_v)) 
         SUBSTRING(nv_pdavar,1,30)  = nv_pdavar1
         SUBSTRING(nv_pdavar,31,30) = nv_pdavar2.
     /*--------------- deduct ----------------*/
      /* caculate deduct OD  */
         DEF VAR dod0 AS INTEGER init 0.
         DEF VAR dod1 AS INTEGER init 0.
         DEF VAR dod2 AS INTEGER init 0.
         DEF VAR dpd0 AS INTEGER init 0.
     IF wdetail.dod <> 0  THEN DO:
         dod0 = wdetail.dod.
         IF dod0 > 3000 THEN DO:
             dod1 = 3000.
             dod2 = dod0 - dod1.
         END.
         ELSE dod1 = dod0.
         ASSIGN
             nv_odcod    = "DC01"
             nv_prem     =  dod1
             nv_sivar2   = "" .  
         RUN Wgs\Wgsmx024( nv_tariff,              
                           nv_odcod,
                           nv_class,
                           nv_key_b,
                           nv_comdat,
                           INPUT-OUTPUT nv_prem,
                           OUTPUT nv_chk ,
                           OUTPUT nv_baseap).
         IF NOT nv_chk THEN DO:
             MESSAGE  " DEDUCTIBLE EXCEED THE LIMIT " nv_baseap  View-as alert-box.
             ASSIGN
                 wdetail.pass    = "N"
                 wdetail.comment = wdetail.comment + "| DEDUCTIBLE EXCEED THE LIMIT ".
         END.
         ASSIGN nv_dedod1var  = ""
             nv_ded1prm        = nv_prem
             nv_dedod1_prm     = nv_prem
             nv_dedod1_cod     = "DOD"
             nv_dedod1var1     = "     Deduct OD = "
             nv_dedod1var2     = STRING(dod1)
             SUBSTRING(nv_dedod1var,1,30)  = nv_dedod1var1
             SUBSTRING(nv_dedod1var,31,30) = nv_dedod1var2.
         /*add od*/
         Assign  
             nv_dedod2var   = " "
             nv_cons  = "AD"
             nv_ded   = dod2.
         Run  Wgs\Wgsmx025(INPUT  nv_ded,  
                                  nv_tariff,
                                  nv_class,
                                  nv_key_b,
                                  nv_comdat,
                                  nv_cons,
                           OUTPUT nv_prem).      
         Assign
             nv_aded1prm     = nv_prem
             nv_dedod2_cod   = "DOD2"
             nv_dedod2var1   = "     Add Ded.OD = "
             nv_dedod2var2   =  STRING(dod2)
             SUBSTRING(nv_dedod2var,1,30)  = nv_dedod2var1
             SUBSTRING(nv_dedod2var,31,30) = nv_dedod2var2
             nv_dedod2_prm   = nv_prem.
     END.
     /***** pd *******/
     IF wdetail.DPD <> 0 THEN DO:
        Assign
            dpd0         = 0
            dpd0         = wdetail.dpd
            nv_dedpdvar  = " "
            nv_cons  = "PD"
            nv_ded   = dpd0.
        Run  Wgs\Wgsmx025(INPUT  nv_ded, 
                                 nv_tariff,
                                 nv_class,
                                 nv_key_b,
                                 nv_comdat,
                                 nv_cons,
                          OUTPUT nv_prem).
        nv_ded2prm    = nv_prem.
        ASSIGN
            nv_dedpd_cod   = "DPD"
            nv_dedpdvar1   = "     Deduct PD = "
            nv_dedpdvar2   =  STRING(nv_ded)
            SUBSTRING(nv_dedpdvar,1,30)    = nv_dedpdvar1
            SUBSTRING(nv_dedpdvar,31,30)   = nv_dedpdvar2
            nv_dedpd_prm  = nv_prem.
     END.
     /*---------- fleet -------------------*/
     ASSIGN nv_flet_per = 0
            nv_flet_per = INTE(wdetail.fleet).
     IF nv_flet_per <> 0 AND  nv_flet_per <> 10 Then do:
         Message  " Fleet Percent must be 0 or 10. " View-as alert-box.
         ASSIGN
             wdetail.pass    = "N"
             wdetail.comment = wdetail.comment + "| Fleet Percent must be 0 or 10. ".
     End.
     IF nv_flet_per = 0 Then do:
         ASSIGN nv_flet     = 0
                nv_fletvar  = " ".
     End.
     RUN WGS\WGSORPRM.P (INPUT  nv_tariff, /*pass*/
                                nv_class,
                                nv_covcod,
                                nv_key_b,
                                nv_comdat,
                                DECI(wdetail.si),
                                uwm130.uom1_v,
                                uwm130.uom2_v,
                                uwm130.uom5_v).
     ASSIGN  nv_fletvar = " "      
         nv_fletvar1    = "     Fleet % = "
         nv_fletvar2    =  STRING(nv_flet_per)
         SUBSTRING(nv_fletvar,1,30)     = nv_fletvar1
         SUBSTRING(nv_fletvar,31,30)    = nv_fletvar2.
     IF nv_flet   = 0  THEN nv_fletvar  = " ".
     /*---------------- NCB -------------------*/
     ASSIGN NV_NCBPER = 0
            NV_NCBPER = INTE(WDETAIL.NCB).
     nv_ncbvar = " ".
     If nv_ncbper  <> 0 Then do:
         Find first sicsyac.xmm104 Use-index xmm10401 Where
             sicsyac.xmm104.tariff = nv_tariff           AND
             sicsyac.xmm104.class  = nv_class            AND 
             sicsyac.xmm104.covcod = nv_covcod           AND 
             sicsyac.xmm104.ncbper   = INTE(wdetail.ncb) No-lock no-error no-wait.
         IF not avail  sicsyac.xmm104  Then do:
             Message " This NCB Step not on NCB Rates file xmm104. " View-as alert-box.
             ASSIGN wdetail.pass    = "N"
                 wdetail.comment = wdetail.comment + "| This NCB Step not on NCB Rates file xmm104. ".
         END.
         ELSE ASSIGN nv_ncbper = xmm104.ncbper   
                     nv_ncbyrs = xmm104.ncbyrs.
     END.
     Else do:  
         ASSIGN nv_ncbyrs =   0
                nv_ncbper =   0
                nv_ncb    =   0.
     END.
     RUN WGS\WGSORPRM.P (INPUT  nv_tariff, /*pass*/
                                nv_class,
                                nv_covcod,
                                nv_key_b,
                                nv_comdat,
                                DECI(wdetail.si),
                                uwm130.uom1_v,
                                uwm130.uom2_v,
                                uwm130.uom5_v).
     
     nv_ncbvar   = " ".
     IF  nv_ncb <> 0  THEN
         ASSIGN 
         nv_ncbvar1   = "     NCB % = "
         nv_ncbvar2   =  STRING(nv_ncbper)
         SUBSTRING(nv_ncbvar,1,30)    = nv_ncbvar1
         SUBSTRING(nv_ncbvar,31,30)   = nv_ncbvar2.
     /*------------------ dsspc ---------------*/
     IF nv_dss_per = 0  AND nv_gapprm <> f AND wdetail.prepol = "" THEN  DO:
            /* A61-0324*/
            IF wdetail.prepol =  "" THEN DO:
               IF nv_gapprm > f THEN 
                   ASSIGN per = TRUNCATE((nv_gapprm - f ),1).
               ELSE ASSIGN per = 0.
            END.
            ELSE ASSIGN per = nv_dss_per.
           
            per = TRUNCATE((per * 100 ),1).
            per = ROUND((per / nv_gapprm ),2). 
            per = IF per <= 33 THEN per ELSE 33 .  /*A61-0324*/
            per = IF per <= (-1) THEN 0 ELSE per. /*A61-0324*/
          Assign  nv_dss_per =  per . 
     END.
     nv_dsspcvar   = " ".
     IF  nv_dss_per   <> 0  THEN
       Assign
       nv_dsspcvar1   = "     Discount Special % = "
       nv_dsspcvar2   =  STRING(nv_dss_per)
       SUBSTRING(nv_dsspcvar,1,30)    = nv_dsspcvar1
       SUBSTRING(nv_dsspcvar,31,30)   = nv_dsspcvar2.
      RUN WGS\WGSORPRM.P (INPUT  nv_tariff,   /*pass*/
                                 nv_class,
                                 nv_covcod,
                                 nv_key_b,
                                 nv_comdat,
                                 nv_totsi,
                                 nv_uom1_v ,       
                                 nv_uom2_v ,       
                                 nv_uom5_v ).
    /*----------- CL ------------*/
    nv_clmvar  = " ".                                    
    nv_cl_per  = DECI(wdetail.claim). /*A60-0150*/      
    IF nv_cl_per  <> 0  THEN                             
        Assign                                           
        nv_clmvar1   = " Load Claim % = "                
        nv_clmvar2   =  STRING(nv_cl_per)                
        SUBSTRING(nv_clmvar,1,30)    = nv_clmvar1        
        SUBSTRING(nv_clmvar,31,30)   = nv_clmvar2.       
    RUN WGS\WGSORPRM.P (INPUT nv_tariff,                 
                        nv_class,                        
                        nv_covcod,                       
                        nv_key_b,                        
                        nv_comdat,                       
                        nv_totsi,                        
                        uwm130.uom1_v,                   
                        uwm130.uom2_v,                   
                        uwm130.uom5_v).                  
                                                         
    /* *------------------ stf ---------------*/         
    nv_stfvar   = " ".                                   
    nv_stf_per  = DECI(wdetail.dstf). /*A60-0150*/    
    IF  nv_stf_per   <> 0  THEN                          
    Assign                                               
         nv_stfvar1   = "     Discount Staff"            
         nv_stfvar2   =  STRING(nv_stf_per)              
         SUBSTRING(nv_stfvar,1,30)    = nv_stfvar1       
         SUBSTRING(nv_stfvar,31,30)   = nv_stfvar2.  
   
     RUN WGS\WGSORPRM.P (INPUT  nv_tariff, /*pass*/
                         nv_class,
                         nv_covcod,
                         nv_key_b,
                         nv_comdat,
                         nv_totsi,
                         nv_uom1_v ,       
                         nv_uom2_v ,       
                         nv_uom5_v ). 
END.
..end A64-0335...*/
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE 00-proc_base2plus C-Win 
PROCEDURE 00-proc_base2plus :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
/* comment by : a64-0355...
DEF VAR chk     AS LOGICAL.
DEF VAR model   AS CHAR FORMAT "x(30)".
DEF VAR aa      AS DECI.
ASSIGN fi_process = "Check Base Plus Data Text 2+3+...." + wdetail.policyno .
DISP fi_process WITH FRAM fr_main.
FIND sic_bran.uwm100 WHERE RECID(sic_bran.uwm100) = s_recid1 NO-WAIT NO-ERROR.
FIND sic_bran.uwm120 WHERE RECID(sic_bran.uwm120) = s_recid2 NO-WAIT NO-ERROR.
FIND sic_bran.uwm130 WHERE RECID(sic_bran.uwm130) = s_recid3 NO-WAIT NO-ERROR.
FIND sic_bran.uwm301 WHERE RECID(sic_bran.uwm301) = s_recid4 NO-WAIT NO-ERROR.
IF wdetail.poltyp = "v70" THEN DO:
    IF wdetail.base <> 0 THEN aa = wdetail.base .
    ELSE IF (wdetail.covcod = "2.1") OR (wdetail.covcod = "3.1") OR (wdetail.covcod = "2.2") OR (wdetail.covcod = "3.2") THEN DO: 
        RUN wgs\wgsfbas.
        ASSIGN aa = nv_baseprm.
    END.
    IF aa = 0 THEN DO:
        RUN wgs\wgsfbas.
        ASSIGN aa = nv_baseprm.
    END.
    ASSIGN
        chk = NO
        NO_basemsg  = " "
        nv_baseprm  = aa
        nv_dss_per  = 0 
        nv_dss_per  = deci(wdetail.dspc)
        nv_drivvar1 = wdetail.drivername1   /*-----nv_drivcod---------------------*/
        nv_drivvar2 = wdetail.drivername2.
    IF wdetail.drivnam = "n" THEN  nv_drivno = 0.
    ELSE DO:
        IF      wdetail.drivername1 <> ""   THEN  wdetail.drivnam  = "y".
        ELSE    wdetail.drivnam     = "N".

        IF      wdetail.drivername2 <> ""   THEN  nv_drivno = 2. 
        ELSE IF wdetail.drivername1 <> "" AND wdetail.drivername2 = "" THEN  nv_drivno = 1.  
        ELSE IF wdetail.drivername1  = "" AND wdetail.drivername2 = "" THEN  nv_drivno = 0.   
    END.
    If wdetail.drivnam  = "N"  Then 
        Assign nv_drivvar   = " "
        nv_drivcod   = "A000"
        nv_drivvar1  =  "     Unname Driver"
        nv_drivvar2  = "0"
        Substr(nv_drivvar,1,30)   = nv_drivvar1
        Substr(nv_drivvar,31,30)  = nv_drivvar2.
    ELSE DO:
        IF  nv_drivno  > 2  Then do:
            Message " Driver'S NO. must not over 2. "  View-as alert-box.
            ASSIGN wdetail.pass    = "N"
                    wdetail.comment = wdetail.comment +  "| Driver'S NO. must not over 2. ".  
        END.
        RUN proc_usdcod.
        ASSIGN nv_drivvar  = " "
            nv_drivvar     = nv_drivcod
            nv_drivvar1    = "     Driver name person = "
            nv_drivvar2    = String(nv_drivno)
            Substr(nv_drivvar,1,30)  = nv_drivvar1
            Substr(nv_drivvar,31,30) = nv_drivvar2.
    END.
    /*-------nv_baseprm----------*/
    nv_basevar = "" .
    IF NO_basemsg <> " " THEN  wdetail.WARNING = no_basemsg.
    IF nv_baseprm = 0  Then 
        ASSIGN  wdetail.pass    = "N"
        wdetail.comment = wdetail.comment + "| Base Premium is Mandatory field. ".  
    ASSIGN nv_prem1 = nv_baseprm
        nv_basecod  = "BASE"
        nv_basevar1 = "     Base Premium = "
        nv_basevar2 = STRING(nv_baseprm)
        SUBSTRING(nv_basevar,1,30)   = nv_basevar1
        SUBSTRING(nv_basevar,31,30)  = nv_basevar2.
    ASSIGN  nv_seat41 = integer(wdetail.seat41).
    RUN WGS\WGSOPER(INPUT nv_tariff,       
                    nv_class,
                    nv_key_b,
                    nv_comdat). 

    Assign nv_411var = ""   nv_412var = ""                                                  
        nv_41cod1   = "411"
        nv_411var1  = "     PA Driver = "
        nv_411var2  =  STRING(wdetail.NO_411)
        SUBSTRING(nv_411var,1,30)    = nv_411var1
        SUBSTRING(nv_411var,31,30)   = nv_411var2
        nv_41cod2   = "412"
        nv_412var1  = "     PA Passengers = "
        nv_412var2  =  STRING(wdetail.NO_412)
        SUBSTRING(nv_412var,1,30)   = nv_412var1
        SUBSTRING(nv_412var,31,30)  = nv_412var2
        nv_411prm  = nv_41 
        nv_412prm  = nv_41 .
    ASSIGN  nv_42var    = " "     /* -------fi_42---------*/
        nv_42cod   = "42"
        nv_42var1  = "     Medical Expense = "
        nv_42var2  = STRING(wdetail.no_42)
        SUBSTRING(nv_42var,1,30)   = nv_42var1
        SUBSTRING(nv_42var,31,30)  = nv_42var2 .
   ASSIGN  nv_43var    = " "     /*---------fi_43--------*/
        nv_43prm = nv_43
        nv_43cod   = "43"
        nv_43var1  = "     Airfrieght = "
        nv_43var2  =  STRING(wdetail.no_43)
        SUBSTRING(nv_43var,1,30)   = nv_43var1
        SUBSTRING(nv_43var,31,30)  = nv_43var2.
    RUN WGS\WGSOPER(INPUT nv_tariff,   /*pass*/ /*a490166 note modi*/
                    nv_class,
                    nv_key_b,
                    nv_comdat).      /*  RUN US\USOPER(INPUT nv_tariff,*/
    /*------nv_usecod------------*/
    ASSIGN nv_usevar = ""
        nv_usecod  = "USE" + TRIM(wdetail.vehuse)
        nv_usevar1 = "     Vehicle Use = "
        nv_usevar2 =  wdetail.vehuse
        Substring(nv_usevar,1,30)   = nv_usevar1
        Substring(nv_usevar,31,30) = nv_usevar2.
    /*-----nv_engcod-----------------*/
    ASSIGN nv_sclass =  wdetail.subclass.       
    RUN wgs\wgsoeng.

    /*-----nv_yrcod---------- 1. ------------------*/  
    ASSIGN nv_yrvar = ""
        nv_caryr   = (Year(nv_comdat)) - integer(wdetail.yrmanu) + 1
        nv_yrvar1  = "     Vehicle Year = "
        nv_yrvar2  =  wdetail.yrmanu
        nv_yrcod   = If nv_caryr <= 10 Then "YR" + String(nv_caryr) Else "YR99"
        Substr(nv_yrvar,1,30)    = nv_yrvar1
        Substr(nv_yrvar,31,30)   = nv_yrvar2.  
    /*-----nv_sicod----------------------------*/  
    Assign nv_sivar = " " 
        nv_totsi = 0        nv_sicod     = "SI"
        nv_sivar1    = "     Own Damage = "
        nv_sivar2    =  STRING(wdetail.siplus)       
        wdetail.si   =  wdetail.siplus       
        SUBSTRING(nv_sivar,1,30)  = nv_sivar1
        SUBSTRING(nv_sivar,31,30) = string(deci(nv_sivar2))
        nv_totsi     = deci(wdetail.siplus) .  /*A62-0215*/
    /*----------nv_grpcod--------------------*/
    ASSIGN  nv_grpvar  = ""
        nv_grpcod      = "GRP" + wdetail.cargrp
        nv_grpvar1     = "     Vehicle Group = "
        nv_grpvar2     = wdetail.cargrp
        Substr(nv_grpvar,1,30)  = nv_grpvar1
        Substr(nv_grpvar,31,30) = nv_grpvar2.
    /*-------------nv_bipcod--------------------*/
    ASSIGN nv_bipvar   = ""
        nv_bipcod      = "BI1"
        nv_bipvar1     = "     BI per Person = "
        nv_bipvar2     = STRING(sic_bran.uwm130.uom1_v)
        SUBSTRING(nv_bipvar,1,30)   = nv_bipvar1
        SUBSTRING(nv_bipvar,31,30)  = nv_bipvar2.
    /*-------------nv_biacod--------------------*/
    Assign nv_biavar  = ""
        nv_biacod      = "BI2"
        nv_biavar1     = "     BI per Accident = "
        nv_biavar2     = STRING(sic_bran.uwm130.uom2_v)
        SUBSTRING(nv_biavar,1,30)  = nv_biavar1
        SUBSTRING(nv_biavar,31,30) = nv_biavar2.
    /*-------------nv_pdacod--------------------*/
    IF (wdetail.covcod = "2.1") THEN nv_usecod3 = "U" + TRIM(nv_vehuse) + "21" .
    ELSE IF (wdetail.covcod = "2.2") THEN nv_usecod3 = "U" + TRIM(nv_vehuse) + "22" .  /*a62-0215*/
    ELSE IF (wdetail.covcod = "3.2") THEN nv_usecod3 = "U" + TRIM(nv_vehuse) + "32" .  /*a62-0215*/
    ELSE nv_usecod3 = "U" + TRIM(nv_vehuse) + "31" .
    ASSIGN nv_usevar3  = ""  
        nv_usevar4 = "     Vehicle Use = "
        nv_usevar5 =  wdetail.vehuse
        Substring(nv_usevar3,1,30)   = nv_usevar4
        Substring(nv_usevar3,31,30)  = nv_usevar5.
    /*------------ base3 --------------*/
    ASSIGN  nv_basecod3 = IF (wdetail.covcod = "2.1") THEN "BA21" 
                          ELSE IF (wdetail.covcod = "2.2") THEN "BA22"
                          ELSE IF (wdetail.covcod = "3.1") THEN "BA31" ELSE "BA32". 
    IF wdetail.baseplus = 0 THEN DO:
     FIND FIRST sicsyac.xmm106 USE-INDEX xmm10601 WHERE
         sicsyac.xmm106.tariff = nv_tariff   AND
         sicsyac.xmm106.bencod = nv_basecod3 AND
         sicsyac.xmm106.covcod = nv_covcod   AND
         sicsyac.xmm106.class  = nv_class    AND
         sicsyac.xmm106.key_b  GE nv_key_b   AND
         sicsyac.xmm106.effdat LE nv_comdat  NO-LOCK NO-ERROR NO-WAIT.
     IF AVAIL sicsyac.xmm106 THEN  nv_baseprm3 = xmm106.min_ap.
     ELSE  nv_baseprm3 = 0.
    END.
    ELSE nv_baseprm3 = wdetail.baseplus .
    ASSIGN nv_basevar3 = ""
        nv_basevar4 = "     Base Premium3 = "
        nv_basevar5 = STRING(nv_baseprm3)
        SUBSTRING(nv_basevar3,1,30)   = nv_basevar4
        SUBSTRING(nv_basevar3,31,30)  = nv_basevar5. 
    /*---------- SI plus -------------*/
     ASSIGN nv_sivar3 = ""
        nv_sicod3    = IF (wdetail.covcod = "2.1") THEN "SI21"
                       ELSE IF (wdetail.covcod = "2.2") THEN "SI22" 
                       ELSE IF (wdetail.covcod = "3.1") THEN "SI31"  ELSE "SI32" 
        nv_sivar4    = "     Own Damage = "                                                                                              
        nv_sivar5    =  string(INT(wdetail.siplus)) 
        wdetail.si   =  INT(wdetail.siplus) 
        SUBSTRING(nv_sivar3,1,30)  = nv_sivar4
        SUBSTRING(nv_sivar3,31,30) = nv_sivar5 .
        nv_siprm3    = DECI(wdetail.siplus) .
    /*----------- PD --------------*/
    ASSIGN nv_pdavar    = ""
         nv_pdacod      = "PD"
         nv_pdavar1     = "     PD per Accident = " 
         nv_pdavar2     = string(deci(sic_bran.uwm130.uom5_v))        
         SUBSTRING(nv_pdavar,1,30)  = nv_pdavar1
         SUBSTRING(nv_pdavar,31,30) = nv_pdavar2.
     RUN WGS\WGSORPR1.P (INPUT  nv_tariff,  
                                nv_class,
                                nv_covcod,
                                nv_key_b,
                                nv_comdat,
                                DECI(wdetail.si),
                                uwm130.uom1_v,
                                uwm130.uom2_v,
                                uwm130.uom5_v).   /*kridtiya i.*/
     /*--------------- deduct ----------------*/
     /* caculate deduct OD  */
     DEF VAR dod0 AS INTEGER init 0.
     DEF VAR dod1 AS INTEGER init 0.
     DEF VAR dod2 AS INTEGER init 0.
     DEF VAR dpd0 AS INTEGER init 0.  

     IF wdetail.dod <> 0  THEN DO: 
         dod0 = wdetail.dod .
         IF dod0 > 3000 THEN DO:
            dod1 = 3000.
            dod2 = dod0 - dod1.
         END.
         ELSE dod1 = dod0.
        
        ASSIGN DOD2        = 0
             nv_odcod    = "DC01"
             nv_prem     =  dod1 
             nv_sivar2   =  "" . 
         RUN Wgs\Wgsmx024( nv_tariff,              
                           nv_odcod,
                           nv_class,
                           nv_key_b,
                           nv_comdat,
                           INPUT-OUTPUT nv_prem,
                           OUTPUT nv_chk ,
                           OUTPUT nv_baseap). 
         IF NOT nv_chk THEN DO:
             MESSAGE  " DEDUCTIBLE EXCEED THE LIMIT " nv_baseap nv_prem   View-as alert-box.
             ASSIGN
                 wdetail.pass    = "N"
                 wdetail.comment = wdetail.comment + "| DEDUCTIBLE EXCEED THE LIMIT ".
         END.
         /*dod*/
         ASSIGN  nv_ded1prm    = 0
                 nv_dedod1_prm = 0
             nv_ded1prm        = nv_prem
             nv_dedod1_prm     = nv_prem.    /*A57-0176 */
         RUN WGS\WGSORPR1.P (INPUT  nv_tariff,  /*pass*/
                                    nv_class,
                                    nv_covcod,
                                    nv_key_b,
                                    nv_comdat,
                                    DECI(wdetail.si),
                                    uwm130.uom1_v,
                                    uwm130.uom2_v,
                                    uwm130.uom5_v).  
         ASSIGN
             nv_dedod1var      = ""
             nv_dedod1_cod     = "DOD"
             nv_dedod1var1     = "     Deduct OD = "
             nv_dedod1var2     = STRING(dod1)
             SUBSTRING(nv_dedod1var,1,30)  = nv_dedod1var1
             SUBSTRING(nv_dedod1var,31,30) = nv_dedod1var2  .
         /*add od*/
         Assign  
             nv_dedod2var   = " "
             nv_cons  = "AD"
             nv_ded   = dod2.
         Run  Wgs\Wgsmx025(INPUT  nv_ded,  
                                  nv_tariff,
                                  nv_class,
                                  nv_key_b,
                                  nv_comdat,
                                  nv_cons,
                           OUTPUT nv_prem).      
         Assign
             nv_aded1prm     = nv_prem
             nv_dedod2_cod   = "DOD2"
             nv_dedod2var1   = "     Add Ded.OD = "
             nv_dedod2var2   =  STRING(dod2)
             SUBSTRING(nv_dedod2var,1,30)  = nv_dedod2var1
             SUBSTRING(nv_dedod2var,31,30) = nv_dedod2var2
             nv_dedod2_prm   = nv_prem.
     END.
     /***** pd *******/
     IF wdetail.dpd <> 0  THEN DO:
         dpd0 = wdetail.dpd .
        Assign
            nv_dedpdvar  = " "
            nv_cons  = "PD"
            nv_ded   = dpd0.
        Run  Wgs\Wgsmx025(INPUT  nv_ded, 
                                 nv_tariff,
                                 nv_class,
                                 nv_key_b,
                                 nv_comdat,
                                 nv_cons,
                          OUTPUT nv_prem).
        nv_ded2prm    = nv_prem.
        ASSIGN
            nv_dedpd_cod   = "DPD"
            nv_dedpdvar1   = "     Deduct PD = "
            nv_dedpdvar2   =  STRING(nv_ded)
            SUBSTRING(nv_dedpdvar,1,30)    = nv_dedpdvar1
            SUBSTRING(nv_dedpdvar,31,30)   = nv_dedpdvar2
            nv_dedpd_prm  = nv_prem  .    /*A57-0177*/
     END.
      /*---------- fleet -------------------*/
     nv_flet_per = INTE(wdetail.fleet).
     IF nv_flet_per <> 0 AND  nv_flet_per <> 10 Then do:
         Message  " Fleet Percent must be 0 or 10. " View-as alert-box.
         ASSIGN
             wdetail.pass    = "N"
             wdetail.comment = wdetail.comment + "| Fleet Percent must be 0 or 10. ".
     End.
     IF nv_flet_per = 0 Then do:
         ASSIGN nv_flet     = 0
             nv_fletvar  = " ".
     End.
     RUN WGS\WGSORPR1.P (INPUT  nv_tariff, /*pass*/
                                nv_class,
                                nv_covcod,
                                nv_key_b,
                                nv_comdat,
                                DECI(wdetail.si),
                                uwm130.uom1_v,
                                uwm130.uom2_v,
                                uwm130.uom5_v).
     ASSIGN  nv_fletvar     = " "
         nv_fletvar1    = "     Fleet % = "
         nv_fletvar2    =  STRING(nv_flet_per)
         SUBSTRING(nv_fletvar,1,30)     = nv_fletvar1
         SUBSTRING(nv_fletvar,31,30)    = nv_fletvar2.
     IF nv_flet   = 0  THEN nv_fletvar  = " ".
     /*---------------- NCB -------------------*/
     NV_NCBPER = INTE(WDETAIL.NCB).
     nv_ncbvar = " ".
     If nv_ncbper  <> 0 Then do:
         Find first sicsyac.xmm104 Use-index xmm10401 Where
             sicsyac.xmm104.tariff = nv_tariff           AND
             sicsyac.xmm104.class  = nv_class            AND 
             sicsyac.xmm104.covcod = nv_covcod           AND 
             sicsyac.xmm104.ncbper   = INTE(wdetail.ncb) No-lock no-error no-wait.
         IF not avail  sicsyac.xmm104  Then do:
             Message " This NCB Step not on NCB Rates file xmm104. " View-as alert-box.
             ASSIGN 
                 wdetail.pass    = "N"
                 wdetail.comment = wdetail.comment + "| This NCB Step not on NCB Rates file xmm104. ".
         END.
         ELSE ASSIGN nv_ncbper = sicsyac.xmm104.ncbper   
                     nv_ncbyrs = sicsyac.xmm104.ncbyrs.
     END.
     Else do:  
         ASSIGN nv_ncbyrs =   0
             nv_ncbper    =   0
             nv_ncb       =   0.
     END.
     RUN WGS\WGSORPR1.P (INPUT  nv_tariff, /*pass*/
                                nv_class,
                                nv_covcod,
                                nv_key_b,
                                nv_comdat,
                                DECI(wdetail.si),
                                sic_bran.uwm130.uom1_v,
                                sic_bran.uwm130.uom2_v,
                                sic_bran.uwm130.uom5_v).
     
     nv_ncbvar   = " ".
     IF  nv_ncb <> 0  THEN
         ASSIGN 
         nv_ncbvar1   = "     NCB % = "
         nv_ncbvar2   =  STRING(nv_ncbper)
         SUBSTRING(nv_ncbvar,1,30)    = nv_ncbvar1
         SUBSTRING(nv_ncbvar,31,30)   = nv_ncbvar2.
     
     /*------------------ dsspc ---------------*/
      IF  nv_dss_per   <> 0  THEN 
          ASSIGN nv_dsspcvar = " "
          nv_dsspcvar1   = "     Discount Special % = "
          nv_dsspcvar2   =  STRING(nv_dss_per)
          SUBSTRING(nv_dsspcvar,1,30)    = nv_dsspcvar1
          SUBSTRING(nv_dsspcvar,31,30)   = nv_dsspcvar2.
      /*--------------------------*/
      RUN WGS\WGSORPR1.P (INPUT  nv_tariff, /*pass*/
                      nv_class,
                      nv_covcod,
                      nv_key_b,
                      nv_comdat,
                      nv_totsi,
                      nv_uom1_v ,       
                      nv_uom2_v ,       
                      nv_uom5_v ). 
      
    /*----------- CL ------------*/
    nv_clmvar  = " ".                                    
    nv_cl_per  = DECI(wdetail.claim). /*A60-0150*/      
    IF nv_cl_per  <> 0  THEN                             
        Assign                                           
        nv_clmvar1   = " Load Claim % = "                
        nv_clmvar2   =  STRING(nv_cl_per)                
        SUBSTRING(nv_clmvar,1,30)    = nv_clmvar1        
        SUBSTRING(nv_clmvar,31,30)   = nv_clmvar2.       
    RUN WGS\WGSORPRM.P (INPUT nv_tariff,                 
                        nv_class,                        
                        nv_covcod,                       
                        nv_key_b,                        
                        nv_comdat,                       
                        nv_totsi,                        
                        uwm130.uom1_v,                   
                        uwm130.uom2_v,                   
                        uwm130.uom5_v).                  
                                                         
    /* *------------------ stf ---------------*/         
    nv_stfvar   = " ".                                   
    nv_stf_per  = DECI(wdetail.dstf). /*A60-0150*/    
    IF  nv_stf_per   <> 0  THEN                          
    Assign                                               
         nv_stfvar1   = "     Discount Staff"            
         nv_stfvar2   =  STRING(nv_stf_per)              
         SUBSTRING(nv_stfvar,1,30)    = nv_stfvar1       
         SUBSTRING(nv_stfvar,31,30)   = nv_stfvar2.  
   
     RUN WGS\WGSORPRM.P (INPUT  nv_tariff, /*pass*/
                         nv_class,
                         nv_covcod,
                         nv_key_b,
                         nv_comdat,
                         nv_totsi,
                         nv_uom1_v ,       
                         nv_uom2_v ,       
                         nv_uom5_v ). 
            
END.
..end A64-0335 ..*/
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE 00-proc_calpremt C-Win 
PROCEDURE 00-proc_calpremt :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes: Add by A64-0355     
------------------------------------------------------------------------------*/
/* comment by : A68-0044...
DEF VAR chk     AS LOGICAL.
DEF VAR n_prem  AS DECI.
FIND sic_bran.uwm100 WHERE RECID(sic_bran.uwm100) = s_recid1 NO-WAIT NO-ERROR.
FIND sic_bran.uwm120 WHERE RECID(sic_bran.uwm120) = s_recid2 NO-WAIT NO-ERROR.
FIND sic_bran.uwm130 WHERE RECID(sic_bran.uwm130) = s_recid3 NO-WAIT NO-ERROR.
FIND sic_bran.uwm301 WHERE RECID(sic_bran.uwm301) = s_recid4 NO-WAIT NO-ERROR.

IF wdetail.poltyp = "V70" THEN DO:
    ASSIGN fi_process = "Create data to base..." + wdetail.policy .
    DISP fi_process WITH FRAM fr_main.
    ASSIGN 
         nv_polday  = 0 
         nv_covcod  = ""  
         nv_class   = ""  
         nv_vehuse  = ""  
         nv_cstflg  = ""  /*C=CC ; S=Seat ; T=Tons ; W=Watts*/    
         nv_engcst  = 0   /* ต้องใส่ค่าตาม nv_cstflg  */         
         /*nv_drivno  = 0*/
         nv_driage1 = 0
         nv_driage2 = 0
         nv_pdprm0  = 0  /*เบี้ยส่วนลดผู้ขับขี่*/
         nv_yrmanu  = 0
         nv_totsi   = 0
         nv_totfi   = 0
         nv_vehgrp  = ""
         nv_access  = ""
         nv_supe    = NO
         nv_tpbi1si = 0
         nv_tpbi2si = 0
         nv_tppdsi  = 0   
         nv_411si   = 0
         nv_412si   = 0
         nv_413si   = 0
         nv_414si   = 0  
         nv_42si    = 0
         nv_43si    = 0
         nv_41prmt  = 0
         nv_42prmt  = 0
         nv_43prmt  = 0
         nv_adjpaprm   = NO /*F68-0001*/
         nv_seat41  = 0          
         nv_dedod   = 0
         nv_addod   = 0
         nv_dedpd   = 0        
         nv_ncbp    = 0
         nv_fletp   = 0
         nv_dspcp   = 0
         nv_dstfp   = 0
         nv_clmp    = 0
         nv_baseprm  = 0
         nv_baseprm3 = 0
         nv_pdprem   = 0
         nv_netprem = 0     /*เบี้ยสุทธิ */
         nv_gapprm  = 0     /*เบี้ยรวม */
         nv_flagprm = "N"   /* N = เบี้ยสุทธิ, G = เบี้ยรวม */
         nv_effdat  = ?
         nv_ratatt  = 0        
         nv_siatt   = 0        
         nv_netatt  = 0        
         nv_fltatt  = 0        
         nv_ncbatt  = 0        
         nv_dscatt  = 0 
         nv_status  = "" 
         nv_fcctv   = NO
         nv_uom1_c  = "" 
         nv_uom2_c  = "" 
         nv_uom5_c  = "" 
         nv_uom6_c  = "" 
         nv_uom7_c  = ""
         nv_message = "" .

    ASSIGN               
         nv_covcod  = wdetail.covcod                                              
         nv_class   = trim(wdetail.prempa) + trim(wdetail.subclass)     /* T110 */                                     
         nv_vehuse  = wdetail.vehuse                                    
       /*nv_cstflg  = "C"  /*C=CC ; S=Seat ; T=Tons ; W=Watts*/ 
         nv_engcst  = 1900*/ /* ต้องใส่ค่าตาม nv_cstflg         
         nv_drivno  = 0   */                                     
         nv_driage1 = nv_drivage1                                 
         nv_driage2 = nv_drivage2                                    
         nv_yrmanu  = INT(wdetail.yrmanu)                         
         nv_totsi   = sic_bran.uwm130.uom6_v       
         nv_totfi   = sic_bran.uwm130.uom7_v
         nv_vehgrp  = wdetail.cargrp                                                     
         nv_access  = IF wdetail.special <> "A" THEN "" ELSE TRIM(wdetail.special)                                          
       /*nv_supe    = NO*/                                              
         nv_tpbi1si = nv_uom1_v             
         nv_tpbi2si = nv_uom2_v             
         nv_tppdsi  = nv_uom5_v             
         nv_411si   = wdetail.NO_411       
         nv_412si   = wdetail.NO_412       
         nv_413si   = wdetail.NO_413                       
         nv_414si   = wdetail.NO_414                     
         nv_42si    = wdetail.no_42                
         nv_43si    = wdetail.no_43 
         nv_41prmt  = wdetail.ry01
         nv_42prmt  = wdetail.ry02
         nv_43prmt  = wdetail.ry03
         nv_adjpaprm   = IF nv_41prmt <> 0 OR nv_412prmt <> 0 OR nv_413prmt <> 0 OR nv_414prmt <> 0 OR nv_42prmt <> 0 OR nv_43prmt <> 0 THEN YES ELSE NO /*F68-0001*/
         nv_seat41  = wdetail.seat41   
         nv_dedod   = dod1      
         nv_addod   = dod2                                
         nv_dedpd   = deci(wdetail.DPD)                                    
         nv_ncbp    = deci(wdetail.ncb)                                     
         nv_fletp   = deci(wdetail.fleet)                                  
         nv_dspcp   = deci(wdetail.dspc)                                      
         nv_dstfp   = deci(wdetail.dstf)                                                    
         nv_clmp    = deci(wdetail.claim) 
         nv_baseprm  = deci(wdetail.base)
         nv_baseprm3 = deci(wdetail.baseplus) 
         /*nv_netprem  = TRUNCATE(((deci(wdetail.premt) * 100 ) / 107.43 ),0 ) + 
                        (IF ((deci(wdetail.premt) * 100) / 107.43) - TRUNCATE(((deci(wdetail.premt) * 100 ) / 107.43 ),0 ) > 0 THEN 1 ELSE 0 )*/
         nv_netprem  = DECI(wdetail.premt) /* เบี้ยสุทธิ */  
         nv_pdprem   = DECI(wdetail.premt)
         nv_gapprm  = 0                                                       
         nv_flagprm = "N"                 /* N = เบี้ยสุทธิ, G = เบี้ยรวม */                                    
         nv_effdat  = sic_bran.uwm100.comdat
        /* comment by : Ranu A64-0355 ...
         nv_ratatt  = 0
         nv_siatt   = 0
         nv_netatt  = 0
         nv_fltatt  = 0
         nv_ncbatt  = 0
         nv_dscatt  = 0
         ...end A64-0355..*/
        /* add by : A64-0355 */
         nv_ratatt  = deci(wdetail.dgrate)                        
         nv_siatt   = deci(wdetail.dgsi)                                                        
         nv_netatt  = deci(wdetail.dgprem)          
         nv_fltatt  = deci(wdetail.dgfeet)         
         nv_ncbatt  = deci(wdetail.dgncb)          
         nv_dscatt  = deci(wdetail.dgdisc)   
        /* end : A64-0355 */
         /*nv_status  = "" */
         nv_fcctv   = IF wdetail.cctv <> "" THEN YES ELSE NO . 

     FIND FIRST stat.clastab_fil USE-INDEX clastab01 WHERE
           clastab_fil.CLASS  = nv_class     AND
           clastab_fil.covcod = wdetail.covcod    NO-LOCK NO-ERROR.
        IF AVAIL stat.clastab_fil THEN DO:
            IF clastab_fil.unit = "C" THEN DO:
                ASSIGN
                    nv_cstflg = IF SUBSTR(nv_class,5,1) = "E" THEN "W" ELSE clastab_fil.unit
                    nv_engine = IF SUBSTR(nv_class,5,1) = "E" THEN DECI(wdetail.watt) ELSE INT(wdetail.engcc).
            END.
            ELSE IF clastab_fil.unit = "S" THEN DO:
                ASSIGN
                    nv_cstflg = clastab_fil.unit
                    nv_engine = INT(wdetail.seat).
            END.
            ELSE IF clastab_fil.unit = "T" THEN DO:
                ASSIGN
                    nv_cstflg = clastab_fil.unit
                    nv_engine = DECI(sic_bran.uwm301.Tons).
            END.
            nv_engcst = nv_engine .
        END.

    IF wdetail.redbook = ""  THEN DO:
        IF nv_cstflg <> "T" THEN DO:
            /*RUN wgw/wgwredbook(input  wdetail.brand ,  */ /*A65=0079*/
                RUN wgw/wgwredbk1(input  wdetail.brand ,       /*A65=0079*/
                               input  wdetail.model ,  
                               input  nv_totsi      ,  
                               INPUT  wdetail.tariff,  
                               input  SUBSTR(nv_class,2,5),   
                               input  wdetail.yrmanu, 
                               input  nv_engine  ,
                               input  0 , 
                               INPUT-OUTPUT wdetail.redbook) .
        END.
        ELSE DO:
            /*RUN wgw/wgwredbook(input  wdetail.brand ,  */ /*A65=0079*/
                RUN wgw/wgwredbk1(input  wdetail.brand ,       /*A65=0079*/  
                               input  wdetail.model ,  
                               input  INT(wdetail.si) ,  
                               INPUT  wdetail.tariff,  
                               input  SUBSTR(nv_class,2,5),   
                               input  wdetail.yrmanu, 
                               input  0  ,
                               input  nv_engine , 
                               INPUT-OUTPUT wdetail.redbook) .
        END.

        IF wdetail.redbook <> ""  THEN ASSIGN sic_bran.uwm301.modcod = wdetail.redbook .
        ELSE DO:
         ASSIGN
                wdetail.comment = wdetail.comment + "| " + "Redbook is Null !! "
                wdetail.WARNING = "Redbook เป็นค่าว่างไม่สามารถนำเข้ามูลเข้าได้ "  .
                wdetail.pass    = "N".
        END.
    END.

    FIND LAST stat.maktab_fil WHERE maktab_fil.makdes   =  wdetail.brand AND 
                                    maktab_fil.sclass   =  trim(SUBSTR(nv_class,2,4)) NO-LOCK NO-ERROR.
        IF AVAIL stat.maktab_fil THEN nv_supe = maktab_fil.impchg.

    IF sic_bran.uwm100.expdat NE ? AND sic_bran.uwm100.comdat NE ? THEN DO:
        IF ( DAY(sic_bran.uwm100.comdat)     =  DAY(sic_bran.uwm100.expdat)     AND
           MONTH(sic_bran.uwm100.comdat)     =  MONTH(sic_bran.uwm100.expdat)   AND
            YEAR(sic_bran.uwm100.comdat) + 1 =  YEAR(sic_bran.uwm100.expdat) )  OR
           ( DAY(sic_bran.uwm100.comdat)     =   29                             AND
           MONTH(sic_bran.uwm100.comdat)     =   02                             AND
             DAY(sic_bran.uwm100.expdat)     =   01                             AND
           MONTH(sic_bran.uwm100.expdat)     =   03                             AND
            YEAR(sic_bran.uwm100.comdat) + 1 =  YEAR(sic_bran.uwm100.expdat) )
        THEN DO:
          nv_polday = 365.
        END.
        ELSE DO:
          nv_polday = (sic_bran.uwm100.expdat  - sic_bran.uwm100.comdat ) + 1 .     /*    =  366  วัน */
        END.
    END.
    
    IF nv_polday < 365 THEN DO:
       /* nv_polday  = (sic_bran.uwm100.expdat  - sic_bran.uwm100.comdat).*/ /*F67-0001*/
        nv_polday  = (sic_bran.uwm100.expdat  - sic_bran.uwm100.comdat) + 1. /*F67-0001*/

        /* ไฟล์ใส่เบี้ยเต็มปีมา ไม่ต้องใช้  loop นี้ 
        nv_netprem = TRUNCATE((nv_netprem / nv_polday ) * 365 ,0) +
                     (IF ((nv_netprem / nv_polday ) * 365 ) - Truncate((nv_netprem / nv_polday ) * 365,0) > 0 Then 1 
                      Else 0). */
    END.
   /*
    MESSAGE 
    " impdata_fil.covcod   "  nv_covcod     skip  
    " impdata_fil.class    "  nv_class      skip  
    " impdata_fil.vehuse   "  nv_vehuse     skip  
    " nv_cstflg        "  nv_cstflg     skip  /*C=CC ; S=Seat ; T=Tons ; W=Watts*/
    " nv_engine        "  nv_engcst     skip  /* ต้องใส่ค่าตาม nv_cstflg  */
    " nv_drivno        "  nv_drivno     skip  
    " nv_drivage1      "  nv_driage1    skip  
    " nv_drivage2      "  nv_driage2    skip
    " impdata_fil.caryear  "  nv_yrmanu     skip
    " impdata_fil.si       "  nv_totsi      skip  
    " impdata_fil.fi       "  nv_totfi      skip  
    " impdata_fil.cargrp   "  nv_vehgrp     skip  
    " impdata_fil.prmtxt   "  nv_access     skip  
    " nv_supe          "  nv_supe       skip  /*  supercar = yes/no  */                  
    " impdata_fil.uom1_v   "  nv_tpbi1si    skip  
    " impdata_fil.uom2_v   "  nv_tpbi2si    skip  
    " impdata_fil.uom5_v   "  nv_tppdsi     skip  
    " nv_411           "  nv_411si      skip  /*nv_411si */    
    " nv_412           "  nv_412si      skip  /*nv_412si */    
    " nv_413           "  nv_413si      skip  /*nv_413si */  
    " nv_414           "  nv_414si      skip  /*nv_414si */ 
    " nv_42            "  nv_42si       skip  
    " nv_43            "  nv_43si       skip  
    " impdata_fil.seat41   "  nv_seat41     skip  
    " dod1             "  nv_dedod      skip  /*nv_dedod */ 
    " dod2             "  nv_addod      skip  /*nv_addod */  
    " dod0             "  nv_dedpd      skip  /*nv_dedpd */                
    " impdata_fil.ncb      "  nv_ncbp       skip  
    " impdata_fil.fleet    "  nv_fletp      skip  
    " impdata_fil.dspc     "  nv_dspcp      skip  
    " nv_dstfp         "  nv_dstfp      skip  
    " nv_clmp          "  nv_clmp       skip  
    " nv_netprem       "  nv_netprem    skip  
    " nv_gapprm        "  nv_gapprem    skip  
    " nv_flagprm       "  nv_flagprm    skip  
    " impdata_fil.comdat   "  nv_effdat     skip 
    " CCTV "              nv_fcctv      VIEW-AS ALERT-BOX.   */  
    RUN WUW\WUWPADP2.P(INPUT sic_bran.uwm100.policy,
                       INPUT sic_bran.uwm100.rencnt,
                       INPUT sic_bran.uwm100.endcnt,
                       INPUT nv_riskno,  
                       INPUT nv_batchyr, 
                       INPUT nv_batchno, 
                       INPUT nv_polday,
                       INPUT-OUTPUT nv_covcod ,
                       INPUT-OUTPUT nv_class  ,
                       INPUT-OUTPUT nv_vehuse ,
                       INPUT-OUTPUT nv_cstflg ,
                       INPUT-OUTPUT nv_engcst ,
                       INPUT-OUTPUT nv_drivno ,
                       INPUT-OUTPUT nv_driage1,
                       INPUT-OUTPUT nv_driage2,
                       INPUT-OUTPUT nv_pdprm0 , 
                       INPUT-OUTPUT nv_yrmanu ,
                       INPUT-OUTPUT nv_totsi  ,
                       /*INPUT-OUTPUT nv_totfi  ,*/
                       INPUT-OUTPUT nv_vehgrp,  
                       INPUT-OUTPUT nv_access,  
                       INPUT-OUTPUT nv_supe,                       
                       INPUT-OUTPUT nv_tpbi1si, 
                       INPUT-OUTPUT nv_tpbi2si, 
                       INPUT-OUTPUT nv_tppdsi,                 
                       INPUT-OUTPUT nv_411si,   
                       INPUT-OUTPUT nv_412si,   
                       INPUT-OUTPUT nv_413si,   
                       INPUT-OUTPUT nv_414si,   
                       INPUT-OUTPUT nv_42si,    
                       INPUT-OUTPUT nv_43si,
                       INput-output nv_41prmt,  /* ระบุเบี้ย รย.*/
                       INput-output nv_42prmt,  /* ระบุเบี้ย รย.*/
                       INput-output nv_43prmt,  /* ระบุเบี้ย รย.*/
                       INPUT-OUTPUT nv_seat41,                
                       INPUT-OUTPUT nv_dedod,   
                       INPUT-OUTPUT nv_addod,    
                       INPUT-OUTPUT nv_dedpd,                  
                       INPUT-OUTPUT nv_ncbp,      
                       INPUT-OUTPUT nv_fletp,   
                       INPUT-OUTPUT nv_dspcp,   
                       INPUT-OUTPUT nv_dstfp,   
                       INPUT-OUTPUT nv_clmp,
                       INPUT-OUTPUT nv_baseprm,
                       INPUT-OUTPUT nv_baseprm3,
                       INPUT-OUTPUT nv_pdprem,
                       INPUT-OUTPUT nv_netprem, 
                       INPUT-OUTPUT nv_gapprm,  
                       INPUT-OUTPUT nv_flagprm,             
                       INPUT-OUTPUT nv_effdat,
                       INPUT-OUTPUT nv_ratatt, 
                       INPUT-OUTPUT nv_siatt ,
                       INPUT-OUTPUT nv_netatt,    
                       INPUT-OUTPUT nv_fltatt, 
                       INPUT-OUTPUT nv_ncbatt, 
                       INPUT-OUTPUT nv_dscatt,
                       INPUT-OUTPUT nv_fcctv , /* cctv = yes/no */
                       OUTPUT nv_uom1_c ,  
                       OUTPUT nv_uom2_c ,  
                       OUTPUT nv_uom5_c ,  
                       OUTPUT nv_uom6_c ,
                       OUTPUT nv_uom7_c ,
                       OUTPUT nv_status ,
                       OUTPUT nv_message ).
    ASSIGN 
        sic_bran.uwm130.uom1_c  = nv_uom1_c
        sic_bran.uwm130.uom2_c  = nv_uom2_c
        sic_bran.uwm130.uom5_c  = nv_uom5_c
        sic_bran.uwm130.uom6_c  = nv_uom6_c
        sic_bran.uwm130.uom7_c  = nv_uom7_c .

    IF nv_drivno <> 0  THEN ASSIGN sic_bran.uwm301.actprm = nv_pdprm0. 
    ASSIGN sic_bran.uwm130.chr3 = IF nv_adjpaprm = YES THEN "YES" ELSE "NO" .   /*F68-0001*/
    IF nv_status = "NO" THEN DO:
        IF INDEX(nv_message,"Not Found Benefit") <> 0 THEN ASSIGN wdetail.pass  = "N". /*A65-0043*/
        ASSIGN
                wdetail.comment = wdetail.comment + "|" + nv_message
                wdetail.WARNING = wdetail.WARNING + "|" + nv_message .
                /*wdetail.pass    = "N".*/
    END.
END.
...end A68-0044...*/
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE 00-proc_chktest2 C-Win 
PROCEDURE 00-proc_chktest2 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
/*ASSIGN fi_process = "Create Data " + wdetail.policyno + " on uwm130,uwm301...."  .
DISP fi_process WITH FRAM fr_main.
FIND sic_bran.uwm130 USE-INDEX uwm13001 WHERE
           sic_bran.uwm130.policy  = sic_bran.uwm100.policy AND
           sic_bran.uwm130.rencnt  = sic_bran.uwm100.rencnt AND
           sic_bran.uwm130.endcnt  = sic_bran.uwm100.endcnt AND
           sic_bran.uwm130.riskgp  = s_riskgp               AND            /*0*/
           sic_bran.uwm130.riskno  = s_riskno               AND            /*1*/
           sic_bran.uwm130.itemno  = s_itemno               AND            /*1*/
           sic_bran.uwm130.bchyr   = nv_batchyr             AND 
           sic_bran.uwm130.bchno   = nv_batchno             AND 
           sic_bran.uwm130.bchcnt  = nv_batcnt             NO-WAIT NO-ERROR.
IF NOT AVAILABLE uwm130 THEN DO:
    DO TRANSACTION:
    CREATE sic_bran.uwm130.
    ASSIGN
        sic_bran.uwm130.policy = sic_bran.uwm120.policy
        sic_bran.uwm130.rencnt = sic_bran.uwm120.rencnt   sic_bran.uwm130.endcnt = sic_bran.uwm120.endcnt
        sic_bran.uwm130.riskgp = sic_bran.uwm120.riskgp   sic_bran.uwm130.riskno = sic_bran.uwm120.riskno
        sic_bran.uwm130.itemno = s_itemno
        sic_bran.uwm130.bchyr  = nv_batchyr          /* batch Year */
        sic_bran.uwm130.bchno  = nv_batchno          /* bchno      */
        sic_bran.uwm130.bchcnt = nv_batcnt        /* bchcnt     */
        nv_sclass     = wdetail.subclass
        nv_uom6_u     = "" 
        nv_othcod     = ""
        nv_othvar1    = ""
        nv_othvar2    = ""
        nv_othvar     = "". 

    IF wdetail.special  =  "A"  THEN DO:
       nv_uom6_u  =  "A".
    END.     
    IF CAPS(nv_uom6_u) = "A"  Then
        Assign  nv_uom6_u                  = "A"
        nv_othcod                  = "OTH"
        nv_othvar1                 = "     Accessory  = "
        nv_othvar2                 =  STRING(nv_uom6_u)
        SUBSTRING(nv_othvar,1,30)  = nv_othvar1
        SUBSTRING(nv_othvar,31,30) = nv_othvar2.
    ELSE ASSIGN  nv_uom6_u              = ""
            nv_othcod                  = ""
            nv_othvar1                 = ""
            nv_othvar2                 = ""
            SUBSTRING(nv_othvar,1,30)  = nv_othvar1
            SUBSTRING(nv_othvar,31,30) = nv_othvar2.
    
    IF (wdetail.covcod = "1")   OR (wdetail.covcod = "5")    OR (wdetail.covcod = "2.1") OR (wdetail.covcod = "3.1") OR
       (wdetail.covcod = "2.2") OR (wdetail.covcod = "3.2")  THEN DO: /*a62-0215*/
        ASSIGN
            sic_bran.uwm130.uom6_v   = IF      wdetail.covcod = "2.1" THEN inte(wdetail.siplus)
                                       ELSE IF wdetail.covcod = "2.2" THEN inte(wdetail.siplus) 
                                       ELSE IF wdetail.covcod = "3.1" THEN INTE(wdetail.siplus) 
                                       ELSE IF wdetail.covcod = "3.2" THEN INTE(wdetail.siplus) 
                                       ELSE inte(wdetail.si)
            sic_bran.uwm130.uom7_v   = IF      wdetail.covcod = "2.1" THEN inte(wdetail.siplus)
                                       ELSE IF wdetail.covcod = "2.2" THEN inte(wdetail.siplus) 
                                       ELSE IF wdetail.covcod = "3.1" THEN 0 
                                       ELSE IF wdetail.covcod = "3.2" THEN 0  
                                       ELSE inte(wdetail.si)
            sic_bran.uwm130.fptr01   = 0     sic_bran.uwm130.bptr01 = 0  /*Item Upper text*/
            sic_bran.uwm130.fptr02   = 0     sic_bran.uwm130.bptr02 = 0  /*Item Lower Text*/
            sic_bran.uwm130.fptr03   = 0     sic_bran.uwm130.bptr03 = 0  /*Cover & Premium*/
            sic_bran.uwm130.fptr04   = 0     sic_bran.uwm130.bptr04 = 0  /*Item Endt. Text*/
            sic_bran.uwm130.fptr05   = 0     sic_bran.uwm130.bptr05 = 0. /*Item Endt. Clause*/
    END.
    IF wdetail.covcod = "2"  THEN DO:
        ASSIGN
            sic_bran.uwm130.uom6_v   = 0
            sic_bran.uwm130.uom7_v   = inte(wdetail.si)
            sic_bran.uwm130.fptr01   = 0     sic_bran.uwm130.bptr01 = 0  /*Item Upper text*/
            sic_bran.uwm130.fptr02   = 0     sic_bran.uwm130.bptr02 = 0  /*Item Lower Text*/
            sic_bran.uwm130.fptr03   = 0     sic_bran.uwm130.bptr03 = 0  /*Cover & Premium*/
            sic_bran.uwm130.fptr04   = 0     sic_bran.uwm130.bptr04 = 0  /*Item Endt. Text*/
            sic_bran.uwm130.fptr05   = 0     sic_bran.uwm130.bptr05 = 0. /*Item Endt. Clause*/
    END.
    IF wdetail.covcod = "3"  THEN DO:
        ASSIGN
            sic_bran.uwm130.uom6_v   = 0
            sic_bran.uwm130.uom7_v   = 0
            sic_bran.uwm130.fptr01   = 0     sic_bran.uwm130.bptr01 = 0  /*Item Upper text*/
            sic_bran.uwm130.fptr02   = 0     sic_bran.uwm130.bptr02 = 0  /*Item Lower Text*/
            sic_bran.uwm130.fptr03   = 0     sic_bran.uwm130.bptr03 = 0  /*Cover & Premium*/
            sic_bran.uwm130.fptr04   = 0     sic_bran.uwm130.bptr04 = 0  /*Item Endt. Text*/
            sic_bran.uwm130.fptr05   = 0     sic_bran.uwm130.bptr05 = 0. /*Item Endt. Clause*/
    END.
    IF wdetail.poltyp = "v72" THEN  n_sclass72 = wdetail.subclass.
    ELSE n_sclass72 = wdetail.prempa + wdetail.subclass .

    FIND FIRST stat.clastab_fil Use-index clastab01 Where
        stat.clastab_fil.class   = n_sclass72       And
        stat.clastab_fil.covcod  = wdetail.covcod No-lock  No-error No-wait.
    IF avail stat.clastab_fil Then do: 
        Assign 
            sic_bran.uwm130.uom1_v     = if int(wdetail.comper)   <> 0 then int(wdetail.comper)   else stat.clastab_fil.uom1_si
            sic_bran.uwm130.uom2_v     = if int(wdetail.comacc)   <> 0 then int(wdetail.comacc)   else stat.clastab_fil.uom2_si
            sic_bran.uwm130.uom5_v     = if int(wdetail.deductpd) <> 0 then int(wdetail.deductpd) else stat.clastab_fil.uom5_si
            sic_bran.uwm130.uom1_u     = if sic_bran.uwm130.uom1_v = 999999999 then "U" else "" /*A64-0355 unlimit */
            sic_bran.uwm130.uom2_u     = if sic_bran.uwm130.uom2_v = 999999999 then "U" else "" /*A64-0355 unlimit */
            sic_bran.uwm130.uom5_u     = if sic_bran.uwm130.uom5_v = 999999999 then "U" else "" /*A64-0355 unlimit */
            sic_bran.uwm130.uom8_v     =  stat.clastab_fil.uom8_si                
            sic_bran.uwm130.uom9_v     =  stat.clastab_fil.uom9_si          
            sic_bran.uwm130.uom3_v     =  0
            sic_bran.uwm130.uom4_v     =  0
            sic_bran.uwm130.uom6_u     =  nv_uom6_u    /* อุปกรณ์เสริมพิเศษ */
            wdetail.comper             =  stat.clastab_fil.uom8_si                
            wdetail.comacc             =  stat.clastab_fil.uom9_si
            nv_uom1_v                  =  sic_bran.uwm130.uom1_v   
            nv_uom2_v                  =  sic_bran.uwm130.uom2_v
            nv_uom5_v                  =  sic_bran.uwm130.uom5_v        
            sic_bran.uwm130.uom1_c  = "D1"
            sic_bran.uwm130.uom2_c  = "D2"
            sic_bran.uwm130.uom5_c  = "D5"
            sic_bran.uwm130.uom6_c  = "D6"
            sic_bran.uwm130.uom7_c  = "D7".
        If  wdetail.garage  =  "G"  THEN DO:
            /*comment by : a65-0079..
            Assign 
            WDETAIL.no_411  =  if int(wdetail.NO_411) <> 0 then wdetail.NO_411 else stat.clastab_fil.si_41pai
            WDETAIL.no_412  =  if int(wdetail.NO_412) <> 0 then wdetail.NO_412 else stat.clastab_fil.si_41pai
            WDETAIL.no_42   =  if int(wdetail.NO_42)  <> 0 then wdetail.NO_42  else stat.clastab_fil.si_42                         
            WDETAIL.no_43   =  if int(wdetail.NO_43)  <> 0 then wdetail.NO_43  else stat.clastab_fil.impsi_43   
            ..end A65-0079..*/
            /* add by :A65-0079 */
            Assign 
            WDETAIL.no_411  =  if int(wdetail.NO_411) <> -1 then wdetail.NO_411 else stat.clastab_fil.si_41pai
            WDETAIL.no_412  =  if int(wdetail.NO_412) <> -1 then wdetail.NO_412 else stat.clastab_fil.si_41pai
            WDETAIL.no_42   =  if int(wdetail.NO_42)  <> -1 then wdetail.NO_42  else stat.clastab_fil.si_42                         
            WDETAIL.no_43   =  if int(wdetail.NO_43)  <> -1 then wdetail.NO_43  else stat.clastab_fil.impsi_43 
             /* end A75-0079 */
            /*WDETAIL.seat41  =  stat.clastab_fil.dri_41 + stat.clastab_fil.pass_41. */   /*A64-0044*/   
            wdetail.seat41   =  IF wdetail.seat41 <> 0 THEN wdetail.seat41 ELSE stat.clastab_fil.dri_41 + stat.clastab_fil.pass_41.  /*A64-0044*/ 
        END.
        Else DO:
            /*comment by : a65-0079..
            Assign WDETAIL.no_411  =  if int(wdetail.NO_411) <> 0 then wdetail.NO_411 else stat.clastab_fil.si_41unp
                WDETAIL.no_412  =  if int(wdetail.NO_412) <> 0 then wdetail.NO_412 else stat.clastab_fil.si_41unp
                WDETAIL.no_42   =  if int(wdetail.NO_42) <> 0  then wdetail.NO_42  else stat.clastab_fil.si_42
                WDETAIL.no_43   =  if int(wdetail.NO_43) <> 0  then wdetail.NO_43  else stat.clastab_fil.si_43 ..end A65-0079..*/   
            /* add by :A65-0079 */
            Assign 
                WDETAIL.no_411  =  if int(wdetail.NO_411) <> -1 then wdetail.NO_411 else stat.clastab_fil.si_41unp
                WDETAIL.no_412  =  if int(wdetail.NO_412) <> -1 then wdetail.NO_412 else stat.clastab_fil.si_41unp
                WDETAIL.no_42   =  if int(wdetail.NO_42)  <> -1 then wdetail.NO_42  else stat.clastab_fil.si_42
                WDETAIL.no_43   =  if int(wdetail.NO_43)  <> -1 then wdetail.NO_43  else stat.clastab_fil.si_43
             /* end A75-0079 */
                /*WDETAIL.seat41  =  stat.clastab_fil.dri_41 + stat.clastab_fil.pass_41. *//*a64-0044*/
                wdetail.seat41  = IF wdetail.seat41 <> 0 THEN wdetail.seat41 ELSE stat.clastab_fil.dri_41 + stat.clastab_fil.pass_41.  /*A64-0044*/ 
        END.
    END. 
    /* add by : A64-0355*/
    ELSE DO:
        ASSIGN wdetail.pass    = "N"
               wdetail.comment = wdetail.comment + "| Class " + n_sclass72 + " Cover: " + wdetail.covcod + " Not on Paramter (clastab_fil) ". 
    END. /* end : A64-0355*/
    ASSIGN  nv_riskno = 1   nv_itemno = 1.
    IF wdetail.covcod = "1" Then 
        RUN wgs/wgschsum(INPUT  wdetail.policy, 
                         nv_riskno,
                         nv_itemno).
    END.  /* end Do transaction*/
    s_recid3  = RECID(sic_bran.uwm130).
    nv_covcod = wdetail.covcod.
    nv_makdes = wdetail.brand.
    nv_moddes = wdetail.model.
    nv_newsck = " ".
    RUN proc_chassic.
    IF SUBSTRING(wdetail.stk,1,1) = "2" THEN nv_newsck = "0" + wdetail.stk.
    ELSE nv_newsck =  wdetail.stk.
    FIND sic_bran.uwm301 USE-INDEX uwm30101      WHERE
         sic_bran.uwm301.policy = sic_bran.uwm100.policy    AND
         sic_bran.uwm301.rencnt = sic_bran.uwm100.rencnt    AND
         sic_bran.uwm301.endcnt = sic_bran.uwm100.endcnt    AND
         sic_bran.uwm301.riskgp = s_riskgp                  AND
         sic_bran.uwm301.riskno = s_riskno                  AND
         sic_bran.uwm301.itemno = s_itemno                  AND
         sic_bran.uwm301.bchyr  = nv_batchyr                AND 
         sic_bran.uwm301.bchno  = nv_batchno                AND 
         sic_bran.uwm301.bchcnt = nv_batcnt                     
         NO-WAIT NO-ERROR.
     IF NOT AVAILABLE sic_bran.uwm301 THEN DO:                  
         DO TRANSACTION:
             CREATE sic_bran.uwm301.
         END. 
     END. 
     ASSIGN
         sic_bran.uwm301.policy   = sic_bran.uwm120.policy                 
         sic_bran.uwm301.rencnt   = sic_bran.uwm120.rencnt
         sic_bran.uwm301.endcnt   = sic_bran.uwm120.endcnt
         sic_bran.uwm301.riskgp   = sic_bran.uwm120.riskgp
         sic_bran.uwm301.riskno   = sic_bran.uwm120.riskno
         sic_bran.uwm301.itemno   = s_itemno
         sic_bran.uwm301.tariff   = wdetail.tariff    
         sic_bran.uwm301.covcod   = nv_covcod
         /*sic_bran.uwm301.cha_no   = wdetail.chasno */ /*A65-0079*/
         sic_bran.uwm301.cha_no   = IF wdetail.chasno = "" THEN "-" ELSE TRIM(wdetail.chasno) /*A65-0079*/
         /*sic_bran.uwm301.trareg   = wdetail.chasno*/ /*A64-0044*/
         sic_bran.uwm301.trareg   = IF nv_uwm301trareg = "" THEN "-" ELSE nv_uwm301trareg /*A65-0079*/ 
         sic_bran.uwm301.eng_no   = wdetail.eng
         sic_bran.uwm301.Tons     = IF int(wdetail.weight) <> 0 AND DECI(wdetail.weight) < 100 THEN wdetail.weight * 1000 ELSE wdetail.weight  
         sic_bran.uwm301.engine   = INTEGER(wdetail.engcc)
         /*sic_bran.uwm301.watts    = INTEGER(wdetail.watt)*/ /*A66-0202*/
         sic_bran.uwm301.watts    = DECI(wdetail.watt)   /*A66-0202*/
         sic_bran.uwm301.yrmanu   = INTEGER(wdetail.yrmanu)
         sic_bran.uwm301.garage   = wdetail.garage
         sic_bran.uwm301.body     = wdetail.body
         sic_bran.uwm301.seats    = INTEGER(wdetail.seat)
         sic_bran.uwm301.mv_ben83 = IF wdetail.poltyp = "V72" THEN "" ELSE IF trim(wdetail.benname) = "-" OR trim(wdetail.benname) = "Null" THEN ""  /*Null A64-0309*/
                                    ELSE trim(wdetail.benname)
         sic_bran.uwm301.vehreg   = wdetail.vehreg + " " + wdetail.re_country
         sic_bran.uwm301.vehuse   = wdetail.vehuse
         sic_bran.uwm301.modcod   = wdetail.redbook
         sic_bran.uwm301.moddes   = trim(wdetail.brand) + " " + trim(wdetail.model) + " " + trim(wdetail.submodel)    
         sic_bran.uwm301.sckno    = 0
         sic_bran.uwm301.itmdel   = NO
         sic_bran.uwm301.logbok   = IF TRIM(wdetail.inspec) = "N" OR TRIM(wdetail.inspec) = "No" THEN "N" 
                                    ELSE IF TRIM(wdetail.inspec) = "Y" OR TRIM(wdetail.inspec) = "Yes" THEN "Y" ELSE "" 
         sic_bran.uwm301.car_year = INT(wdetail.re_year)                                                                
         sic_bran.uwm301.province_reg  = trim(wdetail.re_country)                                                   
         sic_bran.uwm301.vehgrp    = trim(wdetail.cargrp)                                                   
         sic_bran.uwm301.car_color = trim(wdetail.colorcar)                                                  
         sic_bran.uwm301.fuel      = trim(wdetail.fule)
         sic_bran.uwm301.watts     = deci(wdetail.watt)      /* A64-0044-*/                                                   
         wdetail.tariff            = sic_bran.uwm301.tariff
         sic_bran.uwm130.i_text    = IF INT(wdetail.cctv)  <> 0 THEN "0001" ELSE "" .  /*CCTV */
   RUN proc_prmtxt.
   IF wdetail.compul = "y" THEN DO:
     sic_bran.uwm301.cert = "".
     IF LENGTH(wdetail.stk) = 11  THEN sic_bran.uwm301.drinam[9] = "STKNO:" + STRING(wdetail.stk,"99999999999"). 
     IF LENGTH(wdetail.stk) = 13  THEN sic_bran.uwm301.drinam[9] = "STKNO:" + STRING(wdetail.stk,"9999999999999").
     IF wdetail.stk = ""  THEN sic_bran.uwm301.drinam[9] = "".
     FIND FIRST brStat.Detaitem USE-INDEX detaitem11 WHERE
         brStat.Detaitem.serailno = wdetail.stk  NO-LOCK NO-ERROR .
     IF NOT AVAIL brstat.Detaitem THEN DO:     
         CREATE brstat.Detaitem.
         ASSIGN brStat.Detaitem.Policy   = sic_bran.uwm301.Policy
                brStat.Detaitem.RenCnt   = sic_bran.uwm301.RenCnt
                brStat.Detaitem.EndCnt   = sic_bran.uwm301.Endcnt
                brStat.Detaitem.RiskNo   = sic_bran.uwm301.RiskNo
                brStat.Detaitem.ItemNo   = sic_bran.uwm301.ItemNo
                brStat.Detaitem.serailno = wdetail.stk.  
     END.
   END.
   ASSIGN  sic_bran.uwm301.bchyr = nv_batchyr       /* batch Year */
           sic_bran.uwm301.bchno = nv_batchno       /* bchno      */
           sic_bran.uwm301.bchcnt= nv_batcnt      /* bchcnt     */
           /*wdetail.drivername1 = wdetail.ntitle1 + " " + wdetail.drivername1 + " " + wdetail.dname2 */ /*A67-0029*/
           /*wdetail.drivername2 = wdetail.ntitle2 + " " + wdetail.drivername2 + " " + wdetail.ddname1*/ /*A67-0029*/ . 
   IF wdetail.prepol = "" THEN DO:
     IF INTE(wdetail.drivnam) > 0 THEN DO:
         ASSIGN wdetail.drivnam = "Y" .
         /*RUN proc_mailtxt.  /*A55-0151*/*/ /* A67-0029*/
         RUN proc_chkdrive. /*A67-0029*/
     END.
     ELSE ASSIGN wdetail.drivnam = "N".
   END.
   ELSE DO:
       FOR EACH ws0m009 WHERE ws0m009.policy  = wdetail.driver NO-LOCK .
          CREATE brstat.mailtxt_fil.
          ASSIGN
              brstat.mailtxt_fil.policy  = TRIM(sic_bran.uwm301.policy) +
                           STRING(sic_bran.uwm301.rencnt,"99" ) +
                           STRING(sic_bran.uwm301.endcnt,"999")  +
                           STRING(sic_bran.uwm301.riskno,"999") +
                           STRING(sic_bran.uwm301.itemno,"999")    
              brstat.mailtxt_fil.lnumber = INTEGER(ws0m009.lnumber)
              brstat.mailtxt_fil.ltext   = ws0m009.ltext  
              brstat.mailtxt_fil.ltext2  = ws0m009.ltext2   
              brstat.mailtxt_fil.bchyr   = nv_batchyr 
              brstat.mailtxt_fil.bchno   = nv_batchno 
              brstat.mailtxt_fil.bchcnt  = nv_batcnt 
              /* Add by : A67-0029 */
              brstat.mailtxt_fil.drivbirth = ws0m009.drivbirth 
              brstat.mailtxt_fil.drivage   = ws0m009.drivage    
              brstat.mailtxt_fil.occupcod  = ws0m009.occupcod   
              brstat.mailtxt_fil.occupdes  = ws0m009.occupdes   
              brstat.mailtxt_fil.cardflg   = ws0m009.cardflg    
              brstat.mailtxt_fil.drividno  = ws0m009.drividno   
              brstat.mailtxt_fil.licenno   = ws0m009.licenno   
              brstat.mailtxt_fil.drivnam   = ws0m009.drivnam   
              brstat.mailtxt_fil.gender    = ws0m009.gender    
              brstat.mailtxt_fil.drivlevel = ws0m009.drivlevel 
              brstat.mailtxt_fil.levelper  = ws0m009.levelper  
              brstat.mailtxt_fil.titlenam  = ws0m009.titlenam  
              brstat.mailtxt_fil.licenexp  = ws0m009.licenexp  
              brstat.mailtxt_fil.firstnam  = ws0m009.firstnam  
              brstat.mailtxt_fil.lastnam   = ws0m009.lastnam   .
              /* end : A67-0029 */
          ASSIGN nv_drivno = INTEGER(ws0m009.lnumber).
       END.
       IF nv_drivno <> 0 THEN DO:
           ASSIGN wdetail.drivnam = "Y"     sic_bran.uwm301.actprm   = wdetail.nname .
       END.
   END.
   ASSIGN s_recid4    = RECID(sic_bran.uwm301).
   IF wdetail.redbook <> "" THEN DO:
       FIND FIRST stat.maktab_fil USE-INDEX maktab01   WHERE 
           stat.maktab_fil.sclass = wdetail.subclass  AND
           stat.maktab_fil.modcod = wdetail.redbook   No-lock no-error no-wait.
       If  avail  stat.maktab_fil  Then 
           ASSIGN sic_bran.uwm301.modcod  =  stat.maktab_fil.modcod 
           sic_bran.uwm301.vehgrp  =  stat.maktab_fil.prmpac
           wdetail.cargrp          =  stat.maktab_fil.prmpac 
           wdetail.seat41          =  IF wdetail.seat41 = 0 THEN stat.maktab_fil.seats ELSE wdetail.seat41  /*A64-0044*/
           sic_bran.uwm301.body    =  IF wdetail.body = "" THEN stat.maktab_fil.body ELSE wdetail.body  . /*A65-0079*/
  END.
  ELSE RUN proc_maktab.
  /*IF TRIM(wdetail.redbook) = " " THEN ASSIGN wdetail.comment = wdetail.comment + "| Redbook เป็นค่าว่าง " .*/ /*A65-0079*/
END.
RELEASE brStat.Detaitem.
RELEASE brstat.mailtxt_fil .*/
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE 00-proc_insnam C-Win 
PROCEDURE 00-proc_insnam :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
/* comment by : Ranu I. A65-0043 ...
ASSIGN  
    n_insref      = ""  
    nv_messagein  = ""
    nv_usrid      = ""
    nv_transfer   = NO
    n_check       = ""
    nv_insref     = ""
    putchr        = "" 
    putchr1       = ""
    nv_typ        = ""
    nv_usrid      = SUBSTRING(USERID(LDBNAME(1)),3,4) 
    nv_transfer   = YES.
IF wdetail.nv_insref = "" THEN DO:
 FIND LAST sicsyac.xmm600 USE-INDEX  xmm60033 WHERE
    /* (sicsyac.xmm600.NAME      = TRIM(wdetail.insnam) + " " + trim(wdetail.lastname)) OR */ /*A64-0257*/
     (sicsyac.xmm600.firstname = TRIM(wdetail.insnam)    AND
     sicsyac.xmm600.lastname   = TRIM(wdetail.lastname)) AND 
     sicsyac.xmm600.homebr     = TRIM(wdetail.n_branch)  AND 
     sicsyac.xmm600.clicod     = "IN"  EXCLUSIVE-LOCK NO-ERROR NO-WAIT.    /* A56-0047 add check  sicsyac.xmm600.clicod   = "IN"*/
 IF NOT AVAILABLE sicsyac.xmm600 THEN DO: 
    IF n_insref = "" THEN DO:
         ASSIGN  n_check   = ""      nv_insref = "".
         nv_typ = IF wdetail.instyp = "C" THEN "Cs" ELSE "0s"  .
         RUN proc_insno. 
         IF n_check <> "" THEN DO: 
             ASSIGN nv_transfer = NO
                 nv_insref   = "".
             RETURN.
         END.
         IF nv_insref <> "" THEN DO:
             loop_runningins:                /*Check Insured  */
             REPEAT:
                 FIND sicsyac.xmm600 USE-INDEX xmm60001 WHERE
                     sicsyac.xmm600.acno = CAPS(nv_insref)  NO-LOCK NO-ERROR NO-WAIT.
                 IF AVAIL sicsyac.xmm600 THEN DO:
                     RUN proc_insno .
                     IF n_check <> "" THEN DO: 
                         ASSIGN nv_transfer = NO
                             nv_insref   = "".
                         RETURN.
                     END.
                 END.
                 ELSE LEAVE loop_runningins.
             END.
         END.
         IF nv_insref <> "" THEN CREATE sicsyac.xmm600.
         ELSE DO:
             ASSIGN wdetail.pass = "N"  
                 wdetail.comment = wdetail.comment + "| รหัสลูกค้าเป็นค่าว่างไม่สามารถนำเข้าระบบได้ค่ะ" 
                 WDETAIL.OK_GEN  = "N"
                 nv_transfer = NO.
         END.    /**/
     END.
     n_insref = nv_insref.
 END.
 ELSE DO:
    IF sicsyac.xmm600.acno <> "" THEN DO:   /* กรณีพบ */
        ASSIGN
            nv_insref                = trim(sicsyac.xmm600.acno) 
            n_insref                 = caps(trim(nv_insref)) 
            nv_transfer              = NO 
            sicsyac.xmm600.acno_typ  = IF wdetail.instyp = "C" THEN "CO" ELSE "PR"  
            sicsyac.xmm600.ntitle    = TRIM(wdetail.tiname)      /*Title for Name Mr/Mrs/etc*/
            sicsyac.xmm600.fname     = ""                        /*First Name*/
            sicsyac.xmm600.firstname = TRIM(wdetail.insnam)
            sicsyac.xmm600.lastname  = TRIM(wdetail.lastname)
            sicsyac.xmm600.name      = TRIM(wdetail.insnam) + " " + trim(wdetail.lastname)      /*Name Line 1*/
            sicsyac.xmm600.abname    = TRIM(wdetail.insnam) + " " + trim(wdetail.lastname)      /*Abbreviated Name*/
            sicsyac.xmm600.sex       = TRIM(wdetail.gender)
            sicsyac.xmm600.icno      = TRIM(wdetail.ICNO)              /*IC No.*/           
            sicsyac.xmm600.br_insure = TRIM(wdetail.insbr)      /* A64-0355*/
            sicsyac.xmm600.addr1     = TRIM(wdetail.addr)              /*Address line 1*/
            sicsyac.xmm600.addr2     = TRIM(wdetail.tambon)                                /*Address line 2*/
            sicsyac.xmm600.addr3     = TRIM(wdetail.amper)                                 /*Address line 3*/
            sicsyac.xmm600.addr4     = TRIM(wdetail.country)
            sicsyac.xmm600.postcd    = TRIM(wdetail.post)
            sicsyac.xmm600.codeaddr1 = trim(wdetail.provcod)
            sicsyac.xmm600.codeaddr2 = trim(wdetail.distcod)
            sicsyac.xmm600.codeaddr3 = trim(wdetail.sdistcod)
            sicsyac.xmm600.tel[1]    = trim(wdetail.tele1)   
            sicsyac.xmm600.tel[2]    = trim(wdetail.tele2)   
            sicsyac.xmm600.email[1]  = trim(wdetail.mail1)   
            sicsyac.xmm600.email[2]  = trim(wdetail.mail2)   
            sicsyac.xmm600.email[3]  = trim(wdetail.mail3)   
            sicsyac.xmm600.email[4]  = trim(wdetail.mail4)   
            sicsyac.xmm600.email[5]  = trim(wdetail.mail5)   
            sicsyac.xmm600.email[6]  = trim(wdetail.mail6)   
            sicsyac.xmm600.email[7]  = trim(wdetail.mail7)   
            sicsyac.xmm600.email[8]  = trim(wdetail.mail8)   
            sicsyac.xmm600.email[9]  = trim(wdetail.mail9)   
            sicsyac.xmm600.email[10] = trim(wdetail.mail10)  
            sicsyac.xmm600.fax       = trim(wdetail.fax)     
            sicsyac.xmm600.lineid    = trim(wdetail.lineID)  
            sicsyac.xmm600.homebr    = TRIM(wdetail.n_branch)    /*Home branch*/
            sicsyac.xmm600.langug    = TRIM(wdetail.inslang)     /*A64-0355*/
            sicsyac.xmm600.anlyc5    = IF nv_typ = "Cs" THEN TRIM(wdetail.insbr) ELSE ""  
            sicsyac.xmm600.opened    = TODAY
            sicsyac.xmm600.chgpol    = YES                       /*Allow N & A change on pol.Y/N*/
            sicsyac.xmm600.entdat    = TODAY                     /*Entry date*/
            sicsyac.xmm600.enttim    = STRING(TIME,"HH:MM:SS")   /*Entry time*/
            sicsyac.xmm600.usrid     = nv_usrid 
            sicsyac.xmm600.dtyp20    = "" 
            sicsyac.xmm600.dval20    = "" .
       IF n_chkvat = YES THEN DO:
           FIND LAST winst WHERE winst.policyno = wdetail.policyno AND winst.instot = wdetail.instot AND 
                                winst.instname1 <> "" NO-LOCK NO-ERROR .
          IF AVAIL winst THEN DO:
           ASSIGN /*sicsyac.xmm600.acno       =   instcod1*/
                  sicsyac.xmm600.nbr_insure =   winst.instbr1
                  sicsyac.xmm600.nntitle    =   winst.insttitle1
                  sicsyac.xmm600.nfirstName =   winst.instname1   
                  sicsyac.xmm600.nlastname  =   winst.instlname1     
                  sicsyac.xmm600.nphone     =   TRIM(winst.instname1) + " " +  TRIM(winst.instlname1) 
                  sicsyac.xmm600.nicno      =   winst.instic1   
                  sicsyac.xmm600.naddr1     =   winst.instaddr11        
                  sicsyac.xmm600.naddr2     =   winst.instaddr21        
                  sicsyac.xmm600.naddr3     =   winst.instaddr31    
                  sicsyac.xmm600.naddr4     =   winst.instaddr41    
                  sicsyac.xmm600.npostcd    =   winst.instpost1  .
          END.
       END.
    END.
  END.
IF nv_transfer = YES AND nv_insref <>  ""  THEN DO:     
    ASSIGN  
        sicsyac.xmm600.acno_typ  = IF wdetail.instyp = "C" THEN "CO" ELSE "PR" 
        sicsyac.xmm600.acno      = nv_insref                 /*Account no*/
        sicsyac.xmm600.gpstcs    = nv_insref                 /*Group A/C for statistics*/
        sicsyac.xmm600.gpage     = ""                        /*Group A/C for ageing*/
        sicsyac.xmm600.gpstmt    = ""                        /*Group A/C for Statement*/
        sicsyac.xmm600.or1ref    = ""                        /*OR Agent 1 Ref. No.*/
        sicsyac.xmm600.or2ref    = ""                        /*OR Agent 2 Ref. No.*/
        sicsyac.xmm600.or1com    = 0                         /*OR Agent 1 Comm. %*/
        sicsyac.xmm600.or2com    = 0                         /*OR Agent 2 Comm. %*/
        sicsyac.xmm600.or1gn     = "G"                       /*OR Agent 1 Gross/Net*/
        sicsyac.xmm600.or2gn     = "G"                       /*OR Agent 2 Gross/Net*/
        sicsyac.xmm600.ntitle    = TRIM(wdetail.tiname)      /*Title for Name Mr/Mrs/etc*/
        sicsyac.xmm600.fname     = ""                        /*First Name*/
        sicsyac.xmm600.name      = TRIM(wdetail.insnam) + " " + trim(wdetail.lastname)     /*Name Line 1*/
        sicsyac.xmm600.abname    = TRIM(wdetail.insnam) + " " + trim(wdetail.lastname)      /*Abbreviated Name*/
        sicsyac.xmm600.firstname = TRIM(wdetail.insnam)
        sicsyac.xmm600.lastname  = TRIM(wdetail.lastname)
        sicsyac.xmm600.icno      = TRIM(wdetail.ICNO)        /*IC No.*/ 
        sicsyac.xmm600.br_insure = TRIM(wdetail.insbr)      /* A64-0355*/
        sicsyac.xmm600.sex       = TRIM(wdetail.gender)
        sicsyac.xmm600.addr1     = TRIM(wdetail.addr )  /*Address line 1*/
        sicsyac.xmm600.addr2     = TRIM(wdetail.tambon)                     /*Address line 2*/
        sicsyac.xmm600.addr3     = TRIM(wdetail.amper)                      /*Address line 3*/
        sicsyac.xmm600.addr4     = TRIM(wdetail.country)                    /*Address line 4*/
        sicsyac.xmm600.postcd    = TRIM(wdetail.post)                        /*Postal Code*/
        sicsyac.xmm600.codeaddr1 = trim(wdetail.provcod)
        sicsyac.xmm600.codeaddr2 = trim(wdetail.distcod)
        sicsyac.xmm600.codeaddr3 = trim(wdetail.sdistcod)
        sicsyac.xmm600.tel[1]    = trim(wdetail.tele1)   
        sicsyac.xmm600.tel[2]    = trim(wdetail.tele2)   
        sicsyac.xmm600.email[1]  = trim(wdetail.mail1)   
        sicsyac.xmm600.email[2]  = trim(wdetail.mail2)   
        sicsyac.xmm600.email[3]  = trim(wdetail.mail3)   
        sicsyac.xmm600.email[4]  = trim(wdetail.mail4)   
        sicsyac.xmm600.email[5]  = trim(wdetail.mail5)   
        sicsyac.xmm600.email[6]  = trim(wdetail.mail6)   
        sicsyac.xmm600.email[7]  = trim(wdetail.mail7)   
        sicsyac.xmm600.email[8]  = trim(wdetail.mail8)   
        sicsyac.xmm600.email[9]  = trim(wdetail.mail9)   
        sicsyac.xmm600.email[10] = trim(wdetail.mail10)  
        sicsyac.xmm600.fax       = trim(wdetail.fax)     
        sicsyac.xmm600.lineid    = trim(wdetail.lineID)  
        sicsyac.xmm600.clicod   = "IN"                      /*Client Type Code*/
        sicsyac.xmm600.acccod   = "IN"                      /*Account type code*/
        sicsyac.xmm600.relate   = ""                        /*Related A/C for RI Claims*/
        sicsyac.xmm600.notes1   = ""                        /*Notes line 1*/
        sicsyac.xmm600.notes2   = ""                        /*Notes line 2*/
        sicsyac.xmm600.homebr   = TRIM(wdetail.n_branch)      /*Home branch*/
        sicsyac.xmm600.opened   = TODAY                     /*Date A/C opened*/
        sicsyac.xmm600.prindr   = 1                         /*No. to print Dr/Cr N., default*/
        sicsyac.xmm600.langug   = TRIM(wdetail.inslang)     /*Language Code*/
        sicsyac.xmm600.cshdat   = ?                         /*Cash terms wef date*/
        sicsyac.xmm600.legal    = ""                        /*Legal action pending/closed*/
        sicsyac.xmm600.stattp   = "I"                       /*Statement type I/B/N*/
        sicsyac.xmm600.autoap   = NO                        /*Automatic cash matching*/
        sicsyac.xmm600.ltcurr   = "BHT"                     /*Credit limit currency*/
        sicsyac.xmm600.ltamt    = 0                         /*Credit limit amount*/
        sicsyac.xmm600.exec     = ""                        /*Executive responsible*/
        sicsyac.xmm600.cntry    = "TH"                      /*Country code*/
        sicsyac.xmm600.phone    = ""                        /*Phone no.*/
        sicsyac.xmm600.closed   = ?                         /*Date A/C closed*/
        sicsyac.xmm600.crper    = 0                         /*Credit period*/
        sicsyac.xmm600.pvfeq    = 0                         /*PV frequency/Type code*/
        sicsyac.xmm600.comtab   = 1                         /*Commission table no*/
        sicsyac.xmm600.chgpol   = YES                       /*Allow N & A change on pol.Y/N*/
        sicsyac.xmm600.entdat   = TODAY                     /*Entry date*/
        sicsyac.xmm600.enttim   = STRING(TIME,"HH:MM:SS")   /*Entry time*/
        sicsyac.xmm600.usrid    = nv_usrid                 /*Userid*/
        sicsyac.xmm600.regagt   = ""                       /*Registered agent code*/
        sicsyac.xmm600.agtreg   = ""                       /*Agents Registration/Licence No*/
        sicsyac.xmm600.debtyn   = YES                      /*Permit debtor trans Y/N*/
        sicsyac.xmm600.crcon    = NO                       /*Credit Control Report*/
        sicsyac.xmm600.muldeb   = NO                       /*Multiple Debtors Acc.*/
        sicsyac.xmm600.styp20   = ""                       /*Statistic Type Codes (4 x 20)*/
        sicsyac.xmm600.sval20   = ""                       /*Statistic Value Codes (4 x 20)*/
        sicsyac.xmm600.dtyp20   = ""                       /*Type of Date Codes (2 X 20)*/
        sicsyac.xmm600.dval20   = ""                       /*Date Values (8 X 20)*/
        sicsyac.xmm600.iblack   = ""                       /*Insured Black List Code*/
        sicsyac.xmm600.oldic    = ""                       /*Old IC No.*/
        sicsyac.xmm600.cardno   = ""                       /*Credit Card Account No.*/
        sicsyac.xmm600.cshcrd   = ""                       /*Cash(C)/Credit(R) Agent*/
        sicsyac.xmm600.naddr1   = ""                       /*New address line 1*/
        sicsyac.xmm600.gstreg   = ""                       /*GST Registration No.*/
        sicsyac.xmm600.naddr2   = ""                       /*New address line 2*/
        sicsyac.xmm600.fax      = ""                       /*Fax No.*/
        sicsyac.xmm600.naddr3   = ""                       /*New address line 3*/
        sicsyac.xmm600.telex    = ""                       /*Telex No.*/
        sicsyac.xmm600.naddr4   = ""                       /*New address line 4*/
        sicsyac.xmm600.name2    = ""                       /*Name Line 2*/
        sicsyac.xmm600.npostcd  = ""                       /*New postal code*/
        sicsyac.xmm600.name3    = ""                       /*Name Line 3*/
        sicsyac.xmm600.nphone   = ""                       /*New phone no.*/    
        sicsyac.xmm600.nachg    = YES                      /*Change N&A on Renewal/Endt*/
        sicsyac.xmm600.regdate  = ?                        /*Agents registration Date*/
        sicsyac.xmm600.alevel   = 0                        /*Agency Level*/
        sicsyac.xmm600.taxno    = ""                       /*Agent tax no.*/
        sicsyac.xmm600.anlyc1   = ""                       /*Analysis Code 1*/
        sicsyac.xmm600.taxdate  = ?                        /*Agent tax date*/
        sicsyac.xmm600.anlyc5   = IF nv_typ = "Cs" THEN TRIM(wdetail.insbr) ELSE ""
        sicsyac.xmm600.dtyp20   = ""
        sicsyac.xmm600.dval20   = ""     /*string(wdetail.brithday).*/
        /* vat ชมพู : A64-0043 */
        sicsyac.xmm600.nbr_insure = ""
        sicsyac.xmm600.nntitle    = ""
        sicsyac.xmm600.nfirstName = ""
        sicsyac.xmm600.nlastname  = ""
        sicsyac.xmm600.nicno      = "".
       /* end vat ชมพู : A64-0043 */
       IF n_chkvat = YES THEN DO:
          FIND LAST winst WHERE winst.policyno = wdetail.policyno AND winst.instot = wdetail.instot AND 
                                winst.instname1 <> "" NO-LOCK NO-ERROR .
          IF AVAIL winst THEN DO:
           ASSIGN /*sicsyac.xmm600.acno       =   instcod1*/
                  sicsyac.xmm600.nbr_insure =   winst.instbr1
                  sicsyac.xmm600.nntitle    =   winst.insttitle1
                  sicsyac.xmm600.nfirstName =   winst.instname1   
                  sicsyac.xmm600.nlastname  =   winst.instlname1     
                  sicsyac.xmm600.nphone     =   TRIM(winst.instname1) + " " +  TRIM(winst.instlname1) 
                  sicsyac.xmm600.nicno      =   winst.instic1   
                  sicsyac.xmm600.naddr1     =   winst.instaddr11        
                  sicsyac.xmm600.naddr2     =   winst.instaddr21        
                  sicsyac.xmm600.naddr3     =   winst.instaddr31    
                  sicsyac.xmm600.naddr4     =   winst.instaddr41    
                  sicsyac.xmm600.npostcd    =   winst.instpost1  .
          END.
       END.
   END.
END.
IF sicsyac.xmm600.acno <> "" THEN DO:              /*A55-0268 add chk nv_insref = "" */
    ASSIGN nv_insref = trim(sicsyac.xmm600.acno)
        nv_transfer  = YES.
    FIND sicsyac.xtm600 USE-INDEX xtm60001 WHERE sicsyac.xtm600.acno  = nv_insref  NO-ERROR NO-WAIT.
    IF NOT AVAILABLE sicsyac.xtm600 THEN DO:
        IF LOCKED sicsyac.xtm600 THEN DO:
            nv_transfer = NO.
            RETURN.
        END.
        ELSE DO:
            CREATE sicsyac.xtm600.
            nv_transfer  = YES.
        END.
    END.
    IF nv_transfer = YES THEN DO:
        ASSIGN
            sicsyac.xtm600.acno      = nv_insref                                          /*Account no.*/
            sicsyac.xtm600.ntitle    = TRIM(wdetail.tiname)                               /*Title*/
            sicsyac.xtm600.firstname = trim(wdetail.insnam)
            sicsyac.xtm600.lastname  = trim(wdetail.lastname)
            /*sicsyac.xtm600.name      = TRIM(wdetail.insnam) + " " + trim(wdetail.name3) */  /*Name of Insured Line 1*/  /*A64-0355*/
            /*sicsyac.xtm600.abname    = TRIM(wdetail.insnam) + " " + trim(wdetail.name3) */  /*Abbreviated Name*/        /*A64-0355*/
            sicsyac.xtm600.name      = TRIM(wdetail.insnam) + " " + trim(wdetail.lastname)   /*Name of Insured Line 1*/   /*A64-0355*/
            sicsyac.xtm600.abname    = TRIM(wdetail.insnam) + " " + trim(wdetail.lastname)   /*Abbreviated Name*/         /*A64-0355*/
            sicsyac.xtm600.addr1     = TRIM(wdetail.addr)            /*address line 1*/
            sicsyac.xtm600.addr2     = TRIM(wdetail.tambon)                               /*address line 2*/
            sicsyac.xtm600.addr3     = TRIM(wdetail.amper)                                /*address line 3*/
            sicsyac.xtm600.addr4     = TRIM(wdetail.country)                              /*address line 4*/
            sicsyac.xtm600.post      = TRIM(wdetail.post)
            sicsyac.xtm600.name2     = ""                                                 /*Name of Insured Line 2*/ 
            sicsyac.xtm600.name3     = ""                                                 /*Name of Insured Line 3*/
            sicsyac.xtm600.fname     = "" .                                               /*First Name*/
    END.
END.
ASSIGN  wdetail.nv_insref = nv_insref .

RELEASE sicsyac.xtm600.
RELEASE sicsyac.xmm600.
RELEASE sicsyac.xzm056.
... end A65-0043...*/
/*
RETURN.
HIDE MESSAGE NO-PAUSE.*/

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE 00-proc_mailtxt C-Win 
PROCEDURE 00-proc_mailtxt :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
/* comment by : A67-0029 ..
DEF VAR no_policy AS CHAR FORMAT "x(20)" .
DEF VAR no_rencnt AS CHAR FORMAT "99".
DEF VAR no_endcnt AS CHAR FORMAT "999".
DEF VAR no_riskno AS CHAR FORMAT "999".
DEF VAR no_itemno AS CHAR FORMAT "999".
DEF VAR nv_sex1   AS CHAR FORMAT "x(5)" init ""  .
DEF VAR nv_sex2   AS CHAR FORMAT "x(5)" init ""  .
DEF VAR nv_occup1 AS CHAR FORMAT "x(50)" init ""  .   
DEF VAR nv_occup2 AS CHAR FORMAT "x(50)" init ""  .  
DEF VAR nv_idno1  AS CHAR FORMAT "x(13)" init ""  .   
DEF VAR nv_idno2  AS CHAR FORMAT "x(13)" init ""  .   
DEF VAR nv_licen1 AS CHAR FORMAT "x(13)" init ""  .   
DEF VAR nv_licen2 AS CHAR FORMAT "x(13)" init ""  .   

IF  wdetail.drivnam = "Y" THEN DO :      /*note add 07/11/2005*/
  no_policy = sic_bran.uwm301.policy .
  no_rencnt = STRING(sic_bran.uwm301.rencnt,"99") .
  no_endcnt = STRING(sic_bran.uwm301.endcnt,"999") .

  no_riskno = "001".
  no_itemno = "001".
  ASSIGN nv_lnumber  = 0
         nv_drivage1 = 0
         nv_drivage2 = 0
         nv_drivbir1 = ""
         nv_drivbir2 = ""
         nv_sex1     = ""    nv_sex1     = if trim(wdetail.dgender1) = "M" then "MALE" else if trim(wdetail.dgender1) = "F" then "FEMALE" else ""
         nv_sex2     = ""    nv_sex2     = if trim(wdetail.dgender2) = "M" then "MALE" else if trim(wdetail.dgender2) = "F" then "FEMALE" else ""
         nv_occup1   = ""    nv_occup1   = trim(wdetail.docoup) 
         nv_occup2   = ""    nv_occup2   = trim(wdetail.ddocoup)
         nv_idno1    = ""    nv_idno1    = trim(wdetail.dicno) 
         nv_idno2    = ""    nv_idno2    = trim(wdetail.ddicno)
         nv_licen1   = ""    nv_licen1   = trim(wdetail.ddriveno)
         nv_licen2   = ""    nv_licen2   = trim(wdetail.dddriveno) 
         wdetail.dbirth    = STRING(DATE(wdetail.dbirth),"99/99/9999")
         wdetail.ddbirth   = STRING(DATE(wdetail.ddbirth),"99/99/9999") .

  nv_drivage1 = INT(SUBSTR(wdetail.dbirth,7,4)) .
  nv_drivage2 = INT(SUBSTR(wdetail.ddbirth,7,4)) .

  if nv_drivage1 < year(today) then do:
      nv_drivage1 =  YEAR(TODAY) - nv_drivage1  .
      IF wdetail.dbirth <> " "  AND wdetail.drivername1 <> " " THEN DO: /*note add & modified*/
        ASSIGN  nv_drivbir1    = STRING(INT(SUBSTR(wdetail.dbirth,7,4))  + 543 )
                wdetail.dbirth = SUBSTR(wdetail.dbirth,1,6) + nv_drivbir1
                wdetail.dbirth = STRING(DATE(wdetail.dbirth),"99/99/9999") .
      END.
  END.
  ELSE DO:
      nv_drivage1 =  YEAR(TODAY) - (nv_drivage1 - 543).
      IF wdetail.dbirth <> " "  AND wdetail.drivername1 <> " " THEN DO: /*note add & modified*/
          ASSIGN 
          nv_drivbir1    = STRING(INT(SUBSTR(wdetail.dbirth,7,4)))
          wdetail.dbirth = SUBSTR(wdetail.dbirth,1,6) + nv_drivbir1
          wdetail.dbirth = STRING(DATE(wdetail.dbirth),"99/99/9999") .
      END.
  END.
  if nv_drivage2 < year(today) then do:
       nv_drivage2 =  YEAR(TODAY) - nv_drivage2  .
       IF wdetail.ddbirth <>  " " AND wdetail.drivername2 <> " " THEN DO: /*note add & modified */
           ASSIGN 
            nv_drivbir2       = STRING(INT(SUBSTR(wdetail.ddbirth,7,4))  + 543 )
            wdetail.ddbirth   = SUBSTR(wdetail.ddbirth,1,6) + nv_drivbir2
            wdetail.ddbirth   = STRING(DATE(wdetail.ddbirth),"99/99/9999").
       END.
  END.
  ELSE DO:
       nv_drivage2 =  YEAR(TODAY) - (nv_drivage2 - 543) .
       IF wdetail.ddbirth <>  " " AND wdetail.drivername2 <> " " THEN DO: /*note add & modified */
           ASSIGN
              nv_drivbir2       = STRING(INT(SUBSTR(wdetail.ddbirth,7,4)) )
              wdetail.ddbirth   = SUBSTR(wdetail.ddbirth,1,6) + nv_drivbir2
              wdetail.ddbirth   = STRING(DATE(wdetail.ddbirth),"99/99/9999").
       END.
  END.
  
  FIND  LAST   brstat.mailtxt_fil  USE-INDEX  mailtxt01  WHERE
               brstat.mailtxt_fil.policy  = no_policy + no_rencnt + no_endcnt +  no_riskno + no_itemno  AND
               brstat.mailtxt_fil.bchyr = nv_batchyr   AND                                               
               brstat.mailtxt_fil.bchno = nv_batchno   AND
               brstat.mailtxt_fil.bchcnt  = nv_batcnt    NO-LOCK  NO-ERROR  NO-WAIT.
        IF NOT AVAIL brstat.mailtxt_fil THEN  nv_lnumber =   1.                                                      


        FIND FIRST   brstat.mailtxt_fil  USE-INDEX  mailtxt01  WHERE
                     brstat.mailtxt_fil.policy  = no_policy + no_rencnt + no_endcnt +  no_riskno + no_itemno     AND
                     brstat.mailtxt_fil.lnumber = nv_lnumber    AND
                     brstat.mailtxt_fil.bchyr = nv_batchyr    AND                                               
                     brstat.mailtxt_fil.bchno = nv_batchno    AND
                     brstat.mailtxt_fil.bchcnt  = nv_batcnt     NO-LOCK  NO-ERROR  NO-WAIT.
        IF NOT AVAIL brstat.mailtxt_fil   THEN DO:
              CREATE brstat.mailtxt_fil.
              ASSIGN                                           
                     brstat.mailtxt_fil.policy    = no_policy + no_rencnt + no_endcnt +  no_riskno + no_itemno
                     brstat.mailtxt_fil.lnumber   = nv_lnumber.
                     brstat.mailtxt_fil.ltext     = wdetail.drivername1 + FILL(" ",50 - LENGTH(wdetail.drivername1)) + nv_sex1 . 
                     brstat.mailtxt_fil.ltext2    = wdetail.dbirth + "  " 
                                                  + string(nv_drivage1).
                     nv_drivno                    = 1 .
                     ASSIGN 
                     brstat.mailtxt_fil.bchyr = nv_batchyr 
                     brstat.mailtxt_fil.bchno = nv_batchno 
                     brstat.mailtxt_fil.bchcnt  = nv_batcnt 
                     SUBSTRING(brstat.mailtxt_fil.ltext2,16,40)   =  nv_occup1
                     SUBSTRING(brstat.mailtxt_fil.ltext2,101,50)  =  nv_idno1
                     SUBSTRING(brstat.mailtxt_fil.ltext2,151,50)  =  nv_licen1 
                     SUBSTRING(brstat.mailtxt_fil.ltext2,201,4)   =  "" . 
                     
              IF wdetail.drivername2 <> "" THEN DO:
                    CREATE brstat.mailtxt_fil. 
                    ASSIGN
                        brstat.mailtxt_fil.policy   = no_policy + no_rencnt + no_endcnt +  no_riskno + no_itemno
                        brstat.mailtxt_fil.lnumber  = nv_lnumber + 1
                        brstat.mailtxt_fil.ltext    = wdetail.drivername2 + FILL(" ",50 - LENGTH(wdetail.drivername2)) + nv_sex2 
                        brstat.mailtxt_fil.ltext2   = wdetail.ddbirth + "  " + string(nv_drivage2) 
                        nv_drivno                   = 2.
                        ASSIGN /*a490166*/
                        brstat.mailtxt_fil.bchyr = nv_batchyr 
                        brstat.mailtxt_fil.bchno = nv_batchno 
                        brstat.mailtxt_fil.bchcnt  = nv_batcnt 
                        SUBSTRING(brstat.mailtxt_fil.ltext2,16,40)  =  nv_occup2
                        SUBSTRING(brstat.mailtxt_fil.ltext2,101,50) =  nv_idno2
                        SUBSTRING(brstat.mailtxt_fil.ltext2,151,50) =  nv_licen2
                        SUBSTRING(brstat.mailtxt_fil.ltext2,201,4)  =  "" . 
              END.  /*drivnam2 <> " " */
        END. /*End Avail Brstat*/
        ELSE  DO:
              CREATE  brstat.mailtxt_fil.
              ASSIGN  brstat.mailtxt_fil.policy     = wdetail.policy + string(sic_bran.uwm100.rencnt) + string(sic_bran.uwm100.endcnt) + string(sic_bran.uwm301.riskno)  + string(sic_bran.uwm301.itemno)
                      brstat.mailtxt_fil.lnumber    = nv_lnumber
                      brstat.mailtxt_fil.ltext      = wdetail.drivername1 + FILL(" ",50 - LENGTH(wdetail.drivername1)) + nv_sex1 
                      brstat.mailtxt_fil.ltext2     = wdetail.dbirth + "  " +  TRIM(string(nv_drivage1))
                      SUBSTRING(brstat.mailtxt_fil.ltext2,16,40)   =  nv_occup1
                      SUBSTRING(brstat.mailtxt_fil.ltext2,101,50)  =  nv_idno1
                      SUBSTRING(brstat.mailtxt_fil.ltext2,151,50)  =  nv_licen1 
                      SUBSTRING(brstat.mailtxt_fil.ltext2,201,4)   =  "" . 

                      IF wdetail.drivername2 <> "" THEN DO:
                            CREATE  brstat.mailtxt_fil.
                                ASSIGN
                                brstat.mailtxt_fil.policy   = wdetail.policy + string(uwm100.rencnt) + string(uwm100.endcnt) + string(uwm301.riskno)  + string(uwm301.itemno)
                                brstat.mailtxt_fil.lnumber  = nv_lnumber + 1
                                brstat.mailtxt_fil.ltext    = wdetail.drivername2 + FILL(" ",50 - LENGTH(wdetail.drivername2)) + nv_sex2
                                brstat.mailtxt_fil.ltext2   = wdetail.ddbirth + "  " + TRIM(string(nv_drivage2)).
                                ASSIGN /*a490166*/
                                brstat.mailtxt_fil.bchyr = nv_batchyr 
                                brstat.mailtxt_fil.bchno = nv_batchno 
                                brstat.mailtxt_fil.bchcnt  = nv_batcnt 
                                SUBSTRING(brstat.mailtxt_fil.ltext2,16,40)  =  nv_occup2
                                SUBSTRING(brstat.mailtxt_fil.ltext2,101,50) =  nv_idno2
                                SUBSTRING(brstat.mailtxt_fil.ltext2,151,50) =  nv_licen2
                                SUBSTRING(brstat.mailtxt_fil.ltext2,201,4)  =  "" . 
                      END. /*drivnam2 <> " " */                                     
        END. /*Else DO*/                                                            
 END. /*note add for mailtxt 07/11/2005*/
RELEASE brstat.mailtxt_fil .
...end A67-0029...*/
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE 00-proc_policyname4 C-Win 
PROCEDURE 00-proc_policyname4 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:     
------------------------------------------------------------------------------*/
/* comment by : A66-0202...
DEF VAR nv_si AS INT INIT 0. 
DEF VAR nv_ModelYear   AS DECI INIT 0.
DEF VAR nv_campaignMS  AS CHAR INIT "".  /*A63-0206*/ 
DEF VAR n_packcod  AS CHAR FORMAT "x(10)" INIT "" .
def var n_subclass as char format "x(4)" init "" .
def var n_covcod   as char format "x(3)" init "" .
def var n_cargrp   as char format "x(1)" init "" .
def var n_vehuse   as char format "x(1)" init "" .
def var n_garage   as char format "x(1)" init "" .
def var n_si       as DECI init 0 .
def var n_brand    as char format "x(25)" init "" .
def var n_model    as char format "x(30)" init "" .
def var n_premt    as DECI init 0 .

DO:
     ASSIGN fi_process = "Check Campaign (campaign_fil)..." + wdetail.policyno .
     DISP fi_process WITH FRAM fr_main.
     
     IF wdetail.packcod <> "" AND wdetail.poltyp = "V70"  THEN DO:
         ASSIGN n_yr = 0
                n_yr = (YEAR(TODAY) - DECI(wdetail.yrmanu)).

       IF ra_type = 1 THEN DO: 
           IF n_yr = 0 OR n_yr = 1 THEN n_yr = 1 . 
           ELSE n_yr = n_yr + 1.
       END.
       IF wdetail.covcod = "1"  THEN DO:
           IF wdetail.subclass <> "110" THEN DO:  /* 110E 210 320 */ /*A64-0044 */
             IF wdetail.cargrp <> "" AND wdetail.vehuse <> ""  THEN DO:
               FIND LAST stat.campaign_fil USE-INDEX campfil04  WHERE 
                   stat.campaign_fil.camcod = wdetail.packcod   AND /* campaign no */
                   stat.campaign_fil.sclass = wdetail.subclass  AND /* class 110 210 320 */
                   stat.campaign_fil.covcod = wdetail.covcod    AND /* cover 1 2 3 2.1 2.2 3.1 3.2 */
                   stat.campaign_fil.vehgrp = wdetail.cargrp    AND /* group car */
                   stat.campaign_fil.vehuse = wdetail.vehuse    AND /* ประเภทการใช้รถ */
                   stat.campaign_fil.garage = wdetail.garage          AND /* การซ่อม */
                   stat.campaign_fil.maxyea = n_yr                    AND /* อายุรถ */
                   stat.campaign_fil.simax  = deci(wdetail.si)        AND  /* ทุน */
                   stat.campaign_fil.makdes = wdetail.brand     AND 
                   (index(wdetail.model,stat.campaign_fil.moddes) <> 0  OR   /* Model */
                   index(stat.campaign_fil.moddes,wdetail.model) <> 0 ) AND   /* Model */ /*A64-0044*/
                   stat.campaign_fil.netprm  = wdetail.premt         NO-LOCK NO-ERROR.   
             END.
             ELSE DO:
                  FIND LAST stat.campaign_fil USE-INDEX campfil04  WHERE 
                   stat.campaign_fil.camcod = wdetail.packcod   AND /* campaign no */
                   stat.campaign_fil.sclass = wdetail.subclass  AND /* class 110 210 320 */
                   stat.campaign_fil.covcod = wdetail.covcod    AND /* cover 1 2 3 2.1 2.2 3.1 3.2 */
                   stat.campaign_fil.garage = wdetail.garage    AND /* การซ่อม */
                   stat.campaign_fil.maxyea = n_yr              AND /* อายุรถ */
                   stat.campaign_fil.simax  = deci(wdetail.si)  AND  /* ทุน */
                   stat.campaign_fil.makdes = wdetail.brand     AND 
                   (index(wdetail.model,stat.campaign_fil.moddes) <> 0  OR   /* Model */
                   index(stat.campaign_fil.moddes,wdetail.model) <> 0 ) AND   /* Model */ /*A64-0044*/
                   stat.campaign_fil.netprm  = wdetail.premt         NO-LOCK NO-ERROR. 
             END.
             /*IF AVAIL stat.campaign_fil THEN ASSIGN nv_polmaster = stat.campaign_fil.polmst.*/  /* A64-0044 */
             /* add by : A64-0044 */
             IF AVAIL stat.campaign_fil THEN 
                 ASSIGN   wdetail.polmaster = stat.campaign_fil.polmst
                          wdetail.seat41    = stat.campaign_fil.seat41. 
             /* end : A64-0044 */
             ELSE DO: 
                IF deci(wdetail.si) > 1000000 THEN DO:
                    ASSIGN nv_si = 0
                           nv_si = deci(wdetail.si) + 40000 .
                    FIND LAST stat.campaign_fil USE-INDEX campfil04  WHERE 
                     stat.campaign_fil.camcod = wdetail.packcod   AND /* campaign no */
                     stat.campaign_fil.sclass = wdetail.subclass  AND /* class 110 210 320 */
                     stat.campaign_fil.covcod = wdetail.covcod    AND /* cover 1 2 3 2.1 2.2 3.1 3.2 */
                     stat.campaign_fil.garage = wdetail.garage          AND /* การซ่อม */
                     stat.campaign_fil.maxyea = n_yr                    AND /* อายุรถ */
                     stat.campaign_fil.simax  >= deci(wdetail.si)       AND
                     stat.campaign_fil.simax  <= nv_si                  AND
                     stat.campaign_fil.makdes = wdetail.brand     AND 
                     (index(wdetail.model,stat.campaign_fil.moddes) <> 0  OR   /* Model */
                   index(stat.campaign_fil.moddes,wdetail.model) <> 0 ) AND   /* Model */ /*A64-0044*/
                     stat.campaign_fil.netprm   = wdetail.premt           NO-LOCK NO-ERROR.   /* Model */
                    /*IF AVAIL stat.campaign_fil THEN ASSIGN nv_polmaster = stat.campaign_fil.polmst.
                    ELSE ASSIGN nv_polmaster = "" .*/ /*A64-0044*/
                    /* add by : A64-0044 */
                    IF AVAIL stat.campaign_fil THEN 
                        ASSIGN   wdetail.polmaster = stat.campaign_fil.polmst
                                 wdetail.seat41    = stat.campaign_fil.seat41. 
                    ELSE ASSIGN wdetail.polmaster = "" . 
                    /* end : A64-0044 */
                END. /* end si > 1000000 */
             END.
             /* ไม่เช็คอายุรถ */
             /*IF nv_polmaster = "" THEN DO: */ /*A64-0044*/
             IF wdetail.polmaster = "" THEN DO:  /*A64-0044*/
               /* A64-0044 */
               n_model = "" .
               IF INDEX(wdetail.model," ") <> 0 THEN ASSIGN n_model = SUBSTR(wdetail.model,1,INDEX(wdetail.model," ") - 1).
               ELSE n_model = TRIM(wdetail.model) .
               /* end : A64-0044 */
               FIND LAST stat.campaign_fil /*USE-INDEX campfil01*/  WHERE 
                    stat.campaign_fil.camcod = wdetail.packcod     AND /* campaign no */
                    stat.campaign_fil.sclass = wdetail.subclass    AND /* class 110 210 320 */
                    stat.campaign_fil.covcod = wdetail.covcod      AND /* cover 1 2 3 2.1 2.2 3.1 3.2 */
                    stat.campaign_fil.garage = wdetail.garage      AND /* การซ่อม */
                    stat.campaign_fil.maxyea = 1                   AND /* อายุรถ */
                    stat.campaign_fil.simax  = deci(wdetail.si)    AND  /* ทุน */
                    stat.campaign_fil.makdes = wdetail.brand       AND 
                    (index(n_model,stat.campaign_fil.moddes) <> 0  OR   /* Model */
                    index(stat.campaign_fil.moddes,n_model) <> 0 ) AND   /* Model */ /*A64-0044*/
                    stat.campaign_fil.netprm  = wdetail.premt         NO-LOCK NO-ERROR. 
                /*IF AVAIL stat.campaign_fil THEN ASSIGN nv_polmaster = stat.campaign_fil.polmst.*/     /*A64-0044*/
                  /* add by : A64-0044 */
                     IF AVAIL stat.campaign_fil THEN 
                         ASSIGN   wdetail.polmaster = stat.campaign_fil.polmst
                                  wdetail.seat41    = stat.campaign_fil.seat41. 
                 /* end A64-0044 */
             END.
           END. /* end <> 110 */
           ELSE DO:  /* class 110 */
               RUN proc_campaign110.
           END.
       END. /* end ป.1 */
       ELSE IF (wdetail.covcod = "2.1") OR (wdetail.covcod = "3.1") OR 
               (wdetail.covcod = "2.2") OR (wdetail.covcod = "3.2") THEN DO:
           IF wdetail.subclass <> "110" THEN DO:  /*A64-0044*/
            FIND LAST stat.campaign_fil /*USE-INDEX campfil15*/  WHERE                
                stat.campaign_fil.camcod  =  wdetail.packcod         and       /*campaign */ /*A63-0443*/
                stat.campaign_fil.sclass  =  wdetail.subclass        and       /* class 110 210 320 */
                stat.campaign_fil.covcod  =  wdetail.covcod          and       /* cover 1 2 3 2.1 2.2 3.1 3.2 */
                stat.campaign_fil.garage  =  wdetail.garage          and       /*   ประเภทการซ่อม   */
               (stat.campaign_fil.simin   <= deci(wdetail.siplus)    and       /*   วงเงินทุนประกันต่ำสุด */
                stat.campaign_fil.simax   >= deci(wdetail.siplus))   AND       /*   วงเงินทุนประกันสูงสุด */
                stat.campaign_fil.makdes   = wdetail.brand           AND 
                (index(wdetail.model,stat.campaign_fil.moddes) <> 0  OR   /* Model */
                 index(stat.campaign_fil.moddes,wdetail.model) <> 0 ) AND   /* Model */ /*A64-0044*/
                stat.campaign_fil.netprm   = wdetail.premt           NO-LOCK NO-ERROR.  /* เบี้ยจากไฟล์ */
                /*IF AVAIL stat.campaign_fil THEN ASSIGN nv_polmaster = stat.campaign_fil.polmst.
                ELSE ASSIGN nv_polmaster = "" .*/ /*A64-0044*/
              /* add by : A64-0044 */
              IF AVAIL stat.campaign_fil THEN 
                 ASSIGN   wdetail.polmaster = stat.campaign_fil.polmst
                          wdetail.seat41    = stat.campaign_fil.seat41. 
              ELSE ASSIGN wdetail.polmaster = "" . 
             /* end : A64-0044 */
           END.
           /* create by : A64-0044 */
           ELSE DO: /* class 110 */
               IF wdetail.engcc <= 2000 THEN DO:
                    FIND LAST stat.campaign_fil /*USE-INDEX campfil15*/  WHERE                
                     stat.campaign_fil.camcod  =  wdetail.packcod         and       /*campaign */ /*A63-0443*/
                     stat.campaign_fil.sclass  =  wdetail.subclass        and       /* class 110 210 320 */
                     stat.campaign_fil.covcod  =  wdetail.covcod          and       /* cover 1 2 3 2.1 2.2 3.1 3.2 */
                     stat.campaign_fil.garage  =  wdetail.garage          and       /*   ประเภทการซ่อม   */
                     stat.campaign_fil.engine  <= 2000                    AND /* cc */   
                    (stat.campaign_fil.simin   <= deci(wdetail.siplus)    and       /*   วงเงินทุนประกันต่ำสุด */
                     stat.campaign_fil.simax   >= deci(wdetail.siplus))   AND       /*   วงเงินทุนประกันสูงสุด */
                     stat.campaign_fil.makdes   = wdetail.brand           AND 
                     (index(wdetail.model,stat.campaign_fil.moddes) <> 0  OR   /* Model */
                      index(stat.campaign_fil.moddes,wdetail.model) <> 0 ) AND   /* Model */ /*A64-0044*/
                     stat.campaign_fil.netprm   = wdetail.premt           NO-LOCK NO-ERROR.  /* เบี้ยจากไฟล์ */
               END.
               ELSE DO:
                    FIND LAST stat.campaign_fil /*USE-INDEX campfil15*/  WHERE                
                     stat.campaign_fil.camcod  =  wdetail.packcod         and       /*campaign */ /*A63-0443*/
                     stat.campaign_fil.sclass  =  wdetail.subclass        and       /* class 110 210 320 */
                     stat.campaign_fil.covcod  =  wdetail.covcod          and       /* cover 1 2 3 2.1 2.2 3.1 3.2 */
                     stat.campaign_fil.garage  =  wdetail.garage          and       /*   ประเภทการซ่อม   */
                     stat.campaign_fil.engine  > 2000                     AND /* cc */  
                    (stat.campaign_fil.simin   <= deci(wdetail.siplus)    and       /*   วงเงินทุนประกันต่ำสุด */
                     stat.campaign_fil.simax   >= deci(wdetail.siplus))   AND       /*   วงเงินทุนประกันสูงสุด */
                     stat.campaign_fil.makdes   = wdetail.brand           AND 
                     (index(wdetail.model,stat.campaign_fil.moddes) <> 0  OR   /* Model */
                      index(stat.campaign_fil.moddes,wdetail.model) <> 0 ) AND   /* Model */ /*A64-0044*/
                     stat.campaign_fil.netprm   = wdetail.premt           NO-LOCK NO-ERROR.  /* เบี้ยจากไฟล์ */

               END.
              IF AVAIL stat.campaign_fil THEN 
                 ASSIGN   wdetail.polmaster = stat.campaign_fil.polmst
                          wdetail.seat41    = stat.campaign_fil.seat41. 
              ELSE ASSIGN wdetail.polmaster = "" . 
           END.
          /* end : A64-0044 */
       END. /* end ป.2+ ป.3+ */
       ELSE DO: /* ป2 ป3 */
           FIND LAST stat.campaign_fil /*USE-INDEX campfil15*/  WHERE                
               stat.campaign_fil.camcod  = wdetail.packcod  and       /*campaign */ /*A63-0443*/
               stat.campaign_fil.sclass  = wdetail.subclass and       /* class 110 210 320 */
               stat.campaign_fil.covcod  = wdetail.covcod   and       /* cover 1 2 3 2.1 2.2 3.1 3.2 */
               stat.campaign_fil.makdes  = wdetail.brand     AND 
               (index(wdetail.model,stat.campaign_fil.moddes) <> 0  OR   /* Model */
                 index(stat.campaign_fil.moddes,wdetail.model) <> 0 ) AND   /* Model */ /*A64-0044*/
               stat.campaign_fil.netprm  = wdetail.premt           NO-LOCK NO-ERROR.  /* เบี้ยจากไฟล์ */
            /*IF AVAIL stat.campaign_fil THEN ASSIGN nv_polmaster = stat.campaign_fil.polmst.
            ELSE ASSIGN nv_polmaster = "" . */ /*A64-0044*/
            /* add by : A64-0044 */
            IF AVAIL stat.campaign_fil THEN 
              ASSIGN   wdetail.polmaster = stat.campaign_fil.polmst
                       wdetail.seat41    = stat.campaign_fil.seat41. 
            ELSE ASSIGN wdetail.polmaster = "" . 
            /* end : A64-0044*/
       END.
       /*IF nv_polmaster = "" THEN wdetail.comment = "ไม่พบ Policy Master ตามรายละเอียดของไฟล์นำเข้าในแพ็คเกจ " + wdetail.packcod.*/  /*A64-0044*/
       /* A64-0044 */
       IF wdetail.polmaster = "" THEN 
          ASSIGN  wdetail.comment = wdetail.comment + "ไม่พบ Policy Master ตามรายละเอียดของไฟล์นำเข้าในแพ็คเกจ " + wdetail.packcod
                  wdetail.pass    = "N" 
                  wdetail.OK_GEN  = "N".
       /* end : A64-0044 */
     END.
     RELEASE stat.campaign_fil.
      
END.
*/

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE 00-proc_report1 C-Win 
PROCEDURE 00-proc_report1 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes: comment by : A67-0029   
------------------------------------------------------------------------------*/
/*DEF VAR NOT_pass AS INTE INIT 0.
nv_row  =  1.
DEF VAR a AS CHAR FORMAT "x(100)" INIT "".
DEF VAR b AS CHAR FORMAT "x(100)" INIT "".
DEF VAR c AS INTE INIT 0.

FOR EACH wdetail WHERE wdetail.PASS <> "Y"  :
       NOT_pass = NOT_pass + 1.
END.
IF NOT_pass > 0 THEN DO:
OUTPUT STREAM ns1 TO value(fi_output2).
PUT STREAM ns1
  " risk no      "      "|"             /*1  */    /*A64-0355*/
  " itemno       "      "|"             /*2  */  
  " policyno     "     "|"              /*3  */  
  " n_branch     "     "|"              /*4  */  
  " agent        "     "|"              /*5  */  
  " producer     "     "|"              /*6  */  
  " n_delercode  "     "|"              /*7  */  
  " fincode      "     "|"              /*8  */  
  " appenno      "     "|"              /*9  */  
  " salename     "     "|"              /*10 */  
  " srate        "     "|"              /*11 */  
  " comdat       "     "|"              /*12 */  
  " expdat       "     "|"              /*13 */  
  " agreedat     "     "|"              /*14 */  
  " firstdat     "     "|"              /*15 */  
  " packcod      "     "|"              /*16 */  
  " camp_no      "     "|"              /*17 */  
  " campen       "     "|"              /*18 */  
  " specon       "     "|"              /*19 */  
  " product      "     "|"              /*20 */  
  " promo        "     "|"              /*21 */  
  " rencnt       "     "|"              /*22 */  
  " prepol       "     "|"              /*23 */  
  " txt1         "     "|"              /*24 */  
  " txt2         "     "|"              /*25 */  
  " txt3         "     "|"              /*26 */  
  " txt4         "     "|"              /*27 */  
  " txt5         "     "|"              /*28 */  
  " txt6         "     "|"              /*29 */  
  " txt7         "     "|"              /*30 */  
  " txt8         "     "|"              /*31 */  
  " txt9         "     "|"              /*32 */  
  " txt10        "     "|"              /*33 */  
  " memo1        "     "|"              /*34 */  
  " memo2        "     "|"              /*35 */  
  " memo3        "     "|"              /*36 */  
  " memo4        "     "|"              /*37 */  
  " memo5        "     "|"              /*38 */  
  " memo6        "     "|"              /*39 */  
  " memo7        "     "|"              /*40 */  
  " memo8        "     "|"              /*41 */  
  " memo9        "     "|"              /*42 */  
  " memo10       "     "|"              /*43 */  
  " accdata1     "     "|"              /*44 */  
  " accdata2     "     "|"              /*45 */  
  " accdata3     "     "|"              /*46 */  
  " accdata4     "     "|"              /*47 */  
  " accdata5     "     "|"              /*48 */  
  " accdata6     "     "|"              /*49 */  
  " accdata7     "     "|"              /*50 */  
  " accdata8     "     "|"              /*51 */  
  " accdata9     "     "|"              /*52 */  
  " accdata10    "     "|"              /*53 */  
  " compul       "     "|"              /*54 */  
  " insrefno     "     "|"              /*55 */   /*A64-0355*/
  " instyp       "     "|"              /*56 */  
  " inslang      "     "|"              /*57 */  
  " tiname       "     "|"              /*58 */  
  " insnam       "     "|"              /*59 */  
  " lastname     "     "|"              /*60 */  
  " icno         "     "|"              /*61 */  
  " insbr        "     "|"              /*62 */  
  " occup        "     "|"              /*63 */  
  " addr         "     "|"              /*64 */  
  " tambon       "     "|"              /*65 */  
  " amper        "     "|"              /*66 */  
  " country      "     "|"              /*67 */  
  " post         "     "|"              /*68 */  
  " provcod      "     "|"              /*69 */  
  " distcod      "     "|"              /*70 */  
  " sdistcod     "     "|"              /*71 */  
  " jpAE code    "     "|"              /*72 */   /*A64-0355*/ 
  " jpJT Code    "     "|"              /*73 */   /*A64-0355*/
  " jpTS code    "     "|"              /*74 */   /*A64-0355*/
  " gender       "     "|"              /*75 */  
  " tele1        "     "|"              /*76 */  
  " tele2        "     "|"              /*77 */  
  " mail1        "     "|"              /*78 */  
  " mail2        "     "|"              /*79 */  
  " mail3        "     "|"              /*80 */  
  " mail4        "     "|"              /*81 */  
  " mail5        "     "|"              /*82 */  
  " mail6        "     "|"              /*83 */  
  " mail7        "     "|"              /*84 */  
  " mail8        "     "|"              /*85 */  
  " mail9        "     "|"              /*86 */  
  " mail10       "     "|"              /*87 */  
  " fax          "     "|"              /*88 */  
  " lineID       "     "|"              /*89 */  
  " name2        "     "|"              /*90 */  
  " name3        "     "|"              /*91 */  
  " benname      "     "|"              /*92 */  
  " payercod     "     "|"              /*93 */  
  " vatcode      "     "|"              /*94 */  
  " instcod1     "     "|"              /*95 */  
  " insttyp1     "     "|"              /*96 */  
  " insttitle1   "     "|"              /*97 */  
  " instname1    "     "|"              /*98 */  
  " instlname1   "     "|"              /*99 */  
  " instic1      "     "|"              /*100*/  
  " instbr1      "     "|"              /*101*/  
  " instaddr11   "     "|"              /*102*/  
  " instaddr21   "     "|"              /*103*/  
  " instaddr31   "     "|"              /*104*/  
  " instaddr41   "     "|"              /*105*/  
  " instpost1    "     "|"              /*106*/  
  " instprovcod1 "     "|"              /*107*/  
  " instdistcod1 "     "|"              /*108*/  
  " instsdistcod1"     "|"              /*109*/  
  " instprm1     "     "|"              /*110*/  
  " instrstp1    "     "|"              /*111*/  
  " instrtax1    "     "|"              /*112*/  
  " instcomm01   "     "|"              /*113*/  
  " instcomm12   "     "|"              /*114*/  
  " instcod2     "     "|"              /*115*/  
  " insttyp2     "     "|"              /*116*/  
  " insttitle2   "     "|"              /*117*/  
  " instname2    "     "|"              /*118*/  
  " instlname2   "     "|"              /*119*/  
  " instic2      "     "|"              /*120*/  
  " instbr2      "     "|"              /*121*/  
  " instaddr12   "     "|"              /*122*/  
  " instaddr22   "     "|"              /*123*/  
  " instaddr32   "     "|"              /*124*/  
  " instaddr42   "     "|"              /*125*/  
  " instpost2    "     "|"              /*126*/  
  " instprovcod2 "     "|"              /*127*/  
  " instdistcod2 "     "|"              /*128*/  
  " instsdistcod2"     "|"              /*129*/  
  " instprm2     "     "|"              /*130*/  
  " instrstp2    "     "|"              /*131*/  
  " instrtax2    "     "|"              /*132*/  
  " instcomm02   "     "|"              /*133*/  
  " instcomm22   "     "|"              /*134*/  
  " instcod3     "     "|"              /*135*/  
  " insttyp3     "     "|"              /*136*/  
  " insttitle3   "     "|"              /*137*/  
  " instname3    "     "|"              /*138*/  
  " instlname3   "     "|"              /*139*/  
  " instic3      "     "|"              /*140*/  
  " instbr3      "     "|"              /*141*/  
  " instaddr13   "     "|"              /*142*/  
  " instaddr23   "     "|"              /*143*/  
  " instaddr33   "     "|"              /*144*/  
  " instaddr43   "     "|"              /*145*/  
  " instpost3    "     "|"              /*146*/  
  " instprovcod3 "     "|"              /*147*/  
  " instdistcod3 "     "|"              /*148*/  
  " instsdistcod3"     "|"              /*149*/  
  " instprm3     "     "|"              /*150*/  
  " instrstp3    "     "|"              /*151*/  
  " instrtax3    "     "|"              /*152*/  
  " instcomm03   "     "|"              /*153*/  
  " instcomm23   "     "|"              /*154*/  
  " covcod       "     "|"              /*155*/  
  " garage       "     "|"              /*156*/  
  " special      "     "|"              /*157*/  
  " inspec       "     "|"              /*158*/  
  " class70      "     "|"              /*159*/
  " vehuse       "     "|"              /* A65-0079*/
  " redbook      "     "|"              /* A65-0079*/
  " brand        "     "|"              /*160*/  
  " model        "     "|"              /*161*/  
  " submodel     "     "|"              /*162*/  
  " caryear      "     "|"              /*163*/  
  " chasno       "     "|"              /*164*/  
  " eng          "     "|"              /*165*/  
  " seat         "     "|"              /*166*/  
  " engcc        "     "|"              /*167*/  
  " weight       "     "|"              /*168*/  
  " watt         "     "|"              /*169*/  
  " body         "     "|"              /*170*/  
  " type         "     "|"              /*171*/  
  " re_year      "     "|"              /*172*/  
  " vehreg       "     "|"              /*173*/  
  " re_country   "     "|"              /*174*/  
  " cargrp       "     "|"              /*175*/  
  " colorcar     "     "|"              /*176*/  
  " fule         "     "|"              /*177*/  
  " drivnam      "     "|"              /*178*/  
  " ntitle1      "     "|"              /*179*/  
  " drivername1  "     "|"              /*180*/  
  " dname2       "     "|"              /*181*/  
  " dicno        "     "|"              /*182*/  
  " dgender1     "     "|"              /*183*/  
  " dbirth       "     "|"              /*184*/  
  " docoup       "     "|"              /*185*/  
  " ddriveno     "     "|"              /*186*/  
  " ntitle2      "     "|"              /*187*/  
  " drivername2  "     "|"              /*188*/  
  " ddname1      "     "|"              /*189*/  
  " ddicno       "     "|"              /*190*/  
  " dgender2     "     "|"              /*191*/  
  " ddbirth      "     "|"              /*192*/  
  " ddocoup      "     "|"              /*193*/  
  " dddriveno    "     "|"              /*194*/  
  " baseplus     "     "|"              /*195*/  
  " siplus       "     "|"              /*196*/  
  " rs10         "     "|"              /*197*/  
  " comper       "     "|"              /*198*/  
  " comacc       "     "|"              /*199*/  
  " deductpd     "     "|"              /*200*/  
  " DOD          "     "|"              /*201*/  
  " DPD          "     "|"              /*202*/  
  " tpfire       "     "|"              /*203*/  
  " NO_41        "     "|"              /*204*/  
  " ac2          "     "|"              /*205*/  
  " ac4          "     "|"              /*206*/  
  " ac5          "     "|"              /*207*/  
  " ac6          "     "|"              /*208*/  
  " ac7          "     "|"              /*209*/  
  " NO_42        "     "|"              /*210*/  
  " NO_43        "     "|"              /*211*/  
  " base         "     "|"              /*212*/  
  " unname       "     "|"              /*213*/  
  " nname        "     "|"              /*214*/  
  " tpbi         "     "|"              /*215*/  
  " tppd         "     "|"              /*216*/  
  " ry01         "     "|"              /*217*/  
  " ry02         "     "|"              /*218*/  
  " ry03         "     "|"              /*219*/  
  " fleet        "     "|"              /*220*/  
  " ncb          "     "|"              /*221*/  
  " claim        "     "|"              /*222*/  
  " dspc         "     "|"              /*223*/  
  " cctv         "     "|"              /*224*/  
  " dstf         "     "|"              /*225*/  
  " fleetprem    "     "|"              /*226*/  
  " ncbprem      "     "|"              /*227*/  
  " clprem       "     "|"              /*228*/  
  " dspcprem     "     "|"              /*229*/  
  " cctvprem     "     "|"              /*230*/  
  " dstfprem     "     "|"              /*231*/  
  " premt        "     "|"              /*232*/  
  " rstp_t       "     "|"              /*233*/  
  " rtax_t       "     "|"              /*234*/  
  " comper70     "     "|"              /*235*/  
  " comprem70    "     "|"              /*236*/  
  " agco70       "     "|"              /*237*/  
  " comco_per70  "     "|"              /*238*/  
  " comco_prem70 "     "|"              /*239*/  
  " dgpackge     "     "|"              /*240*/  
  " danger1      "     "|"              /*241*/  
  " danger2      "     "|"              /*242*/  
  " dgsi         "     "|"              /*243*/  
  " dgrate       "     "|"              /*244*/  
  " dgfeet       "     "|"              /*245*/  
  " dgncb        "     "|"              /*246*/  
  " dgdisc       "     "|"              /*247*/  
  " dgWdisc      "     "|"              /*248*/  
  " dgatt        "     "|"              /*249*/  
  " dgfeetprm    "     "|"              /*250*/  
  " dgncbprm     "     "|"              /*251*/  
  " dgdiscprm    "     "|"              /*252*/
  " dgwdiscprm   "     "|"              /*253*/ 
  " dgprem       "     "|"              /*254*/  
  " dgrstp_t     "     "|"              /*255*/  
  " dgrtax_t     "     "|"              /*256*/  
  " dgcomper     "     "|"              /*257*/  
  " dgcomprem    "     "|"              /*258*/  
  " cltxt        "     "|"              /*259*/  
  " clamount     "     "|"              /*260*/  
  " faultno      "     "|"              /*261*/  
  " faultprm     "     "|"              /*262*/  
  " goodno       "     "|"              /*263*/  
  " goodprm      "     "|"              /*264*/  
  " loss         "     "|"              /*265*/  
  " compolusory  "     "|"              /*266*/  
  " barcode      "     "|"              /*267*/  
  " class72      "     "|"              /*268*/  
  " dstf72       "     "|"              /*269*/  
  " dstfprem72   "     "|"              /*270*/  
  " premt72      "     "|"              /*271*/  
  " rstp_t72     "     "|"              /*272*/  
  " rtax_t72     "     "|"              /*273*/  
  " comper72     "     "|"              /*274*/  
  " comprem72    "     "|"              /*275*/  
  " Comment      "     SKIP .            
    RUN proc_report1_detail.
END.                                                                                    
OUTPUT STREAM ns1 CLOSE.    */                                                  
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE 00-proc_report1_detail C-Win 
PROCEDURE 00-proc_report1_detail :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
/* comment by : A67-0029...
DO:
    FOR EACH wdetail WHERE wdetail.PASS <> "Y" NO-LOCK /*BY wdetail.itemno*/ .
        FIND FIRST wtxt   WHERE wtxt.policyno   = wdetail.policyno  NO-LOCK NO-ERROR .
        FIND FIRST wmemo  WHERE wmemo.policyno  = wdetail.policyno  NO-LOCK NO-ERROR .
        FIND FIRST wacces WHERE wacces.policyno = wdetail.policyno  NO-LOCK NO-ERROR .
        FIND FIRST winst  WHERE winst.policyno  = wdetail.policyno  NO-LOCK NO-ERROR .
        FIND FIRST wdrive WHERE wdrive.policyno  = wdetail.policyno  NO-LOCK NO-ERROR .
        PUT STREAM ns1
            wdetail.riskno       "|"    /*A64-0355*/
            wdetail.itemno       "|"
            wdetail.policyno FORMAT "x(16)"    "|"
            wdetail.n_branch     "|"
            wdetail.agent        "|"
            wdetail.producer     "|"
            wdetail.n_delercode  "|"
            wdetail.fincode      "|"
            wdetail.appenno      "|"
            wdetail.salename     "|"
            wdetail.srate        "|"
            wdetail.comdat       "|"
            wdetail.expdat       "|"
            wdetail.agreedat     "|"
            wdetail.firstdat     "|"
            wdetail.packcod      "|"
            wdetail.camp_no      "|"
            wdetail.campen       "|"
            wdetail.specon       "|"
            wdetail.product      "|"
            wdetail.promo        "|"
            wdetail.rencnt       "|"
            wdetail.prepol       "|"
            wtxt.txt1            "|"
            wtxt.txt2            "|"
            wtxt.txt3            "|"
            wtxt.txt4            "|"
            wtxt.txt5            "|"
            wtxt.txt6            "|"
            wtxt.txt7            "|"
            wtxt.txt8            "|"
            wtxt.txt9            "|"
            wtxt.txt10           "|"
            wmemo.memo1           "|"
            wmemo.memo2           "|"
            wmemo.memo3           "|"
            wmemo.memo4           "|"
            wmemo.memo5           "|"
            wmemo.memo6           "|"
            wmemo.memo7           "|"
            wmemo.memo8           "|"
            wmemo.memo9           "|"
            wmemo.memo10          "|"
            wacces.accdata1       "|"
            wacces.accdata2       "|"
            wacces.accdata3       "|"
            wacces.accdata4       "|"
            wacces.accdata5       "|"
            wacces.accdata6       "|"
            wacces.accdata7       "|"
            wacces.accdata8       "|"
            wacces.accdata9       "|"
            wacces.accdata10      "|"
            wdetail.compul        "|"
            wdetail.nv_insref     "|" /*A64-0355*/
            wdetail.instyp        "|"
            wdetail.inslang       "|"
            wdetail.tiname        "|"
            wdetail.insnam        "|"
            wdetail.lastname      "|"
            wdetail.icno          "|"
            wdetail.insbr         "|"
            wdetail.occup         "|"
            wdetail.addr          "|"
            wdetail.tambon        "|"
            wdetail.amper         "|"
            wdetail.country       "|"
            wdetail.post          "|"
            wdetail.provcod       "|"
            wdetail.distcod       "|"
            wdetail.sdistcod      "|"
            wdetail.jpae          "|"  /*A64-0355*/
            wdetail.jpjtl         "|"  /*A64-0355*/
            wdetail.jpts          "|"  /*A64-0355*/
            wdetail.gender        "|"
            wdetail.tele1         "|"
            wdetail.tele2         "|"
            wdetail.mail1         "|"
            wdetail.mail2         "|"
            wdetail.mail3         "|"
            wdetail.mail4         "|"
            wdetail.mail5         "|"
            wdetail.mail6         "|"
            wdetail.mail7         "|"
            wdetail.mail8         "|"
            wdetail.mail9         "|"
            wdetail.mail10        "|"
            wdetail.fax           "|"
            wdetail.lineID        "|"
            wdetail.name2         "|"
            wdetail.name3         "|"
            wdetail.benname       "|"
            wdetail.payercod      "|"
            wdetail.vatcode       "|"
            winst.instcod1        "|"
            winst.insttyp1        "|"
            winst.insttitle1      "|"
            winst.instname1       "|"
            winst.instlname1      "|"
            winst.instic1         "|"
            winst.instbr1         "|"
            winst.instaddr11      "|"
            winst.instaddr21      "|"
            winst.instaddr31      "|"
            winst.instaddr41      "|"
            winst.instpost1       "|"
            winst.instprovcod1    "|"
            winst.instdistcod1    "|"
            winst.instsdistcod1   "|"
            winst.instprm1        "|"
            winst.instrstp1       "|"
            winst.instrtax1       "|"
            winst.instcomm01      "|"
            winst.instcomm12      "|"
            winst.instcod2        "|"
            winst.insttyp2        "|"
            winst.insttitle2      "|"
            winst.instname2       "|"
            winst.instlname2      "|"
            winst.instic2         "|"
            winst.instbr2         "|"
            winst.instaddr12      "|"
            winst.instaddr22      "|"
            winst.instaddr32      "|"
            winst.instaddr42      "|"
            winst.instpost2       "|"
            winst.instprovcod2    "|"
            winst.instdistcod2    "|"
            winst.instsdistcod2   "|"
            winst.instprm2        "|"
            winst.instrstp2       "|"
            winst.instrtax2       "|"
            winst.instcomm02      "|"
            winst.instcomm22      "|"
            winst.instcod3        "|"
            winst.insttyp3        "|"
            winst.insttitle3      "|"
            winst.instname3       "|"
            winst.instlname3      "|"
            winst.instic3         "|"
            winst.instbr3         "|"
            winst.instaddr13      "|"
            winst.instaddr23      "|"
            winst.instaddr33      "|"
            winst.instaddr43      "|"
            winst.instpost3       "|"
            winst.instprovcod3    "|"
            winst.instdistcod3    "|"
            winst.instsdistcod3   "|"
            winst.instprm3        "|"
            winst.instrstp3       "|"
            winst.instrtax3       "|"
            winst.instcomm03      "|"
            winst.instcomm23      "|"
            wdetail.covcod        "|"
            wdetail.garage        "|"
            wdetail.special       "|"
            wdetail.inspec        "|"
            wdetail.class70       "|"
            wdetail.vehuse        "|"  /* A65-0079*/
            wdetail.redbook       "|"  /* A65-0079*/
            wdetail.brand         "|"
            wdetail.model         "|"
            wdetail.submodel      "|"
            wdetail.yrmanu        "|"
            wdetail.chasno        "|"
            wdetail.eng           "|"
            wdetail.seat41        "|"
            wdetail.engcc         "|"
            wdetail.weight        "|"
            wdetail.watt          "|"
            wdetail.body          "|"
            wdetail.typ           "|"
            wdetail.re_year       "|"
            wdetail.vehreg        "|"
            wdetail.re_country    "|"
            wdetail.cargrp        "|"
            wdetail.colorcar      "|"
            wdetail.fule          "|"
            wdetail.drivnam       "|"
            wdetail.ntitle1       "|"
            wdetail.drivername1   "|"
            wdetail.dname2        "|"
            wdetail.dicno         "|"
            wdetail.dgender1      "|"
            wdetail.dbirth        "|"
            wdetail.docoup        "|"
            wdetail.ddriveno      "|"
            wdetail.ntitle2       "|"
            wdetail.drivername2   "|"
            wdetail.ddname1       "|"
            wdetail.ddicno        "|"
            wdetail.dgender2      "|"
            wdetail.ddbirth       "|"
            wdetail.ddocoup       "|"
            wdetail.dddriveno     "|"
            wdetail.baseplus      "|"
            wdetail.siplus        "|"
            wdetail.rs10          "|"
            wdetail.comper      "|"
            wdetail.comacc      "|"
            wdetail.deductpd      "|"
            wdetail.DOD           "|"
            wdetail.DPD           "|"
            wdetail.si            "|"
            wdetail.NO_411        "|"
            wdetail.seat41        "|"
            wdetail.NO_412        "|"
            wdetail.NO_413        "|"
            wdetail.ac6           "|"
            wdetail.NO_414        "|"
            wdetail.NO_42         "|"
            wdetail.NO_43         "|"
            wdetail.base          "|"
            wdetail.unname        "|"
            wdetail.nname         "|"
            wdetail.tpbi          "|"
            wdetail.tppd          "|"
            wdetail.ry01          "|"
            wdetail.ry02          "|"
            wdetail.ry03          "|"
            wdetail.fleet         "|"
            wdetail.ncb           "|"
            wdetail.claim         "|"
            wdetail.dspc          "|"
            wdetail.cctv          "|"
            wdetail.dstf          "|"
            wdetail.fleetprem     "|"
            wdetail.ncbprem       "|"
            wdetail.clprem        "|"
            wdetail.dspcprem      "|"
            wdetail.cctvprem      "|"
            wdetail.dstfprem      "|"
            wdetail.premt         "|"
            wdetail.rstp_t        "|"
            wdetail.rtax_t        "|"
            wdetail.comper70      "|"
            wdetail.comprem70     "|"
            wdetail.agco70        "|"
            wdetail.comco_per70   "|"
            wdetail.comco_prem70  "|"
            wdetail.dgpackge      "|"
            wdetail.danger1       "|"
            wdetail.danger2       "|"
            wdetail.dgsi          "|"
            wdetail.dgrate        "|"
            wdetail.dgfeet        "|"
            wdetail.dgncb         "|"
            wdetail.dgdisc        "|"
            wdetail.dgWdisc       "|"
            wdetail.dgatt         "|"
            wdetail.dgfeetprm     "|"
            wdetail.dgncbprm      "|"
            wdetail.dgdiscprm     "|"
            wdetail.dgWdiscprm    "|"
            wdetail.dgprem        "|"
            wdetail.dgrstp_t      "|"
            wdetail.dgrtax_t      "|"
            wdetail.dgcomper      "|"
            wdetail.dgcomprem     "|"
            wdetail.cltxt         "|"
            wdetail.clamount      "|"
            wdetail.faultno       "|"
            wdetail.faultprm      "|"
            wdetail.goodno        "|"
            wdetail.goodprm       "|"
            wdetail.loss          "|"
            wdetail.compolusory   "|"
            wdetail.stk           "|"
            wdetail.class72       "|"
            wdetail.dstf72        "|"
            wdetail.dstfprem72    "|"
            wdetail.premt72       "|"
            wdetail.rstp_t72      "|"
            wdetail.rtax_t72      "|"
            wdetail.comper72      "|"
            wdetail.comprem72     "|"
            wdetail.comment       SKIP .
    END.
END.
...end A67-0029..*/
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE 00-PROC_REPORT2 C-Win 
PROCEDURE 00-PROC_REPORT2 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes: comment by A67-0029 
------------------------------------------------------------------------------*/
/*DEF VAR HEAD AS CHAR INIT "Y".
nv_row  =  1.
DEF VAR a AS CHAR FORMAT "x(20)" INIT "".
DEF VAR b AS CHAR FORMAT "x(20)" INIT "".
DEF VAR c AS INTE INIT 0.
DEF VAR d AS INTE INIT 0.
DEF VAR f AS CHAR FORMAT "x(20)" INIT "".
DEF VAR pass AS INTE INIT 0.
FOR EACH  wdetail  WHERE wdetail.PASS = "Y":
        pass = pass + 1.
END.
IF pass > 0 THEN DO:
    OUTPUT STREAM ns2 TO value(fi_output1).
    PUT STREAM NS2
    " risk no      "      "|"             /*1  */    /*A64-0355*/
    " itemno       "      "|"             /*2  */  
    " policyno     "     "|"              /*3  */  
    " n_branch     "     "|"              /*4  */  
    " agent        "     "|"              /*5  */  
    " producer     "     "|"              /*6  */  
    " n_delercode  "     "|"              /*7  */  
    " fincode      "     "|"              /*8  */  
    " appenno      "     "|"              /*9  */  
    " salename     "     "|"              /*10 */  
    " srate        "     "|"              /*11 */  
    " comdat       "     "|"              /*12 */  
    " expdat       "     "|"              /*13 */  
    " agreedat     "     "|"              /*14 */  
    " firstdat     "     "|"              /*15 */  
    " packcod      "     "|"              /*16 */  
    " camp_no      "     "|"              /*17 */  
    " campen       "     "|"              /*18 */  
    " specon       "     "|"              /*19 */  
    " product      "     "|"              /*20 */  
    " promo        "     "|"              /*21 */  
    " rencnt       "     "|"              /*22 */  
    " prepol       "     "|"              /*23 */  
    " txt1         "     "|"              /*24 */  
    " txt2         "     "|"              /*25 */  
    " txt3         "     "|"              /*26 */  
    " txt4         "     "|"              /*27 */  
    " txt5         "     "|"              /*28 */  
    " txt6         "     "|"              /*29 */  
    " txt7         "     "|"              /*30 */  
    " txt8         "     "|"              /*31 */  
    " txt9         "     "|"              /*32 */  
    " txt10        "     "|"              /*33 */  
    " memo1        "     "|"              /*34 */  
    " memo2        "     "|"              /*35 */  
    " memo3        "     "|"              /*36 */  
    " memo4        "     "|"              /*37 */  
    " memo5        "     "|"              /*38 */  
    " memo6        "     "|"              /*39 */  
    " memo7        "     "|"              /*40 */  
    " memo8        "     "|"              /*41 */  
    " memo9        "     "|"              /*42 */  
    " memo10       "     "|"              /*43 */  
    " accdata1     "     "|"              /*44 */  
    " accdata2     "     "|"              /*45 */  
    " accdata3     "     "|"              /*46 */  
    " accdata4     "     "|"              /*47 */  
    " accdata5     "     "|"              /*48 */  
    " accdata6     "     "|"              /*49 */  
    " accdata7     "     "|"              /*50 */  
    " accdata8     "     "|"              /*51 */  
    " accdata9     "     "|"              /*52 */  
    " accdata10    "     "|"              /*53 */  
    " compul       "     "|"              /*54 */  
    " insrefno     "     "|"              /*55 */   /*A64-0355*/
    " instyp       "     "|"              /*56 */  
    " inslang      "     "|"              /*57 */  
    " tiname       "     "|"              /*58 */  
    " insnam       "     "|"              /*59 */  
    " lastname     "     "|"              /*60 */  
    " icno         "     "|"              /*61 */  
    " insbr        "     "|"              /*62 */  
    " occup        "     "|"              /*63 */  
    " addr         "     "|"              /*64 */  
    " tambon       "     "|"              /*65 */  
    " amper        "     "|"              /*66 */  
    " country      "     "|"              /*67 */  
    " post         "     "|"              /*68 */  
    " provcod      "     "|"              /*69 */  
    " distcod      "     "|"              /*70 */  
    " sdistcod     "     "|"              /*71 */  
    " jpAE code    "     "|"              /*72 */   /*A64-0355*/ 
    " jpJT Code    "     "|"              /*73 */   /*A64-0355*/
    " jpTS code    "     "|"              /*74 */   /*A64-0355*/
    " gender       "     "|"              /*75 */  
    " tele1        "     "|"              /*76 */  
    " tele2        "     "|"              /*77 */  
    " mail1        "     "|"              /*78 */  
    " mail2        "     "|"              /*79 */  
    " mail3        "     "|"              /*80 */  
    " mail4        "     "|"              /*81 */  
    " mail5        "     "|"              /*82 */  
    " mail6        "     "|"              /*83 */  
    " mail7        "     "|"              /*84 */  
    " mail8        "     "|"              /*85 */  
    " mail9        "     "|"              /*86 */  
    " mail10       "     "|"              /*87 */  
    " fax          "     "|"              /*88 */  
    " lineID       "     "|"              /*89 */  
    " name2        "     "|"              /*90 */  
    " name3        "     "|"              /*91 */  
    " benname      "     "|"              /*92 */  
    " payercod     "     "|"              /*93 */  
    " vatcode      "     "|"              /*94 */  
    " instcod1     "     "|"              /*95 */  
    " insttyp1     "     "|"              /*96 */  
    " insttitle1   "     "|"              /*97 */  
    " instname1    "     "|"              /*98 */  
    " instlname1   "     "|"              /*99 */  
    " instic1      "     "|"              /*100*/  
    " instbr1      "     "|"              /*101*/  
    " instaddr11   "     "|"              /*102*/  
    " instaddr21   "     "|"              /*103*/  
    " instaddr31   "     "|"              /*104*/  
    " instaddr41   "     "|"              /*105*/  
    " instpost1    "     "|"              /*106*/  
    " instprovcod1 "     "|"              /*107*/  
    " instdistcod1 "     "|"              /*108*/  
    " instsdistcod1"     "|"              /*109*/  
    " instprm1     "     "|"              /*110*/  
    " instrstp1    "     "|"              /*111*/  
    " instrtax1    "     "|"              /*112*/  
    " instcomm01   "     "|"              /*113*/  
    " instcomm12   "     "|"              /*114*/  
    " instcod2     "     "|"              /*115*/  
    " insttyp2     "     "|"              /*116*/  
    " insttitle2   "     "|"              /*117*/  
    " instname2    "     "|"              /*118*/  
    " instlname2   "     "|"              /*119*/  
    " instic2      "     "|"              /*120*/  
    " instbr2      "     "|"              /*121*/  
    " instaddr12   "     "|"              /*122*/  
    " instaddr22   "     "|"              /*123*/  
    " instaddr32   "     "|"              /*124*/  
    " instaddr42   "     "|"              /*125*/  
    " instpost2    "     "|"              /*126*/  
    " instprovcod2 "     "|"              /*127*/  
    " instdistcod2 "     "|"              /*128*/  
    " instsdistcod2"     "|"              /*129*/  
    " instprm2     "     "|"              /*130*/  
    " instrstp2    "     "|"              /*131*/  
    " instrtax2    "     "|"              /*132*/  
    " instcomm02   "     "|"              /*133*/  
    " instcomm22   "     "|"              /*134*/  
    " instcod3     "     "|"              /*135*/  
    " insttyp3     "     "|"              /*136*/  
    " insttitle3   "     "|"              /*137*/  
    " instname3    "     "|"              /*138*/  
    " instlname3   "     "|"              /*139*/  
    " instic3      "     "|"              /*140*/  
    " instbr3      "     "|"              /*141*/  
    " instaddr13   "     "|"              /*142*/  
    " instaddr23   "     "|"              /*143*/  
    " instaddr33   "     "|"              /*144*/  
    " instaddr43   "     "|"              /*145*/  
    " instpost3    "     "|"              /*146*/  
    " instprovcod3 "     "|"              /*147*/  
    " instdistcod3 "     "|"              /*148*/  
    " instsdistcod3"     "|"              /*149*/  
    " instprm3     "     "|"              /*150*/  
    " instrstp3    "     "|"              /*151*/  
    " instrtax3    "     "|"              /*152*/  
    " instcomm03   "     "|"              /*153*/  
    " instcomm23   "     "|"              /*154*/  
    " covcod       "     "|"              /*155*/  
    " garage       "     "|"              /*156*/  
    " special      "     "|"              /*157*/  
    " inspec       "     "|"              /*158*/  
    " class70      "     "|"              /*159*/
    " vehuse       "     "|"             
    " redbook      "     "|"    
    " brand        "     "|"              /*160*/  
    " model        "     "|"              /*161*/  
    " submodel     "     "|"              /*162*/  
    " caryear      "     "|"              /*163*/  
    " chasno       "     "|"              /*164*/  
    " eng          "     "|"              /*165*/  
    " seat         "     "|"              /*166*/  
    " engcc        "     "|"              /*167*/  
    " weight       "     "|"              /*168*/  
    " watt         "     "|"              /*169*/  
    " body         "     "|"              /*170*/  
    " type         "     "|"              /*171*/  
    " re_year      "     "|"              /*172*/  
    " vehreg       "     "|"              /*173*/  
    " re_country   "     "|"              /*174*/  
    " cargrp       "     "|"              /*175*/  
    " colorcar     "     "|"              /*176*/  
    " fule         "     "|"              /*177*/  
    " drivnam      "     "|"              /*178*/  
    " ntitle1      "     "|"              /*179*/  
    " drivername1  "     "|"              /*180*/  
    " dname2       "     "|"              /*181*/  
    " dicno        "     "|"              /*182*/  
    " dgender1     "     "|"              /*183*/  
    " dbirth       "     "|"              /*184*/  
    " docoup       "     "|"              /*185*/  
    " ddriveno     "     "|"              /*186*/  
    " ntitle2      "     "|"              /*187*/  
    " drivername2  "     "|"              /*188*/  
    " ddname1      "     "|"              /*189*/  
    " ddicno       "     "|"              /*190*/  
    " dgender2     "     "|"              /*191*/  
    " ddbirth      "     "|"              /*192*/  
    " ddocoup      "     "|"              /*193*/  
    " dddriveno    "     "|"              /*194*/  
    " baseplus     "     "|"              /*195*/  
    " siplus       "     "|"              /*196*/  
    " rs10         "     "|"              /*197*/  
    " comper       "     "|"              /*198*/  
    " comacc       "     "|"              /*199*/  
    " deductpd     "     "|"              /*200*/  
    " DOD          "     "|"              /*201*/  
    " DPD          "     "|"              /*202*/  
    " tpfire       "     "|"              /*203*/  
    " NO_41        "     "|"              /*204*/  
    " ac2          "     "|"              /*205*/  
    " ac4          "     "|"              /*206*/  
    " ac5          "     "|"              /*207*/  
    " ac6          "     "|"              /*208*/  
    " ac7          "     "|"              /*209*/  
    " NO_42        "     "|"              /*210*/  
    " NO_43        "     "|"              /*211*/  
    " base         "     "|"              /*212*/  
    " unname       "     "|"              /*213*/  
    " nname        "     "|"              /*214*/  
    " tpbi         "     "|"              /*215*/  
    " tppd         "     "|"              /*216*/  
    " ry01         "     "|"              /*217*/  
    " ry02         "     "|"              /*218*/  
    " ry03         "     "|"              /*219*/  
    " fleet        "     "|"              /*220*/  
    " ncb          "     "|"              /*221*/  
    " claim        "     "|"              /*222*/  
    " dspc         "     "|"              /*223*/  
    " cctv         "     "|"              /*224*/  
    " dstf         "     "|"              /*225*/  
    " fleetprem    "     "|"              /*226*/  
    " ncbprem      "     "|"              /*227*/  
    " clprem       "     "|"              /*228*/  
    " dspcprem     "     "|"              /*229*/  
    " cctvprem     "     "|"              /*230*/  
    " dstfprem     "     "|"              /*231*/  
    " premt        "     "|"              /*232*/  
    " rstp_t       "     "|"              /*233*/  
    " rtax_t       "     "|"              /*234*/  
    " comper70     "     "|"              /*235*/  
    " comprem70    "     "|"              /*236*/  
    " agco70       "     "|"              /*237*/  
    " comco_per70  "     "|"              /*238*/  
    " comco_prem70 "     "|"              /*239*/  
    " dgpackge     "     "|"              /*240*/  
    " danger1      "     "|"              /*241*/  
    " danger2      "     "|"              /*242*/  
    " dgsi         "     "|"              /*243*/  
    " dgrate       "     "|"              /*244*/  
    " dgfeet       "     "|"              /*245*/  
    " dgncb        "     "|"              /*246*/  
    " dgdisc       "     "|"              /*247*/  
    " dgWdisc      "     "|"              /*248*/  
    " dgatt        "     "|"              /*249*/  
    " dgfeetprm    "     "|"              /*250*/  
    " dgncbprm     "     "|"              /*251*/  
    " dgdiscprm    "     "|"              /*252*/
    " dgwdiscprm   "     "|"              /*253*/ 
    " dgprem       "     "|"              /*254*/  
    " dgrstp_t     "     "|"              /*255*/  
    " dgrtax_t     "     "|"              /*256*/  
    " dgcomper     "     "|"              /*257*/  
    " dgcomprem    "     "|"              /*258*/  
    " cltxt        "     "|"              /*259*/  
    " clamount     "     "|"              /*260*/  
    " faultno      "     "|"              /*261*/  
    " faultprm     "     "|"              /*262*/  
    " goodno       "     "|"              /*263*/  
    " goodprm      "     "|"              /*264*/  
    " loss         "     "|"              /*265*/  
    " compolusory  "     "|"              /*266*/  
    " barcode      "     "|"              /*267*/  
    " class72      "     "|"              /*268*/  
    " dstf72       "     "|"              /*269*/  
    " dstfprem72   "     "|"              /*270*/  
    " premt72      "     "|"              /*271*/  
    " rstp_t72     "     "|"              /*272*/  
    " rtax_t72     "     "|"              /*273*/  
    " comper72     "     "|"              /*274*/  
    " comprem72    "     "|"              /*275*/  
    " Comment      "     SKIP .            
    RUN proc_report2_detail.
END.   */                                    

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE 00-Proc_report2_Detail C-Win 
PROCEDURE 00-Proc_report2_Detail :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
/* comment by : A67-0029...
DO:
    FOR EACH wdetail WHERE wdetail.PASS = "Y"  NO-LOCK.
        FIND FIRST wtxt   WHERE wtxt.policyno   = wdetail.policyno  NO-LOCK NO-ERROR .
        FIND FIRST wmemo  WHERE wmemo.policyno  = wdetail.policyno  NO-LOCK NO-ERROR .
        FIND FIRST wacces WHERE wacces.policyno = wdetail.policyno  NO-LOCK NO-ERROR .
        FIND FIRST winst  WHERE winst.policyno  = wdetail.policyno  NO-LOCK NO-ERROR .
        PUT STREAM ns2
            wdetail.riskno          "|" /*A64-0355*/
            wdetail.itemno          "|" 
            wdetail.policyno FORMAT "x(16)"       "|"
            wdetail.redbook         "|"
            wdetail.n_branch        "|"
            wdetail.agent           "|"
            wdetail.producer        "|"
            wdetail.n_delercode     "|"
            wdetail.fincode         "|"
            wdetail.appenno         "|"
            wdetail.salename        "|"
            wdetail.srate           "|"
            wdetail.comdat          "|"
            wdetail.expdat          "|"
            wdetail.agreedat        "|"
            wdetail.firstdat        "|"
            wdetail.packcod         "|"
            wdetail.camp_no         "|"
            wdetail.campen          "|"
            wdetail.specon          "|"
            wdetail.product         "|"
            wdetail.promo           "|"
            wdetail.rencnt          "|"
            wdetail.prepol          "|"
            wtxt.txt1               "|"
            wtxt.txt2               "|"
            wtxt.txt3               "|"
            wtxt.txt4               "|"
            wtxt.txt5               "|"
            wtxt.txt6               "|"
            wtxt.txt7               "|"
            wtxt.txt8               "|"
            wtxt.txt9               "|"
            wtxt.txt10              "|"
            wmemo.memo1             "|"
            wmemo.memo2             "|"
            wmemo.memo3             "|"
            wmemo.memo4             "|"
            wmemo.memo5             "|"
            wmemo.memo6             "|"
            wmemo.memo7             "|"
            wmemo.memo8             "|"
            wmemo.memo9             "|"
            wmemo.memo10            "|"
            wacces.accdata1        "|"
            wacces.accdata2        "|"
            wacces.accdata3        "|"
            wacces.accdata4        "|"
            wacces.accdata5        "|"
            wacces.accdata6        "|"
            wacces.accdata7        "|"
            wacces.accdata8        "|"
            wacces.accdata9        "|"
            wacces.accdata10       "|"
            wdetail.compul          "|"
            wdetail.nv_insref       "|"
            wdetail.instyp          "|"
            wdetail.inslang         "|"
            wdetail.tiname          "|"
            wdetail.insnam          "|"
            wdetail.lastname        "|"
            wdetail.icno            "|"
            wdetail.insbr           "|"
            wdetail.occup           "|"
            wdetail.addr            "|"
            wdetail.tambon          "|"
            wdetail.amper           "|"
            wdetail.country         "|"
            wdetail.post            "|"
            wdetail.provcod         "|"
            wdetail.distcod         "|"
            wdetail.sdistcod        "|"
            wdetail.jpae           "|"   /*A64-0355*/
            wdetail.jpjtl          "|"   /*A64-0355*/
            wdetail.jpts           "|"   /*A64-0355*/
            wdetail.gender          "|"
            wdetail.tele1           "|"
            wdetail.tele2           "|"
            wdetail.mail1           "|"
            wdetail.mail2           "|"
            wdetail.mail3           "|"
            wdetail.mail4           "|"
            wdetail.mail5           "|"
            wdetail.mail6           "|"
            wdetail.mail7           "|"
            wdetail.mail8           "|"
            wdetail.mail9           "|"
            wdetail.mail10          "|"
            wdetail.fax             "|"
            wdetail.lineID          "|"
            wdetail.name2           "|"
            wdetail.name3           "|"
            wdetail.benname         "|"
            wdetail.payercod        "|"
            wdetail.vatcode         "|"
            winst.instcod1        "|"
            winst.insttyp1        "|"
            winst.insttitle1      "|"
            winst.instname1       "|"
            winst.instlname1      "|"
            winst.instic1         "|"
            winst.instbr1         "|"
            winst.instaddr11      "|"
            winst.instaddr21      "|"
            winst.instaddr31      "|"
            winst.instaddr41      "|"
            winst.instpost1       "|"
            winst.instprovcod1    "|"
            winst.instdistcod1    "|"
            winst.instsdistcod1   "|"
            winst.instprm1        "|"
            winst.instrstp1       "|"
            winst.instrtax1       "|"
            winst.instcomm01      "|"
            winst.instcomm12      "|"
            winst.instcod2        "|"
            winst.insttyp2        "|"
            winst.insttitle2      "|"
            winst.instname2       "|"
            winst.instlname2      "|"
            winst.instic2         "|"
            winst.instbr2         "|"
            winst.instaddr12      "|"
            winst.instaddr22      "|"
            winst.instaddr32      "|"
            winst.instaddr42      "|"
            winst.instpost2       "|"
            winst.instprovcod2    "|"
            winst.instdistcod2    "|"
            winst.instsdistcod2   "|"
            winst.instprm2        "|"
            winst.instrstp2       "|"
            winst.instrtax2       "|"
            winst.instcomm02      "|"
            winst.instcomm22      "|"
            winst.instcod3        "|"
            winst.insttyp3        "|"
            winst.insttitle3      "|"
            winst.instname3       "|"
            winst.instlname3      "|"
            winst.instic3         "|"
            winst.instbr3         "|"
            winst.instaddr13      "|"
            winst.instaddr23      "|"
            winst.instaddr33      "|"
            winst.instaddr43      "|"
            winst.instpost3       "|"
            winst.instprovcod3    "|"
            winst.instdistcod3    "|"
            winst.instsdistcod3   "|"
            winst.instprm3        "|"
            winst.instrstp3       "|"
            winst.instrtax3       "|"
            winst.instcomm03      "|"
            winst.instcomm23      "|"
            wdetail.covcod          "|"
            wdetail.garage          "|"
            wdetail.special         "|"
            wdetail.inspec          "|"
            wdetail.class70         "|"
            wdetail.vehuse          "|"  /*A65-0079*/
            wdetail.redbook         "|"  /*A65-0079*/
            wdetail.brand           "|"
            wdetail.model           "|"
            wdetail.submodel        "|"
            wdetail.yrmanu          "|"
            wdetail.chasno          "|"
            wdetail.eng             "|"
            wdetail.seat41          "|"
            wdetail.engcc           "|"
            wdetail.weight          "|"
            wdetail.watt            "|"
            wdetail.body            "|"
            wdetail.typ            "|"
            wdetail.re_year         "|"
            wdetail.vehreg          "|"
            wdetail.re_country      "|"
            wdetail.cargrp          "|"
            wdetail.colorcar        "|"
            wdetail.fule            "|"
            wdetail.drivnam         "|"
            wdetail.ntitle1         "|"
            wdetail.drivername1     "|"
            wdetail.dname2          "|"
            wdetail.dicno           "|"
            wdetail.dgender1        "|"
            wdetail.dbirth          "|"
            wdetail.docoup          "|"
            wdetail.ddriveno        "|"
            wdetail.ntitle2         "|"
            wdetail.drivername2     "|"
            wdetail.ddname1         "|"
            wdetail.ddicno          "|"
            wdetail.dgender2        "|"
            wdetail.ddbirth         "|"
            wdetail.ddocoup         "|"
            wdetail.dddriveno       "|"
            wdetail.baseplus        "|"
            wdetail.siplus          "|"
            wdetail.rs10            "|"
            wdetail.comper          "|"
            wdetail.comacc          "|"
            wdetail.deductpd        "|"
            wdetail.DOD             "|"
            wdetail.DPD             "|"
            wdetail.si              "|"
            wdetail.NO_411          "|"
            wdetail.seat41          "|"
            wdetail.NO_412          "|"
            wdetail.NO_413          "|"
            wdetail.ac6             "|"
            wdetail.NO_414          "|"
            wdetail.NO_42           "|"
            wdetail.NO_43           "|"
            wdetail.base            "|"
            wdetail.unname          "|"
            wdetail.nname           "|"
            wdetail.tpbi            "|"
            wdetail.tppd            "|"
            wdetail.ry01            "|"
            wdetail.ry02            "|"
            wdetail.ry03            "|"
            wdetail.fleet           "|"
            wdetail.ncb             "|"
            wdetail.claim           "|"
            wdetail.dspc            "|"
            wdetail.cctv            "|"
            wdetail.dstf            "|"
            wdetail.fleetprem       "|"
            wdetail.ncbprem         "|"
            wdetail.clprem          "|"
            wdetail.dspcprem        "|"
            wdetail.cctvprem        "|"
            wdetail.dstfprem        "|"
            wdetail.premt           "|"
            wdetail.rstp_t          "|"
            wdetail.rtax_t          "|"
            wdetail.comper70        "|"
            wdetail.comprem70       "|"
            wdetail.agco70          "|"
            wdetail.comco_per70     "|"
            wdetail.comco_prem70    "|"
            wdetail.dgpackge        "|"
            wdetail.danger1         "|"
            wdetail.danger2         "|"
            wdetail.dgsi            "|"
            wdetail.dgrate          "|"
            wdetail.dgfeet          "|"
            wdetail.dgncb           "|"
            wdetail.dgdisc          "|"
            wdetail.dgWdisc          "|"
            wdetail.dgatt           "|"
            wdetail.dgfeetprm       "|"
            wdetail.dgncbprm        "|"
            wdetail.dgdiscprm       "|"
            wdetail.dgprem          "|"
            wdetail.dgrstp_t        "|"
            wdetail.dgrtax_t        "|"
            wdetail.dgcomper        "|"
            wdetail.dgcomprem       "|"
            wdetail.cltxt           "|"
            wdetail.clamount        "|"
            wdetail.faultno         "|"
            wdetail.faultprm        "|"
            wdetail.goodno          "|"
            wdetail.goodprm         "|"
            wdetail.loss            "|"
            wdetail.compolusory     "|"
            wdetail.stk             "|"
            wdetail.class72         "|"
            wdetail.dstf72          "|"
            wdetail.dstfprem72      "|"
            wdetail.premt72         "|"
            wdetail.rstp_t72        "|"
            wdetail.rtax_t72        "|"
            wdetail.comper72        "|"
            wdetail.comprem72       "|"
            wdetail.comment         "|"
            wdetail.pass             SKIP .
    END.
END.
...END A67-0029...*/
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE 00-proc_reportpolno_2 C-Win 
PROCEDURE 00-proc_reportpolno_2 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
/* add by : A67-0029 ....
DEF VAR n_count AS INT INIT 0.
FOR EACH wdetail NO-LOCK .
    n_count = n_count + 1.
    FIND FIRST wtxt   WHERE wtxt.policyno   = wdetail.policyno  NO-LOCK NO-ERROR .
    FIND FIRST wmemo  WHERE wmemo.policyno  = wdetail.policyno  NO-LOCK NO-ERROR .
    FIND FIRST wacces WHERE wacces.policyno = wdetail.policyno  NO-LOCK NO-ERROR .
    FIND FIRST winst  WHERE winst.policyno  = wdetail.policyno  NO-LOCK NO-ERROR .
    FIND FIRST wdrive WHERE wdrive.policy   = wdetail.policyno  NO-LOCK NO-ERROR . /* A67-0029*/
    PUT STREAM ns1 
        wdetail.riskno       "|"    /*A64-0355*/
        wdetail.itemno       "|"
        wdetail.policyno   FORMAT "x(12)"  "|"
        wdetail.n_branch     "|"
        wdetail.agent        "|"
        wdetail.producer     "|"
        wdetail.n_delercode  "|"
        wdetail.fincode      "|"
        wdetail.appenno      "|"
        wdetail.salename     "|"
        wdetail.srate        "|"
        wdetail.comdat       "|"
        wdetail.expdat       "|"
        wdetail.agreedat     "|"
        wdetail.firstdat     "|"
        wdetail.packcod      "|"
        wdetail.camp_no      "|"
        wdetail.campen       "|"
        wdetail.specon       "|"
        wdetail.product      "|"
        wdetail.promo        "|"
        wdetail.rencnt       "|"
        wdetail.prepol       "|"
        wtxt.txt1            "|"
        wtxt.txt2            "|"
        wtxt.txt3            "|"
        wtxt.txt4            "|"
        wtxt.txt5            "|"
        wtxt.txt6            "|"
        wtxt.txt7            "|"
        wtxt.txt8            "|"
        wtxt.txt9            "|"
        wtxt.txt10           "|"
        wmemo.memo1           "|"
        wmemo.memo2           "|"
        wmemo.memo3           "|"
        wmemo.memo4           "|"
        wmemo.memo5           "|"
        wmemo.memo6           "|"
        wmemo.memo7           "|"
        wmemo.memo8           "|"
        wmemo.memo9           "|"
        wmemo.memo10          "|"
        wacces.accdata1       "|"
        wacces.accdata2       "|"
        wacces.accdata3       "|"
        wacces.accdata4       "|"
        wacces.accdata5       "|"
        wacces.accdata6       "|"
        wacces.accdata7       "|"
        wacces.accdata8       "|"
        wacces.accdata9       "|"
        wacces.accdata10      "|"
        wdetail.compul        "|"
        wdetail.nv_insref     "|" /* A64-0355*/
        wdetail.instyp        "|"
        wdetail.inslang       "|"
        wdetail.tiname        "|"
        wdetail.insnam        "|"
        wdetail.lastname      "|"
        wdetail.icno          "|"
        wdetail.insbr         "|"
        wdetail.occup         "|"
        wdetail.addr          "|"
        wdetail.tambon        "|"
        wdetail.amper         "|"
        wdetail.country       "|"
        wdetail.post          "|"
        wdetail.provcod       "|"
        wdetail.distcod       "|"
        wdetail.sdistcod      "|"
        wdetail.jpae          "|"  /*A64-0355*/      
        wdetail.jpjtl         "|"  /*A64-0355*/      
        wdetail.jpts          "|"  /*A64-0355*/      
        wdetail.gender        "|"
        wdetail.tele1         "|"
        wdetail.tele2         "|"
        wdetail.mail1         "|"
        wdetail.mail2         "|"
        wdetail.mail3         "|"
        wdetail.mail4         "|"
        wdetail.mail5         "|"
        wdetail.mail6         "|"
        wdetail.mail7         "|"
        wdetail.mail8         "|"
        wdetail.mail9         "|"
        wdetail.mail10        "|"
        wdetail.fax           "|"
        wdetail.lineID        "|"
        wdetail.name2         "|"
        wdetail.name3         "|"
        wdetail.benname       "|"
        wdetail.payercod      "|"
        wdetail.vatcode       "|"
        winst.instcod1        "|"
        winst.insttyp1        "|"
        winst.insttitle1      "|"
        winst.instname1       "|"
        winst.instlname1      "|"
        winst.instic1         "|"
        winst.instbr1         "|"
        winst.instaddr11      "|"
        winst.instaddr21      "|"
        winst.instaddr31      "|"
        winst.instaddr41      "|"
        winst.instpost1       "|"
        winst.instprovcod1    "|"
        winst.instdistcod1    "|"
        winst.instsdistcod1   "|"
        winst.instprm1        "|"
        winst.instrstp1       "|"
        winst.instrtax1       "|"
        winst.instcomm01      "|"
        winst.instcomm12      "|"
        winst.instcod2        "|"
        winst.insttyp2        "|"
        winst.insttitle2      "|"
        winst.instname2       "|"
        winst.instlname2      "|"
        winst.instic2         "|"
        winst.instbr2         "|"
        winst.instaddr12      "|"
        winst.instaddr22      "|"
        winst.instaddr32      "|"
        winst.instaddr42      "|"
        winst.instpost2       "|"
        winst.instprovcod2    "|"
        winst.instdistcod2    "|"
        winst.instsdistcod2   "|"
        winst.instprm2        "|"
        winst.instrstp2       "|"
        winst.instrtax2       "|"
        winst.instcomm02      "|"
        winst.instcomm22      "|"
        winst.instcod3        "|"
        winst.insttyp3        "|"
        winst.insttitle3      "|"
        winst.instname3       "|"
        winst.instlname3      "|"
        winst.instic3         "|"
        winst.instbr3         "|"
        winst.instaddr13      "|"
        winst.instaddr23      "|"
        winst.instaddr33      "|"
        winst.instaddr43      "|"
        winst.instpost3       "|"
        winst.instprovcod3    "|"
        winst.instdistcod3    "|"
        winst.instsdistcod3   "|"
        winst.instprm3        "|"
        winst.instrstp3       "|"
        winst.instrtax3       "|"
        winst.instcomm03      "|"
        winst.instcomm23      "|"
        wdetail.covcod        "|"
        wdetail.garage        "|"
        wdetail.special       "|"
        wdetail.inspec        "|"
        wdetail.class70       "|"
        wdetail.vehuse        "|"  /*A64-0355*/
        wdetail.redbook       "|"  /*A65-0079*/
        wdetail.brand         "|"
        wdetail.model         "|"
        wdetail.submodel      "|"
        wdetail.yrmanu        "|"
        wdetail.chasno        "|"
        wdetail.eng           "|"
        wdetail.seat          "|"
        wdetail.engcc         "|"
        wdetail.weight        "|"
        wdetail.watt          "|"
        wdetail.body          "|"
        wdetail.typ           "|"
        wdetail.re_year       "|"
        wdetail.vehreg        "|"
        wdetail.re_country    "|"
        wdetail.cargrp        "|"
        wdetail.colorcar      "|"
        wdetail.fule          "|"
        wdetail.drivnam       "|"
        wdetail.ntitle1       "|"
        wdetail.drivername1   "|"
        wdetail.dname2        "|"
        wdetail.dicno         "|"
        wdetail.dgender1      "|"
        wdetail.dbirth        "|"
        wdetail.docoup        "|"
        wdetail.ddriveno      "|"
        wdetail.ntitle2       "|"
        wdetail.drivername2   "|"
        wdetail.ddname1       "|"
        wdetail.ddicno        "|"
        wdetail.dgender2      "|"
        wdetail.ddbirth       "|"
        wdetail.ddocoup       "|"
        wdetail.dddriveno     "|"
        wdetail.baseplus      "|"
        wdetail.siplus        "|"
        wdetail.rs10          "|"
        wdetail.comper        "|"
        wdetail.comacc        "|"
        wdetail.deductpd      "|"
        wdetail.DOD           "|"
        wdetail.DPD           "|"
        wdetail.si            "|"
        wdetail.NO_411        "|"
        wdetail.seat41        "|"
        wdetail.NO_412        "|"
        wdetail.NO_413        "|"
        wdetail.ac6           "|"
        wdetail.NO_414        "|"
        wdetail.NO_42         "|"
        wdetail.NO_43         "|"
        wdetail.base          "|"
        wdetail.unname        "|"
        wdetail.nname         "|"
        wdetail.tpbi          "|"
        wdetail.tppd          "|"
        wdetail.ry01          "|"
        wdetail.ry02          "|"
        wdetail.ry03          "|"
        wdetail.fleet         "|"
        wdetail.ncb           "|"
        wdetail.claim         "|"
        wdetail.dspc          "|"
        wdetail.cctv          "|"
        wdetail.dstf          "|"
        wdetail.fleetprem     "|"
        wdetail.ncbprem       "|"
        wdetail.clprem        "|"
        wdetail.dspcprem      "|"
        wdetail.cctvprem      "|"
        wdetail.dstfprem      "|"
        wdetail.premt         "|"
        wdetail.rstp_t        "|"
        wdetail.rtax_t        "|"
        wdetail.comper70      "|"
        wdetail.comprem70     "|"
        wdetail.agco70        "|"
        wdetail.comco_per70   "|"
        wdetail.comco_prem70  "|"
        wdetail.dgpackge      "|"
        wdetail.danger1       "|"
        wdetail.danger2       "|"
        wdetail.dgsi          "|"
        wdetail.dgrate        "|"
        wdetail.dgfeet        "|"
        wdetail.dgncb         "|"
        wdetail.dgdisc        "|"
        wdetail.dgWdisc       "|"
        wdetail.dgatt         "|"
        wdetail.dgfeetprm     "|"
        wdetail.dgncbprm      "|"
        wdetail.dgdiscprm     "|"
        wdetail.dgWdiscprm    "|"
        wdetail.dgprem        "|"
        wdetail.dgrstp_t      "|"
        wdetail.dgrtax_t      "|"
        wdetail.dgcomper      "|"
        wdetail.dgcomprem     "|"
        wdetail.cltxt         "|"
        wdetail.clamount      "|"
        wdetail.faultno       "|"
        wdetail.faultprm      "|"
        wdetail.goodno        "|"
        wdetail.goodprm       "|"
        wdetail.loss          "|"
        wdetail.compolusory FORMAT "x(12)"   "|" 
        wdetail.stk           "|"
        wdetail.class72  FORMAT "x(5)"     "|"
        wdetail.dstf72        "|"
        wdetail.dstfprem72    "|"
        wdetail.premt72       "|"
        wdetail.rstp_t72      "|"
        wdetail.rtax_t72      "|"
        wdetail.comper72      "|"
        wdetail.comprem72     "|"
        wdetail.comment        SKIP .
END.
...end A67-0029...*/
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE 00-proc_runningpol_2 C-Win 
PROCEDURE 00-proc_runningpol_2 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:  comment by A67-0029     
------------------------------------------------------------------------------*/
/*DO:
    ASSIGN fi_process = "Create data text file " + wf_chasno + " to wdetail ....." .
    DISP fi_process WITH FRAM fr_main.
    CREATE wdetail.
    CREATE wtxt.
    CREATE wmemo.
    CREATE wacces.
    CREATE winst.
    CREATE wdrive. /*A67-0029*/
    ASSIGN
        wdetail.riskno        =  TRIM(wf_riskno)   /*A64-0355*/
        wdetail.itemno        =  TRIM(wf_num)
        wdetail.policyno      =  "" /*trim(wf_policyno) A64-0355*/       
        wdetail.n_branch      =  trim(wf_n_branch)        
        wdetail.agent         =  trim(wf_agent)           
        wdetail.producer      =  trim(wf_producer)        
        wdetail.n_delercode   =  trim(wf_n_delercode)   
        wdetail.fincode       =  trim(wf_fincode)   
        wdetail.appenno       =  trim(wf_appenno)   
        wdetail.salename      =  trim(wf_salename)   
        wdetail.srate         =  trim(wf_srate ) 
        wdetail.comdat        =  date(wf_comdat)                                        
        wdetail.expdat        =  date(wf_expdat)                                        
        wdetail.agreedat      =  date(wf_agreedat)  
        wdetail.firstdat      =  date(wf_firstdat)  
        wdetail.packcod       =  trim(wf_packcod )   
        wdetail.camp_no       =  trim(wf_camp_no )   
        wdetail.campen        =  trim(wf_campen) 
        wdetail.specon        =  trim(wf_specon) 
        wdetail.product       =  trim(wf_product )   
        wdetail.promo         =  trim(wf_promo )   
        wdetail.rencnt        =  TRIM(wf_rencnt)   
        wdetail.prepol        =  trim(wf_prepol)
        wdetail.compul        =  trim(wf_compul)
        wdetail.nv_insref     =  TRIM(wf_insref)  /*A64-0355*/
        wdetail.instyp        =  trim(wf_instyp) 
        wdetail.inslang       =  trim(wf_inslang )  
        wdetail.tiname        =  trim(wf_tiname) 
        wdetail.insnam        =  trim(wf_insnam) 
        wdetail.lastname      =  trim(wf_lastname)  
        wdetail.icno          =  trim(wf_icno)  
        wdetail.insbr         =  trim(wf_insbr) 
        wdetail.occup         =  trim(wf_occup) 
        wdetail.addr          =  trim(wf_addr)
        wdetail.tambon        =  trim(wf_tambon) 
        wdetail.amper         =  trim(wf_amper) 
        wdetail.country       =  trim(wf_country )  
        wdetail.post          =  trim(wf_post ) 
        wdetail.provcod       =  trim(wf_provcod)  
        wdetail.distcod       =  trim(wf_distcod)  
        wdetail.sdistcod      =  trim(wf_sdistcod) 
        wdetail.jpae          =  trim(wf_ae)     /*A64-0355*/
        wdetail.jpjtl         =  trim(wf_jtl)    /*A64-0355*/
        wdetail.jpts          =  trim(wf_ts)     /*A64-0355*/
        wdetail.gender        =  trim(wf_gender) 
        wdetail.tele1         =  trim(wf_tele1) 
        wdetail.tele2         =  trim(wf_tele2) 
        wdetail.mail1         =  trim(wf_mail1) 
        wdetail.mail2         =  trim(wf_mail2) 
        wdetail.mail3         =  trim(wf_mail3) 
        wdetail.mail4         =  trim(wf_mail4) 
        wdetail.mail5         =  trim(wf_mail5) 
        wdetail.mail6         =  trim(wf_mail6)  
        wdetail.mail7         =  trim(wf_mail7)  
        wdetail.mail8         =  trim(wf_mail8)  
        wdetail.mail9         =  trim(wf_mail9)  
        wdetail.mail10        =  trim(wf_mail10)  
        wdetail.fax           =  trim(wf_fax)  
        wdetail.lineID        =  trim(wf_lineID)  
        wdetail.name2         =  trim(wf_name2 )  
        wdetail.name3         =  trim(wf_name3 )  
        wdetail.benname       =  trim(wf_benname )  
        wdetail.payercod      =  trim(wf_payercod)  
        wdetail.vatcode       =  trim(wf_vatcode )
        wdetail.covcod        =  trim(wf_covcod )  
        wdetail.garage        =  trim(wf_garage )  
        wdetail.special       =  trim(wf_special)  
        wdetail.inspec        =  trim(wf_inspec )  
        wdetail.class70       =  trim(wf_class70)
        wdetail.vehuse        =  TRIM(wf_vehuse)    /*A64-0355*/
        wdetail.redbook       =  TRIM(wf_redbook)  /*A65-0079*/
        wdetail.brand         =  trim(wf_brand)  
        wdetail.model         =  trim(wf_model)  
        wdetail.submodel      =  trim(wf_submodel)  
        wdetail.yrmanu        =  trim(wf_caryear)  
        wdetail.chasno        =  trim(wf_chasno )  
        wdetail.eng           =  trim(wf_eng) 
        wdetail.eng_no2       =  TRIM(wf_eng_no2)    /*A67-0029*/
        wdetail.seat          =  INTE(wf_seat)  
        wdetail.engcc         =  INTE(wf_engcc)  
        wdetail.weight        =  DECI(wf_weight) 
        /*wdetail.watt          =  INTE(wf_watt) */ /*A66-0202*/ 
        wdetail.watt          =  DECI(wf_watt)     /*A66-0202*/ 
        wdetail.body          =  trim(wf_body )  
        wdetail.typ           =  trim(wf_type )  
        wdetail.re_year       =  trim(wf_re_year)  
        wdetail.vehreg        =  trim(wf_vehreg )  
        wdetail.re_country    =  trim(wf_re_country)
        wdetail.cargrp        =  trim(wf_cargrp )   
        wdetail.colorcar      =  trim(wf_colorcar )
        wdetail.fule          =  trim(wf_fule  )   
        wdetail.drivnam       =  trim(wf_drivnam)  
        /* comment by : A67-0029 ...
        wdetail.ntitle1       =  trim(wf_ntitle1)   
        wdetail.drivername1   =  trim(wf_drivername1)
        wdetail.dname2        =  trim(wf_dname2)  
        wdetail.dicno         =  trim(wf_dicno )  
        wdetail.dgender1      =  trim(wf_dgender1)  
        wdetail.dbirth        =  trim(wf_dbirth)  
        wdetail.docoup        =  trim(wf_docoup)  
        wdetail.ddriveno      =  trim(wf_ddriveno)  
        wdetail.ntitle2       =  trim(wf_ntitle2 )  
        wdetail.drivername2   =  trim(wf_drivername2)
        wdetail.ddname1       =  trim(wf_ddname1 )
        wdetail.ddicno        =  trim(wf_ddicno  )
        wdetail.dgender2      =  trim(wf_dgender2)
        wdetail.ddbirth       =  trim(wf_ddbirth )
        wdetail.ddocoup       =  trim(wf_ddocoup )
        wdetail.dddriveno     =  trim(wf_dddriveno)
        ...end A67-0029..*/
        wdetail.baseplus      =  INTE(wf_baseplus)  
        wdetail.siplus        =  int(wf_siplus)
        wdetail.rs10          =  int(wf_rs10)   
        /* comment :  A64-0355
        wdetail.comper        =  int(wf_comper) 
        wdetail.comacc        =  int(wf_comacc) 
        wdetail.deductpd      =  int(wf_deductpd) */
        wdetail.comper        =  if trim(wf_comper)  = "U" then 999999999 else  int(wf_comper)    /*A64-0355*/
        wdetail.comacc        =  if trim(wf_comacc)  = "U" then 999999999 else  int(wf_comacc)    /*A64-0355*/
        wdetail.deductpd      =  if trim(wf_deductpd)= "U" then 999999999 else  int(wf_deductpd)  /*A64-0355*/ 
        wdetail.DOD           =  int(wf_DOD)   
        wdetail.DPD           =  int(wf_DPD)
        wdetail.maksi         =  trim(wf_maksi)  /* A67-0029 */
        wdetail.si            =  int(wf_tpfire) 
        wdetail.NO_411        =  int(wf_NO_41 ) 
        wdetail.seat41        =  int(wf_ac2)   
        wdetail.NO_412        =  int(wf_ac4)   
        wdetail.NO_413        =  int(wf_ac5)   
        wdetail.ac6           =  int(wf_ac6)   
        wdetail.NO_414        =  int(wf_ac7)   
        wdetail.NO_42         =  int(wf_NO_42) 
        wdetail.NO_43         =  int(wf_NO_43) 
        wdetail.base          =  int(wf_base)
        wdetail.unname        =  deci(wf_unname) 
        wdetail.nname         =  deci(wf_nname) 
        wdetail.tpbi          =  deci(wf_tpbi)   
        wdetail.tppd          =  deci(wf_tppd)   
        wdetail.ry01          =  deci(wf_ry01)   
        wdetail.ry02          =  deci(wf_ry02)   
        wdetail.ry03          =  deci(wf_ry03)   
        wdetail.fleet         =  trim(wf_fleet)   
        wdetail.ncb           =  trim(wf_ncb)
        wdetail.claim         =  trim(wf_claim)   
        wdetail.dspc          =  trim(wf_dspc)   
        wdetail.cctv          =  trim(wf_cctv)   
        wdetail.dstf          =  trim(wf_dstf)   
        wdetail.fleetprem     =  deci(wf_fleetprem)
        wdetail.ncbprem       =  deci(wf_ncbprem)   
        wdetail.clprem        =  deci(wf_clprem )   
        wdetail.dspcprem      =  deci(wf_dspcprem) 
        wdetail.cctvprem      =  deci(wf_cctvprem) 
        wdetail.dstfprem      =  deci(wf_dstfprem) 
        wdetail.premt         =  deci(wf_premt )   
        wdetail.rstp_t        =  deci(wf_rstp_t)   
        wdetail.rtax_t        =  deci(wf_rtax_t)   
        wdetail.comper70      =  deci(wf_comper70) 
        wdetail.comprem70     =  deci(wf_comprem70) 
        wdetail.agco70        =  trim(wf_agco70 )  
        wdetail.comco_per70   =  deci(wf_comco_per70) 
        wdetail.comco_prem70  =  deci(wf_comco_prem70)
        wdetail.dgpackge      =  trim(wf_dgpackge)
        wdetail.danger1       =  trim(wf_danger1)   
        wdetail.danger2       =  trim(wf_danger2)   
        wdetail.dgsi          =  inte(wf_dgsi)
        wdetail.dgrate        =  trim(wf_dgrate)   
        wdetail.dgfeet        =  trim(wf_dgfeet)   
        wdetail.dgncb         =  trim(wf_dgncb )   
        wdetail.dgdisc        =  trim(wf_dgdisc)   
        wdetail.dgatt         =  INTE(wf_dgatt)    
        wdetail.dgfeetprm     =  deci(wf_dgfeetprm)
        wdetail.dgncbprm      =  deci(wf_dgncbprm) 
        wdetail.dgdiscprm     =  deci(wf_dgdiscprm) 
        wdetail.dgprem        =  deci(wf_dgprem) 
        wdetail.cltxt         =  trim(wf_cltxt )
        wdetail.clamount      =  inte(wf_clamount)
        wdetail.faultno       =  inte(wf_faultno)  
        wdetail.faultprm      =  inte(wf_faultprm)  
        wdetail.goodno        =  inte(wf_goodno)  
        wdetail.goodprm       =  inte(wf_goodprm)  
        wdetail.loss          =  inte(wf_loss)  
        wdetail.compolusory   =  trim(wf_compolusory)
        wdetail.stk           =  trim(wf_barcode)  
        wdetail.class72       =  trim(wf_class72)  
        wdetail.dstf72        =  trim(wf_dstf72 )  
        wdetail.dstfprem72    =  deci(wf_dstfprem72)
        wdetail.premt72       =  deci(wf_premt72 )  
        wdetail.rstp_t72      =  deci(wf_rstp_t72)  
        wdetail.rtax_t72      =  deci(wf_rtax_t72)  
        wdetail.comper72      =  deci(wf_comper72)  
        wdetail.comprem72     =  deci(wf_comprem72) 
        /* Add by : A67-0029 */
        wdetail.battno        =  trim(wf_battno)   
        wdetail.battyr        =  trim(wf_battyr)   
        wdetail.battprice     =  trim(wf_battprice)
        wdetail.battper       =  trim(wf_battper  )
        wdetail.battrate      =  trim(wf_battrate  )
        wdetail.battsi        =  trim(wf_battsi  )
        wdetail.battprm       =  trim(wf_battprm  )
        wdetail.chargno       =  trim(wf_chargno  )
        wdetail.chargsi       =  trim(wf_chargsi  )
        wdetail.chargrate      =  trim(wf_chargrate)
        wdetail.chargprm      =  trim(wf_chargprm ).
        /* end : A67-0029 */

    IF wdetail.policy = ""  THEN DO:
        IF wdetail.chasno <> ""  THEN assign wdetail.policy = "/" + SUBSTRING(wdetail.chasno,9,LENGTH(wdetail.chasno)).
        ELSE IF wdetail.prepol <> ""  THEN assign wdetail.policy = TRIM(wdetail.prepol) .
        ELSE IF trim(wf_policyno) <> ""  THEN ASSIGN  wdetail.policy = TRIM(wf_policyno) . /*A65-0079*/
        ELSE wdetail.policy = STRING(wdetail.riskno,"999") + "/" + STRING(wdetail.itemno,"999") . /*A65-0079*/
    END.                     
    RUN proc_assigninit70_2.
    IF trim(wdetail.nv_insref) <> ""  THEN RUN proc_chkinscode. /*A64-0355*/
    
END.*/
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE 00-proc_updaterenew C-Win 
PROCEDURE 00-proc_updaterenew :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
/* comment by : A67-0029..
/*A64-0309*/
DEF VAR n_taddress AS CHAR FORMAT "x(150)" INIT "" .
DEF VAR n_name     AS CHAR FORMAT "x(150)" INIT "" .
ASSIGN n_taddress = trim(TRIM(wdetail.addr) + " " + TRIM(wdetail.tambon) + " " + 
                    TRIM(wdetail.amper) + " " + TRIM(wdetail.country) + " " + TRIM(wdetail.post)).
ASSIGN n_name = trim(trim(wdetail.tiname) + " " + TRIM(wdetail.insnam) + " " + TRIM(wdetail.lastname)).
/* end : A64-0309*/
IF  int(wdetail.rencnt)  <> re_rencnt  THEN ASSIGN wdetail.rencnt  = string(re_rencnt) .
IF  wdetail.n_branch    = "" THEN  ASSIGN wdetail.n_branch    = trim(re_branch) .
IF  wdetail.nv_insref   = "" THEN  ASSIGN wdetail.nv_insref   = trim(re_insref).
if  wdetail.agent       = "" THEN  assign wdetail.agent       = trim(re_agent)   .
if  wdetail.producer    = "" THEN  assign wdetail.producer    = trim(re_producer) .
if  wdetail.n_delercode = "" THEN  assign wdetail.n_delercode = trim(re_delercode).
if  wdetail.fincode     = "" THEN  assign wdetail.fincode     = trim(re_fincode)  .
if  wdetail.payercod    = "" THEN  assign wdetail.payercod    = trim(re_payercod) .
if  wdetail.vatcode     = "" THEN  assign wdetail.vatcode     = trim(re_vatcode)  .
IF  wdetail.comdat      = ?  THEN  ASSIGN wdetail.comdat      = date(re_comdat) .     
IF  wdetail.expdat      = ?  THEN  ASSIGN wdetail.expdat      = date(re_expdat) . 
IF  wdetail.firstdat    = ?  THEN  ASSIGN wdetail.firstdat    = DATE(re_firstdat).
IF n_name = "" THEN DO: /* add : A64-0309*/
    IF  wdetail.tiname      = "" then  Assign wdetail.tiname      = trim(re_tiname) . 
    IF  wdetail.insnam      = "" then  Assign wdetail.insnam      = trim(re_insnam) .
    IF  wdetail.lastname    = "" THEN  ASSIGN wdetail.lastname    = trim(re_lastname) .
END.  /* end : A64-0309*/
IF  wdetail.name2       = "" then  Assign wdetail.name2       = trim(re_name2)  . 
IF  wdetail.name3       = "" then  Assign wdetail.name3       = trim(re_name3)  . 
IF  n_taddress = " " THEN DO: /*A64-0309*/
    IF  wdetail.addr        = "" then  Assign wdetail.addr        = trim(re_n_addr1). 
    IF  wdetail.tambon      = "" then  Assign wdetail.tambon      = trim(re_n_addr2). 
    IF  wdetail.amper       = "" then  Assign wdetail.amper       = trim(re_n_addr3). 
    IF  wdetail.country     = "" then  Assign wdetail.country     = trim(re_n_addr4).
    if  wdetail.post        = "" then  assign wdetail.post        = trim(re_post)    . 
END. /*A64-0309*/
if  wdetail.provcod     = "" then  assign wdetail.provcod     = trim(re_provcod) . 
if  wdetail.distcod     = "" then  assign wdetail.distcod     = trim(re_distcod) . 
if  wdetail.sdistcod    = "" then  assign wdetail.sdistcod    = trim(re_sdistcod).
IF  wdetail.covcod      = "T" AND wdetail.class72 = ""  THEN  ASSIGN wdetail.class72 = wdetail.subclass .
IF  wdetail.subclass    = "" THEN DO:
        ASSIGN  wdetail.prempa   = SUBSTR(re_class,1,1)
                wdetail.subclass = substr(re_class,2,LENGTH(re_class))  /*A64-0044*/.
                /*wdetail.subclass = substr(re_class,2,3) */ /*A64-0044*/
END.
IF  wdetail.body     = ""       THEN ASSIGN wdetail.body     =  n_body.
IF  wdetail.weight   = 0        THEN ASSIGN wdetail.weight   =  deci(n_Tonn70). 
IF  wdetail.engcc    = 0        THEN ASSIGN wdetail.engcc    =  int(n_engine). 
IF  wdetail.redbook  = ""       THEN ASSIGN wdetail.redbook  =  nn_redbook.
IF  wdetail.brand    = ""       THEN ASSIGN wdetail.brand    =  IF INDEX(re_moddes," ") <> 0 THEN SUBSTR(re_moddes,1,R-INDEX(re_moddes," ")) ELSE re_moddes.  
IF  wdetail.model    = ""       THEN ASSIGN wdetail.model    =  IF INDEX(re_moddes," ") <> 0 THEN SUBSTR(re_moddes,R-INDEX(re_moddes," ")) ELSE "". 
IF  wdetail.yrmanu   = ""       THEN ASSIGN wdetail.yrmanu   =  re_yrmanu .     
IF  wdetail.seat     = 0        THEN ASSIGN wdetail.seat     =  int(re_seats)  .         
IF  wdetail.vehuse   = ""       THEN ASSIGN wdetail.vehuse   =  re_vehuse .       
IF  wdetail.covcod   = ""       THEN ASSIGN wdetail.covcod   =  re_covcod .       
IF  wdetail.garage   = ""       THEN ASSIGN wdetail.garage   =  re_garage .       
IF  wdetail.vehreg   = ""       THEN ASSIGN wdetail.vehreg   =  re_vehreg .
IF  wdetail.vehreg   = "null"   THEN ASSIGN wdetail.vehreg   =  re_vehreg . /* A64-0355*/
IF  wdetail.chasno   = ""       THEN ASSIGN wdetail.chasno   =  re_cha_no .     
IF  wdetail.eng      = ""       THEN ASSIGN wdetail.eng      =  re_eng_no .
IF  wdetail.cargrp   = ""       THEN ASSIGN wdetail.cargrp   =  re_cargrp .
IF  wdetail.agco     = ""       THEN ASSIGN wdetail.agco     =  re_agco .                                                   /*A64-0355*/
IF  wdetail.agco <> "Null" AND wdetail.agco <> "" AND wdetail.comco_per70 = 0 THEN ASSIGN wdetail.comco_per70 = re_commco . /*A64-0355*/
IF  wdetail.special  = ""       THEN ASSIGN wdetail.special  =  re_acctyp .   /*A66-0202*/
IF  wdetail.watt     = 0        THEN ASSIGN wdetail.watt     =  re_watt.      /*A66-0202*/

IF wdetail.poltyp = "V70" THEN DO:
   /* IF  wdetail.comper70 = 0    THEN*/ /* ASSIGN wdetail.comper70 =  re_comm .*/ /* comment by : A64-0257 */
    IF  wdetail.comper70 = 0    THEN ASSIGN wdetail.comper70 =  re_comm .     /* add by : A64-0257 */
    ASSIGN wdetail.baseplus = re_base3 .    /* add by : A64-0257 */
   /* IF  wdetail.base     = 0    THEN*/  ASSIGN wdetail.base     =  re_baseprm.
   /* IF  wdetail.comper   = 0    THEN*/  ASSIGN wdetail.comper   =  int(re_uom1_v) .      
   /* IF  wdetail.comacc   = 0    THEN*/  ASSIGN wdetail.comacc   =  int(re_uom2_v) .     
   /* IF  wdetail.deductpd = 0    THEN*/  ASSIGN wdetail.deductpd =  int(re_uom5_v) .     
   /* IF  wdetail.si       = 0    THEN*/  ASSIGN wdetail.si       =  IF index(wdetail.covcod,".") = 0 THEN INT(re_si) ELSE 0 .
   /* IF  wdetail.siplus   = 0    THEN*/  ASSIGN wdetail.siplus   =  IF index(wdetail.covcod,".") <> 0 THEN INT(re_si) ELSE 0 .
   /*IF  wdetail.fi       = ""   THEN ASSIGN wdetail.fi       =  wdetail.si.*/
   /* IF  wdetail.no_411   = 0    THEN*/  ASSIGN wdetail.no_411   =  re_41.      
   /* IF  wdetail.no_412   = 0    THEN*/  ASSIGN wdetail.no_412   =  re_41.     
   /* IF  wdetail.no_42    = 0    THEN*/  ASSIGN wdetail.no_42    =  re_42. 
   /* IF  wdetail.no_43    = 0    THEN*/  ASSIGN wdetail.no_43    =  re_43. 
   /* IF  wdetail.seat41   = 0    THEN*/  ASSIGN wdetail.seat41   =  re_seat41 .
   /* IF  wdetail.dod      = 0    THEN*/  ASSIGN wdetail.dod      =  re_dedod.     
   /*IF  wdetail.dod2      = ""   THEN ASSIGN wdetail.dod2     =  STRING(re_addod).  */   
   /* IF  wdetail.dpd      = 0    THEN*/  ASSIGN wdetail.dpd      =  re_dedpd.     
   /* IF  int(wdetail.fleet) = 0  THEN*/  ASSIGN wdetail.fleet    =  STRING(re_flet_per).      
   /* IF  int(wdetail.ncb)   = 0  THEN*/  ASSIGN wdetail.ncb      =  STRING(re_ncbper).      
   /* IF  int(wdetail.dspc)  = 0  THEN*/  ASSIGN wdetail.dspc     =  STRING(re_dss_per).      
   /* IF  int(wdetail.dstf)  = 0  THEN*/  ASSIGN wdetail.dstf     =  STRING(re_stf_per).      
   /* IF  int(wdetail.claim) = 0  THEN*/  ASSIGN wdetail.claim    =  STRING(re_cl_per).     
    IF  wdetail.benname  = ""   THEN ASSIGN wdetail.benname  =  re_bennam1.
    IF  re_driver <> "" AND (INT(wdetail.drivnam) = 0 OR trim(wdetail.drivnam) = "" ) THEN DO: 
        ASSIGN wdetail.driver = re_driver 
               wdetail.nname  = re_prmtdriv.
    END.
    /*IF  re_acctxt <> "" THEN DO: 
        CREATE wacces.
        ASSIGN 
        wacces.policyno  =  TRIM(wdetail.policyno)
        wacces.accdata1  =  IF LENGTH(re_acctxt) >= 60  THEN SUBSTR(re_acctxt,1,60)    ELSE TRIM(re_acctxt)   
        wacces.accdata2  =  IF LENGTH(re_acctxt) >= 61  THEN SUBSTR(re_acctxt,61,60)   ELSE ""  
        wacces.accdata3  =  IF LENGTH(re_acctxt) >= 121 THEN SUBSTR(re_acctxt,121,60)  ELSE ""
        wacces.accdata4  =  IF LENGTH(re_acctxt) >= 181 THEN SUBSTR(re_acctxt,181,60)  ELSE "" 
        wacces.accdata5  =  IF LENGTH(re_acctxt) >= 241 THEN SUBSTR(re_acctxt,241,60)  ELSE "" 
        wacces.accdata6  =  IF LENGTH(re_acctxt) >= 301 THEN SUBSTR(re_acctxt,301,60)  ELSE "" 
        wacces.accdata7  =  "" 
        wacces.accdata8  =  "" 
        wacces.accdata9  =  "" 
        wacces.accdata10 =  "".
    END. ===Comment A65-0271=== */

/*Begin By Naphasint C. A65-0271*/
    FIND FIRST wacces WHERE wacces.policy = wdetail.policyno NO-LOCK NO-ERROR NO-WAIT.
    IF AVAIL wacces THEN DO:
        IF wacces.accdata1  = "" AND wacces.accdata2 = "" AND wacces.accdata3 = "" AND 
           wacces.accdata4  = "" AND wacces.accdata5 = "" AND wacces.accdata6 = "" AND 
           wacces.accdata7  = "" AND wacces.accdata8 = "" AND wacces.accdata9 = "" AND 
           wacces.accdata10 = "" THEN DO:
           ASSIGN
               wacces.policyno  =  TRIM(wdetail.policyno)                                                          
               wacces.accdata1  =  IF LENGTH(re_acctxt) >= 60  THEN SUBSTR(re_acctxt,1,60)    ELSE TRIM(re_acctxt) 
               wacces.accdata2  =  IF LENGTH(re_acctxt) >= 61  THEN SUBSTR(re_acctxt,61,60)   ELSE ""              
               wacces.accdata3  =  IF LENGTH(re_acctxt) >= 121 THEN SUBSTR(re_acctxt,121,60)  ELSE ""              
               wacces.accdata4  =  IF LENGTH(re_acctxt) >= 181 THEN SUBSTR(re_acctxt,181,60)  ELSE ""              
               wacces.accdata5  =  IF LENGTH(re_acctxt) >= 241 THEN SUBSTR(re_acctxt,241,60)  ELSE ""              
               wacces.accdata6  =  IF LENGTH(re_acctxt) >= 301 THEN SUBSTR(re_acctxt,301,60)  ELSE ""              
               wacces.accdata7  =  IF LENGTH(re_acctxt) >= 361 THEN SUBSTR(re_acctxt,361,60)  ELSE ""              
               wacces.accdata8  =  IF LENGTH(re_acctxt) >= 421 THEN SUBSTR(re_acctxt,421,60)  ELSE ""              
               wacces.accdata9  =  IF LENGTH(re_acctxt) >= 481 THEN SUBSTR(re_acctxt,481,60)  ELSE ""              
               wacces.accdata10 =  IF LENGTH(re_acctxt) >= 541 THEN SUBSTR(re_acctxt,541,60)  ELSE "".             
        END.

        ELSE IF wacces.accdata1  = "Null" OR wacces.accdata2 = "Null" OR wacces.accdata3 = "Null" OR
                wacces.accdata4  = "Null" OR wacces.accdata5 = "Null" OR wacces.accdata6 = "Null" OR
                wacces.accdata7  = "Null" OR wacces.accdata8 = "Null" OR wacces.accdata9 = "Null" OR
                wacces.accdata10 = "Null" THEN DO:
            ASSIGN
                wacces.policyno  =  TRIM(wdetail.policyno)
                wacces.accdata1  =  FILL(" ",60)          
                wacces.accdata2  =  FILL(" ",60)          
                wacces.accdata3  =  FILL(" ",60)          
                wacces.accdata4  =  FILL(" ",60)          
                wacces.accdata5  =  FILL(" ",60)          
                wacces.accdata6  =  FILL(" ",60)          
                wacces.accdata7  =  FILL(" ",60)          
                wacces.accdata8  =  FILL(" ",60)          
                wacces.accdata9  =  FILL(" ",60)          
                wacces.accdata10 =  FILL(" ",60).         
        END.
        ELSE DO:
            ASSIGN
                wacces.policyno  =  TRIM(wdetail.policyno).

            re_acctxt = "".
            re_acctxt = TRIM(wacces.accdata1) + TRIM(wacces.accdata2) + TRIM(wacces.accdata3) + 
                        TRIM(wacces.accdata4) + TRIM(wacces.accdata5) + TRIM(wacces.accdata6) + 
                        TRIM(wacces.accdata7) + TRIM(wacces.accdata8) + TRIM(wacces.accdata9) +
                        TRIM(wacces.accdata10).

            ASSIGN
                wacces.accdata1  =  IF LENGTH(re_acctxt) >= 60  THEN SUBSTR(re_acctxt,1,60)    ELSE TRIM(re_acctxt) 
                wacces.accdata2  =  IF LENGTH(re_acctxt) >= 61  THEN SUBSTR(re_acctxt,61,60)   ELSE ""              
                wacces.accdata3  =  IF LENGTH(re_acctxt) >= 121 THEN SUBSTR(re_acctxt,121,60)  ELSE ""              
                wacces.accdata4  =  IF LENGTH(re_acctxt) >= 181 THEN SUBSTR(re_acctxt,181,60)  ELSE ""              
                wacces.accdata5  =  IF LENGTH(re_acctxt) >= 241 THEN SUBSTR(re_acctxt,241,60)  ELSE ""              
                wacces.accdata6  =  IF LENGTH(re_acctxt) >= 301 THEN SUBSTR(re_acctxt,301,60)  ELSE ""              
                wacces.accdata7  =  IF LENGTH(re_acctxt) >= 361 THEN SUBSTR(re_acctxt,361,60)  ELSE ""              
                wacces.accdata8  =  IF LENGTH(re_acctxt) >= 421 THEN SUBSTR(re_acctxt,421,60)  ELSE ""              
                wacces.accdata9  =  IF LENGTH(re_acctxt) >= 481 THEN SUBSTR(re_acctxt,481,60)  ELSE ""              
                wacces.accdata10 =  IF LENGTH(re_acctxt) >= 541 THEN SUBSTR(re_acctxt,541,60)  ELSE "". 
        END.
    END.
/*End By Naphasint C. A65-0271*/
   
END.
...end A67-0029...*/

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE 01-proc_assigninit70 C-Win 
PROCEDURE 01-proc_assigninit70 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes: A65-0079      
------------------------------------------------------------------------------*/
/*DEF VAR n_chkbr AS CHAR FORMAT "x(2)" INIT "" . /* A65-0043 */
DO:
    ASSIGN fi_process = "Create data text file " + wf_chasno + " to wdetail ....." .
    DISP fi_process WITH FRAM fr_main.
    CREATE wdetail.
    CREATE wtxt.
    CREATE wmemo.
    CREATE wacces.
    CREATE winst.
    CREATE wdrive. /* A67-0029 */
    ASSIGN
        wdetail.riskno        =  trim(wf_riskno)   
        wdetail.itemno        =  trim(wf_num)
        wdetail.policyno      =  trim(wf_policyno) 
        wdetail.n_branch      =  trim(wf_n_branch)        
        wdetail.agent         =  trim(wf_agent)           
        wdetail.producer      =  trim(wf_producer)        
        wdetail.n_delercode   =  trim(wf_n_delercode)   
        wdetail.fincode       =  trim(wf_fincode)   
        wdetail.appenno       =  trim(wf_appenno)   
        wdetail.salename      =  trim(wf_salename)   
        wdetail.srate         =  trim(wf_srate ) 
        wdetail.comdat        =  date(wf_comdat)                                        
        wdetail.expdat        =  date(wf_expdat)                                        
        wdetail.agreedat      =  if trim(wf_agreedat) = "" and wdetail.prepol = "" then date(wf_comdat) else if trim(wf_agreedat) <> "" then date(wf_agreedat)  ELSE ? 
        wdetail.firstdat      =  if trim(wf_firstdat) = "" and wdetail.prepol = "" then date(wf_comdat) else if trim(wf_firstdat) <> "" then date(wf_firstdat)  ELSE ? 
        wdetail.packcod       =  trim(wf_packcod)   
        wdetail.camp_no       =  trim(wf_camp_no)   
        wdetail.campen        =  trim(wf_campen) 
        wdetail.specon        =  trim(wf_specon) 
        wdetail.product       =  trim(wf_product )   
        wdetail.promo         =  trim(wf_promo )   
        wdetail.rencnt        =  TRIM(wf_rencnt)   
        wdetail.prepol        =  trim(wf_prepol)
        wdetail.compul        =  trim(wf_compul) 
        wdetail.instyp        =  trim(wf_instyp) 
        wdetail.nv_insref     =  TRIM(wf_insref)  
        wdetail.inslang       =  trim(wf_inslang)  
        wdetail.tiname        =  trim(wf_tiname) 
        wdetail.insnam        =  trim(wf_insnam) 
        wdetail.lastname      =  trim(wf_lastname)  
        wdetail.icno          =  trim(wf_icno)  
        wdetail.insbr         =  trim(wf_insbr) 
        wdetail.occup         =  trim(wf_occup) 
        wdetail.addr          =  trim(wf_addr)
        wdetail.tambon        =  trim(wf_tambon) 
        wdetail.amper         =  trim(wf_amper) 
        wdetail.country       =  trim(wf_country )  
        wdetail.post          =  trim(wf_post ) 
        wdetail.provcod       =  trim(wf_provcod)  
        wdetail.distcod       =  trim(wf_distcod)  
        wdetail.sdistcod      =  IF trim(wf_sdistcod) <> "" AND LENGTH(wf_sdistcod) > 2 THEN SUBSTR(wf_sdistcod,1,2) ELSE TRIM(wf_sdistcod) 
        wdetail.jpae          =  trim(wf_ae)    
        wdetail.jpjtl         =  trim(wf_jtl)   
        wdetail.jpts          =  trim(wf_ts)    
        wdetail.gender        =  trim(wf_gender)
        wdetail.tele1         =  trim(wf_tele1) 
        wdetail.tele2         =  trim(wf_tele2) 
        wdetail.mail1         =  trim(wf_mail1) 
        wdetail.mail2         =  trim(wf_mail2) 
        wdetail.mail3         =  trim(wf_mail3) 
        wdetail.mail4         =  trim(wf_mail4) 
        wdetail.mail5         =  trim(wf_mail5) 
        wdetail.mail6         =  trim(wf_mail6)  
        wdetail.mail7         =  trim(wf_mail7)  
        wdetail.mail8         =  trim(wf_mail8)  
        wdetail.mail9         =  trim(wf_mail9)  
        wdetail.mail10        =  trim(wf_mail10)  
        wdetail.fax           =  trim(wf_fax)  
        wdetail.lineID        =  trim(wf_lineID)  
        wdetail.name2         =  trim(wf_name2)  
        wdetail.name3         =  trim(wf_name3)  
        wdetail.benname       =  trim(wf_benname) 
        wdetail.payercod      =  trim(wf_payercod)  
        wdetail.vatcode       =  trim(wf_vatcode )
        wdetail.covcod        =  trim(wf_covcod )  
        wdetail.garage        =  trim(wf_garage )  
        wdetail.special       =  trim(wf_special)  
        wdetail.inspec        =  trim(wf_inspec )  
        wdetail.class70       =  trim(wf_class70)
        wdetail.redbook       =  TRIM(wf_redbook)  /*A65-0079*/
        wdetail.brand         =  trim(wf_brand)  
        wdetail.model         =  trim(wf_model)  
        wdetail.submodel      =  trim(wf_submodel)  
        wdetail.yrmanu        =  trim(wf_caryear)  
        wdetail.chasno        =  trim(wf_chasno )  
        wdetail.eng           =  trim(wf_eng)  
        wdetail.seat          =  INTE(wf_seat)  
        wdetail.engcc         =  INTE(wf_engcc)  
        wdetail.weight        =  DECI(wf_weight) 
        /*wdetail.watt          =  INTE(wf_watt)  */ /*A66-0202*/
        wdetail.watt          =  DECI(wf_watt)    /*A66-0202*/
        wdetail.body          =  trim(wf_body )  
        wdetail.typ           =  trim(wf_type )  
        wdetail.re_year       =  trim(wf_re_year)  
        wdetail.vehreg        =  trim(wf_vehreg )  
        wdetail.re_country    =  trim(wf_re_country)
        wdetail.cargrp        =  trim(wf_cargrp )   
        wdetail.colorcar      =  trim(wf_colorcar )
        wdetail.fule          =  trim(wf_fule) .
      ASSIGN 
        /* comment by : A67-0029..
        wdetail.drivnam       =  trim(wf_drivnam)   
        wdetail.ntitle1       =  if trim(wf_ntitle1)    = "-" then "" else trim(wf_ntitle1)   
        wdetail.drivername1   =  if trim(wf_drivername1)= "-" then "" else trim(wf_drivername1)
        wdetail.dname2        =  if trim(wf_dname2)     = "-" then "" else trim(wf_dname2)  
        wdetail.dicno         =  if trim(wf_dicno )     = "-" then "" else trim(wf_dicno )  
        wdetail.dgender1      =  if trim(wf_dgender1)   = "-" then "" else trim(wf_dgender1)  
        wdetail.dbirth        =  if trim(wf_dbirth)     = "-" then "" else trim(wf_dbirth)  
        wdetail.docoup        =  if trim(wf_docoup)     = "-" then "" else trim(wf_docoup)  
        wdetail.ddriveno      =  if trim(wf_ddriveno)   = "-" then "" else trim(wf_ddriveno)  
        wdetail.ntitle2       =  if trim(wf_ntitle2 )   = "-" then "" else trim(wf_ntitle2 )  
        wdetail.drivername2   =  if trim(wf_drivername2)= "-" then "" else trim(wf_drivername2)
        wdetail.ddname1       =  if trim(wf_ddname1)    = "-" then "" else trim(wf_ddname1)  
        wdetail.ddicno        =  if trim(wf_ddicno)     = "-" then "" else trim(wf_ddicno)  
        wdetail.dgender2      =  if trim(wf_dgender2)   = "-" then "" else trim(wf_dgender2)
        wdetail.ddbirth       =  if trim(wf_ddbirth)    = "-" then "" else trim(wf_ddbirth)
        wdetail.ddocoup       =  if trim(wf_ddocoup)    = "-" then "" else trim(wf_ddocoup)
        wdetail.dddriveno     =  if trim(wf_dddriveno)  = "-" then "" else trim(wf_dddriveno)
        ...end A67-0029...*/
        wdetail.baseplus      =  INTE(wf_baseplus)  
        wdetail.siplus        =  int(wf_siplus)
        wdetail.rs10          =  int(wf_rs10)   
        wdetail.comper        =  if trim(wf_comper)  = "U" then 999999999 else  int(wf_comper)    /*A64-0355*/
        wdetail.comacc        =  if trim(wf_comacc)  = "U" then 999999999 else  int(wf_comacc)    /*A64-0355*/
        wdetail.deductpd      =  if trim(wf_deductpd)= "U" then 999999999 else  int(wf_deductpd)  /*A64-0355*/ 
        wdetail.DOD           =  int(wf_DOD)   
        wdetail.DPD           =  int(wf_DPD)   
        wdetail.si            =  int(wf_tpfire) 
        wdetail.NO_411        = IF trim(wf_NO_41) = "" THEN (-1) ELSE int(wf_NO_41 ) /* A65-0079*/
        wdetail.seat41        = IF int(wf_ac2) <> 0 THEN int(wf_ac2) + 1 ELSE INTE(wf_seat) /*A64-0044*/
        wdetail.NO_412        = if trim(wf_ac4) = "" then (-1) else int(wf_ac4) /*A65-0079*/
        wdetail.NO_413        =  int(wf_ac5)  
        wdetail.ac6           =  int(wf_ac6)   
        wdetail.NO_414        =  int(wf_ac7) 
        wdetail.NO_42         = if trim(wf_NO_42) = "" then (-1) else int(wf_NO_42) /*A65-0079*/  
        wdetail.NO_43         = if trim(wf_NO_43) = "" then (-1) else int(wf_NO_43) /*A65-0079*/  
        wdetail.base          =  int(wf_base)
        wdetail.unname        =  deci(wf_unname) 
        wdetail.nname         =  deci(wf_nname) 
        wdetail.tpbi          =  deci(wf_tpbi)   
        wdetail.tppd          =  deci(wf_tppd)   
        wdetail.ry01          =  deci(wf_ry01)   
        wdetail.ry02          =  deci(wf_ry02)   
        wdetail.ry03          =  deci(wf_ry03) 
        wdetail.fleet         =  trim(wf_fleet)   
        wdetail.ncb           =  trim(wf_ncb)
        wdetail.claim         =  trim(wf_claim)   
        wdetail.dspc          =  trim(wf_dspc)   
        wdetail.cctv          =  trim(wf_cctv)   
        wdetail.dstf          =  trim(wf_dstf)   
        wdetail.fleetprem     =  deci(wf_fleetprem)
        wdetail.ncbprem       =  deci(wf_ncbprem)   
        wdetail.clprem        =  deci(wf_clprem )   
        wdetail.dspcprem      =  deci(wf_dspcprem) 
        wdetail.cctvprem      =  deci(wf_cctvprem) 
        wdetail.dstfprem      =  deci(wf_dstfprem) 
        wdetail.premt         =  deci(wf_premt )   
        wdetail.rstp_t        =  deci(wf_rstp_t)   
        wdetail.rtax_t        =  deci(wf_rtax_t)   
        wdetail.comper70      =  IF trim(wf_comper70)  =  " " THEN (-1) ELSE deci(wf_comper70)    /* ค่าว่างใส่ -1 ดึง comm ตามระบบ  ถ้าระบุ 0 ไม่มีค่าคอม */
        wdetail.comprem70     =  IF trim(wf_comprem70) =  " " THEN (-1) ELSE deci(wf_comprem70)  /* ค่าว่างใส่ -1 คำนวณ comm ตามระบบ ถ้าระบุ 0 ไม่มีค่าคอม */
        wdetail.agco70        =  trim(wf_agco70 )  
        wdetail.comco_per70   =  IF trim(wf_comco_per70)  =  " " THEN (-1) ELSE deci(wf_comco_per70) 
        wdetail.comco_prem70  =  IF trim(wf_comco_prem70) =  " " THEN (-1) ELSE deci(wf_comco_prem70)
        wdetail.dgpackge      =  trim(wf_dgpackge)
        wdetail.danger1       =  trim(wf_danger1)   
        wdetail.danger2       =  trim(wf_danger2)   
        wdetail.dgsi          =  inte(wf_dgsi)
        wdetail.dgrate        =  trim(wf_dgrate)   
        wdetail.dgfeet        =  trim(wf_dgfeet)   
        wdetail.dgncb         =  trim(wf_dgncb )   
        wdetail.dgdisc        =  trim(wf_dgdisc)  
        wdetail.dgwdisc       =  trim(wf_dgwdisc) 
        wdetail.dgatt         =  INTE(wf_dgatt)    
        wdetail.dgfeetprm     =  deci(wf_dgfeetprm)
        wdetail.dgncbprm      =  deci(wf_dgncbprm) 
        wdetail.dgdiscprm     =  deci(wf_dgdiscprm) 
        wdetail.dgWdiscprm    =  deci(wf_dgWdiscprm) 
        wdetail.dgprem        =  deci(wf_dgprem)
        wdetail.dgrstp_t      =  deci(wf_dgrstp_t) 
        wdetail.dgrtax_t      =  deci(wf_dgrtax_t) 
        wdetail.dgcomper      =  deci(wf_dgcomper) 
        wdetail.dgcomprem     =  deci(wf_dgcomprem)
        wdetail.cltxt         =  trim(wf_cltxt )
        wdetail.clamount      =  inte(wf_clamount)
        wdetail.faultno       =  inte(wf_faultno)  
        wdetail.faultprm      =  inte(wf_faultprm)  
        wdetail.goodno        =  inte(wf_goodno)  
        wdetail.goodprm       =  inte(wf_goodprm)  
        wdetail.loss          =  inte(wf_loss)  
        wdetail.compolusory   =  trim(wf_compolusory)
        wdetail.stk           =  trim(wf_barcode)  
        wdetail.class72       =  trim(wf_class72)  
        wdetail.dstf72        =  trim(wf_dstf72 )  
        wdetail.dstfprem72    =  deci(wf_dstfprem72)
        wdetail.premt72       =  deci(wf_premt72 )  
        wdetail.rstp_t72      =  deci(wf_rstp_t72)  
        wdetail.rtax_t72      =  deci(wf_rtax_t72)  
        wdetail.comper72      =  deci(wf_comper72)  
        wdetail.comprem72     =  deci(wf_comprem72) 
        wdetail.vehuse        =  trim(wf_vehuse) . /* ranu : vehuse 15/12/2021 */
    ASSIGN wdetail.poltyp        = "V70"
        wdetail.prempa        = IF LENGTH(wdetail.class70) = 5 THEN SUBSTR(wdetail.class70,1,1)                                                       
                                ELSE IF LENGTH(wdetail.class70) = 4 AND SUBSTR(wdetail.class70,4,1) <> "E" THEN SUBSTR(wdetail.class70,1,1)                   
                                ELSE TRIM(fi_pack)                                                                                            
        wdetail.subclass      = IF LENGTH(wdetail.class70) = 5 THEN SUBSTR(wdetail.class70,2,4)                                                       
                                ELSE IF LENGTH(wdetail.class70) = 4 AND SUBSTR(wdetail.class70,4,1) <> "E" THEN SUBSTR(wdetail.class70,2,3) 
                                ELSE wdetail.class70 
        wdetail.dspc          = IF DECI(wdetail.dspc) = 0  THEN TRIM(wdetail.cctv)  ELSE string(DECI(wdetail.dspc) + DECI(wdetail.cctv))
        wdetail.dspcprem      = IF deci(wf_dspcprem) = 0 THEN deci(wf_cctvprem) ELSE deci(wf_dspcprem) + deci(wdetail.cctvprem) /*A65-0079*/
        wdetail.tariff        = "X"
        wdetail.dgdisc        = IF deci(wdetail.dgwdisc) <> 0 THEN STRING(DECI(wdetail.dgdisc) + deci(wdetail.dgwdisc)) ELSE wdetail.dgdisc
        wdetail.comment       = ""
        wdetail.entdat        = string(TODAY)                /*entry date*/
        wdetail.enttim        = STRING(TIME, "HH:MM:SS")    /*entry time*/
        wdetail.trandat       = STRING(fi_loaddat)          /*tran date*/
        wdetail.trantim       = STRING(TIME, "HH:MM:SS")    /*tran time*/
        wdetail.n_IMPORT      = "IM" .
    n_chkbr   = "" .  /*A65-0043*/
    /*  A65-0079 */
    IF TRIM(wf_seat) = ""  THEN DO:
         ASSIGN wdetail.comment  = wdetail.comment + "|ที่นั่งเป็นค่าว่าง "   wdetail.pass     = "N" .
    END.
    /* end:A65-0079 */
    IF  wdetail.policyno <> "" THEN DO:
        IF  LENGTH(wdetail.policyno) <> 12 THEN   
            ASSIGN wdetail.comment  = wdetail.comment + "|เบอร์กรมธรรม์ " + wdetail.policyno + " ไม่ครบ 12 หลัก" 
               wdetail.pass     = "N" .
        IF SUBSTR(wdetail.policyno,3,2) <> "70" THEN 
            ASSIGN wdetail.comment  = wdetail.comment + "|เบอร์กรมธรรม์ " + wdetail.policyno + " หลักที่ 3-4 ไม่เท่ากับ 70 " 
                   wdetail.pass = "N" .
        /*A65-0043*/
        n_chkbr = TRIM(SUBSTR(wdetail.policyno,1,2)).
        IF SUBSTR(n_chkbr,1,1) = "D" THEN n_chkbr = trim(SUBSTR(n_chkbr,2,1)) . 
        IF  wdetail.n_branch <> n_chkbr  THEN
            ASSIGN wdetail.comment  = wdetail.comment +  "|สาขาเบอร์กรมธรรม์ " + wdetail.policyno + " ไม่ตรงกับสาขาของกรมธรรม์ "
                   wdetail.pass     = "N" .
        /* end : A65-0043*/
        FIND LAST sicuw.uwm100 WHERE sicuw.uwm100.policy = TRIM(wdetail.policyno) NO-LOCK NO-ERROR .
        IF AVAIL sicuw.uwm100  THEN
            ASSIGN wdetail.comment  = wdetail.comment + "|เบอร์กรมธรรม์ " + wdetail.policyno + " มีข้อมูลในระบบพรีเมียมแล้ว " 
                   wdetail.pass     = "N" .
    END.
    IF wdetail.compolusory <> ""  THEN DO:
        n_chkbr = "" .
        IF LENGTH(wdetail.compolusory) <> 12 THEN 
        ASSIGN wdetail.comment  = wdetail.comment + "|เบอร์กรมธรรม์ พรบ. " + wdetail.compolusory + " ไม่ครบ 12 หลัก" 
               wdetail.pass     = "N" .
        IF SUBSTR(wdetail.compolusory,3,2) <> "72" THEN 
        ASSIGN wdetail.comment  = wdetail.comment +  "|เบอร์กรมธรรม์ พรบ. " + wdetail.compolusory + " หลักที่ 3-4 ไม่เท่ากับ 72 "
               wdetail.pass     = "N" .
        /*A65-0043*/
        n_chkbr = TRIM(SUBSTR(wdetail.compolusory,1,2)).
        IF SUBSTR(n_chkbr,1,1) = "D" THEN n_chkbr = trim(SUBSTR(n_chkbr,2,1)) . 
        IF  wdetail.n_branch <> n_chkbr  THEN
            ASSIGN wdetail.comment  = wdetail.comment +  "|สาขาเบอร์กรมธรรม์ พรบ. " + wdetail.compolusory + " ไม่ตรงกับสาขาของกรมธรรม์ "
                   wdetail.pass     = "N" .
        /* end : A65-0043*/
    END.
    /* end : A64-0355 */ 
    /********* ห้ามแก้ไขเบอร์กรมธรรม์ในระบบ N70 ,N72 ,R70 ,R72 เนื่องจากมีผลต่อการ Running policy no. ที่ข้อ 08.05 ************/
    IF wdetail.policyno = ""  THEN DO:
        IF ra_type = 1  THEN DO:  /*Type = new */
            IF LENGTH(wdetail.chasno) > 9  THEN DO:
             ASSIGN wdetail.policyno = "N70" + STRING(int(wdetail.riskno),"999") + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 9).
             IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */
                 IF wdetail.compolusory <> "" THEN wdetail.cr_2 = wdetail.compolusory.
                 ELSE ASSIGN wdetail.cr_2 = "N72" + STRING(int(wdetail.riskno),"999") + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 9).
             END.
            END.
            ELSE DO:
                ASSIGN wdetail.policyno = "N70" + STRING(int(wdetail.riskno),"999") + TRIM(wdetail.chasno).
                IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */
                    IF wdetail.compolusory <> "" THEN wdetail.cr_2 = wdetail.compolusory.
                    ELSE ASSIGN wdetail.cr_2 = "N72" + STRING(int(wdetail.riskno),"999") + TRIM(wdetail.chasno).
                END.
            END.
        END.
        ELSE DO:  /*Renew*/
            IF wdetail.chasno <> "" THEN DO: 
                IF LENGTH(wdetail.chasno) > 9  THEN DO:
                   ASSIGN wdetail.policyno = "R70" + STRING(int(wdetail.riskno),"999") + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 9).
                    IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */ 
                       IF wdetail.compolusory <> "" THEN wdetail.cr_2 = wdetail.compolusory.
                       ELSE ASSIGN wdetail.cr_2 = "R72" + STRING(int(wdetail.riskno),"999") + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 9).
                   END.
                END.
                ELSE DO:
                    ASSIGN wdetail.policyno = "R70" + STRING(int(wdetail.riskno),"999") + TRIM(wdetail.chasno).
                    IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */ 
                         IF wdetail.compolusory <> "" THEN wdetail.cr_2 = wdetail.compolusory.
                         ELSE ASSIGN wdetail.cr_2 = "R72" + STRING(int(wdetail.riskno),"999") + TRIM(wdetail.chasno).
                    END.
                END.
            END.
            ELSE DO: 
                ASSIGN wdetail.policyno = "R70" + STRING(int(wdetail.riskno),"999") + SUBSTRING(wdetail.prepol,LENGTH(wdetail.prepol) - 6). /*A64-0355*/
                IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */  
                     IF wdetail.compolusory <> "" THEN wdetail.cr_2 = wdetail.compolusory.
                     ELSE ASSIGN wdetail.cr_2 = "R72" + STRING(int(wdetail.riskno),"999") + SUBSTRING(wdetail.prepol,LENGTH(wdetail.prepol) - 6). /*A64-0355*/
                END.
            END.
        END.
    END.
    ELSE IF wdetail.compul = "Y"  AND ra_poltyp = 3 AND wdetail.compolusory <> "" THEN wdetail.cr_2 = wdetail.compolusory.  /*A64-0355*/
    ELSE IF wdetail.compul = "Y"  AND ra_poltyp = 1 AND wdetail.compolusory <> "" THEN wdetail.cr_2 = wdetail.compolusory.  /*A66-0018*/
    ASSIGN wf_policyno = wdetail.policyno . /*A66-0202 */

    RUN proc_assigninit70_2.
    IF TRIM(wdetail.nv_insref) <> "" THEN  RUN proc_chkinscode . /*A65-0043*/ 
    RELEASE wdetail.
    RELEASE wtxt.
    RELEASE wmemo.
    RELEASE wacces.
    RELEASE winst.
END.*/
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE 01-proc_calpremt C-Win 
PROCEDURE 01-proc_calpremt :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
/*DEF VAR chk     AS LOGICAL.
DEF VAR n_prem  AS DECI.
FIND sic_bran.uwm100 WHERE RECID(sic_bran.uwm100) = s_recid1 NO-WAIT NO-ERROR.
FIND sic_bran.uwm120 WHERE RECID(sic_bran.uwm120) = s_recid2 NO-WAIT NO-ERROR.
FIND sic_bran.uwm130 WHERE RECID(sic_bran.uwm130) = s_recid3 NO-WAIT NO-ERROR.
FIND sic_bran.uwm301 WHERE RECID(sic_bran.uwm301) = s_recid4 NO-WAIT NO-ERROR.

IF wdetail.poltyp = "V70" THEN DO:
        ASSIGN fi_process = "Create data to base..." + wdetail.policy .
        DISP fi_process WITH FRAM fr_main.
        ASSIGN 
            nv_polday  = 0 
            nv_covcod  = ""  
            nv_class   = ""  
            nv_vehuse  = ""  
            nv_cstflg  = ""  /*C=CC ; S=Seat ; T=Tons ; W=Watts*/    
            nv_engcst  = 0   /* ต้องใส่ค่าตาม nv_cstflg  */         
            /*nv_drivno  = 0*/
            nv_driage1 = 0
            nv_driage2 = 0
            nv_pdprm0  = 0  /*เบี้ยส่วนลดผู้ขับขี่*/
            nv_yrmanu  = 0
            nv_totsi   = 0
            nv_totfi   = 0
            nv_vehgrp  = ""
            nv_access  = ""
            nv_supe    = NO
            nv_tpbi1si = 0
            nv_tpbi2si = 0
            nv_tppdsi  = 0   
            nv_411si   = 0
            nv_412si   = 0
            nv_413si   = 0
            nv_414si   = 0  
            nv_42si    = 0
            nv_43si    = 0
            nv_41prmt  = 0
            nv_412prmt = 0  /*A65-0079*/
            nv_413prmt = 0  /*A65-0079*/
            nv_414prmt = 0  /*A65-0079*/
            nv_42prmt  = 0
            nv_43prmt  = 0
            nv_seat41  = 0          
            nv_dedod   = 0
            nv_addod   = 0
            nv_dedpd   = 0        
            nv_ncbp    = 0
            nv_fletp   = 0
            nv_dspcp   = 0
            nv_dstfp   = 0
            nv_clmp    = 0
            /* A65-0079*/
            nv_mainprm = 0 
            nv_ncbamt  = 0 
            nv_fletamt = 0 
            nv_dspcamt = 0 
            nv_dstfamt = 0 
            nv_clmamt  = 0 
            /* end : A65-0079 */
            nv_baseprm  = 0
            nv_baseprm3 = 0
            nv_pdprem   = 0
            nv_netprem  = 0    /*เบี้ยสุทธิ */
            nv_gapprm   = 0    /*เบี้ยรวม */
            nv_flagprm  = "N"  /* N = เบี้ยสุทธิ, G = เบี้ยรวม */
            nv_effdat   = ?    
            nv_ratatt   = 0    
            nv_siatt    = 0    
            nv_netatt   = 0    
            nv_fltatt   = 0    
            nv_ncbatt   = 0    
            nv_dscatt   = 0    
            nv_atfltgap = 0   /*A65-0079*/
            nv_atncbgap = 0   /*A65-0079*/
            nv_atdscgap = 0   /*A65-0079*/
            nv_packatt  = ""  /*A65-0079*/
            nv_flgsht   = ""  /*A65-0079*/
            nv_status   = "" 
            nv_fcctv    = NO
            nv_uom1_c   = "" 
            nv_uom2_c   = "" 
            nv_uom5_c   = "" 
            nv_uom6_c   = "" 
            nv_uom7_c   = ""
            nv_message  = "" 
            nv_level    = 0 .
        ASSIGN               
            nv_covcod  = wdetail.covcod                                              
            nv_class   = trim(wdetail.prempa) + trim(wdetail.subclass)     /* T110 */                                     
            nv_vehuse  = wdetail.vehuse                                    
           /*nv_cstflg  = "C"  /*C=CC ; S=Seat ; T=Tons ; W=Watts*/ 
            nv_engcst  = 1900*/ /* ต้องใส่ค่าตาม nv_cstflg         
            nv_drivno  = 0   */                                     
            nv_driage1 = nv_drivage1                                 
            nv_driage2 = nv_drivage2                                    
            nv_yrmanu  = INT(wdetail.yrmanu)                         
            /*nv_totsi   = sic_bran.uwm130.uom6_v */ /* A66-0202*/
            nv_totsi   = IF sic_bran.uwm130.uom6_v = 0 THEN sic_bran.uwm130.uom7_v ELSE sic_bran.uwm130.uom6_v /*A66-0202*/
            nv_totfi   = sic_bran.uwm130.uom7_v
            nv_vehgrp  = wdetail.cargrp                                                     
            nv_access  = IF wdetail.special <> "A" THEN "" ELSE TRIM(wdetail.special)                                          
           /*nv_supe    = NO*/                                              
            nv_tpbi1si = nv_uom1_v             
            nv_tpbi2si = nv_uom2_v             
            nv_tppdsi  = nv_uom5_v             
            nv_411si   = wdetail.NO_411       
            nv_412si   = wdetail.NO_412       
            nv_413si   = wdetail.NO_413                       
            nv_414si   = wdetail.NO_414                     
            nv_42si    = wdetail.no_42                
            nv_43si    = wdetail.no_43 
            nv_41prmt  = wdetail.ry01
            nv_412prmt = wdetail.ry412    /*A65-0079*/  
            nv_413prmt = wdetail.ry413    /*A65-0079*/  
            nv_414prmt = wdetail.ry414    /*A65-0079*/
            nv_42prmt  = wdetail.ry02
            nv_43prmt  = wdetail.ry03
            nv_seat41  = wdetail.seat41   
            nv_dedod   = dod1      
            nv_addod   = dod2                                
            nv_dedpd   = deci(wdetail.DPD)                                    
            nv_ncbp    = deci(wdetail.ncb)                                     
            nv_fletp   = deci(wdetail.fleet)                                  
            nv_dspcp   = deci(wdetail.dspc)                                      
            nv_dstfp   = deci(wdetail.dstf)                                                    
            nv_clmp    = deci(wdetail.claim)
            /* Add : A65-0079 */
            nv_mainprm  = IF INT(wdetail.unname) <> 0 THEN deci(wdetail.unname) 
                          ELSE deci(wdetail.nname) 
            nv_dodamt   = deci(wdetail.dod_prm) /*A67-0029*/
            nv_dadamt   = deci(wdetail.dod1_prm) /*A67-0029*/
            nv_dpdamt   = deci(wdetail.dpd_prm) /*A67-0029*/
            nv_ncbamt   = deci(wdetail.ncbprem)
            nv_fletamt  = deci(wdetail.fleetprem) 
            nv_dspcamt  = deci(wdetail.dspcprem)  
            nv_dstfamt  = deci(wdetail.dstfprem)  
            nv_clmamt   = deci(wdetail.clprem)
            /* end : A65-0079*/
            nv_baseprm  = deci(wdetail.base)
            nv_baseprm3 = deci(wdetail.baseplus) 
            nv_netprem  = DECI(wdetail.premt) /* เบี้ยสุทธิ */  
            nv_pdprem   = DECI(wdetail.premt)
            nv_gapprm   = 0                                                       
            nv_flagprm  = "N"                 /* N = เบี้ยสุทธิ, G = เบี้ยรวม */                                    
            nv_effdat   = sic_bran.uwm100.comdat
            nv_ratatt   = deci(wdetail.dgrate)                        
            nv_siatt    = deci(wdetail.dgsi)                                                        
            nv_netatt   = deci(wdetail.dgprem)          
            nv_fltatt   = deci(wdetail.dgfeet)         
            nv_ncbatt   = deci(wdetail.dgncb)          
            nv_dscatt   = deci(wdetail.dgdisc)
            nv_attgap   = deci(wdetail.dgatt) 
            nv_atfltgap = deci(wdetail.dgfeetprm)
            nv_atncbgap = deci(wdetail.dgncbprm)
            nv_atdscgap = deci(wdetail.dgdiscprm) 
            nv_packatt  = trim(wdetail.dgpackge)
            nv_flgsht   = IF wdetail.srate = "Y" THEN "S" ELSE "P" /*A65-0079*/
            nv_fcctv    = IF wdetail.cctv <> "" THEN YES ELSE NO .
            /*nv_status  = "" */
         FIND FIRST stat.clastab_fil USE-INDEX clastab01 WHERE
               clastab_fil.CLASS  = nv_class     AND
               clastab_fil.covcod = wdetail.covcod    NO-LOCK NO-ERROR.
            IF AVAIL stat.clastab_fil THEN DO:
                IF clastab_fil.unit = "C" THEN DO:
                    ASSIGN
                        nv_cstflg = IF SUBSTR(nv_class,5,1) = "E" THEN "W" ELSE clastab_fil.unit
                        nv_engine = IF SUBSTR(nv_class,5,1) = "E" THEN DECI(wdetail.watt) ELSE INT(wdetail.engcc).
                END.
                ELSE IF clastab_fil.unit = "S" THEN DO:
                    ASSIGN
                        nv_cstflg = clastab_fil.unit
                        nv_engine = INT(wdetail.seat).
                END.
                ELSE IF clastab_fil.unit = "T" THEN DO:
                    ASSIGN
                        nv_cstflg = clastab_fil.unit
                        nv_engine = DECI(sic_bran.uwm301.Tons).
                END.
                nv_engcst = nv_engine .
            END.

        IF wdetail.redbook = ""  THEN DO:
            IF nv_cstflg <> "T" THEN DO:
                /*RUN wgw/wgwredbook(input  wdetail.brand ,  */ /*A65=0079*/
                RUN wgw/wgwredbk1(input  wdetail.brand ,       /*A65=0079*/
                                   input  wdetail.model ,  
                                   input  nv_totsi      ,  
                                   INPUT  wdetail.tariff,  
                                   input  SUBSTR(nv_class,2,5),   
                                   input  wdetail.yrmanu, 
                                   input  nv_engine  ,
                                   input  0 , 
                                   INPUT-OUTPUT wdetail.redbook) .
            END.
            ELSE DO:
                /*RUN wgw/wgwredbook(input  wdetail.brand ,  */ /*A65=0079*/
                RUN wgw/wgwredbk1(input  wdetail.brand ,       /*A65=0079*/ 
                                   input  wdetail.model ,  
                                   input  INT(wdetail.si) ,  
                                   INPUT  wdetail.tariff,  
                                   input  SUBSTR(nv_class,2,5),   
                                   input  wdetail.yrmanu, 
                                   input  0  ,
                                   input  nv_engine , 
                                   INPUT-OUTPUT wdetail.redbook) .
            END.

            IF wdetail.redbook <> ""  THEN ASSIGN sic_bran.uwm301.modcod = wdetail.redbook .
            ELSE DO:
             ASSIGN
                    wdetail.comment = wdetail.comment + "| " + "Redbook is Null !! "
                    wdetail.WARNING = "Redbook เป็นค่าว่างไม่สามารถนำเข้ามูลเข้าได้ "  .
                    wdetail.pass    = "N". /*A65-0079*/
            END.
        END.

        FIND LAST stat.maktab_fil WHERE maktab_fil.makdes   =  wdetail.brand AND 
                                        maktab_fil.sclass   =  trim(SUBSTR(nv_class,2,4)) NO-LOCK NO-ERROR.
            IF AVAIL stat.maktab_fil THEN nv_supe = maktab_fil.impchg.

        IF sic_bran.uwm100.expdat NE ? AND sic_bran.uwm100.comdat NE ? THEN DO:
            IF ( DAY(sic_bran.uwm100.comdat)     =  DAY(sic_bran.uwm100.expdat)     AND
               MONTH(sic_bran.uwm100.comdat)     =  MONTH(sic_bran.uwm100.expdat)   AND
                YEAR(sic_bran.uwm100.comdat) + 1 =  YEAR(sic_bran.uwm100.expdat) )  OR
               ( DAY(sic_bran.uwm100.comdat)     =   29                             AND
               MONTH(sic_bran.uwm100.comdat)     =   02                             AND
                 DAY(sic_bran.uwm100.expdat)     =   01                             AND
               MONTH(sic_bran.uwm100.expdat)     =   03                             AND
                YEAR(sic_bran.uwm100.comdat) + 1 =  YEAR(sic_bran.uwm100.expdat) )
            THEN DO:
              nv_polday = 365.
            END.
            ELSE DO:
              nv_polday = (sic_bran.uwm100.expdat  - sic_bran.uwm100.comdat ) + 1 .     /*    =  366  วัน */
            END.
        END.

        IF nv_polday < 365 THEN DO:
            nv_polday  = (sic_bran.uwm100.expdat  - sic_bran.uwm100.comdat).
        END.
    RUN WUW\WUWPADP3.P(INPUT sic_bran.uwm100.policy,
                       INPUT nv_campcd , 
                       INPUT sic_bran.uwm100.rencnt,
                       INPUT sic_bran.uwm100.endcnt,
                       INPUT 0  ,
                       INPUT nv_riskno ,
                       INPUT nv_itemno ,  
                       INPUT nv_batchyr, 
                       INPUT nv_batchno,
                       INPUT nv_batcnt , 
                       INPUT nv_polday ,
                       INPUT nv_usrid  ,
                       INPUT "wgwloadem"  ,
                       INPUT-OUTPUT nv_covcod, 
                       INPUT-OUTPUT nv_class , 
                       INPUT-OUTPUT nv_vehuse, 
                       INPUT-OUTPUT nv_cstflg, 
                       INPUT-OUTPUT nv_engcst, 
                       INPUT-OUTPUT nv_drivno, 
                       INPUT-OUTPUT nv_driage1, 
                       INPUT-OUTPUT nv_driage2, 
                       INPUT-OUTPUT nv_pdprm0, 
                       INPUT-OUTPUT nv_yrmanu, 
                       INPUT-OUTPUT nv_totsi , 
                       INPUT-OUTPUT nv_totfi , 
                       INPUT-OUTPUT nv_vehgrp,  
                       INPUT-OUTPUT nv_access,  
                       INPUT-OUTPUT nv_supe,                       
                       INPUT-OUTPUT nv_tpbi1si, 
                       INPUT-OUTPUT nv_tpbi2si, 
                       INPUT-OUTPUT nv_tppdsi,                 
                       INPUT-OUTPUT nv_411si,   
                       INPUT-OUTPUT nv_412si,   
                       INPUT-OUTPUT nv_413si,   
                       INPUT-OUTPUT nv_414si,   
                       INPUT-OUTPUT nv_42si,    
                       INPUT-OUTPUT nv_43si,
                       INPUT-OUTPUT nv_41prmt,   /* ระบุเบี้ย รย.*/
                       INPUT-OUTPUT nv_412prmt,   /* ระบุเบี้ย รย.*/
                       INPUT-OUTPUT nv_413prmt,   /* ระบุเบี้ย รย.*/
                       INPUT-OUTPUT nv_414prmt,   /* ระบุเบี้ย รย.*/
                       INput-output nv_42prmt,   /* ระบุเบี้ย รย.*/
                       INput-output nv_43prmt,   /* ระบุเบี้ย รย.*/
                       INPUT-OUTPUT nv_seat41,              
                       INPUT-OUTPUT nv_dedod,    
                       INPUT-OUTPUT nv_addod,    
                       INPUT-OUTPUT nv_dedpd,    
                       input-output nv_dodamt,   /* ระบุเบี้ย DOD */ 
                       input-output nv_dadamt,   /* ระบุเบี้ย DOD1 */ 
                       input-output nv_dpdamt,   /* ระบุเบี้ย DPD */ 
                       INPUT-OUTPUT nv_ncbp,     
                       INPUT-OUTPUT nv_fletp,    
                       INPUT-OUTPUT nv_dspcp,    
                       INPUT-OUTPUT nv_dstfp,    
                       INPUT-OUTPUT nv_clmp,     
                       input-output nv_ncbamt ,  /* ระบุเบี้ย  NCB PREMIUM */       
                       input-output nv_fletamt,  /* ระบุเบี้ย  FLEET PREMIUM */     
                       input-output nv_dspcamt,  /* ระบุเบี้ย  DSPC PREMIUM */      
                       input-output nv_dstfamt,  /* ระบุเบี้ย  DSTF PREMIUM */      
                       input-output nv_clmamt ,  /* ระบุเบี้ย  LOAD CLAIM PREMIUM */
                       INPUT-OUTPUT nv_baseprm,
                       INPUT-OUTPUT nv_baseprm3,
                       INPUT-OUTPUT nv_mainprm,  /* Main Premium หรือเบี้ยหลัก ช่อง Name/Unname Premium (HG) */
                       INPUT-OUTPUT nv_pdprem,
                       INPUT-OUTPUT nv_netprem, 
                       INPUT-OUTPUT nv_gapprem,  
                       INPUT-OUTPUT nv_flagprm,             
                       INPUT-OUTPUT nv_effdat,
                       INPUT-OUTPUT nv_ratatt, 
                       INPUT-OUTPUT nv_siatt ,
                       INPUT-OUTPUT nv_netatt,    
                       INPUT-OUTPUT nv_fltatt, 
                       INPUT-OUTPUT nv_ncbatt, 
                       INPUT-OUTPUT nv_dscatt,
                       input-output nv_attgap ,   /*a65-0079*/
                       input-output nv_atfltgap,  /*a65-0079*/
                       input-output nv_atncbgap,  /*a65-0079*/
                       input-output nv_atdscgap,  /*a65-0079*/
                       input-output nv_packatt ,  /*a65-0079*/
                       INPUT-OUTPUT nv_fcctv ,  /* cctv = yes/no */
                       INPUT-OUTPUT nv_flgsht , /* Short rate = "S" , Pro rate = "P" */
                       INPUT-OUTPUT nv_level , /* A67-0029 */
                       OUTPUT nv_uom1_c,  
                       OUTPUT nv_uom2_c,  
                       OUTPUT nv_uom5_c,  
                       OUTPUT nv_uom6_c,
                       OUTPUT nv_uom7_c,
                       output nv_gapprm,
                       output nv_pdprm ,
                       OUTPUT nv_status,
                       OUTPUT nv_message ).
    ASSIGN                        
        sic_bran.uwm130.uom1_c  = nv_uom1_c
        sic_bran.uwm130.uom2_c  = nv_uom2_c
        sic_bran.uwm130.uom5_c  = nv_uom5_c
        sic_bran.uwm130.uom6_c  = nv_uom6_c
        sic_bran.uwm130.uom7_c  = nv_uom7_c .
    
    IF nv_drivno <> 0  THEN ASSIGN sic_bran.uwm301.actprm = nv_pdprm0. 

    /*IF nv_status = "NO" THEN DO:*/
    IF nv_message <> "" THEN DO:   /*A65-0079*/
        IF INDEX(nv_message,"Not Found Benefit") <> 0 THEN ASSIGN wdetail.pass  = "N". /*A65-0043*/
        ASSIGN
                wdetail.comment = wdetail.comment + "|" + nv_message
                wdetail.WARNING = wdetail.WARNING + "|" + nv_message.
                /*wdetail.pass    = "N".*/
    END.
    
END.*/
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE disable_UI C-Win  _DEFAULT-DISABLE
PROCEDURE disable_UI :
/*------------------------------------------------------------------------------
  Purpose:     DISABLE the User Interface
  Parameters:  <none>
  Notes:       Here we clean-up the user-interface by deleting
               dynamic widgets we have created and/or hide 
               frames.  This procedure is usually called when
               we are ready to "clean-up" after running.
------------------------------------------------------------------------------*/
  /* Delete the WINDOW we created */
  IF SESSION:DISPLAY-TYPE = "GUI":U AND VALID-HANDLE(C-Win)
  THEN DELETE WIDGET C-Win.
  IF THIS-PROCEDURE:PERSISTENT THEN DELETE PROCEDURE THIS-PROCEDURE.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE enable_UI C-Win  _DEFAULT-ENABLE
PROCEDURE enable_UI :
/*------------------------------------------------------------------------------
  Purpose:     ENABLE the User Interface
  Parameters:  <none>
  Notes:       Here we display/view/enable the widgets in the
               user-interface.  In addition, OPEN all queries
               associated with each FRAME and BROWSE.
               These statements here are based on the "Other 
               Settings" section of the widget Property Sheets.
------------------------------------------------------------------------------*/
  DISPLAY tg_flag ra_poltyp ra_type fi_loaddat fi_pack fi_bchno fi_prevbat 
          fi_bchyr fi_filename fi_output1 fi_output2 fi_output3 fi_process 
          fi_outputpro fi_impcnt fi_completecnt fi_premtot fi_premsuc ra_match 
      WITH FRAME fr_main IN WINDOW C-Win.
  ENABLE br_wdetail tg_flag ra_poltyp ra_type fi_loaddat fi_pack fi_bchno 
         fi_prevbat fi_bchyr fi_filename bu_file fi_output1 fi_output2 
         fi_output3 buok bu_exit fi_outputpro ra_match RECT-370 RECT-372 
         RECT-374 RECT-376 RECT-377 RECT-378 
      WITH FRAME fr_main IN WINDOW C-Win.
  {&OPEN-BROWSERS-IN-QUERY-fr_main}
  VIEW C-Win.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_722 C-Win 
PROCEDURE proc_722 :
/* ---------------------------------------------  U W M 1 3 0 -------------- */

ASSIGN fi_process = "Process data File Load....sic_bran.uwm130,sic_bran.uwm301"  .
        DISP fi_process WITH FRAM fr_main.
FIND sic_bran.uwm130 USE-INDEX uwm13001 WHERE
    sic_bran.uwm130.policy = sic_bran.uwm100.policy AND
    sic_bran.uwm130.rencnt = sic_bran.uwm100.rencnt AND
    sic_bran.uwm130.endcnt = sic_bran.uwm100.endcnt AND
    sic_bran.uwm130.riskgp = s_riskgp     AND            /*0*/
    sic_bran.uwm130.riskno = s_riskno     AND            /*1*/
    sic_bran.uwm130.itemno = s_itemno     AND            /*1*/
    sic_bran.uwm130.bchyr  = nv_batchyr   AND            /*26/10/2006 change field name */
    sic_bran.uwm130.bchno  = nv_batchno   AND            /*26/10/2006 change field name */ 
    sic_bran.uwm130.bchcnt = nv_batcnt                     /*26/10/2006 change field name */            
    NO-WAIT NO-ERROR.
IF NOT AVAILABLE sic_bran.uwm130 THEN 
    DO TRANSACTION:
    CREATE sic_bran.uwm130.
    ASSIGN sic_bran.uwm130.policy = sic_bran.uwm120.policy
        sic_bran.uwm130.rencnt = sic_bran.uwm120.rencnt   sic_bran.uwm130.endcnt = sic_bran.uwm120.endcnt
        sic_bran.uwm130.riskgp = sic_bran.uwm120.riskgp   sic_bran.uwm130.riskno = sic_bran.uwm120.riskno
        sic_bran.uwm130.itemno = s_itemno.
    ASSIGN  sic_bran.uwm130.bchyr = nv_batchyr     /* batch Year */
        sic_bran.uwm130.bchno = nv_batchno         /* bchno      */
        sic_bran.uwm130.bchcnt  = nv_batcnt .      /* bchcnt     */
    ASSIGN  sic_bran.uwm130.uom6_v   = 0
        sic_bran.uwm130.uom7_v   = 0
        sic_bran.uwm130.fptr01   = 0     sic_bran.uwm130.bptr01 = 0     /*Item Upper text*/
        sic_bran.uwm130.fptr02   = 0     sic_bran.uwm130.bptr02 = 0     /*Item Lower Text*/
        sic_bran.uwm130.fptr03   = 0     sic_bran.uwm130.bptr03 = 0     /*Cover & Premium*/
        sic_bran.uwm130.fptr04   = 0     sic_bran.uwm130.bptr04 = 0     /*Item Endt. Text*/
        sic_bran.uwm130.fptr05   = 0     sic_bran.uwm130.bptr05 = 0.    /*Item Endt. Clause*/
    FIND sicsyac.xmm016 USE-INDEX xmm01601 WHERE  sicsyac.xmm016.class =   sic_bran.uwm120.class
        NO-LOCK NO-ERROR.
    IF AVAIL sicsyac.xmm016 THEN 
        ASSIGN  sic_bran.uwm130.uom8_c = sicsyac.xmm016.uom8
        sic_bran.uwm130.uom9_c = sicsyac.xmm016.uom9 
        nv_comper     = deci(sicsyac.xmm016.si_d_t[8]) 
        nv_comacc     = deci(sicsyac.xmm016.si_d_t[9])                                           
        sic_bran.uwm130.uom8_v   = nv_comper   
        sic_bran.uwm130.uom9_v   = nv_comacc  .   
    ASSIGN  nv_riskno = 1
        nv_itemno = 1.
    IF wdetail.covcod = "1" Then 
        RUN wgs/wgschsum(INPUT  wdetail.policy,         /*a490166 Note modi*/
                         nv_riskno,
                         nv_itemno).
END.   /*transaction*/
s_recid3  = RECID(sic_bran.uwm130).
/* ---------------------------------------------  U W M 3 0 1 --------------*/ 
ASSIGN 
nv_covcod =   wdetail.covcod
nv_makdes  =  wdetail.brand
nv_moddes  =  wdetail.model.
/*--Str Amparat C. A51-0253--*/
nv_newsck = " ".
RUN proc_chassic .  /*A64-0044*/
IF SUBSTR(wdetail.stk,1,1) = "2" THEN nv_newsck = "0" + wdetail.stk.
ELSE nv_newsck = wdetail.stk.
     /*--End Amparat C. A51-0253--*/       
     FIND sic_bran.uwm301 USE-INDEX uwm30101      WHERE
         sic_bran.uwm301.policy = sic_bran.uwm100.policy  AND
         sic_bran.uwm301.rencnt = sic_bran.uwm100.rencnt  AND
         sic_bran.uwm301.endcnt = sic_bran.uwm100.endcnt  AND
         sic_bran.uwm301.riskgp = s_riskgp                AND
         sic_bran.uwm301.riskno = s_riskno                AND
         sic_bran.uwm301.itemno = s_itemno                AND
         sic_bran.uwm301.bchyr = nv_batchyr               AND 
         sic_bran.uwm301.bchno = nv_batchno               AND 
         sic_bran.uwm301.bchcnt  = nv_batcnt     NO-WAIT NO-ERROR.
    IF NOT AVAILABLE sic_bran.uwm301 THEN DO:
        DO TRANSACTION:
            CREATE sic_bran.uwm301.
        END. /*transaction*/
    END.                                                          
    Assign sic_bran.uwm301.policy  = sic_bran.uwm120.policy                   
        sic_bran.uwm301.rencnt  = sic_bran.uwm120.rencnt
        sic_bran.uwm301.endcnt  = sic_bran.uwm120.endcnt
        sic_bran.uwm301.riskgp  = sic_bran.uwm120.riskgp
        sic_bran.uwm301.riskno  = sic_bran.uwm120.riskno
        sic_bran.uwm301.itemno  = s_itemno
        sic_bran.uwm301.tariff  = wdetail.tariff
        sic_bran.uwm301.covcod  = nv_covcod
        /*sic_bran.uwm301.cha_no  = wdetail.chasno*/ /* A66-0202*/
        sic_bran.uwm301.cha_no  = IF trim(wdetail.chasno) = "" THEN "-" ELSE trim(wdetail.chasno) /* A66-0202*/
        sic_bran.uwm301.trareg  = nv_uwm301trareg    /*A64-0044*/
        sic_bran.uwm301.eng_no  = wdetail.eng
        sic_bran.uwm301.Tons    = INTEGER(wdetail.weight)
        sic_bran.uwm301.engine  = INTEGER(wdetail.engcc)
        sic_bran.uwm301.watts   = DECI(wdetail.watt) /*A66-0202*/
        sic_bran.uwm301.yrmanu  = INTEGER(wdetail.yrmanu)
        /*sic_bran.uwm301.garage  = wdetail.garage*/  /*A66-0018*/
        sic_bran.uwm301.garage  = ""                  /*A66-0018*/
        sic_bran.uwm301.body    = wdetail.body
        sic_bran.uwm301.seats   = INTEGER(wdetail.seat)
        /*sic_bran.uwm301.mv_ben83 = wdetail.benname*/ /*A64-0309 */
        sic_bran.uwm301.mv_ben83 = IF wdetail.benname <> "-" AND wdetail.benname <> "Null" THEN wdetail.benname ELSE ""  /*A64-0309 */
        /*sic_bran.uwm301.vehreg   = wdetail.vehreg + nv_provi*/ /*A64-0309 */
        sic_bran.uwm301.vehreg   = trim(wdetail.vehreg) + " " + trim(wdetail.re_country)  /*A64-0309 */
        sic_bran.uwm301.vehuse   = wdetail.vehuse
        /*sic_bran.uwm301.moddes   = wdetail.model + " " +  */    
        sic_bran.uwm301.moddes    = trim(wdetail.brand) + " " + trim(wdetail.model) + " " + trim(wdetail.submodel)
        sic_bran.uwm301.modcod   = wdetail.redbook 
        sic_bran.uwm301.vehgrp   = trim(wdetail.cargrp) /*A67-0212*/ 
        sic_bran.uwm301.sckno    = 0              
        sic_bran.uwm301.itmdel   = NO
        sic_bran.uwm301.bchyr    = nv_batchyr         /* batch Year */      
        sic_bran.uwm301.bchno    = nv_batchno         /* bchno    */      
        sic_bran.uwm301.bchcnt   = nv_batcnt          /* bchcnt     */ 
        /* A67-0029 */
        /*sic_bran.uwm301.maksi     = INTE(wdetail.maksi) */     
        sic_bran.uwm301.eng_no2   = wdetail.eng_no2  
        sic_bran.uwm301.battper   = INTE(wdetail.battper)
        /*sic_bran.uwm301.battrate  = INTE(wdetail.battrate)*/
        sic_bran.uwm301.battyr    = INTE(wdetail.battyr)  
        sic_bran.uwm301.battsi    = INTE(wdetail.battsi)
        sic_bran.uwm301.battprice = deci(wdetail.battprice)
        sic_bran.uwm301.battno    = wdetail.battno 
        sic_bran.uwm301.chargno   = wdetail.chargno 
        sic_bran.uwm301.chargsi   = deci(wdetail.chargsi)  
        sic_bran.uwm301.battflg   = IF DECI(wdetail.battprm) <> 0 THEN "Y" ELSE "N"  
        sic_bran.uwm301.chargflg  = IF DECI(wdetail.chargprm) <> 0 THEN "Y" ELSE "N".
        /* end : A67-0029 */                                                                         
    /*-----compul-----*/
    IF wdetail.compul = "y" THEN DO:
        sic_bran.uwm301.cert = "".
        IF LENGTH(wdetail.stk) = 11 THEN DO:    
            sic_bran.uwm301.drinam[9] = "STKNO:" + STRING(wdetail.stk,"99999999999"). 
        END.
        IF LENGTH(wdetail.stk) = 13  THEN DO:
            sic_bran.uwm301.drinam[9] = "STKNO:" + STRING(wdetail.stk,"9999999999999").
        END.  
        IF wdetail.stk = ""  THEN DO:
            sic_bran.uwm301.drinam[9] = "".
        END. 
        /*--create detaitem--*/
        FIND FIRST brStat.Detaitem USE-INDEX detaitem11 WHERE
            brStat.Detaitem.serailno   = wdetail.stk  AND 
            brstat.detaitem.yearReg    = nv_batchyr   AND
            brstat.detaitem.seqno      = STRING(nv_batchno)  AND
            brstat.detaitem.seqno2     = STRING(nv_batcnt)   NO-ERROR NO-WAIT.
        IF NOT AVAIL brstat.Detaitem THEN DO:   
            CREATE brstat.Detaitem.
            /*--STR Amparat C. A51-0253---*/
            ASSIGN                                                            
                brstat.detaitem.policy   = sic_bran.uwm301.policy                 
                brstat.Detaitem.rencnt   = sic_bran.uwm301.rencnt                 
                brstat.Detaitem.endcnt   = sic_bran.uwm301.endcnt                 
                brstat.Detaitem.riskno   = sic_bran.uwm301.riskno                 
                brstat.Detaitem.itemno   = sic_bran.uwm301.itemno                 
                brstat.detaitem.serailno = wdetail.stk
                brstat.detaitem.yearReg  = sic_bran.uwm301.bchyr
                brstat.detaitem.seqno    = STRING(sic_bran.uwm301.bchno)     
                brstat.detaitem.seqno2   = STRING(sic_bran.uwm301.bchcnt).  
            /*--END Amparat C. A51-0253---*/
        END.
    END.
    ELSE sic_bran.uwm301.drinam[9] = "".
    s_recid4  = RECID(sic_bran.uwm301).
    IF wdetail.redbook <> "" THEN DO:     /*กรณีที่มีการระบุ Code รถมา*/
        FIND FIRST stat.maktab_fil Use-index   maktab04   WHERE 
            stat.maktab_fil.sclass = wdetail.subclass    AND  /*kridtiya i. A53-0406*/
            stat.maktab_fil.modcod = wdetail.redbook     No-lock no-error no-wait.
        If  avail stat.maktab_fil  Then 
            ASSIGN wdetail.redbook =  stat.maktab_fil.modcod
            /*wdetail.model           =  stat.maktab_fil.makdes  +  " "  +  stat.maktab_fil.moddes*/
            sic_bran.uwm301.modcod  =  stat.maktab_fil.modcod                                    
            /*sic_bran.uwm301.moddes  =  stat.maktab_fil.makdes  +  " "  +  stat.maktab_fil.moddes*/
            wdetail.cargrp          =  stat.maktab_fil.prmpac
            sic_bran.uwm301.vehgrp  =  stat.maktab_fil.prmpac .
            /*sic_bran.uwm301.body    =  stat.maktab_fil.body*/
            /*sic_bran.uwm301.seats   =  stat.maktab_fil.seats
            sic_bran.uwm301.Tons    =  stat.maktab_fil.tons
            sic_bran.uwm301.engine  =  stat.maktab_fil.eng.*/
            /*sic_bran.uwm301.moddes  =  stat.maktab_fil.moddes.*//*comment by kridtiya i. A53-0100 01/04/2010*/
    END.
    /*IF wdetail.redbook = "" THEN  RUN proc_maktab.   /*kridtiya i. A53-0220  */
    /* add by : A64-0043 */
    IF wdetail.redbook = "" THEN DO:
        ASSIGN
                wdetail.comment = wdetail.comment + "| " + "Redbook is Null !! "
                wdetail.WARNING = "Redbook เป็นค่าว่างไม่สามารถนำเข้ามูลเข้าได้ "  .
                wdetail.pass    = "N".
    END.
    /* end : A64-0043 */*/

    FIND sic_bran.uwd132  USE-INDEX uwd13201 WHERE
         sic_bran.uwd132.policy = wdetail.policyno AND
         sic_bran.uwd132.rencnt = 0                AND
         sic_bran.uwd132.endcnt = 0                AND
         sic_bran.uwd132.riskgp = 0                AND
         sic_bran.uwd132.riskno = 1                AND
         sic_bran.uwd132.itemno = 1                AND
         sic_bran.uwd132.bchyr  = nv_batchyr       AND
         sic_bran.uwd132.bchno  = nv_batchno       AND
         sic_bran.uwd132.bchcnt = nv_batcnt   NO-ERROR NO-WAIT.
    IF NOT AVAILABLE sic_bran.uwd132 THEN DO:
      IF LOCKED sic_bran.uwd132 THEN DO:
        MESSAGE "พบกำลังใช้งาน Insured (UWD132)" wdetail.policyno
                "ไม่สามารถ Generage ข้อมูลได้".
        NEXT.
      END.
      CREATE sic_bran.uwd132.
    END.
    ASSIGN  sic_bran.uwd132.bencod  = "COMP"             /*Benefit Code*/
      sic_bran.uwd132.benvar  = ""                       /*Benefit Variable*/
      sic_bran.uwd132.rate    = 0                        /*Premium Rate %*/
      sic_bran.uwd132.gap_ae  = NO                       /*GAP A/E Code*/
      sic_bran.uwd132.gap_c   = deci(wdetail.premt72)    /*GAP, per Benefit per Item*/
      sic_bran.uwd132.dl1_c   = 0                        /*Disc./Load 1,p. Benefit p.Item*/
      sic_bran.uwd132.dl2_c   = 0                        /*Disc./Load 2,p. Benefit p.Item*/
      sic_bran.uwd132.dl3_c   = 0                        /*Disc./Load 3,p. Benefit p.Item*/
      sic_bran.uwd132.pd_aep  = "E"                      /*Premium Due A/E/P Code*/
      sic_bran.uwd132.prem_c  = deci(wdetail.premt72)    /*PD, per Benefit per Item*/
      sic_bran.uwd132.fptr    = 0                        /*Forward Pointer*/
      sic_bran.uwd132.bptr    = 0                        /*Backward Pointer*/
      sic_bran.uwd132.policy  = wdetail.policyno         /*Policy No. - uwm130*/
      sic_bran.uwd132.rencnt  = 0                        /*Renewal Count - uwm130*/
      sic_bran.uwd132.endcnt  = 0                        /*Endorsement Count - uwm130*/
      sic_bran.uwd132.riskgp  = 0                        /*Risk Group - uwm130*/
      sic_bran.uwd132.riskno  = 1                        /*Risk No. - uwm130*/
      sic_bran.uwd132.itemno  = 1                        /*Insured Item No. - uwm130*/
      sic_bran.uwd132.rateae  = NO                       /*Premium Rate % A/E Code*/
      sic_bran.uwm130.fptr03  = RECID(sic_bran.uwd132)   /*First uwd132 Cover & Premium*/
      sic_bran.uwm130.bptr03  = RECID(sic_bran.uwd132)   /*Last  uwd132 Cover & Premium*/
      sic_bran.uwd132.bchyr   = nv_batchyr  
      sic_bran.uwd132.bchno   = nv_batchno  
      sic_bran.uwd132.bchcnt  = nv_batcnt .
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_723 C-Win 
PROCEDURE proc_723 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DEFINE INPUT        PARAMETER  s_recid1   AS   RECID     NO-UNDO.
DEFINE INPUT        PARAMETER  s_recid2   AS   RECID     NO-UNDO.
DEFINE INPUT        PARAMETER  s_recid3   AS   RECID     NO-UNDO.
DEFINE INPUT        PARAMETER  s_recid4   AS   RECID     NO-UNDO.
DEFINE INPUT-OUTPUT PARAMETER  nv_message AS   CHARACTER NO-UNDO.
nv_rec100 = s_recid1.
nv_rec120 = s_recid2.
nv_rec130 = s_recid3.
nv_rec301 = s_recid4.
nv_message = "".
nv_gap     = 0.
nv_prem    = 0.
FIND sic_bran.uwm100 WHERE RECID(sic_bran.uwm100) = nv_rec100 NO-WAIT NO-ERROR.
FIND sic_bran.uwm120 WHERE RECID(sic_bran.uwm120) = nv_rec120 NO-WAIT NO-ERROR.
FIND sic_bran.uwm130 WHERE RECID(sic_bran.uwm130) = nv_rec130 NO-WAIT NO-ERROR.
FIND sic_bran.uwm301 WHERE RECID(sic_bran.uwm301) = nv_rec301 NO-WAIT NO-ERROR.
IF sic_bran.uwm130.fptr03 = 0 OR sic_bran.uwm130.fptr03 = ? THEN DO:
    FIND sicsyac.xmm107 USE-INDEX xmm10701      WHERE
        sicsyac.xmm107.class  = wdetail.subclass   AND
        sicsyac.xmm107.tariff = wdetail.tariff
        NO-LOCK NO-ERROR NO-WAIT.
    IF AVAILABLE sicsyac.xmm107 THEN DO:
        FIND sicsyac.xmd107  WHERE RECID(sicsyac.xmd107) = sicsyac.xmm107.fptr
            NO-LOCK NO-ERROR NO-WAIT.
        IF AVAILABLE sicsyac.xmd107 THEN DO:
            CREATE sic_bran.uwd132.
            FIND sicsyac.xmm016 USE-INDEX xmm01601 WHERE
                sicsyac.xmm016.class = wdetail.subclass
                NO-LOCK NO-ERROR NO-WAIT.
            IF AVAIL sicsyac.xmm016 THEN 
                ASSIGN sic_bran.uwd132.gap_ae = NO
                sic_bran.uwd132.pd_aep = "E".
            ASSIGN sic_bran.uwd132.bencod = sicsyac.xmd107.bencod   sic_bran.uwd132.policy = wdetail.policy
                sic_bran.uwd132.rencnt = sic_bran.uwm130.rencnt  sic_bran.uwd132.endcnt = sic_bran.uwm130.endcnt
                sic_bran.uwd132.riskgp = sic_bran.uwm130.riskgp  sic_bran.uwd132.riskno = sic_bran.uwm130.riskno
                sic_bran.uwd132.itemno = sic_bran.uwm130.itemno
                sic_bran.uwd132.bptr   = 0
                sic_bran.uwd132.fptr   = 0          
                nvffptr     = xmd107.fptr
                s_130bp1    = RECID(sic_bran.uwd132)
                s_130fp1    = RECID(sic_bran.uwd132)
                n_rd132     = RECID(sic_bran.uwd132)
                sic_bran.uwd132.bchyr = nv_batchyr         /* batch Year */      
                sic_bran.uwd132.bchno = nv_batchno         /* bchno    */      
                sic_bran.uwd132.bchcnt  = nv_batcnt .        /* bchcnt     */ 
            FIND sicsyac.xmm105 USE-INDEX xmm10501      WHERE
                sicsyac.xmm105.tariff = wdetail.tariff  AND
                sicsyac.xmm105.bencod = sicsyac.xmd107.bencod
                NO-LOCK NO-ERROR NO-WAIT.
            IF AVAIL sicsyac.xmm105 THEN sic_bran.uwd132.benvar = sicsyac.xmm105.vardef.
            ELSE  MESSAGE "ไม่พบ Tariff  " wdetail.tariff   VIEW-AS ALERT-BOX.
            IF wdetail.tariff = "Z" OR wdetail.tariff = "X" THEN DO:  /* Malaysia */
                IF           wdetail.subclass      = "110" THEN nv_key_a = inte(wdetail.engcc).
                ELSE IF SUBSTRING(wdetail.subclass,1,3) = "120" THEN nv_key_a = inte(wdetail.seat).
                ELSE IF SUBSTRING(wdetail.subclass,1,3) = "130" THEN nv_key_a = inte(wdetail.engcc).
                ELSE IF SUBSTRING(wdetail.subclass,1,3) = "140" THEN nv_key_a = inte(wdetail.weight).
                nv_key_b = (sic_bran.uwm100.expdat - sic_bran.uwm100.comdat) + 1.
                FIND FIRST sicsyac.xmm106 USE-INDEX xmm10601  WHERE
                    sicsyac.xmm106.tariff  = wdetail.tariff   AND
                    sicsyac.xmm106.bencod  = uwd132.bencod    AND
                    sicsyac.xmm106.class   = wdetail.subclass AND
                    sicsyac.xmm106.covcod  = wdetail.covcod   AND
                    sicsyac.xmm106.key_a  >= nv_key_a         AND
                    sicsyac.xmm106.key_b  >= nv_key_b         AND
                    sicsyac.xmm106.effdat <= uwm100.comdat    NO-LOCK NO-ERROR NO-WAIT.
                IF AVAILABLE sicsyac.xmm106 THEN 
                    ASSIGN sic_bran.uwd132.gap_c  = sicsyac.xmm106.baseap
                    sic_bran.uwd132.prem_c = sicsyac.xmm106.baseap
                    nv_gap                 = nv_gap  + sic_bran.uwd132.gap_c
                    nv_prem                = nv_prem + sic_bran.uwd132.prem_c.
                ELSE  nv_message = "NOTFOUND".
            END.
            ELSE DO:
                FIND FIRST sicsyac.xmm106 USE-INDEX xmm10601  WHERE
                    sicsyac.xmm106.tariff  = wdetail.tariff   AND
                    sicsyac.xmm106.bencod  = sic_bran.uwd132.bencod   AND
                    sicsyac.xmm106.class   = wdetail.subclass AND
                    sicsyac.xmm106.covcod  = wdetail.covcod   AND
                    sicsyac.xmm106.key_a  >= 0                AND
                    sicsyac.xmm106.key_b  >= 0                AND
                    sicsyac.xmm106.effdat <= sic_bran.uwm100.comdat
                    NO-LOCK NO-ERROR NO-WAIT.
                FIND LAST  sicsyac.xmm106 USE-INDEX xmm10601  WHERE
                    sicsyac.xmm106.tariff  = wdetail.tariff   AND
                    sicsyac.xmm106.bencod  = sic_bran.uwd132.bencod   AND
                    sicsyac.xmm106.class   = wdetail.subclass AND
                    sicsyac.xmm106.covcod  = wdetail.covcod   AND
                    sicsyac.xmm106.key_a   = 0                AND
                    sicsyac.xmm106.key_b   = 0                AND
                    sicsyac.xmm106.effdat <= sic_bran.uwm100.comdat
                    NO-LOCK NO-ERROR NO-WAIT.
                IF AVAILABLE sicsyac.xmm106 THEN DO:
                    sic_bran.uwd132.gap_c     = sicsyac.xmm106.baseap.
                    RUN proc_wgw72013   (INPUT RECID(sic_bran.uwm100), 
                                        RECID(sic_bran.uwd132),
                                        sic_bran.uwm301.tariff).
                    nv_gap        = nv_gap  + sic_bran.uwd132.gap_c.
                    nv_prem       = nv_prem + sic_bran.uwd132.prem_c.
                END.
            END.
            loop_def:
            REPEAT:
                IF nvffptr EQ 0 THEN LEAVE loop_def.
                FIND sicsyac.xmd107 WHERE RECID(sicsyac.xmd107) EQ nvffptr
                    NO-LOCK NO-ERROR NO-WAIT.
                nvffptr   = sicsyac.xmd107.fptr.
                CREATE sic_bran.uwd132.
                ASSIGN sic_bran.uwd132.bencod = sicsyac.xmd107.bencod    sic_bran.uwd132.policy = wdetail.policy
                    sic_bran.uwd132.rencnt = sic_bran.uwm130.rencnt   sic_bran.uwd132.endcnt = sic_bran.uwm130.endcnt
                    sic_bran.uwd132.riskgp = sic_bran.uwm130.riskgp   sic_bran.uwd132.riskno = sic_bran.uwm130.riskno
                    sic_bran.uwd132.itemno = sic_bran.uwm130.itemno
                    sic_bran.uwd132.fptr   = 0
                    sic_bran.uwd132.bptr   = n_rd132
                    sic_bran.uwd132.bchyr = nv_batchyr      /* batch Year */      
                    sic_bran.uwd132.bchno = nv_batchno      /* bchno    */      
                    sic_bran.uwd132.bchcnt  = nv_batcnt     /* bchcnt     */      
                    n_rd132                 = RECID(sic_bran.uwd132).
                FIND sicsyac.xmm016 USE-INDEX xmm01601 WHERE
                    sicsyac.xmm016.class = wdetail.subclass
                    NO-LOCK NO-ERROR.
                IF AVAIL sicsyac.xmm016 THEN 
                    ASSIGN sic_bran.uwd132.gap_ae = NO
                    sic_bran.uwd132.pd_aep = "E".
                FIND sicsyac.xmm105 USE-INDEX xmm10501      WHERE
                    sicsyac.xmm105.tariff = wdetail.tariff  AND
                    sicsyac.xmm105.bencod = sicsyac.xmd107.bencod
                    NO-LOCK NO-ERROR NO-WAIT.
                IF AVAIL sicsyac.xmm105 THEN sic_bran.uwd132.benvar = sicsyac.xmm105.vardef.
                ELSE   MESSAGE "ไม่พบ Tariff นี้ในระบบ กรุณาใส่ Tariff ใหม่" 
                    "Tariff" wdetail.tariff "Bencod"  xmd107.bencod VIEW-AS ALERT-BOX.
                IF wdetail.tariff = "Z" OR wdetail.tariff = "X" THEN DO:
                    IF           wdetail.subclass      = "110" THEN nv_key_a = inte(wdetail.engcc).
                    ELSE IF SUBSTRING(wdetail.subclass,1,3) = "120" THEN nv_key_a = inte(wdetail.seat).
                    ELSE IF SUBSTRING(wdetail.subclass,1,3) = "130" THEN nv_key_a = inte(wdetail.engcc).
                    ELSE IF SUBSTRING(wdetail.subclass,1,3) = "140" THEN nv_key_a = inte(wdetail.weight).
                    nv_key_b = (sic_bran.uwm100.expdat - sic_bran.uwm100.comdat) + 1.
                    FIND FIRST sicsyac.xmm106 USE-INDEX xmm10601        WHERE
                        sicsyac.xmm106.tariff  = wdetail.tariff   AND
                        sicsyac.xmm106.bencod  = sic_bran.uwd132.bencod   AND
                        sicsyac.xmm106.class   = wdetail.subclass    AND
                        sicsyac.xmm106.covcod  = wdetail.covcod   AND
                        sicsyac.xmm106.key_a  >= nv_key_a        AND
                        sicsyac.xmm106.key_b  >= nv_key_b        AND
                        sicsyac.xmm106.effdat <= sic_bran.uwm100.comdat
                        NO-LOCK NO-ERROR NO-WAIT.
                    IF AVAILABLE sicsyac.xmm106 THEN 
                        ASSIGN
                            sic_bran.uwd132.gap_c  = sicsyac.xmm106.baseap
                            sic_bran.uwd132.prem_c = sicsyac.xmm106.baseap
                            nv_gap                 = nv_gap  + sic_bran.uwd132.gap_c
                            nv_prem                = nv_prem + sic_bran.uwd132.prem_c.
                END.
                ELSE DO:
                    FIND FIRST sicsyac.xmm106 USE-INDEX xmm10601                 WHERE
                        sicsyac.xmm106.tariff  = wdetail.tariff           AND
                        sicsyac.xmm106.bencod  = sic_bran.uwd132.bencod   AND
                        sicsyac.xmm106.class   = wdetail.subclass        AND
                        sicsyac.xmm106.covcod  = wdetail.covcod           AND
                        sicsyac.xmm106.key_a  >= 0                        AND
                        sicsyac.xmm106.key_b  >= 0                        AND
                        sicsyac.xmm106.effdat <= sic_bran.uwm100.comdat
                        NO-LOCK NO-ERROR NO-WAIT.
                    FIND LAST  sicsyac.xmm106 USE-INDEX xmm10601                  WHERE
                        sicsyac.xmm106.tariff  = wdetail.tariff            AND
                        sicsyac.xmm106.bencod  = sic_bran.uwd132.bencod    AND
                        sicsyac.xmm106.class   = wdetail.subclass          AND
                        sicsyac.xmm106.covcod  = wdetail.covcod            AND
                        sicsyac.xmm106.key_a   = 0                         AND
                        sicsyac.xmm106.key_b   = 0                         AND
                        sicsyac.xmm106.effdat <= sic_bran.uwm100.comdat
                        NO-LOCK NO-ERROR NO-WAIT.
                    IF AVAILABLE xmm106 THEN DO:
                        sic_bran.uwd132.gap_c     = sicsyac.xmm106.baseap.
                        RUN proc_wgw72013   (INPUT RECID(sic_bran.uwm100), 
                                            RECID(sic_bran.uwd132),
                                            sic_bran.uwm301.tariff).
                        nv_gap        = nv_gap  + sic_bran.uwd132.gap_c.
                        nv_prem       = nv_prem + sic_bran.uwd132.prem_c.
                    END.
                END.
                FIND sic_bran.uwd132 WHERE RECID(sic_bran.uwd132) EQ s_130bp1 NO-WAIT NO-ERROR.
                sic_bran.uwd132.fptr   = n_rd132.
                FIND sic_bran.uwd132 WHERE RECID(sic_bran.uwd132) EQ n_rd132 NO-WAIT NO-ERROR.
                s_130bp1      = RECID(sic_bran.uwd132).
                NEXT loop_def.
            END.
        END.
    END.
    ELSE DO:   
        ASSIGN s_130fp1 = 0
        s_130bp1 = 0.
        MESSAGE "ไม่พบ Class " wdetail.subclass " ใน Tariff  " wdetail.tariff  skip
                        "กรุณาใส่ Class หรือ Tariff ใหม่อีกครั้ง" VIEW-AS ALERT-BOX.
    END.
    ASSIGN sic_bran.uwm130.fptr03 = s_130fp1
        sic_bran.uwm130.bptr03 = s_130bp1.
END.
ELSE DO:                              
    s_130fp1 = sic_bran.uwm130.fptr03.
    DO WHILE s_130fp1 <> ? AND s_130fp1 <> 0:
        FIND sic_bran.uwd132 WHERE RECID(sic_bran.uwd132) = s_130fp1 NO-ERROR NO-WAIT.
        IF AVAILABLE sic_bran.uwd132 THEN DO:
            s_130fp1 = sic_bran.uwd132.fptr.
            IF wdetail.tariff = "Z" OR wdetail.tariff = "X" THEN DO:
                IF           wdetail.subclass      = "110" THEN nv_key_a = inte(wdetail.engcc).
                ELSE IF SUBSTRING(wdetail.subclass,1,3) = "120" THEN nv_key_a = inte(wdetail.seat).
                ELSE IF SUBSTRING(wdetail.subclass,1,3) = "130" THEN nv_key_a = inte(wdetail.engcc).
                ELSE IF SUBSTRING(wdetail.subclass,1,3) = "140" THEN nv_key_a = inte(wdetail.weight).
                nv_key_b = (sic_bran.uwm100.expdat - sic_bran.uwm100.comdat) + 1.
                FIND FIRST sicsyac.xmm106 USE-INDEX xmm10601                WHERE
                    sicsyac.xmm106.tariff  = wdetail.tariff          AND
                    sicsyac.xmm106.bencod  = sic_bran.uwd132.bencod  AND
                    sicsyac.xmm106.class   = wdetail.subclass        AND
                    sicsyac.xmm106.covcod  = wdetail.covcod          AND
                    sicsyac.xmm106.key_a  >= nv_key_a                AND 
                    sicsyac.xmm106.key_b  >= nv_key_b                AND 
                    sicsyac.xmm106.effdat <= sic_bran.uwm100.comdat
                    NO-LOCK NO-ERROR NO-WAIT.
                IF AVAILABLE xmm106 THEN 
                    ASSIGN sic_bran.uwd132.gap_c  = sicsyac.xmm106.baseap
                    sic_bran.uwd132.prem_c = sicsyac.xmm106.baseap
                    nv_gap                 = nv_gap  + sic_bran.uwd132.gap_c
                    nv_prem                = nv_prem + sic_bran.uwd132.prem_c.
                ELSE  nv_message = "NOTFOUND".
            END.
            ELSE DO:
                FIND FIRST sicsyac.xmm106 USE-INDEX xmm10601            WHERE
                    sicsyac.xmm106.tariff  = wdetail.tariff      AND 
                    sicsyac.xmm106.bencod  = sic_bran.uwd132.bencod       AND 
                    sicsyac.xmm106.class   = wdetail.subclass    AND 
                    sicsyac.xmm106.covcod  = wdetail.covcod      AND 
                    sicsyac.xmm106.key_a  >= 0                   AND 
                    sicsyac.xmm106.key_b  >= 0                   AND 
                    sicsyac.xmm106.effdat <= sic_bran.uwm100.comdat
                    NO-LOCK NO-ERROR NO-WAIT.
                FIND LAST  sicsyac.xmm106 USE-INDEX xmm10601        WHERE
                    sicsyac.xmm106.tariff  = wdetail.tariff   AND
                    sicsyac.xmm106.bencod  = sic_bran.uwd132.bencod   AND
                    sicsyac.xmm106.class   = wdetail.subclass    AND
                    sicsyac.xmm106.covcod  = wdetail.covcod   AND
                    sicsyac.xmm106.key_a   = 0               AND
                    sicsyac.xmm106.key_b   = 0               AND
                    sicsyac.xmm106.effdat <= sic_bran.uwm100.comdat
                    NO-LOCK NO-ERROR NO-WAIT.
                IF AVAILABLE sicsyac.xmm106 THEN DO:
                    sic_bran.uwd132.gap_c     = sicsyac.xmm106.baseap.         
                    RUN proc_wgw72013   (INPUT RECID(sic_bran.uwm100),         
                                        RECID(sic_bran.uwd132),                
                                        sic_bran.uwm301.tariff).
                    nv_gap        = nv_gap  + sic_bran.uwd132.gap_c.
                    nv_prem       = nv_prem + sic_bran.uwd132.prem_c.
                END.
            END.
        END.
    END.
END.

IF deci(wdetail.dstf72) <> 0  THEN DO:
    nv_stf_per = 0.
    nv_stf_per = DECI(wdetail.dstf72) .
    nv_prem = 0.
    FIND FIRST sic_bran.uwd132 USE-INDEX uwd13201 WHERE
        sic_bran.uwd132.policy = uwm100.policy  AND
        sic_bran.uwd132.rencnt = uwm100.rencnt  AND 
        sic_bran.uwd132.endcnt = uwm100.endcnt  AND
        SUBSTRING(sic_bran.uwd132.bencod,1,3) = "COM"   AND
        sic_bran.uwd132.riskno  = sic_bran.uwm130.riskno  AND
        sic_bran.uwd132.itemno  = sic_bran.uwm130.itemno  AND
        sic_bran.uwd132.bchyr   = sic_bran.uwm130.bchyr   AND
        sic_bran.uwd132.bchno   = sic_bran.uwm130.bchno   AND
        sic_bran.uwd132.bchcnt  = sic_bran.uwm130.bchcnt  NO-LOCK NO-ERROR.
    IF AVAIL sic_bran.uwd132 THEN nv_prem = sic_bran.uwd132.prem_c.
    ASSIGN
        nv_stf_per    = - ROUND(nv_prem * nv_stf_per / 100,2)
        nv_stfvar     = ""
        nv_stfvar1    = ""
        nv_stfvar2    = "".
    
    IF nv_stf_per   <> 0  THEN DO:
        ASSIGN 
            /*nv_stfvar1   = "     Discount Staff = "   */ /*A66-0202*/   
            nv_stfvar1   = "     DISCOUNT SPECIAL = "    /*A66-0202*/
            nv_stfvar2   =  STRING(wdetail.dstf72)              
            SUBSTRING(nv_stfvar,1,30)    = nv_stfvar1       
            SUBSTRING(nv_stfvar,31,30)   = nv_stfvar2.  
    END.
    RUN proc_dstf72.
END.
RUN proc_7231.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_7231 C-Win 
PROCEDURE proc_7231 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
ASSIGN nv_stm_per = 0.4
       nv_tax_per = 7.0.
FIND sicsyac.xmm020 USE-INDEX xmm02001     WHERE
    sicsyac.xmm020.branch = sic_bran.uwm100.branch AND
    sicsyac.xmm020.dir_ri = sic_bran.uwm100.dir_ri
    NO-LOCK NO-ERROR.
IF AVAIL sicsyac.xmm020 THEN 
    ASSIGN nv_stm_per             = sicsyac.xmm020.rvstam
           nv_tax_per             = sicsyac.xmm020.rvtax
           sic_bran.uwm100.gstrat = sicsyac.xmm020.rvtax.
ELSE sic_bran.uwm100.gstrat = nv_tax_per.
     ASSIGN  nv_gap2  = 0
         nv_prem2 = 0
         nv_rstp  = 0
         nv_rtax  = 0
         nv_com1_per = 0
         nv_com1_prm = 0.
     FIND sicsyac.xmm031 USE-INDEX xmm03101 WHERE sicsyac.xmm031.poltyp = sic_bran.uwm100.poltyp
         NO-LOCK NO-ERROR NO-WAIT.
     IF AVAILABLE sicsyac.xmm031 THEN nv_com1_per = sicsyac.xmm031.comm1.
     FOR EACH sic_bran.uwm120 USE-INDEX uwm12001 WHERE
         sic_bran.uwm120.policy = wdetail.policy         AND
         sic_bran.uwm120.rencnt = sic_bran.uwm100.rencnt AND
         sic_bran.uwm120.endcnt = sic_bran.uwm100.endcnt AND
         sic_bran.uwm120.riskgp = s_riskgp               AND
         sic_bran.uwm120.riskno = s_riskno               AND
         sic_bran.uwm120.bchyr  = nv_batchyr             AND 
         sic_bran.uwm120.bchno  = nv_batchno             AND 
         sic_bran.uwm120.bchcnt = nv_batcnt              :
         ASSIGN nv_gap  = 0
         nv_prem = 0.
         FOR EACH sic_bran.uwm130 USE-INDEX uwm13001 WHERE
             sic_bran.uwm130.policy = wdetail.policy AND
             sic_bran.uwm130.rencnt = sic_bran.uwm100.rencnt AND
             sic_bran.uwm130.endcnt = sic_bran.uwm100.endcnt AND
             sic_bran.uwm130.riskgp = sic_bran.uwm120.riskgp AND
             sic_bran.uwm130.riskno = sic_bran.uwm120.riskno AND
             sic_bran.uwm130.itemno = s_itemno               AND 
             sic_bran.uwm130.bchyr  = nv_batchyr             AND 
             sic_bran.uwm130.bchno  = nv_batchno             AND 
             sic_bran.uwm130.bchcnt  = nv_batcnt             NO-LOCK:
             nv_fptr = sic_bran.uwm130.fptr03.
             DO WHILE nv_fptr <> 0 AND nv_fptr <> ? :
                 FIND sic_bran.uwd132 WHERE RECID(sic_bran.uwd132) = nv_fptr
                     NO-LOCK NO-ERROR NO-WAIT.
                 IF NOT AVAILABLE sic_bran.uwd132 THEN LEAVE.
                 ASSIGN 
                 nv_fptr = sic_bran.uwd132.fptr
                 nv_gap  = nv_gap  + sic_bran.uwd132.gap_c
                 nv_prem = nv_prem + sic_bran.uwd132.prem_c.
             END.
         END.
         ASSIGN 
         sic_bran.uwm120.gap_r  =  nv_gap
         sic_bran.uwm120.prem_r =  nv_prem
         sic_bran.uwm120.rstp_r =  TRUNCATE(sic_bran.uwm120.prem_r * nv_stm_per / 100, 0) +
                                  (IF  TRUNCATE(sic_bran.uwm120.prem_r * nv_stm_per / 100, 2) -
                                  TRUNCATE(sic_bran.uwm120.prem_r * nv_stm_per / 100, 0) > 0  THEN 1 ELSE 0)
         sic_bran.uwm120.rtax_r = ROUND((sic_bran.uwm120.prem_r + sic_bran.uwm120.rstp_r)  * nv_tax_per  / 100 ,2)
         nv_gap2                = nv_gap2  + nv_gap
         nv_prem2               = nv_prem2 + nv_prem
         nv_rstp                = nv_rstp  + sic_bran.uwm120.rstp_r
         nv_rtax                = nv_rtax  + sic_bran.uwm120.rtax_r.
         IF sic_bran.uwm120.com1ae = NO THEN
             nv_com1_per            = sic_bran.uwm120.com1p.
         IF nv_com1_per <> 0 THEN 
             ASSIGN sic_bran.uwm120.com1ae =  NO
             sic_bran.uwm120.com1p  =  nv_com1_per
             sic_bran.uwm120.com1_r =  (sic_bran.uwm120.prem_r * sic_bran.uwm120.com1p / 100) * 1-
             nv_com1_prm = nv_com1_prm + sic_bran.uwm120.com1_r.
          ELSE DO:
              IF nv_com1_per   = 0  AND sic_bran.uwm120.com1ae = NO THEN 
                  ASSIGN
                      sic_bran.uwm120.com1p  =  0
                      sic_bran.uwm120.com1_r =  0
                      sic_bran.uwm120.com1_r =  0
                      nv_com1_prm            =  0.
          END.
     END.
     FIND sic_bran.uwm130 WHERE RECID(sic_bran.uwm130) = nv_rec130 NO-WAIT NO-ERROR.
     FIND sic_bran.uwm120 WHERE RECID(sic_bran.uwm120) = nv_rec120 NO-WAIT NO-ERROR.
     ASSIGN
         sic_bran.uwm100.gap_p  =  nv_gap2
         sic_bran.uwm100.prem_t =  nv_prem2
        /* sic_bran.uwm100.rstp_t =  nv_rstp */ /*F67-0001*/
        /* sic_bran.uwm100.rtax_t =  nv_rtax */ /*F67-0001*/
         sic_bran.uwm100.rstp_t =  IF DECI(wdetail.rstp_t72) = 0 THEN nv_rstp ELSE DECI(wdetail.rstp_t72)  /*F67-0001*/
         sic_bran.uwm100.rtax_t =  IF DECI(wdetail.rtax_t72) = 0 THEN nv_rtax ELSE DECI(wdetail.rtax_t72)  /*F67-0001*/
         sic_bran.uwm100.com1_t =  nv_com1_prm.
    
     RUN proc_chktest4.     
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_address C-Win 
PROCEDURE proc_address :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
def var n_address  as char format "x(50)".
def var n_build    as char format "x(50)".
def var n_tambon   as char format "x(50)".
def var n_amper    as char format "x(50)".
def var n_country  as char format "x(50)".
def var n_post     as char format "x(50)".
DEF VAR n_length   AS INT.
            
ASSIGN  n_address  = ""
        n_address  = trim(trim(wdetail.addr) + " " + trim(wdetail.tambon) + " " +
                     trim(wdetail.amper) + " " + TRIM(wdetail.country) + " " + TRIM(wdetail.post))
        n_build    = "" 
        n_tambon   = ""          
        n_amper    = ""          
        n_country  = ""          
        n_post     = "".

       IF n_address <> ""  THEN DO:
            IF INDEX(n_address,"จ." ) <> 0 THEN DO: 
                ASSIGN 
                n_country  =  TRIM(SUBSTR(n_address,INDEX(n_address,"จ."),LENGTH(n_address)))
                n_length   =  LENGTH(n_country)
                n_address  =  trim(SUBSTR(n_address,1,LENGTH(n_address) - n_length))
            
                n_country  =  IF index(n_country,"จ. ") <> 0 THEN  trim(REPLACE(n_country,"จ. ","จ.")) ELSE TRIM(n_country) 
                n_length   =  LENGTH(n_country)
                n_post     =  IF INDEX(n_country," ")  <> 0 THEN SUBSTR(n_country,INDEX(n_country," ") + 1,n_length) ELSE ""
                n_country  =  trim(SUBSTR(n_country,1,n_length - LENGTH(n_post))).
            END.
            ELSE IF INDEX(n_address,"จังหวัด" ) <> 0 THEN DO: 
                ASSIGN 
                n_country  =  trim(SUBSTR(n_address,INDEX(n_address,"จังหวัด"),LENGTH(n_address)))
                n_length   =  LENGTH(n_country)
                n_address  =  trim(SUBSTR(n_address,1,LENGTH(n_address) - n_length)) 
                n_post     =  IF INDEX(n_country," ") <> 0 THEN SUBSTR(n_country,INDEX(n_country," ") + 1,n_length)  ELSE ""
                n_country  =  trim(SUBSTR(n_country,1,n_length - LENGTH(n_post))).
            END.
            ELSE IF INDEX(n_address,"กทม" ) <> 0 THEN DO: 
                ASSIGN 
                n_country  =  trim(SUBSTR(n_address,INDEX(n_address,"กทม"),LENGTH(n_address)))
                n_length   =  LENGTH(n_country)
                n_address  =  trim(SUBSTR(n_address,1,LENGTH(n_address) - n_length))
                n_post     =  IF INDEX(n_country," ") <> 0 THEN SUBSTR(n_country,INDEX(n_country," ") + 1,n_length) ELSE ""
                n_country  =  trim(SUBSTR(n_country,1,n_length - LENGTH(n_post))).
            END.
            ELSE IF INDEX(n_address,"กรุงเทพ" ) <> 0 THEN DO: 
                ASSIGN 
                n_country  =  trim(SUBSTR(n_address,INDEX(n_address,"กรุงเทพ"),LENGTH(n_address)))
                n_length   =  LENGTH(n_country)
                n_address  =  trim(SUBSTR(n_address,1,LENGTH(n_address) - n_length)) 
                n_post     =  IF INDEX(n_country," ") <> 0 THEN SUBSTR(n_country,INDEX(n_country," ") + 1,n_length) ELSE ""
                n_country  =  trim(SUBSTR(n_country,1,n_length - LENGTH(n_post))).
            END.
            ELSE DO: 
                ASSIGN 
                n_post     =  trim(SUBSTR(n_address,R-INDEX(n_address," ")))
                n_length   =  LENGTH(n_post)
                n_address  =  trim(SUBSTR(n_address,1,LENGTH(n_address) - n_length))
                n_country  =  trim(SUBSTR(n_address,R-INDEX(n_address," ")))
                n_length   =  LENGTH(n_country)
                n_address  =  trim(SUBSTR(n_address,1,LENGTH(n_address) - n_length)).
            END.
            
            IF INDEX(n_address,"อ." ) <> 0 THEN DO: 
                ASSIGN 
                n_amper    =  trim(SUBSTR(n_address,INDEX(n_address,"อ."),LENGTH(n_address)))
                n_length   =  LENGTH(n_amper)
                n_address  =  trim(SUBSTR(n_address,1,LENGTH(n_address) - n_length)).
            END.
            ELSE IF INDEX(n_address,"อำเภอ" ) <> 0 THEN DO: 
                ASSIGN 
                n_amper    =  trim(SUBSTR(n_address,INDEX(n_address,"อำเภอ"),LENGTH(n_address)))
                n_length   =  LENGTH(n_amper)
                n_address  =  trim(SUBSTR(n_address,1,LENGTH(n_address) - n_length)).
            END.
            ELSE IF INDEX(n_address,"เขต" ) <> 0 THEN DO: 
                ASSIGN 
                n_amper    =  trim(SUBSTR(n_address,INDEX(n_address,"เขต"),LENGTH(n_address)))
                n_length   =  LENGTH(n_amper)
                n_address  =  trim(SUBSTR(n_address,1,LENGTH(n_address) - n_length)).
            END.
            IF INDEX(n_address,"ต." ) <> 0 THEN DO: 
                ASSIGN 
                n_tambon   =  trim(SUBSTR(n_address,INDEX(n_address,"ต."),LENGTH(n_address)))
                n_length   =  LENGTH(n_tambon)
                n_address  =  trim(SUBSTR(n_address,1,LENGTH(n_address) - n_length)).
            END.
            ELSE IF INDEX(n_address,"ตำบล" ) <> 0 THEN DO: 
                ASSIGN 
                n_tambon   =  trim(SUBSTR(n_address,INDEX(n_address,"ตำบล"),LENGTH(n_address)))
                n_length   =  LENGTH(n_tambon)
                n_address  =  trim(SUBSTR(n_address,1,LENGTH(n_address) - n_length)).
            END.
            ELSE IF INDEX(n_address,"แขวง" ) <> 0 THEN DO: 
                ASSIGN 
                n_tambon   =  trim(SUBSTR(n_address,INDEX(n_address,"แขวง"),LENGTH(n_address)))
                n_length   =  LENGTH(n_tambon)
                n_address  =  trim(SUBSTR(n_address,1,LENGTH(n_address) - n_length)).
            END.
            ELSE IF INDEX(n_address,"ขว." ) <> 0 THEN DO: 
                ASSIGN 
                n_tambon   =  trim(SUBSTR(n_address,INDEX(n_address,"ขว."),LENGTH(n_address)))
                n_length   =  LENGTH(n_tambon)
                n_address  =  trim(SUBSTR(n_address,1,LENGTH(n_address) - n_length)).
                
            END.
       
            ASSIGN  n_build  = trim(n_address).
            ASSIGN  wdetail.addr    = TRIM(n_build)  
                    wdetail.tambon  = trim(n_tambon) 
                    wdetail.amper   = trim(n_amper) 
                    wdetail.country = trim(n_country) 
                    wdetail.post    = TRIM(n_post) .
       END.
/* comment by : A64-0309
IF LENGTH(wdetail.addr) > 35 THEN DO:
    loop_add01:
    DO WHILE LENGTH(wdetail.addr) > 35 :
        IF R-INDEX(wdetail.addr," ") <> 0 THEN DO:
            ASSIGN 
                wdetail.tambon  = trim(SUBSTR(wdetail.addr,r-INDEX(wdetail.addr," "))) + " " + wdetail.tambon
                wdetail.addr    = trim(SUBSTR(wdetail.addr,1,r-INDEX(wdetail.addr," "))).
        END.
        ELSE LEAVE loop_add01.
    END.
    /*wdetail.tambon*/
    IF LENGTH(wdetail.tambon) > 35 THEN DO:
        loop_add02:
        DO WHILE LENGTH(wdetail.tambon) > 35 :
            IF R-INDEX(wdetail.tambon," ") <> 0 THEN DO:
                ASSIGN 
                    wdetail.amper    = trim(SUBSTR(wdetail.tambon,r-INDEX(wdetail.tambon," "))) + " " + wdetail.amper
                    wdetail.tambon   = trim(SUBSTR(wdetail.tambon,1,r-INDEX(wdetail.tambon," "))).
            END.
            ELSE LEAVE loop_add02.
        END.
    END.
    /*wdetail.amper*/
    IF LENGTH(wdetail.amper) > 35 THEN DO:
        loop_add03:
        DO WHILE LENGTH(wdetail.amper) > 35 :
            IF R-INDEX(wdetail.amper," ") <> 0 THEN DO:
                ASSIGN 
                    wdetail.country = trim(SUBSTR(wdetail.amper,r-INDEX(wdetail.amper," "))) + " " + wdetail.country
                    wdetail.amper   = trim(SUBSTR(wdetail.amper,1,r-INDEX(wdetail.amper," "))).
            END.
            ELSE LEAVE loop_add03.
        END.
    END.
END.
ELSE DO:
    /*wdetail.tambon*/
    IF LENGTH(wdetail.tambon + " " + wdetail.amper ) <= 35 THEN  
        ASSIGN 
        wdetail.tambon   = wdetail.tambon + " " + wdetail.amper 
        wdetail.amper    = wdetail.country
        wdetail.country  = "" .
    ELSE IF LENGTH(wdetail.amper + " " + wdetail.country) <= 35 THEN  
        ASSIGN 
        wdetail.amper    = wdetail.amper + " " + wdetail.country
        wdetail.country  = "" .
END.
..end A64-0309..*/
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_adduwd132 C-Win 
PROCEDURE proc_adduwd132 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DEF VAR nv_campaign AS CHAR FORMAT "x(20)" INIT "" . /*A62-0493*/

DEF BUFFER wf_uwd132 FOR sic_bran.uwd132.
DO:
    FIND sic_bran.uwm100 WHERE RECID(sic_bran.uwm100) = s_recid1 NO-WAIT NO-ERROR.
    FIND sic_bran.uwm130 WHERE RECID(sic_bran.uwm130) = s_recid3 NO-WAIT NO-ERROR.
    
    ASSIGN nv_bptr = 0      nv_gapprm   = 0     nv_pdprm    = 0 
           /* A64-0309 */ 
           nv_411t = 0      nv_412t = 0
           nv_42t  = 0      nv_43t  = 0 
           /* end : A64-0309 */ 
           nv_ry31 = 0 .
                         
     FOR EACH stat.pmuwd132 USE-INDEX pmuwd13201 WHERE 
              stat.pmuwd132.campcd        = trim(wdetail.packcod)   AND 
              /*TRIM(stat.pmuwd132.policy)  = TRIM(nv_polmaster)  NO-LOCK.*/      /*A64-0044*/
              TRIM(stat.pmuwd132.policy)  = TRIM(wdetail.polmaster)  NO-LOCK.    /*A64-0044*/
        FIND sic_bran.uwd132  USE-INDEX uwd13201 WHERE
             sic_bran.uwd132.policy  = sic_bran.uwm100.policy AND
             sic_bran.uwd132.rencnt  = sic_bran.uwm100.rencnt AND
             sic_bran.uwd132.endcnt  = sic_bran.uwm100.endcnt AND
             sic_bran.uwd132.riskgp  = sic_bran.uwm130.riskgp AND
             sic_bran.uwd132.riskno  = sic_bran.uwm130.riskno AND
             sic_bran.uwd132.itemno  = sic_bran.uwm130.itemno AND
             sic_bran.uwd132.bchyr   = nv_batchyr             AND
             sic_bran.uwd132.bchno   = nv_batchno             AND
             sic_bran.uwd132.bchcnt  = nv_batcnt              AND 
             sic_bran.uwd132.bencod  = stat.pmuwd132.bencod      NO-ERROR NO-WAIT.
   
            IF NOT AVAILABLE sic_bran.uwd132 THEN DO:
                CREATE sic_bran.uwd132.

               ASSIGN fi_process = "Create data to sic_bran.uwd132  ..." + wdetail.policy .
               DISP fi_process WITH FRAM fr_main. 
               ASSIGN
                  sic_bran.uwd132.bencod  =  stat.pmuwd132.bencod 
                  sic_bran.uwd132.benvar  =  stat.pmuwd132.benvar 
                  sic_bran.uwd132.rate    =  stat.pmuwd132.rate                     
                  sic_bran.uwd132.gap_ae  =  NO /*stat.pmuwd132.gap_ae --A64-0355--*/                
                  sic_bran.uwd132.gap_c   =  stat.pmuwd132.gap_c                    
                  sic_bran.uwd132.dl1_c   =  stat.pmuwd132.dl1_c                    
                  sic_bran.uwd132.dl2_c   =  stat.pmuwd132.dl2_c                    
                  sic_bran.uwd132.dl3_c   =  stat.pmuwd132.dl3_c                    
                  sic_bran.uwd132.pd_aep  =  "E" /*stat.pmuwd132.pd_aep --A64-0355--*/                      
                  sic_bran.uwd132.prem_c  =  stat.pmuwd132.prem_c                   
                  sic_bran.uwd132.fptr    =  0                   
                  sic_bran.uwd132.bptr    =  nv_bptr                   
                  sic_bran.uwd132.policy  =  sic_bran.uwm100.policy 
                  sic_bran.uwd132.rencnt  =  sic_bran.uwm100.rencnt                    
                  sic_bran.uwd132.endcnt  =  sic_bran.uwm100.endcnt                    
                  sic_bran.uwd132.riskgp  =  sic_bran.uwm130.riskgp                 
                  sic_bran.uwd132.riskno  =  sic_bran.uwm130.riskno                 
                  sic_bran.uwd132.itemno  =  sic_bran.uwm130.itemno                 
                  sic_bran.uwd132.rateae  =  stat.pmuwd132.rateae                  
                  sic_bran.uwd132.bchyr   =  nv_batchyr                   
                  sic_bran.uwd132.bchno   =  nv_batchno 
                  sic_bran.uwd132.bchcnt  =  nv_batcnt.
               
                  nv_gapprm = nv_gapprm + stat.pmuwd132.gap_c .
                  nv_pdprm  = nv_pdprm + stat.pmuwd132.prem_C.

               IF sic_bran.uwd132.bencod = "SI"   THEN ASSIGN sic_bran.uwd132.benvar = nv_sivar .
               IF sic_bran.uwd132.bencod = "dspc" THEN ASSIGN nv_dss_per  = DECI(SUBSTRING(sic_bran.uwd132.benvar,31,30)).
               IF sic_bran.uwd132.bencod = "NCB"  THEN ASSIGN nv_ncbper   = DECI(SUBSTRING(sic_bran.uwd132.benvar,31,30)).

               IF sic_bran.uwd132.bencod = "BI1"  THEN ASSIGN wdetail.comper   = int(SUBSTRING(sic_bran.uwd132.benvar,31,30)) .
               IF sic_bran.uwd132.bencod = "BI2"  THEN ASSIGN wdetail.comacc   = int(SUBSTRING(sic_bran.uwd132.benvar,31,30)) .
               IF sic_bran.uwd132.bencod = "PD"   THEN ASSIGN wdetail.deductpd = int(SUBSTRING(sic_bran.uwd132.benvar,31,30)) .
               if sic_bran.uwm130.uom1_v <> int(wdetail.comper)   then assign sic_bran.uwm130.uom1_v = int(wdetail.comper)   .
               if sic_bran.uwm130.uom2_v <> int(wdetail.comacc)   then assign sic_bran.uwm130.uom2_v = int(wdetail.comacc)   .
               if sic_bran.uwm130.uom5_v <> int(wdetail.deductpd) then assign sic_bran.uwm130.uom5_v = int(wdetail.deductpd) .

               IF sic_bran.uwd132.bencod = "SI" AND wdetail.covcod = "2"  THEN ASSIGN SUBSTRING(sic_bran.uwd132.benvar,31,30) = "0". /* A66-0202*/

               /* add by : Ranu I. A64-0309 05/08/2021 */
               IF sic_bran.uwd132.bencod = "411"  THEN ASSIGN  nv_411t = stat.pmuwd132.prem_C  wdetail.NO_411 = int(SUBSTRING(sic_bran.uwd132.benvar,31,30)).  
               IF sic_bran.uwd132.bencod = "412"  THEN ASSIGN  nv_412t = stat.pmuwd132.prem_C  wdetail.NO_412 = int(SUBSTRING(sic_bran.uwd132.benvar,31,30)).  
               IF sic_bran.uwd132.bencod = "42"   THEN ASSIGN  nv_42t  = stat.pmuwd132.prem_C  wdetail.NO_42  = int(SUBSTRING(sic_bran.uwd132.benvar,31,30)).  
               IF sic_bran.uwd132.bencod = "43"   THEN ASSIGN  nv_43t  = stat.pmuwd132.prem_C  wdetail.NO_43  = int(SUBSTRING(sic_bran.uwd132.benvar,31,30)).   
               IF sic_bran.uwd132.bencod = "31"   THEN ASSIGN  nv_ry31 = stat.pmuwd132.prem_c  . /*A68-0044*/

               IF sic_bran.uwd132.bencod = "FLET" AND TRIM(stat.pmuwd132.benvar) = "" THEN DO:
                   ASSIGN sic_bran.uwd132.benvar = "     Fleet Discount %  =      10 " .
               END.
               /* end A64-0309 */
               /* A64-0257 */
               IF SUBSTR(sic_bran.uwd132.bencod,1,3) = "GRP" AND wdetail.cargrp <> "" THEN DO:
                   ASSIGN   sic_bran.uwd132.bencod = nv_grpcod
                            sic_bran.uwd132.benvar = nv_grpvar .
               END.
               /* end A64-0257*/
               If nv_ncbper  <> 0 Then do:
                   Find LAST sicsyac.xmm104 Use-index xmm10401 Where
                       sicsyac.xmm104.tariff = nv_tariff           AND
                       sicsyac.xmm104.class  = nv_class            AND 
                       sicsyac.xmm104.covcod = nv_covcod           AND 
                       sicsyac.xmm104.ncbper   = INTE(nv_ncbper) No-lock no-error no-wait.
                   IF not avail  sicsyac.xmm104  Then do:
                       Message " This NCB Step not on NCB Rates file xmm104. " View-as alert-box.
                       ASSIGN wdetail.pass    = "N"
                           wdetail.comment = wdetail.comment + "| This NCB Step not on NCB Rates file xmm104. ".
                   END.
                   ELSE ASSIGN nv_ncbper = xmm104.ncbper   
                               nv_ncbyrs = xmm104.ncbyrs.
               END.
               Else do:  
                   ASSIGN nv_ncbyrs =   0
                       nv_ncbper    =   0
                       nv_ncb       =   0.
               END.
               ASSIGN   
                sic_bran.uwm301.ncbper   = nv_ncbper
                sic_bran.uwm301.ncbyrs   = nv_ncbyrs .

               IF nv_bptr <> 0 THEN DO:
                   FIND wf_uwd132 WHERE RECID(wf_uwd132) = nv_bptr.
                       wf_uwd132.fptr = RECID(sic_bran.uwd132).
               END.
               IF nv_bptr = 0 THEN sic_bran.uwm130.fptr03  =  RECID(sic_bran.uwd132).
               nv_bptr = RECID(sic_bran.uwd132).

            END.
        END.
    RUN proc_chkRY. /*A64-0309*/
    sic_bran.uwm130.bptr03  =  nv_bptr. 
    RELEASE stat.pmuwd132.
    RELEASE sic_bran.uwd132.
END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_adduwd132Plus C-Win 
PROCEDURE proc_adduwd132Plus :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DEF BUFFER wf_uwd132 FOR sic_bran.uwd132.
DO:
    FIND sic_bran.uwm100 WHERE RECID(sic_bran.uwm100) = s_recid1 NO-WAIT NO-ERROR.
    FIND sic_bran.uwm130 WHERE RECID(sic_bran.uwm130) = s_recid3 NO-WAIT NO-ERROR.
   
    ASSIGN nv_bptr = 0      nv_gapprm   = 0     nv_pdprm    = 0
           /* A64-0309 */ 
           nv_411t = 0      nv_412t = 0
           nv_42t  = 0      nv_43t  = 0.
           /* end : A64-0309 */ 

     FOR EACH stat.pmuwd132 USE-INDEX pmuwd13201 WHERE 
              stat.pmuwd132.campcd        = trim(wdetail.packcod)  AND 
              TRIM(stat.pmuwd132.policy)  = TRIM(wdetail.polmaster)  NO-LOCK.  /*A64-0044*/
              /*TRIM(stat.pmuwd132.policy)  = TRIM(nv_polmaster)  NO-LOCK.*/ /*A64-0044*/
        FIND LAST sic_bran.uwd132  USE-INDEX uwd13201 WHERE
             sic_bran.uwd132.policy  = sic_bran.uwm100.policy AND
             sic_bran.uwd132.rencnt  = sic_bran.uwm100.rencnt AND
             sic_bran.uwd132.endcnt  = sic_bran.uwm100.endcnt AND
             sic_bran.uwd132.riskgp  = sic_bran.uwm130.riskgp AND
             sic_bran.uwd132.riskno  = sic_bran.uwm130.riskno AND
             sic_bran.uwd132.itemno  = sic_bran.uwm130.itemno AND
             sic_bran.uwd132.bchyr   = nv_batchyr             AND
             sic_bran.uwd132.bchno   = nv_batchno             AND
             sic_bran.uwd132.bchcnt  = nv_batcnt              AND 
             sic_bran.uwd132.bencod  = stat.pmuwd132.bencod      NO-ERROR NO-WAIT.
   
            IF NOT AVAILABLE sic_bran.uwd132 THEN DO:
                CREATE sic_bran.uwd132.

               ASSIGN fi_process = "Create data to sic_bran.uwd132  ..." + wdetail.policy .
               DISP fi_process WITH FRAM fr_main. 
               ASSIGN
                  sic_bran.uwd132.bencod  =  stat.pmuwd132.bencod 
                  sic_bran.uwd132.benvar  =  stat.pmuwd132.benvar 
                  sic_bran.uwd132.rate    =  stat.pmuwd132.rate                     
                  sic_bran.uwd132.gap_ae  =  NO /*stat.pmuwd132.gap_ae --a64-0355--*/                  
                  sic_bran.uwd132.gap_c   =  stat.pmuwd132.gap_c                    
                  sic_bran.uwd132.dl1_c   =  stat.pmuwd132.dl1_c                    
                  sic_bran.uwd132.dl2_c   =  stat.pmuwd132.dl2_c                    
                  sic_bran.uwd132.dl3_c   =  stat.pmuwd132.dl3_c                    
                  sic_bran.uwd132.pd_aep  =  "E"  /*stat.pmuwd132.pd_aep --a64-0355--*/                   
                  sic_bran.uwd132.prem_c  =  stat.pmuwd132.prem_c                   
                  sic_bran.uwd132.fptr    =  0                   
                  sic_bran.uwd132.bptr    =  nv_bptr                   
                  sic_bran.uwd132.policy  =  sic_bran.uwm100.policy 
                  sic_bran.uwd132.rencnt  =  sic_bran.uwm100.rencnt                    
                  sic_bran.uwd132.endcnt  =  sic_bran.uwm100.endcnt                    
                  sic_bran.uwd132.riskgp  =  sic_bran.uwm130.riskgp                 
                  sic_bran.uwd132.riskno  =  sic_bran.uwm130.riskno                 
                  sic_bran.uwd132.itemno  =  sic_bran.uwm130.itemno                 
                  sic_bran.uwd132.rateae  =  stat.pmuwd132.rateae                  
                  sic_bran.uwd132.bchyr   =  nv_batchyr                   
                  sic_bran.uwd132.bchno   =  nv_batchno 
                  sic_bran.uwd132.bchcnt  =  nv_batcnt.
               
                  nv_gapprm = nv_gapprm + stat.pmuwd132.gap_c .
                  nv_pdprm  = nv_pdprm  + stat.pmuwd132.prem_C.
              
               IF sic_bran.uwd132.bencod = "SI"           THEN ASSIGN sic_bran.uwd132.benvar = nv_sivar .
               
               IF sic_bran.uwd132.bencod = "dspc" THEN ASSIGN nv_dss_per  = DECI(SUBSTRING(sic_bran.uwd132.benvar,31,30)).
               IF sic_bran.uwd132.bencod = "NCB"  THEN ASSIGN nv_ncbper   = DECI(SUBSTRING(sic_bran.uwd132.benvar,31,30)).

               IF sic_bran.uwd132.bencod = "BI1"  THEN ASSIGN wdetail.comper   = int(SUBSTRING(sic_bran.uwd132.benvar,31,30)) .
               IF sic_bran.uwd132.bencod = "BI2"  THEN ASSIGN wdetail.comacc   = int(SUBSTRING(sic_bran.uwd132.benvar,31,30)) .
               IF sic_bran.uwd132.bencod = "PD"   THEN ASSIGN wdetail.deductpd = int(SUBSTRING(sic_bran.uwd132.benvar,31,30)) .
               if sic_bran.uwm130.uom1_v <> int(wdetail.comper)   then assign sic_bran.uwm130.uom1_v = int(wdetail.comper)   .
               if sic_bran.uwm130.uom2_v <> int(wdetail.comacc)   then assign sic_bran.uwm130.uom2_v = int(wdetail.comacc)   .
               if sic_bran.uwm130.uom5_v <> int(wdetail.deductpd) then assign sic_bran.uwm130.uom5_v = int(wdetail.deductpd) .

               IF sic_bran.uwd132.bencod = "SI" AND wdetail.covcod = "2"  THEN ASSIGN SUBSTRING(sic_bran.uwd132.benvar,31,30) = "0". /* A66-0202*/

               /* add by : Ranu I. A64-0309 05/08/2021 */
               IF sic_bran.uwd132.bencod = "411"  THEN ASSIGN  nv_411t = stat.pmuwd132.prem_C  wdetail.NO_411 = int(SUBSTRING(sic_bran.uwd132.benvar,31,30)).  
               IF sic_bran.uwd132.bencod = "412"  THEN ASSIGN  nv_412t = stat.pmuwd132.prem_C  wdetail.NO_412 = int(SUBSTRING(sic_bran.uwd132.benvar,31,30)).  
               IF sic_bran.uwd132.bencod = "42"   THEN ASSIGN  nv_42t  = stat.pmuwd132.prem_C  wdetail.NO_42  = int(SUBSTRING(sic_bran.uwd132.benvar,31,30)).  
               IF sic_bran.uwd132.bencod = "43"   THEN ASSIGN  nv_43t  = stat.pmuwd132.prem_C  wdetail.NO_43  = int(SUBSTRING(sic_bran.uwd132.benvar,31,30)).   
               
               IF sic_bran.uwd132.bencod = "FLET" AND stat.pmuwd132.benvar = " "  THEN 
                   ASSIGN sic_bran.uwd132.benvar = "     Fleet Discount %  =      10" .
               /* end A64-0309 */
                
                /* A64-0257 */
               IF SUBSTR(sic_bran.uwd132.bencod,1,3) = "GRP" AND wdetail.cargrp <> "" THEN DO:
                   ASSIGN   sic_bran.uwd132.bencod = nv_grpcod
                            sic_bran.uwd132.benvar = nv_grpvar .
               END.
               /* end A64-0257 */
               
               If nv_ncbper  <> 0 Then do:
                   Find LAST sicsyac.xmm104 Use-index xmm10401 Where
                       sicsyac.xmm104.tariff = nv_tariff           AND
                       sicsyac.xmm104.class  = nv_class            AND 
                       sicsyac.xmm104.covcod = nv_covcod           AND 
                       sicsyac.xmm104.ncbper   = INTE(nv_ncbper) No-lock no-error no-wait.
                   IF not avail  sicsyac.xmm104  Then do:
                       Message " This NCB Step not on NCB Rates file xmm104. " View-as alert-box.
                       ASSIGN wdetail.pass    = "N"
                           wdetail.comment = wdetail.comment + "| This NCB Step not on NCB Rates file xmm104. ".
                   END.
                   ELSE ASSIGN nv_ncbper = xmm104.ncbper   
                               nv_ncbyrs = xmm104.ncbyrs.
               END.
               Else do:  
                   ASSIGN nv_ncbyrs =   0
                       nv_ncbper    =   0
                       nv_ncb       =   0.
               END.
               ASSIGN   
                sic_bran.uwm301.ncbper   = nv_ncbper
                sic_bran.uwm301.ncbyrs   = nv_ncbyrs .

               IF nv_bptr <> 0 THEN DO:
                   FIND wf_uwd132 WHERE RECID(wf_uwd132) = nv_bptr.
                       wf_uwd132.fptr = RECID(sic_bran.uwd132).
               END.
               IF nv_bptr = 0 THEN sic_bran.uwm130.fptr03  =  RECID(sic_bran.uwd132).
               nv_bptr = RECID(sic_bran.uwd132).

            END.
        END.
    RUN proc_chkRY . /* A64-0309 */

    sic_bran.uwm130.bptr03  =  nv_bptr. 
    RELEASE stat.pmuwd132.
    RELEASE sic_bran.uwd132.
END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_adduwd132prem C-Win 
PROCEDURE proc_adduwd132prem :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes: add by A64-0355       
------------------------------------------------------------------------------*/
DEF BUFFER wf_uwd132 FOR sic_bran.uwd132.
DO:
    FIND sic_bran.uwm100 WHERE RECID(sic_bran.uwm100) = s_recid1 NO-WAIT NO-ERROR.
    FIND sic_bran.uwm130 WHERE RECID(sic_bran.uwm130) = s_recid3 NO-WAIT NO-ERROR.

    ASSIGN nv_bptr = 0      nv_gapprm   = 0     nv_pdprm    = 0 
           nv_411t = 0      nv_412t = 0         nv_42t  = 0      nv_43t  = 0    nv_ry31 = 0 . /*A68-0044*/

     FOR EACH stat.pmuwd132 USE-INDEX pmuwd13201 WHERE 
              /*stat.pmuwd132.campcd    = sic_bran.uwm100.policy AND*/ /*A68-0061*/
              stat.pmuwd132.policy    = sic_bran.uwm100.policy AND
              stat.pmuwd132.rencnt    = sic_bran.uwm100.rencnt AND
              stat.pmuwd132.endcnt    = sic_bran.uwm100.endcnt AND
              stat.pmuwd132.txt1      = STRING(nv_batchyr,"9999") AND
              stat.pmuwd132.txt2      = nv_batchno             .
        FIND sic_bran.uwd132  USE-INDEX uwd13201 WHERE
             sic_bran.uwd132.policy  = sic_bran.uwm100.policy AND
             sic_bran.uwd132.rencnt  = sic_bran.uwm100.rencnt AND
             sic_bran.uwd132.endcnt  = sic_bran.uwm100.endcnt AND
             sic_bran.uwd132.riskgp  = sic_bran.uwm130.riskgp AND
             sic_bran.uwd132.riskno  = sic_bran.uwm130.riskno AND
             sic_bran.uwd132.itemno  = sic_bran.uwm130.itemno AND
             sic_bran.uwd132.bchyr   = nv_batchyr             AND
             sic_bran.uwd132.bchno   = nv_batchno             AND
             sic_bran.uwd132.bchcnt  = nv_batcnt              AND 
             sic_bran.uwd132.bencod  = stat.pmuwd132.bencod    NO-ERROR NO-WAIT.

            IF NOT AVAILABLE sic_bran.uwd132 THEN DO:
                CREATE sic_bran.uwd132.

               ASSIGN fi_process = "Create data to sic_bran.uwd132  ..." + wdetail.policy .
               DISP fi_process WITH FRAM fr_main. 
               ASSIGN
                  sic_bran.uwd132.bencod  =  stat.pmuwd132.bencod 
                  sic_bran.uwd132.benvar  =  stat.pmuwd132.benvar 
                  sic_bran.uwd132.rate    =  stat.pmuwd132.rate                     
                  sic_bran.uwd132.gap_ae  =  NO /*stat.pmuwd132.gap_ae --A64-0355--*/                     
                  sic_bran.uwd132.gap_c   =  stat.pmuwd132.gap_c                    
                  sic_bran.uwd132.dl1_c   =  stat.pmuwd132.dl1_c                    
                  sic_bran.uwd132.dl2_c   =  stat.pmuwd132.dl2_c                    
                  sic_bran.uwd132.dl3_c   =  stat.pmuwd132.dl3_c                    
                  sic_bran.uwd132.pd_aep  =  "E" /*stat.pmuwd132.pd_aep --A64-0355--*/                   
                  sic_bran.uwd132.prem_c  =  stat.pmuwd132.prem_c                  
                  sic_bran.uwd132.fptr    =  0                   
                  sic_bran.uwd132.bptr    =  nv_bptr                   
                  sic_bran.uwd132.policy  =  sic_bran.uwm100.policy 
                  sic_bran.uwd132.rencnt  =  sic_bran.uwm100.rencnt                    
                  sic_bran.uwd132.endcnt  =  sic_bran.uwm100.endcnt                    
                  sic_bran.uwd132.riskgp  =  sic_bran.uwm130.riskgp                 
                  sic_bran.uwd132.riskno  =  sic_bran.uwm130.riskno                 
                  sic_bran.uwd132.itemno  =  sic_bran.uwm130.itemno                 
                  sic_bran.uwd132.rateae  =  stat.pmuwd132.rateae                  
                  sic_bran.uwd132.bchyr   =  nv_batchyr                   
                  sic_bran.uwd132.bchno   =  nv_batchno 
                  sic_bran.uwd132.bchcnt  =  nv_batcnt.

                  nv_gapprm = nv_gapprm + stat.pmuwd132.gap_c .
                  nv_pdprm  = nv_pdprm  + stat.pmuwd132.prem_C.
                  
               IF sic_bran.uwd132.bencod = "SI" AND wdetail.covcod = "2"  THEN ASSIGN SUBSTRING(sic_bran.uwd132.benvar,31,30) = "0". /* A66-0202*/
              
               
               IF SUBSTR(sic_bran.uwd132.bencod,1,3) = "GRP" AND wdetail.cargrp <> "" THEN DO:
                   ASSIGN   sic_bran.uwd132.bencod = nv_grpcod
                            sic_bran.uwd132.benvar = nv_grpvar .
               END.
               IF sic_bran.uwd132.bencod = "NCB" THEN ASSIGN nv_ncbper   = DECI(SUBSTRING(sic_bran.uwd132.benvar,31,30)). 
               
               IF sic_bran.uwd132.bencod = "411"  THEN ASSIGN  nv_411t = stat.pmuwd132.prem_C  wdetail.NO_411 = int(SUBSTRING(sic_bran.uwd132.benvar,31,30)).  
               IF sic_bran.uwd132.bencod = "412"  THEN ASSIGN  nv_412t = stat.pmuwd132.prem_C  wdetail.NO_412 = int(SUBSTRING(sic_bran.uwd132.benvar,31,30)).  
               IF sic_bran.uwd132.bencod = "42"   THEN ASSIGN  nv_42t  = stat.pmuwd132.prem_C  wdetail.NO_42  = int(SUBSTRING(sic_bran.uwd132.benvar,31,30)).  
               IF sic_bran.uwd132.bencod = "43"   THEN ASSIGN  nv_43t  = stat.pmuwd132.prem_C  wdetail.NO_43  = int(SUBSTRING(sic_bran.uwd132.benvar,31,30)).
               IF sic_bran.uwd132.bencod = "31"   THEN ASSIGN  nv_ry31 = stat.pmuwd132.prem_c  . /*A68-0044*/
               
               IF sic_bran.uwd132.bencod = "FLET" AND stat.pmuwd132.benvar = " "  THEN 
                   ASSIGN sic_bran.uwd132.benvar = "     Fleet Discount %  =      10" .
               /* end A64-0309 */

               IF nv_bptr <> 0 THEN DO:
                   FIND wf_uwd132 WHERE RECID(wf_uwd132) = nv_bptr.
                       wf_uwd132.fptr = RECID(sic_bran.uwd132).
               END.
               IF nv_bptr = 0 THEN sic_bran.uwm130.fptr03  =  RECID(sic_bran.uwd132).
               nv_bptr = RECID(sic_bran.uwd132).

            END. /* end uwd132*/
            /* add : A64-0355 */
            If nv_ncbper  <> 0 Then do:
               Find LAST sicsyac.xmm104 Use-index xmm10401 Where
                   sicsyac.xmm104.tariff = nv_tariff           AND
                   sicsyac.xmm104.class  = nv_class            AND 
                   sicsyac.xmm104.covcod = nv_covcod           AND 
                   sicsyac.xmm104.ncbper   = INTE(nv_ncbper) No-lock no-error no-wait.
               IF not avail  sicsyac.xmm104  Then do:
                   Message " This NCB Step not on NCB Rates file xmm104. " View-as alert-box.
                   ASSIGN wdetail.pass    = "N"
                          wdetail.comment = wdetail.comment + "| This NCB Step not on NCB Rates file xmm104. ".
               END.
               ELSE ASSIGN nv_ncbper = xmm104.ncbper   
                           nv_ncbyrs = xmm104.ncbyrs.
            END.
            Else do:  
               ASSIGN nv_ncbyrs    =   0
                      nv_ncbper    =   0
                      nv_ncb       =   0.
            END.
            ASSIGN   
                sic_bran.uwm301.ncbper   = nv_ncbper
                sic_bran.uwm301.ncbyrs   = nv_ncbyrs .
            
            DELETE stat.pmuwd132 .  
            /* end A64-0355 */
    END. /* end pmuwd132 */
    RUN proc_chkRY . /* A64-0309 */
    sic_bran.uwm130.bptr03  =  nv_bptr. 
    RELEASE stat.pmuwd132.
    RELEASE sic_bran.uwd132.
    RELEASE sic_bran.uwm100.
    RELEASE sic_bran.uwm130.

END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_assign2 C-Win 
PROCEDURE proc_assign2 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DEF VAR  b_eng    AS DECI FORMAT  ">>>>9.99-".
DEF VAR  n_addr   AS CHAR FORMAT "x(500)" INIT "" .
DEF VAR  n_date   AS CHAR FORMAT  "x(10)".
DEF BUFFER bfwdetail FOR wdetail.  /* A67-0029*/
FOR EACH wdetail WHERE wdetail.policyno NE " "  .
    /* comment by : A64-0355...
    IF wdetail.engcc <> 0  THEN DO:
        ASSIGN 
            b_eng            = round((DECI(wdetail.engcc) / 1000),1)     /*format engcc */
            b_eng            = b_eng * 1000
            wdetail.engcc    = b_eng.
    END.*/
        ASSIGN 
        n_addr           = "" 
        nv_chkerror      = ""
        nv_polday        = 0.

        IF ra_type  = 2 THEN DO:
            IF wdetail.prepol <> " " AND wdetail.poltyp = "V70" THEN RUN proc_assignrenew.  
        END.
        IF ra_poltyp = 2 AND wdetail.compul <> "Y" THEN DO:
            ASSIGN wdetail.compul = "Y" .
        END.
        RUN proc_cutchar.
        /*IF TRIM(wdetail.nv_insref) <> "" THEN  RUN proc_chkinscode . /* A64-0355 */ */ /*A65-0043*/

        IF wdetail.provcod  = ""  OR wdetail.distcod  = ""  OR wdetail.sdistcod = "" THEN DO:
            n_addr = trim(wdetail.addr  + " " + wdetail.tambon + " " + wdetail.amper + " " + wdetail.country)  .
            RUN wgw/wgwchkaddr(INPUT n_addr ,
                               OUTPUT wdetail.provcod , 
                               OUTPUT wdetail.distcod , 
                               OUTPUT wdetail.sdistcod,
                               OUTPUT nv_chkerror) .
            IF nv_chkerror <> ""  THEN 
                ASSIGN wdetail.comment = wdetail.comment + "|" + nv_chkerror 
                       wdetail.pass    = "N"
                       WDETAIL.OK_GEN  = "N".
        END.
        /*RUN proc_address. */ /*A64-0309*/
        IF wdetail.vehreg = "" THEN DO:
            IF ra_type = 1 THEN DO:
                IF LENGTH(wdetail.chasno) < 9  THEN
                    ASSIGN wdetail.vehreg   = "/" + TRIM(wdetail.chasno) 
                       wdetail.re_country  = "" .
                /*ELSE ASSIGN wdetail.vehreg   = "/" + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 9) */  /*A65-0043*/
                ELSE ASSIGN wdetail.vehreg   = "/" + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 8)       /*A65-0043*/
                            wdetail.re_country  = "" .
            END.
        END.
        IF TRIM(wdetail.re_country) <> "" THEN DO: 
            FIND LAST brstat.insure USE-INDEX Insure05   WHERE   /*use-index fname */
                brstat.insure.FName = TRIM(wdetail.re_country) AND
                brstat.insure.compno = "999" NO-LOCK NO-WAIT NO-ERROR.
            IF AVAIL brstat.insure THEN 
                ASSIGN wdetail.re_country = trim(Insure.LName) .
        END.
        RELEASE brstat.insure.
        
        RUN proc_chktest0.
        /* check Redbook */
        IF wdetail.redbook = ""  THEN DO:
            ASSIGN fi_process = "check Redbook " + wdetail.riskno + " " + wdetail.chasno + ".....".
            DISP fi_process WITH FRAM fr_main.

            /*IF wdetail.covcod <> "1" THEN nv_si = INT(wdetail.siplus)  .*//* A65-0079*/
            IF wdetail.covcod <> "1" THEN nv_si = IF INT(wdetail.siplus) <> 0 THEN INT(wdetail.siplus) ELSE INT(wdetail.si) . /* A65-0079*/
            ELSE nv_si = INT(wdetail.si).
            /*RUN wgw/wgwredbook(input  wdetail.brand ,  */ /*A65-0079*/
             /* add by :A67-0029 */
             IF INDEX(wdetail.subclass,"E") <> 0   THEN DO:
                  RUN wgw/wgwredbev(input wdetail.brand ,      
                                   input  wdetail.model ,  
                                   input  nv_si ,  
                                   INPUT  wdetail.tariff,  
                                   input  wdetail.subclass,   
                                   input  wdetail.yrmanu, 
                                   input  wdetail.watt,
                                   input  0 , 
                                   INPUT-OUTPUT wdetail.maksi,
                                   INPUT-OUTPUT wdetail.redbook) .
             END.
             ELSE DO: /* end :A67-0029 */
                RUN wgw/wgwredbk1(input  wdetail.brand , /*A65-0079*/
                                  input  wdetail.model ,  
                                  input  nv_si         ,  
                                  INPUT  wdetail.tariff,  
                                  input  wdetail.subclass,   
                                  input  wdetail.yrmanu, 
                                  input  wdetail.engcc  ,
                                  input  wdetail.weight , 
                                  INPUT-OUTPUT wdetail.redbook) .
             END.
              /* add:A67-0029 */
             IF wdetail.cr_2 <> "" AND wdetail.redbook <> ""  THEN DO:
                 FIND LAST bfwdetail WHERE bfwdetail.policy = wdetail.cr_2 AND bfwdetail.poltyp = "V72" NO-ERROR NO-WAIT.
                    IF AVAIL bfwdetail THEN DO: 
                        ASSIGN bfwdetail.redbook = IF bfwdetail.redbook = "" THEN wdetail.redbook ELSE bfwdetail.redbook.
                    END.
                    RELEASE bfwdetail.
             END.
              /* end :A67-0029 */
        END.
        /* add by : A65-0079 */
        ELSE DO:
            IF INT(wdetail.rencnt) = 0 AND ra_poltyp <> 2 THEN DO:
                Find First stat.maktab_fil USE-INDEX maktab04    Where
                   stat.maktab_fil.modcod   = trim(wdetail.redbook)  AND 
                   stat.maktab_fil.sclass   = wdetail.subclass       No-lock no-error no-wait.
                  If NOT AVAIL stat.maktab_fil  THEN DO:
                      ASSIGN wdetail.comment = wdetail.comment + "|" + "ไม่พบ Redbook Code:" + wdetail.redbook + " ของ Class : " + 
                                               wdetail.subclass + " ที่ระบุมาในไฟล์" 
                             wdetail.redbook = "" .
                  END.
            END.
            ELSE IF INT(wdetail.rencnt) > 0 THEN DO:
                FIND FIRST stat.maktab_fil USE-INDEX maktab01  WHERE 
                           stat.maktab_fil.modcod = wdetail.redbook   No-lock no-error no-wait.
                  If NOT AVAIL stat.maktab_fil  THEN DO:
                    ASSIGN wdetail.comment = wdetail.comment + "|" + "ไม่พบ Redbook Code:" + wdetail.redbook + " ที่ระบุมาในไฟล์ " 
                           wdetail.redbook = "" .
                  END.
            END.
            IF wdetail.redbook = "" THEN DO:
                IF wdetail.covcod <> "1" THEN nv_si = IF INT(wdetail.siplus) <> 0 THEN INT(wdetail.siplus) ELSE INT(wdetail.si) .
                ELSE nv_si = INT(wdetail.si).
                 /* add by :A67-0029 */
                IF INDEX(wdetail.subclass,"E") <> 0   THEN DO:
                     RUN wgw/wgwredbev(input wdetail.brand ,      
                                      input  wdetail.model ,  
                                      input  nv_si ,  
                                      INPUT  wdetail.tariff,  
                                      input  wdetail.subclass,   
                                      input  wdetail.yrmanu, 
                                      input  wdetail.watt,
                                      input  0 , 
                                      INPUT-OUTPUT wdetail.maksi,
                                      INPUT-OUTPUT wdetail.redbook) .
                END.
                ELSE DO: /* end :A67-0029 */
                   RUN wgw/wgwredbk1(input  wdetail.brand , /*A65-0079*/
                                     input  wdetail.model ,  
                                     input  nv_si         ,  
                                     INPUT  wdetail.tariff,  
                                     input  wdetail.subclass,   
                                     input  wdetail.yrmanu, 
                                     input  wdetail.engcc  ,
                                     input  wdetail.weight , 
                                     INPUT-OUTPUT wdetail.redbook) .
                END.
                 /* add:A67-0029 */
                IF wdetail.cr_2 <> "" AND wdetail.redbook <> ""  THEN DO:
                    FIND LAST bfwdetail WHERE bfwdetail.policy = wdetail.cr_2 AND bfwdetail.poltyp = "V72" NO-ERROR NO-WAIT.
                       IF AVAIL bfwdetail THEN do: 
                           ASSIGN bfwdetail.redbook = IF bfwdetail.redbook = "" THEN wdetail.redbook ELSE bfwdetail.redbook.
                       END.
                       RELEASE bfwdetail.
                END.
                 /* end :A67-0029 */
            END.
        END.
        /* end A65-0079*/
        /* add by : A64-0355 */
        IF wdetail.instot > 1 THEN DO:
            FIND FIRST winst WHERE winst.policyno = wdetail.policyno NO-LOCK NO-ERROR.
            IF AVAIL winst THEN DO:
                IF winst.instot = 2 AND winst.instprm2 = 0 THEN DO:
                     ASSIGN wdetail.comment = wdetail.comment + "| กรมธรรม์มี " + STRING(winst.instot) + " ใบเสร็จ/กรุณาตรวจสอบเบี้ยของใบเสร็จ " 
                       wdetail.pass    = "N"
                       WDETAIL.OK_GEN  = "N".
                END.
                ELSE IF winst.instot = 3 AND (winst.instprm2 = 0 OR winst.instprm3 = 0 ) THEN DO:
                     ASSIGN wdetail.comment = wdetail.comment + "| กรมธรรม์มี " + STRING(winst.instot) + " ใบเสร็จ/กรุณาตรวจสอบเบี้ยของใบเสร็จ "
                            wdetail.pass    = "N"
                            WDETAIL.OK_GEN  = "N".
                END.
            END.
        END.
         /*  end : A64-0355 */
        RUN proc_susspect.  /*Add by Kridtiya i. A63-0419 */
       
END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_assigndata C-Win 
PROCEDURE proc_assigndata :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:  A67-0029   
------------------------------------------------------------------------------*/
DO:
INPUT FROM VALUE(fi_FileName).
    REPEAT:
    IMPORT DELIMITER "|" 
        wf_riskno    /* risk no */  /*--A64-0355--*/
        wf_num       /*ItemNo                     */                  
        wf_policyno  /*Policy No (เลขที่กรมธรรม์ภาคสมัครใจ)     */      
        wf_n_branch  /*Branch (สาขา)              */      
        wf_agent     /*Agent Code (รหัสตัวแทน)    */      
        wf_producer  /*Producer Code              */      
        wf_n_delercode /*Dealer Code (รหัสดีเลอร์)  */      
        wf_fincode   /*Finance Code (รหัสไฟแนนซ์) */      
        wf_appenno   /*Notification Number (เลขที่รับแจ้ง)*/      
        wf_salename  /*Notification Name (ชื่อผู้แจ้ง)    */      
        wf_srate     /*Short Rate                 */      
        wf_comdat    /*Effective Date (วันที่เริ่มความคุ้มครอง) */      
        wf_expdat    /*Expiry Date (วันที่สิ้นสุดความคุ้มครอง)  */      
        wf_agreedat  /*Agree Date    */      
        wf_firstdat  /*First Date    */      
        wf_packcod   /*รหัส Package  */          
        wf_camp_no   /*Campaign Code (รหัสแคมเปญ) */      
        wf_campen    /*Campaign Text */      
        wf_specon    /*Spec Con      */      
        wf_product   /*Product Type  */      
        wf_promo     /*Promotion Code*/      
        wf_rencnt    /*Renew Count   */      
        wf_prepol    /*Previous Policy (เลขทีกรมธรรม์ภาคสมัครใจเดิม)*/  
        wf_txt1      /*Policy Text 1  */                                
        wf_txt2      /*Policy Text 2  */                                
        wf_txt3      /*Policy Text 3  */                                
        wf_txt4      /*Policy Text 4  */                                
        wf_txt5      /*Policy Text 5  */                                
        wf_txt6      /*Policy Text 6  */                                
        wf_txt7      /*Policy Text 7  */                                
        wf_txt8      /*Policy Text 8  */                                
        wf_txt9      /*Policy Text 9  */                                
        wf_txt10     /*Policy Text 10 */                                
        wf_memo1     /*Memo Text 1    */                                
        wf_memo2     /*Memo Text 2    */                                
        wf_memo3     /*Memo Text 3    */                                
        wf_memo4     /*Memo Text 4    */                                
        wf_memo5     /*Memo Text 5    */                                
        wf_memo6     /*Memo Text 6    */                                
        wf_memo7     /*Memo Text 7    */                                
        wf_memo8     /*Memo Text 8    */                                
        wf_memo9     /*Memo Text 9    */                                
        wf_memo10    /*Memo Text 10   */                                
        wf_accdata1  /*Accessory Text 1 */                              
        wf_accdata2  /*Accessory Text 2 */                              
        wf_accdata3  /*Accessory Text 3 */                              
        wf_accdata4  /*Accessory Text 4 */                                  
        wf_accdata5  /*Accessory Text 5 */                                  
        wf_accdata6  /*Accessory Text 6 */                                  
        wf_accdata7  /*Accessory Text 7 */                                  
        wf_accdata8  /*Accessory Text 8 */                                  
        wf_accdata9  /*Accessory Text 9 */                                  
        wf_accdata10 /*Accessory Text 10*/                                  
        wf_compul   /*กรมธรรม์ซื้อควบ (Y/N)  */ 
        wf_insref   /* insured code */ /* A64-0355 */
        wf_instyp   /*ประเภทบุคคล            */                            
        wf_inslang  /*ภาษาที่ใช้สร้าง Cilent Code */         
        wf_tiname   /*คำนำหน้า   */         
        wf_insnam   /*ชื่อ       */         
        wf_lastname /*นามสกุล    */                            
        wf_icno     /*เลขที่บัตรประชาชน / เลขที่นิติบุคคล*/         
        wf_insbr    /*ลำดับที่สาขา      */                            
        wf_occup    /*อาชีพ             */                            
        wf_addr     /*ที่อยู่บรรทัดที่ 1*/                            
        wf_tambon   /*ที่อยู่บรรทัดที่ 2*/                            
        wf_amper    /*ที่อยู่บรรทัดที่ 3*/                            
        wf_country  /*ที่อยู่บรรทัดที่ 4*/                            
        wf_post     /*รหัสไปรษณีย์      */                            
        wf_provcod  /*province code     */                            
        wf_distcod  /*district code     */                            
        wf_sdistcod /*sub district code */   
        wf_ae       /* ae  new Xmm600 งาน Japanes */  /*A64-0355*/
        wf_jtl      /* jtl new Xmm600 งาน Japanes */  /*A64-0355*/
        wf_ts       /* ts  new Xmm600 งาน Japanes */  /*A64-0355*/
        wf_gender   /*Gender (Male/Female/Other) */         
        wf_tele1    /*Telephone 1*/                            
        wf_tele2    /*Telephone 2*/                            
        wf_mail1    /*E-Mail 1   */                            
        wf_mail2    /*E-Mail 2   */                            
        wf_mail3    /*E-Mail 3   */                            
        wf_mail4    /*E-Mail 4   */                            
        wf_mail5    /*E-Mail 5   */                            
        wf_mail6    /*E-Mail 6   */                            
        wf_mail7    /*E-Mail 7   */                            
        wf_mail8    /*E-Mail 8   */                            
        wf_mail9    /*E-Mail 9   */                            
        wf_mail10   /*E-Mail 10  */                            
        wf_fax      /*Fax      */                            
        wf_lineID   /*Line ID  */                            
        wf_name2    /*CareOf1  */                            
        wf_name3    /*CareOf2  */                            
        wf_benname  /*Benefit Name*/                            
        wf_payercod /*Payer Code  */                            
        wf_vatcode  /*VAT Code    */                            
        wf_instcod1 /*Client Code */                            
        wf_insttyp1 /*ประเภทบุคคล */                            
        wf_insttitle1 /*คำนำหน้า    */                            
        wf_instname1  /*ชื่อ        */                            
        wf_instlname1 /*นามสกุล     */                            
        wf_instic1    /*เลขที่บัตรประชาชน / เลขที่นิติบุคคล       */         
        wf_instbr1    /*ลำดับที่สาขา       */                           
        wf_instaddr11 /*ที่อยู่บรรทัดที่ 1 */                 
        wf_instaddr21 /*ที่อยู่บรรทัดที่ 2 */                 
        wf_instaddr31 /*ที่อยู่บรรทัดที่ 3 */                 
        wf_instaddr41 /*ที่อยู่บรรทัดที่ 4 */                 
        wf_instpost1  /* รหัสไปรษณีย์      */                 
        wf_instprovcod1  /*province code      */                 
        wf_instdistcod1  /*district code      */                 
        wf_instsdistcod1 /*sub district code  */                 
        wf_instprm1   /*เบี้ยก่อนภาษีอากร  */                 
        wf_instrstp1  /*อากร    */                 
        wf_instrtax1  /*ภาษี    */                 
        wf_instcomm01 /*คอมมิชชั่น 1 */                 
        wf_instcomm12 /*คอมมิชชั่น 2 (co-broker) */           
        wf_instcod2   /*Client Code  */                 
        wf_insttyp2   /*ประเภทบุคคล  */                 
        wf_insttitle2 /*คำนำหน้า*/                 
        wf_instname2  /*ชื่อ    */                 
        wf_instlname2 /*นามสกุล */                 
        wf_instic2    /*เลขที่บัตรประชาชน / เลขที่นิติบุคคล*/     
        wf_instbr2    /*ลำดับที่สาขา      */                 
        wf_instaddr12 /*ที่อยู่บรรทัดที่ 1*/                 
        wf_instaddr22 /*ที่อยู่บรรทัดที่ 2*/                 
        wf_instaddr32 /*ที่อยู่บรรทัดที่ 3*/                 
        wf_instaddr42 /*ที่อยู่บรรทัดที่ 4*/                 
        wf_instpost2  /*รหัสไปรษณีย์      */                 
        wf_instprovcod2  /*province code     */                 
        wf_instdistcod2  /*district code     */                 
        wf_instsdistcod2 /*sub district code */                 
        wf_instprm2   /*เบี้ยก่อนภาษีอากร */                 
        wf_instrstp2  /*อากร    */                 
        wf_instrtax2  /*ภาษี    */                 
        wf_instcomm02 /*คอมมิชชั่น 1 */                 
        wf_instcomm22 /*คอมมิชชั่น 2 (co-broker)     */           
        wf_instcod3   /*Client Code  */                 
        wf_insttyp3   /*ประเภทบุคคล  */                 
        wf_insttitle3 /*คำนำหน้า*/                 
        wf_instname3  /*ชื่อ    */                 
        wf_instlname3 /*นามสกุล */                 
        wf_instic3    /*เลขที่บัตรประชาชน/เลขที่นิติบุคคล  */   
        wf_instbr3    /*ลำดับที่สาขา      */                
        wf_instaddr13 /*ที่อยู่บรรทัดที่ 1*/                
        wf_instaddr23 /*ที่อยู่บรรทัดที่ 2*/                
        wf_instaddr33 /*ที่อยู่บรรทัดที่ 3*/                
        wf_instaddr43 /*ที่อยู่บรรทัดที่ 4*/                
        wf_instpost3  /*รหัสไปรษณีย์      */                
        wf_instprovcod3  /*province code     */                
        wf_instdistcod3  /*district code     */                
        wf_instsdistcod3 /*sub district code */                
        wf_instprm3   /*เบี้ยก่อนภาษีอากร*/                
        wf_instrstp3  /*อากร   */                
        wf_instrtax3  /*ภาษี   */        
        wf_instcomm03 /*คอมมิชชั่น 1*/          
        wf_instcomm23 /*คอมมิชชั่น 2 (co-broker)          */
        wf_covcod  /*Cover Type (ประเภทความคุ้มครอง)   */
        wf_garage  /*Garage (ประเภทการซ่อม ซ่อมอู่/ซ่อมห้าง)  */
        wf_special /*Spacial EquipmentFlag(A/Blank)*/       
        wf_inspec  /*Inspection       */                
        wf_class70 /*รหัสรถภาคสมัครใจ (110/120/)   */ 
        wf_vehuse  /* A64-0355 : vehuse 15/12/2021 */
        wf_redbook /*A65-0079*/
        wf_brand   /*ยี่ห้อรถ         */                
        wf_model   /*ชื่อรุ่นรถ       */                
        wf_submodel /*ชื่อรุ่นย่อยรถ   */                
        wf_caryear /*ปีรุ่นรถ         */                
        wf_chasno  /*หมายเลขตัวถัง    */                
        wf_eng     /*หมายเลขเครื่อง   */ 
        wf_eng_no2 /*หมายเลขเครื่อง 2 */ /*A67-0029*/
        wf_seat    /*จำนวนที่นั่ง (รวมผู้ขับขี่)    */       
        wf_engcc   /*ปริมาตรกระบอกสูบ (CC) */                
        wf_weight  /*น้ำหนัก (ตัน) */ 
        wf_watt    /*Kilowatt      */ 
        wf_body    /*รหัสแบบตัวถัง */ 
        wf_type    /*ป้ายแดง (Y/N) */ 
        wf_re_year /*ปีที่จดทะเบียน*/ 
        wf_vehreg  /*เลขทะเบียนรถ  */ 
        wf_re_country  /*จังหวัดที่จดทะเบียน*/ 
        wf_cargrp   /*Group Car (กลุ่มรถ)*/ 
        wf_colorcar /*Color (สี)  */ 
        wf_fule     /*Fule (เชื้อเพลิง) */ 
        wf_drivnam  /*Driver Number     */
        wf_ntitle1  /*คำนำหน้า    */ 
        wf_drivername1 /*ชื่อ     */ 
        wf_dname2   /*นามสกุล     */  
        wf_dicno    /*เลขที่บัตรประชาชน */  
        wf_dgender1 /*เพศ         */  
        wf_dbirth   /*วันเกิด     */  
        wf_doccup   /*ชื่ออาชีพ   */  
        wf_ddriveno /*เลขที่ใบอนุญาตขับขี่  */ 
        wf_drivexp1 /*วันที่ใบอนุญาต หมดอายุ */  /*A67-0029*/
        wf_dconsen1  /*A67-0029*/
        wf_dlevel1  /*ระดับพฤติกรรมการขับขี่ */  /*A67-0029*/
        wf_ntitle2  /*คำนำหน้า  */  
        wf_drivername2 /*ชื่อ   */  
        wf_ddname1  /*นามสกุล   */  
        wf_ddicno   /*เลขที่บัตรประชาชน */  
        wf_dgender2 /*เพศ       */  
        wf_ddbirth  /*วันเกิด   */  
        wf_ddoccup  /*ชื่ออาชีพ */  
        wf_dddriveno /*เลขที่ใบอนุญาตขับขี่  */ 
        wf_drivexp2  /*วันที่ใบอนุญาต หมดอายุ */ 
        wf_dconsen2  /*A67-0029*/   
        wf_dlevel2   /*ระดับพฤติกรรมการขับขี่ */
        wf_ntitle3   /*คำนำหน้า */  
        wf_dname3    /*ชื่อ     */  
        wf_dlname3   /*นามสกุล  */  
        wf_dicno3    /*เลขที่บัตรประชาชน     */ 
        wf_dgender3  /*เพศ      */  
        wf_dbirth3   /*วันเกิด  */  
        wf_doccup3   /*ชื่ออาชีพ*/  
        wf_ddriveno3 /*เลขที่ใบอนุญาตขับขี่  */ 
        wf_drivexp3  /*วันที่ใบอนุญาต หมดอายุ*/
        wf_dconsen3  /*A67-0029*/
        wf_dlevel3   /*ระดับพฤติกรรมการขับขี่*/ 
        wf_ntitle4   /*คำนำหน้า   */     
        wf_dname4    /*ชื่อ       */     
        wf_dlname4   /*นามสกุล    */     
        wf_dicno4    /*เลขที่บัตรประชาชน */ 
        wf_dgender4  /*เพศ        */     
        wf_dbirth4   /*วันเกิด    */     
        wf_doccup4   /*ชื่ออาชีพ  */     
        wf_ddriveno4 /*เลขที่ใบอนุญาตขับขี่  */ 
        wf_drivexp4  /*วันที่ใบอนุญาต หมดอายุ*/ 
        wf_dconsen4  /*A67-0029*/        
        wf_dlevel4   /*ระดับพฤติกรรมการขับขี่*/
        wf_ntitle5   /*คำนำหน้า   */     
        wf_dname5    /*ชื่อ       */     
        wf_dlname5   /*นามสกุล    */     
        wf_dicno5    /*เลขที่บัตรประชาชน */ 
        wf_dgender5  /*เพศ        */     
        wf_dbirth5   /*วันเกิด    */ 
        wf_doccup5   /*ชื่ออาชีพ  */ 
        wf_ddriveno5 /*เลขที่ใบอนุญาตขับขี่  */ 
        wf_drivexp5  /*วันที่ใบอนุญาต หมดอายุ*/ 
        wf_dconsen5  /*A67-0029*/
        wf_dlevel5   /*ระดับพฤติกรรมการขับขี่*/ 
        wf_baseplus /*Base Premium Plus */  
        wf_siplus   /*Sum Insured Plus  */  
        wf_rs10     /*RS10 Amount   */  
        wf_comper   /*TPBI / person */  
        wf_comacc   /*TPBI / occurrence */  
        wf_deductpd /*TPPD          */  
        wf_DOD      /*Deduct / OD   */  
        wf_dod1     /* Add / OD */  /*A67-0029*/
        wf_DPD      /*Deduct / PD   */  
        wf_maksi    /* ทุนประกันรถ EV */ /*A67-0029*/
        wf_tpfire   /*Theft & Fire      */  
        wf_NO_41    /*PA1.1 / driver    */  
        wf_ac2      /*PA1.1 no.of passenger */  
        wf_ac4      /*PA1.1 / passenger */  
        wf_ac5      /*PA1.2 / driver    */  
        wf_ac6      /*PA1.2 no.of passenger */  
        wf_ac7      /*PA1.2 / passenger*/  
        wf_NO_42    /*PA2    */  
        wf_NO_43    /*PA3    */  
        wf_base     /*Base Premium */  
        wf_unname   /*Unname */  
        wf_nname    /*Name   */  
        wf_tpbi     /*TPBI/Person Amount  */ 
        wf_bi2       /*TPBI/Accident amt */  /*A67-0029*/
        wf_tppd     /*TPPD Amount  */
        wf_dodamt   /*Deduct / OD Amount*/  /*A67-0029*/
        wf_dod1amt  /*Add / OD Amount   */  /*A67-0029*/
        wf_dpdamt   /*Deduct / PD Amount*/  /*A67-0029*/
        wf_ry01     /*RY01 Amount 411  */ 
        wf_ry412    /*RY01 Amount 412  */   /*A67-0029*/ 
        wf_ry413    /*RY01 Amount 413  */   /*A67-0029*/ 
        wf_ry414    /*RY01 Amount 414  */   /*A67-0029*/ 
        wf_ry02     /*RY02 Amount  */  
        wf_ry03     /*RY03 Amount  */  
        wf_fleet    /*Fleet%       */  
        wf_ncb      /*NCB%         */  
        wf_claim    /*Load Claim%  */  
        wf_dspc     /*Other Disc.% */  
        wf_cctv     /*CCTV%        */  
        wf_dstf     /*Walkin Disc.%*/  
        wf_fleetprem /*Fleet Amount */  
        wf_ncbprem   /*NCB Amount   */  
        wf_clprem    /*Load Claim Amount*/  
        wf_dspcprem  /*Other Disc. Amount */ 
        wf_cctvprem  /*CCTV Amount  */  
        wf_dstfprem  /*Walk in Disc.Amount */ 
        wf_premt     /*เบี้ยสุทธิ   */  
        wf_rstp_t    /*Stamp Duty   */  
        wf_rtax_t    /*VAT          */  
        wf_comper70  /*Commission % */  
        wf_comprem70 /*Commission Amount*/  
        wf_agco70    /*Agent Code co-broker (รหัสตัวแทน)*/      
        wf_comco_per70  /*Commission % co-broker*/              
        wf_comco_prem70 /*Commission Amount co-broker*/         
        wf_dgpackge     /*Package (Attach Coverage)  */         
        wf_danger1      /*Dangerous Object 1*/              
        wf_danger2      /*Dangerous Object 2*/              
        wf_dgsi         /*Sum Insured */    
        wf_dgrate       /*Rate%       */    
        wf_dgfeet       /*Fleet%      */    
        wf_dgncb        /*NCB%        */    
        wf_dgdisc       /*Discount%   */    
        wf_dgwdisc      /*Walkin Discount%  */          
        wf_dgatt        /*Premium Attach Coverage */            
        wf_dgfeetprm    /*Discount Fleet  */              
        wf_dgncbprm     /*Discount NCB    */              
        wf_dgdiscprm    /*Other Discount  */ 
        wf_dgWdiscprm   /*walkin Discount  */ 
        wf_dgprem    /*Net Premium  */              
        wf_dgrstp_t  /*Stamp Duty   */              
        wf_dgrtax_t  /*VAT          */              
        wf_dgcomper  /*Commission % */              
        wf_dgcomprem /*Commission Amount */                                                   
        wf_cltxt     /*Claim Text   */   
        wf_clamount  /*Claim Amount */   
        wf_faultno   /*Claim Count Fault */                           
        wf_faultprm  /*Claim Count Fault Amount   */                      
        wf_goodno    /*Claim Count Good           */                      
        wf_goodprm   /*Claim Count Good Amount    */                      
        wf_loss      /*Loss Ratio % (Not TP)      */                      
        wf_compolusory     /*Compulsory Policy Number (เลขที่กรมธรรม์ พรบ.)*/   
        wf_comdat72  /* วันที่คุ้มครอง 72 */  /*F67-0001*/
        wf_expdat72  /* วันที่หมดอายุ 72 */   /*F67-0001*/
        wf_barcode  /*Barcode No.                    */                  
        wf_class72  /*Compulsory Class (รหัส พรบ.)   */                  
        wf_dstf72   /*Compulsory Walk In Discount %  */                  
        wf_dstfprem72      /*Compulsory Walk In Discount Amount      */         
        wf_premt72  /*เบี้ยสุทธิ พ.ร.บ. กรณี "กรมธรรม์ซื้อควบ"*/       
        wf_rstp_t72 /*Stamp Duty   */                         
        wf_rtax_t72 /*VAT          */                         
        wf_comper72 /*Commission % */                         
        wf_comprem72 /*Commission Amount     */
        wf_battno    /*เลขที่แบตเตอรี่   */  
        wf_battyr    /*ปีแบตฯ    */  
        wf_battprice /*ราคาแบตฯ  */ 
        wf_battsi     /* ทุน */ 
        wf_battrate   /*Rate  */
        wf_battprm   /*Premium   */  
        wf_chargno   /*เลขที่เครื่องชาร์จ*/  
        wf_chargsi   /*ราคาเครื่องชาร์จ  */  
        wf_chargrate /*Rate     */  
        wf_chargprm  /*Premium */
        wf_31rate   /* Rate 31  --A68-0044-- */
        wf_31prmt . /* เบี้ย 31 --A68-0044-- */
        RUN proc_assigndata2.
    END.
END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_assigndata2 C-Win 
PROCEDURE proc_assigndata2 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes: add by A67-0029     
------------------------------------------------------------------------------*/
DO:
    IF      TRIM(wf_num) = ""           THEN RUN proc_initdataex.
    ELSE IF index(TRIM(wf_num),"no")     <> 0 THEN RUN proc_initdataex.
    ELSE IF index(TRIM(wf_num),"เลขที่") <> 0 THEN RUN proc_initdataex.
    ELSE IF index(TRIM(wf_num),"item")   <> 0 THEN RUN proc_initdataex.
    ELSE DO:
        IF ra_match = 2 THEN RUN proc_runningpol_2.
        ELSE DO:
            IF      ra_poltyp = 1 THEN RUN proc_assigninit70.
            ELSE IF ra_poltyp = 2 THEN RUN proc_assigninit72.
            ELSE DO:
                IF wf_compul = "Y"  THEN DO:
                    RUN proc_assigninit70.
                    RUN proc_assigninit72.
                END.
                ELSE RUN proc_assigninit70.
            END.
        END.
        RUN proc_initdataex.
    END.
END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_assigninit70 C-Win 
PROCEDURE proc_assigninit70 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes: /* A67-0029 */     
------------------------------------------------------------------------------*/
DEF VAR n_chkbr AS CHAR FORMAT "x(2)" INIT "" . 
DO:
    ASSIGN fi_process = "Create data text file " + wf_chasno + " to wdetail ....." .
    DISP fi_process WITH FRAM fr_main.
    CREATE wdetail.
    CREATE wtxt.
    CREATE wmemo.
    CREATE wacces.
    CREATE winst.
    CREATE wdrive. 
    ASSIGN
        wdetail.riskno        =  trim(wf_riskno)   
        wdetail.itemno        =  trim(wf_num)
        wdetail.policyno      =  trim(wf_policyno) 
        wdetail.n_branch      =  trim(wf_n_branch)        
        wdetail.agent         =  trim(wf_agent)           
        wdetail.producer      =  trim(wf_producer)        
        wdetail.n_delercode   =  trim(wf_n_delercode)   
        wdetail.fincode       =  trim(wf_fincode)   
        wdetail.appenno       =  trim(wf_appenno)   
        wdetail.salename      =  trim(wf_salename)   
        wdetail.srate         =  trim(wf_srate ) 
        wdetail.comdat        =  date(wf_comdat)                                        
        wdetail.expdat        =  date(wf_expdat)                                        
        wdetail.agreedat      =  if trim(wf_agreedat) = "" and wf_prepol = "" then date(wf_comdat) else if trim(wf_agreedat) <> "" then date(wf_agreedat)  ELSE ? 
        wdetail.firstdat      =  if trim(wf_firstdat) = "" and wf_prepol = "" then date(wf_comdat) else if trim(wf_firstdat) <> "" then date(wf_firstdat)  ELSE ? 
        wdetail.packcod       =  trim(wf_packcod)   
        wdetail.camp_no       =  trim(wf_camp_no)   
        wdetail.campen        =  trim(wf_campen) 
        wdetail.specon        =  trim(wf_specon) 
        wdetail.product       =  trim(wf_product )   
        wdetail.promo         =  trim(wf_promo )   
        wdetail.rencnt        =  TRIM(wf_rencnt)   
        wdetail.prepol        =  trim(wf_prepol)
        wdetail.compul        =  trim(wf_compul) 
        wdetail.instyp        =  trim(wf_instyp) 
        wdetail.nv_insref     =  TRIM(wf_insref)  
        wdetail.inslang       =  trim(wf_inslang)  
        wdetail.tiname        =  trim(wf_tiname) 
        wdetail.insnam        =  trim(wf_insnam) 
        wdetail.lastname      =  trim(wf_lastname)  
        wdetail.icno          =  trim(wf_icno)  
        wdetail.insbr         =  trim(wf_insbr) 
        wdetail.occup         =  trim(wf_occup) 
        wdetail.addr          =  trim(wf_addr)
        wdetail.tambon        =  trim(wf_tambon) 
        wdetail.amper         =  trim(wf_amper) 
        wdetail.country       =  trim(wf_country )  
        wdetail.post          =  trim(wf_post ) 
        wdetail.provcod       =  trim(wf_provcod)  
        wdetail.distcod       =  trim(wf_distcod)  
        wdetail.sdistcod      =  IF trim(wf_sdistcod) <> "" AND LENGTH(wf_sdistcod) > 2 THEN SUBSTR(wf_sdistcod,1,2) ELSE TRIM(wf_sdistcod) 
        wdetail.jpae          =  trim(wf_ae)    
        wdetail.jpjtl         =  trim(wf_jtl)   
        wdetail.jpts          =  trim(wf_ts)    
        wdetail.gender        =  trim(wf_gender)
        wdetail.tele1         =  trim(wf_tele1) 
        wdetail.tele2         =  trim(wf_tele2) 
        wdetail.mail1         =  trim(wf_mail1) 
        wdetail.mail2         =  trim(wf_mail2) 
        wdetail.mail3         =  trim(wf_mail3) 
        wdetail.mail4         =  trim(wf_mail4) 
        wdetail.mail5         =  trim(wf_mail5) 
        wdetail.mail6         =  trim(wf_mail6)  
        wdetail.mail7         =  trim(wf_mail7)  
        wdetail.mail8         =  trim(wf_mail8)  
        wdetail.mail9         =  trim(wf_mail9)  
        wdetail.mail10        =  trim(wf_mail10)  
        wdetail.fax           =  trim(wf_fax)  
        wdetail.lineID        =  trim(wf_lineID)  
        wdetail.name2         =  trim(wf_name2)  
        wdetail.name3         =  trim(wf_name3)  
        wdetail.benname       =  trim(wf_benname) 
        wdetail.payercod      =  trim(wf_payercod)  
        wdetail.vatcode       =  trim(wf_vatcode )
        wdetail.covcod        =  trim(wf_covcod )  
        wdetail.garage        =  trim(wf_garage )  
        wdetail.special       =  trim(wf_special)  
        wdetail.inspec        =  trim(wf_inspec )  
        wdetail.class70       =  trim(wf_class70)
        wdetail.redbook       =  TRIM(wf_redbook)  /*A65-0079*/
        wdetail.brand         =  trim(wf_brand)  
        wdetail.model         =  trim(wf_model)  
        wdetail.submodel      =  trim(wf_submodel)  
        wdetail.yrmanu        =  trim(wf_caryear)  
        wdetail.chasno        =  trim(wf_chasno )  
        wdetail.eng           =  trim(wf_eng)  
        wdetail.seat          =  INTE(wf_seat)  
        wdetail.engcc         =  INTE(wf_engcc)  
        wdetail.weight        =  DECI(wf_weight) 
        wdetail.watt          =  DECI(wf_watt)    /*A66-0202*/
        wdetail.body          =  trim(wf_body )  
        wdetail.typ           =  trim(wf_type )  
        wdetail.re_year       =  trim(wf_re_year)  
        wdetail.vehreg        =  trim(wf_vehreg )  
        wdetail.re_country    =  trim(wf_re_country)
        wdetail.cargrp        =  trim(wf_cargrp )   
        wdetail.colorcar      =  trim(wf_colorcar )
        wdetail.fule          =  trim(wf_fule) .
      ASSIGN 
        wdetail.drivnam       =  IF trim(wf_drivnam) = "" THEN "0" ELSE  trim(wf_drivnam)  /*A67-0212*/ 
        wdetail.baseplus      =  INTE(wf_baseplus)  
        wdetail.siplus        =  int(wf_siplus)
        wdetail.rs10          =  int(wf_rs10)   
        wdetail.comper        =  if trim(wf_comper)  = "U" then 999999999 else  int(wf_comper)    
        wdetail.comacc        =  if trim(wf_comacc)  = "U" then 999999999 else  int(wf_comacc)    
        wdetail.deductpd      =  if trim(wf_deductpd)= "U" then 999999999 else  int(wf_deductpd)   
        wdetail.DOD           =  int(wf_DOD)
        wdetail.dod1          =  INT(wf_dod1)  
        wdetail.DPD           =  int(wf_DPD)   
        wdetail.si            =  int(wf_tpfire) 
        wdetail.NO_411        =  IF trim(wf_NO_41) = "" THEN (-1) ELSE int(wf_NO_41 ) 
        wdetail.seat41        =  IF int(wf_ac2) <> 0 THEN int(wf_ac2) + 1 ELSE INTE(wf_seat) 
        wdetail.NO_412        =  if trim(wf_ac4) = "" then (-1) else int(wf_ac4) 
        wdetail.NO_413        =  int(wf_ac5)  
        wdetail.ac6           =  int(wf_ac6)   
        wdetail.NO_414        =  int(wf_ac7) 
        wdetail.NO_42         =  if trim(wf_NO_42) = "" then (-1) else int(wf_NO_42)  
        wdetail.NO_43         =  if trim(wf_NO_43) = "" then (-1) else int(wf_NO_43)  
        wdetail.base          =  int(wf_base)
        wdetail.unname        =  deci(wf_unname) 
        wdetail.nname         =  deci(wf_nname) 
        wdetail.tpbi          =  deci(wf_tpbi) 
        wdetail.bi2           =  DECI(wf_bi2) /*A67-0029*/
        wdetail.tppd          =  deci(wf_tppd)
        wdetail.dod_prm       =  deci(wf_dodamt)  /*A67-0029*/
        wdetail.dod1_prm      =  deci(wf_dod1amt) /*A67-0029*/
        wdetail.dpd_prm       =  deci(wf_dpdamt)  /*A67-0029*/
        wdetail.ry01          =  deci(wf_ry01)
        wdetail.ry412         =  deci(wf_ry412) /*A67-0029*/    
        wdetail.ry413         =  deci(wf_ry413) /*A67-0029*/
        wdetail.ry414         =  deci(wf_ry414) /*A67-0029*/
        wdetail.ry02          =  deci(wf_ry02)   
        wdetail.ry03          =  deci(wf_ry03) 
        wdetail.fleet         =  trim(wf_fleet)   
        wdetail.ncb           =  trim(wf_ncb)
        wdetail.claim         =  trim(wf_claim)   
        wdetail.dspc          =  trim(wf_dspc)   
        wdetail.cctv          =  trim(wf_cctv)   
        wdetail.dstf          =  trim(wf_dstf)   
        wdetail.fleetprem     =  deci(wf_fleetprem)
        wdetail.ncbprem       =  deci(wf_ncbprem)   
        wdetail.clprem        =  deci(wf_clprem )   
        wdetail.dspcprem      =  deci(wf_dspcprem) 
        wdetail.cctvprem      =  deci(wf_cctvprem) 
        wdetail.dstfprem      =  deci(wf_dstfprem) 
        wdetail.premt         =  deci(wf_premt )   
        wdetail.rstp_t        =  deci(wf_rstp_t)   
        wdetail.rtax_t        =  deci(wf_rtax_t)   
        wdetail.comper70      =  IF trim(wf_comper70)  =  " " THEN (-1) ELSE deci(wf_comper70)    /* ค่าว่างใส่ -1 ดึง comm ตามระบบ  ถ้าระบุ 0 ไม่มีค่าคอม */
        wdetail.comprem70     =  IF trim(wf_comprem70) =  " " THEN (-1) ELSE deci(wf_comprem70)  /* ค่าว่างใส่ -1 คำนวณ comm ตามระบบ ถ้าระบุ 0 ไม่มีค่าคอม */
        wdetail.agco70        =  trim(wf_agco70 )  
        wdetail.comco_per70   =  IF trim(wf_comco_per70)  =  " " THEN (-1) ELSE deci(wf_comco_per70) 
        wdetail.comco_prem70  =  IF trim(wf_comco_prem70) =  " " THEN (-1) ELSE deci(wf_comco_prem70)
        wdetail.dgpackge      =  trim(wf_dgpackge)
        wdetail.danger1       =  trim(wf_danger1)   
        wdetail.danger2       =  trim(wf_danger2)   
        wdetail.dgsi          =  inte(wf_dgsi)
        wdetail.dgrate        =  trim(wf_dgrate)   
        wdetail.dgfeet        =  trim(wf_dgfeet)   
        wdetail.dgncb         =  trim(wf_dgncb )   
        wdetail.dgdisc        =  trim(wf_dgdisc)  
        wdetail.dgwdisc       =  trim(wf_dgwdisc) 
        wdetail.dgatt         =  INTE(wf_dgatt)    
        wdetail.dgfeetprm     =  deci(wf_dgfeetprm)
        wdetail.dgncbprm      =  deci(wf_dgncbprm) 
        wdetail.dgdiscprm     =  deci(wf_dgdiscprm) 
        wdetail.dgWdiscprm    =  deci(wf_dgWdiscprm) 
        wdetail.dgprem        =  deci(wf_dgprem)
        wdetail.dgrstp_t      =  deci(wf_dgrstp_t) 
        wdetail.dgrtax_t      =  deci(wf_dgrtax_t) 
        wdetail.dgcomper      =  deci(wf_dgcomper) 
        wdetail.dgcomprem     =  deci(wf_dgcomprem)
        wdetail.cltxt         =  trim(wf_cltxt )
        wdetail.clamount      =  inte(wf_clamount)
        wdetail.faultno       =  inte(wf_faultno)  
        wdetail.faultprm      =  inte(wf_faultprm)  
        wdetail.goodno        =  inte(wf_goodno)  
        wdetail.goodprm       =  inte(wf_goodprm)  
        wdetail.loss          =  inte(wf_loss)  
        wdetail.compolusory   =  trim(wf_compolusory)
        wdetail.stk           =  trim(wf_barcode)  
        wdetail.class72       =  trim(wf_class72)  
        wdetail.dstf72        =  trim(wf_dstf72 )  
        wdetail.dstfprem72    =  deci(wf_dstfprem72)
        wdetail.premt72       =  deci(wf_premt72 )  
        wdetail.rstp_t72      =  deci(wf_rstp_t72)  
        wdetail.rtax_t72      =  deci(wf_rtax_t72)  
        wdetail.comper72      =  deci(wf_comper72)  
        wdetail.comprem72     =  deci(wf_comprem72) 
        wdetail.vehuse        =  trim(wf_vehuse) . /* ranu : vehuse 15/12/2021 */
        ASSIGN 
        wdetail.poltyp        = "V70"
        wdetail.prempa        = IF LENGTH(wdetail.class70) = 5 THEN SUBSTR(wdetail.class70,1,1)                                                       
                                ELSE IF LENGTH(wdetail.class70) = 4 AND SUBSTR(wdetail.class70,4,1) <> "E" THEN SUBSTR(wdetail.class70,1,1)                   
                                ELSE TRIM(fi_pack)                                                                                            
        wdetail.subclass      = IF LENGTH(wdetail.class70) = 5 THEN SUBSTR(wdetail.class70,2,4)                                                       
                                ELSE IF LENGTH(wdetail.class70) = 4 AND SUBSTR(wdetail.class70,4,1) <> "E" THEN SUBSTR(wdetail.class70,2,3) 
                                ELSE wdetail.class70
        wdetail.dspc          = IF DECI(wdetail.dspc) = 0  THEN TRIM(wdetail.cctv)  ELSE string(DECI(wdetail.dspc) + DECI(wdetail.cctv))
        wdetail.dspcprem      = IF deci(wf_dspcprem) = 0 THEN deci(wf_cctvprem) ELSE deci(wf_dspcprem) + deci(wdetail.cctvprem) /*A65-0079*/
        wdetail.tariff        = "X"
        wdetail.dgdisc        = IF deci(wdetail.dgwdisc) <> 0 THEN STRING(DECI(wdetail.dgdisc) + deci(wdetail.dgwdisc)) ELSE wdetail.dgdisc
        wdetail.comment       = ""
        wdetail.entdat        = string(TODAY)                /*entry date*/
        wdetail.enttim        = STRING(TIME, "HH:MM:SS")    /*entry time*/
        wdetail.trandat       = STRING(fi_loaddat)          /*tran date*/
        wdetail.trantim       = STRING(TIME, "HH:MM:SS")    /*tran time*/
        wdetail.n_IMPORT      = "IM" 
        /* Add by : A67-0029 */
        wdetail.maksi         = trim(wf_maksi)   
        wdetail.eng_no2       = trim(wf_eng_no2) 
        wdetail.battno        = trim(wf_battno) 
        wdetail.battyr        = IF trim(wf_battyr) = "" AND index(wdetail.subclass,"E") <> 0 THEN trim(wf_caryear)  ELSE trim(wf_battyr)
        wdetail.battprice     = trim(wf_battprice)
        wdetail.battsi        = TRIM(wf_battsi)
        wdetail.battrate      = TRIM(wf_battrate)  
        wdetail.battprm       = trim(wf_battprm) 
        wdetail.chargno       = trim(wf_chargno)   
        wdetail.chargsi       = trim(wf_chargsi)   
        wdetail.chargrate     = trim(wf_chargrate)   
        wdetail.chargprm      = trim(wf_chargprm)
        wdetail.drilevel      = "0"  
        /* end : A67-0029 */    
        wdetail.prmt31       = TRIM(wf_31prmt)   /*A68-0044*/
        wdetail.rate31       = TRIM(wf_31rate) .  /*A68-0044*/
    n_chkbr   = "" .  /*A65-0043*/
    /*  A65-0079 */
    /*IF TRIM(wf_seat) = ""  THEN DO:*/ /*A67-0212 */
    IF TRIM(wf_seat) = "" AND trim(wf_prepol) = "" THEN DO:  /*A67-0212 */
         ASSIGN wdetail.comment  = wdetail.comment + "|ที่นั่งเป็นค่าว่าง "   wdetail.pass     = "N" .
    END.
    /* end:A65-0079 */
    /********* ห้ามแก้ไขเบอร์กรมธรรม์ในระบบ N70 ,N72 ,R70 ,R72 เนื่องจากมีผลต่อการ Running policy no. ที่ข้อ 08.05 ************/
    IF  wdetail.policyno <> "" THEN DO:
        IF  LENGTH(wdetail.policyno) <> 12 THEN   
            ASSIGN wdetail.comment  = wdetail.comment + "|เบอร์กรมธรรม์ " + wdetail.policyno + " ไม่ครบ 12 หลัก" 
               wdetail.pass     = "N" .
        IF SUBSTR(wdetail.policyno,3,2) <> "70" THEN 
            ASSIGN wdetail.comment  = wdetail.comment + "|เบอร์กรมธรรม์ " + wdetail.policyno + " หลักที่ 3-4 ไม่เท่ากับ 70 " 
                   wdetail.pass = "N" .
        /*A65-0043*/
        n_chkbr = TRIM(SUBSTR(wdetail.policyno,1,2)).
        IF SUBSTR(n_chkbr,1,1) = "D" THEN n_chkbr = trim(SUBSTR(n_chkbr,2,1)) . 
        IF  wdetail.n_branch <> n_chkbr  THEN
            ASSIGN wdetail.comment  = wdetail.comment +  "|สาขาเบอร์กรมธรรม์ " + wdetail.policyno + " ไม่ตรงกับสาขาของกรมธรรม์ "
                   wdetail.pass     = "N" .
        /* end : A65-0043*/
        FIND LAST sicuw.uwm100 WHERE sicuw.uwm100.policy = TRIM(wdetail.policyno) NO-LOCK NO-ERROR .
        IF AVAIL sicuw.uwm100  THEN
            ASSIGN wdetail.comment  = wdetail.comment + "|เบอร์กรมธรรม์ " + wdetail.policyno + " มีข้อมูลในระบบพรีเมียมแล้ว " 
                   wdetail.pass     = "N" .
    END.
    IF wdetail.compolusory <> ""  THEN DO:
        n_chkbr = "" .
        IF LENGTH(wdetail.compolusory) <> 12 THEN 
        ASSIGN wdetail.comment  = wdetail.comment + "|เบอร์กรมธรรม์ พรบ. " + wdetail.compolusory + " ไม่ครบ 12 หลัก" 
               wdetail.pass     = "N" .
        IF SUBSTR(wdetail.compolusory,3,2) <> "72" THEN 
        ASSIGN wdetail.comment  = wdetail.comment +  "|เบอร์กรมธรรม์ พรบ. " + wdetail.compolusory + " หลักที่ 3-4 ไม่เท่ากับ 72 "
               wdetail.pass     = "N" .
        /*A65-0043*/
        n_chkbr = TRIM(SUBSTR(wdetail.compolusory,1,2)).
        IF SUBSTR(n_chkbr,1,1) = "D" THEN n_chkbr = trim(SUBSTR(n_chkbr,2,1)) . 
        IF  wdetail.n_branch <> n_chkbr  THEN
            ASSIGN wdetail.comment  = wdetail.comment +  "|สาขาเบอร์กรมธรรม์ พรบ. " + wdetail.compolusory + " ไม่ตรงกับสาขาของกรมธรรม์ "
                   wdetail.pass     = "N" .
        /* end : A65-0043*/
    END.
    /* end : A64-0355 */ 
    IF wdetail.policyno = ""  THEN DO:
        IF ra_type = 1  THEN DO:  /*Type = new */
            IF LENGTH(wdetail.chasno) > 9  THEN DO:
             ASSIGN wdetail.policyno = "N70" + STRING(int(wdetail.riskno),"999") + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 9).
             IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */
                 IF wdetail.compolusory <> "" THEN wdetail.cr_2 = wdetail.compolusory.
                 ELSE ASSIGN wdetail.cr_2 = "N72" + STRING(int(wdetail.riskno),"999") + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 9).
             END.
            END.
            ELSE DO:
                ASSIGN wdetail.policyno = "N70" + STRING(int(wdetail.riskno),"999") + TRIM(wdetail.chasno).
                IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */
                    IF wdetail.compolusory <> "" THEN wdetail.cr_2 = wdetail.compolusory.
                    ELSE ASSIGN wdetail.cr_2 = "N72" + STRING(int(wdetail.riskno),"999") + TRIM(wdetail.chasno).
                END.
            END.
        END.
        ELSE DO:  /*Renew*/
            IF wdetail.chasno <> "" THEN DO: 
                IF LENGTH(wdetail.chasno) > 9  THEN DO:
                   ASSIGN wdetail.policyno = "R70" + STRING(int(wdetail.riskno),"999") + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 9).
                    IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */ 
                       IF wdetail.compolusory <> "" THEN wdetail.cr_2 = wdetail.compolusory.
                       ELSE ASSIGN wdetail.cr_2 = "R72" + STRING(int(wdetail.riskno),"999") + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 9).
                   END.
                END.
                ELSE DO:
                    ASSIGN wdetail.policyno = "R70" + STRING(int(wdetail.riskno),"999") + TRIM(wdetail.chasno).
                    IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */ 
                         IF wdetail.compolusory <> "" THEN wdetail.cr_2 = wdetail.compolusory.
                         ELSE ASSIGN wdetail.cr_2 = "R72" + STRING(int(wdetail.riskno),"999") + TRIM(wdetail.chasno).
                    END.
                END.
            END.
            ELSE DO: 
                ASSIGN wdetail.policyno = "R70" + STRING(int(wdetail.riskno),"999") + SUBSTRING(wdetail.prepol,LENGTH(wdetail.prepol) - 6). /*A64-0355*/
                IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */  
                     IF wdetail.compolusory <> "" THEN wdetail.cr_2 = wdetail.compolusory.
                     ELSE ASSIGN wdetail.cr_2 = "R72" + STRING(int(wdetail.riskno),"999") + SUBSTRING(wdetail.prepol,LENGTH(wdetail.prepol) - 6). /*A64-0355*/
                END.
            END.
        END.
    END.
    ELSE IF wdetail.compul = "Y"  AND ra_poltyp = 3 AND wdetail.compolusory <> "" THEN wdetail.cr_2 = wdetail.compolusory.  /*A64-0355*/
    ELSE IF wdetail.compul = "Y"  AND ra_poltyp = 1 AND wdetail.compolusory <> "" THEN wdetail.cr_2 = wdetail.compolusory.  /*A66-0018*/
    ASSIGN wf_policyno = wdetail.policyno . /*A66-0202 */
    RUN proc_assigninit70_2.
    IF TRIM(wdetail.nv_insref) <> "" THEN  RUN proc_chkinscode . /*A65-0043*/ 
    RELEASE wdetail.
    RELEASE wtxt.
    RELEASE wmemo.
    RELEASE wacces.
    RELEASE winst.
    RELEASE wdrive.
END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_assigninit70_2 C-Win 
PROCEDURE proc_assigninit70_2 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DO: 
    ASSIGN 
    wtxt.policyno        =  TRIM(wdetail.policyno)
    wtxt.txt1             =  trim(wf_txt1)   
    wtxt.txt2             =  trim(wf_txt2)   
    wtxt.txt3             =  trim(wf_txt3)   
    wtxt.txt4             =  trim(wf_txt4)   
    wtxt.txt5             =  trim(wf_txt5)   
    wtxt.txt6             =  trim(wf_txt6)   
    wtxt.txt7             =  trim(wf_txt7)   
    wtxt.txt8             =  trim(wf_txt8)   
    wtxt.txt9             =  trim(wf_txt9)   
    wtxt.txt10            =  trim(wf_txt10)

    wmemo.policyno        =  TRIM(wdetail.policyno)
    wmemo.memo1           =  trim(wf_memo1)   
    wmemo.memo2           =  trim(wf_memo2)   
    wmemo.memo3           =  trim(wf_memo3)   
    wmemo.memo4           =  trim(wf_memo4)   
    wmemo.memo5           =  trim(wf_memo5)   
    wmemo.memo6           =  trim(wf_memo6)   
    wmemo.memo7           =  trim(wf_memo7)   
    wmemo.memo8           =  trim(wf_memo8)   
    wmemo.memo9           =  trim(wf_memo9)   
    wmemo.memo10          =  trim(wf_memo10) 

    wacces.policyno       =  TRIM(wdetail.policyno)
    wacces.accdata1       =  trim(wf_accdata1)   
    wacces.accdata2       =  trim(wf_accdata2)   
    wacces.accdata3       =  trim(wf_accdata3)   
    wacces.accdata4       =  trim(wf_accdata4)   
    wacces.accdata5       =  trim(wf_accdata5)   
    wacces.accdata6       =  trim(wf_accdata6)   
    wacces.accdata7       =  trim(wf_accdata7)   
    wacces.accdata8       =  trim(wf_accdata8)  
    wacces.accdata9       =  trim(wf_accdata9)  
    wacces.accdata10      =  trim(wf_accdata10)

    winst.policyno        =  TRIM(wdetail.policyno)
    winst.instot          =  0 
    winst.instcod1        =  trim(wf_instcod1)  
    winst.insttyp1        =  trim(wf_insttyp1)  
    winst.insttitle1      =  trim(wf_insttitle1)
    winst.instname1       =  trim(wf_instname1 )
    winst.instlname1      =  trim(wf_instlname1)
    winst.instic1         =  trim(wf_instic1)   
    winst.instbr1         =  trim(wf_instbr1)   
    winst.instaddr11      =  trim(wf_instaddr11)
    winst.instaddr21      =  trim(wf_instaddr21)
    winst.instaddr31      =  trim(wf_instaddr31)
    winst.instaddr41      =  trim(wf_instaddr41)
    winst.instpost1       =  trim(wf_instpost1 )
    winst.instprovcod1    =  trim(wf_instprovcod1 ) 
    winst.instdistcod1    =  trim(wf_instdistcod1 ) 
    winst.instsdistcod1   =  trim(wf_instsdistcod1) 
    winst.instprm1        =  deci(wf_instprm1)  
    winst.instrstp1       =  deci(wf_instrstp1 )  
    winst.instrtax1       =  deci(wf_instrtax1 )  
    winst.instcomm01      =  deci(wf_instcomm01)  
    winst.instcomm12      =  deci(wf_instcomm12)  
    winst.instcod2        =  trim(wf_instcod2)  
    winst.insttyp2        =  trim(wf_insttyp2)  
    winst.insttitle2      =  trim(wf_insttitle2)  
    winst.instname2       =  trim(wf_instname2 )  
    winst.instlname2      =  trim(wf_instlname2)  
    winst.instic2         =  trim(wf_instic2 )  
    winst.instbr2         =  trim(wf_instbr2 )  
    winst.instaddr12      =  trim(wf_instaddr12)  
    winst.instaddr22      =  trim(wf_instaddr22)  
    winst.instaddr32      =  trim(wf_instaddr32)  
    winst.instaddr42      =  trim(wf_instaddr42)  
    winst.instpost2       =  trim(wf_instpost2 )  
    winst.instprovcod2    =  trim(wf_instprovcod2 ) 
    winst.instdistcod2    =  trim(wf_instdistcod2 ) 
    winst.instsdistcod2   =  trim(wf_instsdistcod2) 
    winst.instprm2        =  deci(wf_instprm2 ) 
    winst.instrstp2       =  deci(wf_instrstp2) 
    winst.instrtax2       =  deci(wf_instrtax2) 
    winst.instcomm02      =  deci(wf_instcomm02)
    winst.instcomm22      =  deci(wf_instcomm22)
    winst.instcod3        =  trim(wf_instcod3) 
    winst.insttyp3        =  trim(wf_insttyp3) 
    winst.insttitle3      =  trim(wf_insttitle3)
    winst.instname3       =  trim(wf_instname3) 
    winst.instlname3      =  trim(wf_instlname3)
    winst.instic3         =  trim(wf_instic3)  
    winst.instbr3         =  trim(wf_instbr3)  
    winst.instaddr13      =  trim(wf_instaddr13)
    winst.instaddr23      =  trim(wf_instaddr23)
    winst.instaddr33      =  trim(wf_instaddr33)
    winst.instaddr43      =  trim(wf_instaddr43)
    winst.instpost3       =  trim(wf_instpost3 )  
    winst.instprovcod3    =  trim(wf_instprovcod3) 
    winst.instdistcod3    =  trim(wf_instdistcod3) 
    winst.instsdistcod3   =  trim(wf_instsdistcod3) 
    winst.instprm3        =  deci(wf_instprm3)  
    winst.instrstp3       =  deci(wf_instrstp3 )
    winst.instrtax3       =  deci(wf_instrtax3 )
    winst.instcomm03      =  deci(wf_instcomm03)
    winst.instcomm23      =  deci(wf_instcomm23) 
    /* add by : A67-0029 */
    wdrive.policy     =  TRIM(wdetail.policyno)
    wdrive.drivnam    =  trim(wf_drivnam)
    wdrive.drivno     =  INTE(wf_drivnam)
    wdrive.ntitle1    =  if trim(wf_ntitle1)    = "-" then "" else trim(wf_ntitle1)   
    wdrive.name1      =  if trim(wf_drivername1)= "-" then "" else trim(wf_drivername1)
    wdrive.lname1     =  if trim(wf_dname2)     = "-" then "" else trim(wf_dname2)  
    wdrive.dicno1     =  if trim(wf_dicno )     = "-" then "" else trim(wf_dicno )  
    wdrive.dgender1   =  if trim(wf_dgender1)   = "-" then "" else trim(wf_dgender1)  
    wdrive.dbirth1    =  if trim(wf_dbirth)     = "-" then "" else trim(wf_dbirth)  
    wdrive.doccup1    =  if trim(wf_doccup)     = "-" then "" else trim(wf_doccup)  
    wdrive.ddriveno1  =  if trim(wf_ddriveno)   = "-" then "" else trim(wf_ddriveno)
    wdrive.drivexp1   =  if trim(wf_drivexp1)   = "-" then "" else trim(wf_drivexp1) 
    wdrive.dconsen1   =  IF TRIM(wf_dconsen1)   = ""  THEN "N" ELSE TRIM(wf_dconsen1) 
    wdrive.dlevel1    =  if trim(wf_dlevel1)    = "-" then "1" else IF trim(wf_dlevel1) = "" THEN "1" ELSE trim(wf_dlevel1) 

    wdrive.ntitle2    =  if trim(wf_ntitle2 )   = "-" then "" else trim(wf_ntitle2 )  
    wdrive.name2      =  if trim(wf_drivername2)= "-" then "" else trim(wf_drivername2)
    wdrive.lname2     =  if trim(wf_ddname1)    = "-" then "" else trim(wf_ddname1)  
    wdrive.dicno2     =  if trim(wf_ddicno)     = "-" then "" else trim(wf_ddicno)  
    wdrive.dgender2   =  if trim(wf_dgender2)   = "-" then "" else trim(wf_dgender2)
    wdrive.dbirth2    =  if trim(wf_ddbirth)    = "-" then "" else trim(wf_ddbirth)
    wdrive.doccup2    =  if trim(wf_ddoccup)    = "-" then "" else trim(wf_ddoccup)
    wdrive.ddriveno2  =  if trim(wf_dddriveno)  = "-" then "" else trim(wf_dddriveno)
    wdrive.drivexp2   =  if trim(wf_drivexp2)   = "-" then "" else trim(wf_drivexp2) 
    wdrive.dconsen2   =  IF TRIM(wf_dconsen2)   = ""  THEN "N" ELSE TRIM(wf_dconsen2) 
    wdrive.dlevel2    =  if trim(wf_dlevel2)    = "-" then "1" else IF trim(wf_dlevel2) = "" THEN "1" ELSE trim(wf_dlevel2)
                                            
    wdrive.ntitle3    =  if trim(wf_ntitle3  ) = "-" then "" else trim(wf_ntitle3  )
    wdrive.name3      =  if trim(wf_dname3   ) = "-" then "" else trim(wf_dname3   )
    wdrive.lname3     =  if trim(wf_dlname3  ) = "-" then "" else trim(wf_dlname3  )
    wdrive.dicno3     =  if trim(wf_dicno3   ) = "-" then "" else trim(wf_dicno3   )
    wdrive.dgender3   =  if trim(wf_dgender3 ) = "-" then "" else trim(wf_dgender3 )
    wdrive.dbirth3    =  if trim(wf_dbirth3  ) = "-" then "" else trim(wf_dbirth3  )
    wdrive.doccup3    =  if trim(wf_doccup3  ) = "-" then "" else trim(wf_doccup3  )
    wdrive.ddriveno3  =  if trim(wf_ddriveno3) = "-" then "" else trim(wf_ddriveno3)
    wdrive.drivexp3   =  if trim(wf_drivexp3 ) = "-" then "" else trim(wf_drivexp3 )
    wdrive.dconsen3   =  IF TRIM(wf_dconsen3)   = ""  THEN "N" ELSE TRIM(wf_dconsen3) 
    wdrive.dlevel3    =  if trim(wf_dlevel3  ) = "-" then "1" else IF trim(wf_dlevel3) = "" THEN "1" ELSE trim(wf_dlevel3)

    wdrive.ntitle4    =  if trim(wf_ntitle4  ) = "-" then "" else trim(wf_ntitle4  )
    wdrive.name4      =  if trim(wf_dname4   ) = "-" then "" else trim(wf_dname4   )
    wdrive.lname4     =  if trim(wf_dlname4  ) = "-" then "" else trim(wf_dlname4  )
    wdrive.dicno4     =  if trim(wf_dicno4   ) = "-" then "" else trim(wf_dicno4   )
    wdrive.dgender4   =  if trim(wf_dgender4 ) = "-" then "" else trim(wf_dgender4 )
    wdrive.dbirth4    =  if trim(wf_dbirth4  ) = "-" then "" else trim(wf_dbirth4  )
    wdrive.doccup4    =  if trim(wf_doccup4  ) = "-" then "" else trim(wf_doccup4  )
    wdrive.ddriveno4  =  if trim(wf_ddriveno4) = "-" then "" else trim(wf_ddriveno4)
    wdrive.drivexp4   =  if trim(wf_drivexp4 ) = "-" then "" else trim(wf_drivexp4 )
    wdrive.dconsen4   =  IF TRIM(wf_dconsen4)   = ""  THEN "N" ELSE TRIM(wf_dconsen4) 
    wdrive.dlevel4    =  if trim(wf_dlevel4  ) = "-" then "1" else IF trim(wf_dlevel4) = "" THEN "1" ELSE trim(wf_dlevel4)

    wdrive.ntitle5    =  if trim(wf_ntitle5  ) = "-" then "" else trim(wf_ntitle5  )
    wdrive.name5      =  if trim(wf_dname5   ) = "-" then "" else trim(wf_dname5   )
    wdrive.lname5     =  if trim(wf_dlname5  ) = "-" then "" else trim(wf_dlname5  )
    wdrive.dicno5     =  if trim(wf_dicno5   ) = "-" then "" else trim(wf_dicno5   )
    wdrive.dgender5   =  if trim(wf_dgender5 ) = "-" then "" else trim(wf_dgender5 )
    wdrive.dbirth5    =  if trim(wf_dbirth5  ) = "-" then "" else trim(wf_dbirth5  )
    wdrive.doccup5    =  if trim(wf_doccup5  ) = "-" then "" else trim(wf_doccup5  )
    wdrive.ddriveno5  =  if trim(wf_ddriveno5) = "-" then "" else trim(wf_ddriveno5)
    wdrive.drivexp5   =  if trim(wf_drivexp5 ) = "-" then "" else trim(wf_drivexp5 )
    wdrive.dconsen5   =  IF TRIM(wf_dconsen5)  = ""  THEN "N" ELSE TRIM(wf_dconsen5) 
    wdrive.dlevel5    =  if trim(wf_dlevel5  ) = "-" then "1" else IF trim(wf_dlevel5) = "" THEN "1" ELSE trim(wf_dlevel5) .
    /*IF      wf_drivername1 <> "" THEN ASSIGN wdrive.drivno  = 1.
    ELSE IF wf_drivername2 <> "" THEN ASSIGN wdrive.drivno  = 2.
    ELSE IF wf_dname3 <> "" THEN ASSIGN wdrive.drivno  = 3.
    ELSE IF wf_dname4 <> "" THEN ASSIGN wdrive.drivno  = 4.
    ELSE IF wf_dname5 <> "" THEN ASSIGN wdrive.drivno  = 5.*/
    /*...end A67-0029...*/

    ASSIGN wf_instot = 0 .
    IF wdetail.poltyp = "V70" THEN DO:
        IF  wf_instname1 <> "" THEN ASSIGN wf_instot = wf_instot + 1.  /*  ชื่อบริษัทเต็มบนใบกำกับภาษี1 */
        ELSE IF winst.instcod1 <> ""  THEN DO:
             FIND LAST sicsyac.xmm600 USE-INDEX xmm60001 WHERE xmm600.acno = trim(winst.instcod1) NO-LOCK NO-ERROR.
             IF NOT AVAIL sicsyac.xmm600  THEN DO: 
                  IF wf_instname1 = "" THEN ASSIGN wdetail.comment = wdetail.comment + "| Code " + winst.instcod1 + " ของใบเสร็จ/ใบกำกับภาษี 1 ไม่มีในระบบ และข้อมูลชื่อเป็นค่าว่าง" .
                  ELSE ASSIGN  wf_instot = wf_instot + 1. 
             END.
             ELSE DO: 
                wf_instot = wf_instot + 1.
                /* คำนำหน้า */
                IF   winst.insttitle1   = "" AND trim(sicsyac.xmm600.ntitle)    <> "" then winst.insttitle1 = trim(sicsyac.xmm600.ntitle).
                /* สกุล */
                IF   winst.instlname1   = "" AND trim(sicsyac.xmm600.lastname)  <> "" then winst.instlname1 = trim(sicsyac.xmm600.lastname).
                ELSE winst.instlname1   = IF index(sicsyac.xmm600.name," ") <> 0 THEN trim(SUBSTR(sicsyac.xmm600.name,R-INDEX(sicsyac.xmm600.name," ") + 1 )) ELSE "".
                /* ชื่อ*/
                IF   winst.instname1    = "" AND trim(sicsyac.xmm600.firstname) <> "" then winst.instname1  = trim(sicsyac.xmm600.firstname).
                ELSE winst.instname1    = trim(SUBSTR(sicsyac.xmm600.name,1,LENGTH(sicsyac.xmm600.name) - LENGTH(winst.instlname1))).
                /* แยกคำหน้าชื่อ กับ ชื่อ */
               /* IF winst.insttitle1 = "" AND index(winst.instname1," ") <> 0 THEN DO: 
                    ASSIGN 
                    winst.insttitle1 = trim(SUBSTR(winst.instname1,1,INDEX(winst.instname1," ") - 1 ))
                    winst.instname1  = trim(SUBSTR(winst.instname1,R-INDEX(winst.instname1," ") ))
                    winst.instname1  = trim(REPLACE(winst.instname1,winst.insttitle1,"")).
                END.*/
             END.
        END.
        
        IF  wf_instname2 <> "" THEN ASSIGN wf_instot = wf_instot + 1.  /*  ชื่อบริษัทเต็มบนใบกำกับภาษี2 */
        ELSE IF winst.instcod2 <> ""  THEN DO:
         FIND LAST sicsyac.xmm600 USE-INDEX xmm60001 WHERE xmm600.acno = trim(winst.instcod2) NO-LOCK NO-ERROR.
             IF NOT AVAIL sicsyac.xmm600  THEN DO: 
                 IF wf_instname2 = "" THEN ASSIGN wdetail.comment = wdetail.comment + "| Code " + winst.instcod2 + " ของใบเสร็จ/ใบกำกับภาษี 2 ไม่มีในระบบ และข้อมูลชื่อเป็นค่าว่าง" .
                 ELSE ASSIGN wf_instot = wf_instot + 1 .
             END.
             ELSE DO: 
                 wf_instot = wf_instot + 1.
                 /* คำนำหน้า */
                 IF  winst.insttitle2  = "" AND trim(sicsyac.xmm600.ntitle)  <> "" then winst.insttitle2 = trim(sicsyac.xmm600.ntitle).
                /* สกุล */             
                IF   winst.instlname2  = "" AND trim(sicsyac.xmm600.lastname) <> "" then winst.instlname2 = trim(sicsyac.xmm600.lastname).
                ELSE winst.instlname2  = IF index(sicsyac.xmm600.name," ") <> 0 THEN trim(SUBSTR(sicsyac.xmm600.name,R-INDEX(sicsyac.xmm600.name," ") + 1 )) ELSE "".
                /* ชื่อ*/              
                IF   winst.instname2   = "" AND trim(sicsyac.xmm600.firstname) <> "" then winst.instname2  = trim(sicsyac.xmm600.firstname).
                ELSE winst.instname2   = trim(SUBSTR(sicsyac.xmm600.name,1,LENGTH(sicsyac.xmm600.name) - LENGTH(winst.instlname2))).
                /* แยกคำหน้าชื่อ กับ ชื่อ */
                /*IF winst.insttitle2 = "" AND index(winst.instname2," ") <> 0 THEN DO: 
                    ASSIGN 
                    winst.insttitle2 = trim(SUBSTR(winst.instname2,1,INDEX(winst.instname2," ") - 1 ))
                    winst.instname2  = trim(SUBSTR(winst.instname2,R-INDEX(winst.instname2," ") ))
                    winst.instname2  = trim(REPLACE(winst.instname2,winst.insttitle2,"")).
                END.*/
             END.
        END.
        
        IF  wf_instname3 <> "" THEN ASSIGN wf_instot = wf_instot + 1.  /*  ชื่อบริษัทเต็มบนใบกำกับภาษี3 */
        ELSE IF winst.instcod3 <> ""   THEN DO:
         FIND LAST sicsyac.xmm600 USE-INDEX xmm60001 WHERE xmm600.acno = trim(winst.instcod3) NO-LOCK NO-ERROR.
             IF NOT AVAIL sicsyac.xmm600  THEN DO: 
                 IF wf_instname3 = "" THEN ASSIGN wdetail.comment = wdetail.comment + "| Code " + winst.instcod3 + " ของใบเสร็จ/ใบกำกับภาษี 2 ไม่มีในระบบ และข้อมูลชื่อเป็นค่าว่าง" .
                 ELSE ASSIGN wf_instot = wf_instot + 1.
             END.
             ELSE DO: 
                 wf_instot = wf_instot + 1.
                 /* คำนำหน้า */
                 IF   winst.insttitle3   = "" AND trim(sicsyac.xmm600.ntitle)    <> "" then winst.insttitle3 = trim(sicsyac.xmm600.ntitle).
                 /* สกุล */
                 IF   winst.instlname3   = "" AND trim(sicsyac.xmm600.lastname)  <> "" then winst.instlname3 = trim(sicsyac.xmm600.lastname).
                 ELSE winst.instlname3   = IF index(sicsyac.xmm600.name," ") <> 0 THEN trim(SUBSTR(sicsyac.xmm600.name,R-INDEX(sicsyac.xmm600.name," ") + 1 )) ELSE "".
                 /* ชื่อ*/
                 IF   winst.instname3    = "" AND trim(sicsyac.xmm600.firstname) <> "" then winst.instname3  = trim(sicsyac.xmm600.firstname).
                 ELSE winst.instname3    = trim(SUBSTR(sicsyac.xmm600.name,1,LENGTH(sicsyac.xmm600.name) - LENGTH(winst.instlname3))).
                 /* แยกคำหน้าชื่อ กับ ชื่อ */
                 /*IF winst.insttitle3 = "" AND index(winst.instname3," ") <> 0 THEN DO: 
                     ASSIGN 
                     winst.insttitle3 = trim(SUBSTR(winst.instname3,1,INDEX(winst.instname3," ") - 1 ))
                     winst.instname3  = trim(SUBSTR(winst.instname3,R-INDEX(winst.instname3," ") ))
                     winst.instname3  = trim(REPLACE(winst.instname3,winst.insttitle3,"")). 
                 END.*/
             END.
        END.
    END.

    IF  wf_instot = 0 THEN wdetail.instot = 1.
    ELSE IF wf_instot = 1 THEN DO:
        ASSIGN 
            wdetail.instot = 1 
            winst.instot   = 1.
    END.
    ELSE ASSIGN winst.instot   = wf_instot
                wdetail.instot = wf_instot .

END.

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_assigninit72 C-Win 
PROCEDURE proc_assigninit72 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DEF VAR n_chkbr AS CHAR FORMAT "x(2)" INIT "" . /* A65-0043 */
DO:
    ASSIGN fi_process = "Create data text file " + wf_chasno + " to wdetail ....." .
    DISP fi_process WITH FRAM fr_main.
    
    CREATE wdetail.
    CREATE wtxt.
    CREATE wmemo.
    CREATE wacces.
    CREATE winst.
    CREATE wdrive. /*A67-0029*/
    ASSIGN
        wdetail.riskno        =  TRIM(wf_riskno)   /*A64-0355*/
        wdetail.itemno        =  TRIM(wf_num)
        wdetail.policyno      =  " "   /*trim(wf_policyno)*/  
        wdetail.n_branch      =  trim(wf_n_branch)        
        wdetail.agent         =  trim(wf_agent)           
        wdetail.producer      =  trim(wf_producer)        
        wdetail.n_delercode   =  trim(wf_n_delercode)   
        wdetail.fincode       =  trim(wf_fincode)   
        wdetail.appenno       =  trim(wf_appenno)   
        wdetail.salename      =  trim(wf_salename)   
        wdetail.srate         =  trim(wf_srate) 
       /* wdetail.comdat        =  date(wf_comdat)  */ /*F67-0001*/                                                      
       /* wdetail.expdat        =  date(wf_expdat)  */ /*F67-0001*/
        wdetail.comdat        =  if trim(wf_comdat72) <> "" then date(wf_comdat72) else date(wf_comdat)  /*F67-0001*/
        wdetail.expdat        =  if trim(wf_expdat72) <> "" then date(wf_expdat72) else date(wf_expdat)  /*F67-0001*/
        wdetail.agreedat      =  if trim(wf_agreedat) = "" and wdetail.prepol = "" then date(wf_comdat) 
                                 else if trim(wf_agreedat) <> "" then date(wf_agreedat)  ELSE ? 
        wdetail.firstdat      =  if trim(wf_firstdat) = "" and wdetail.prepol = "" then date(wf_comdat) 
                                 else if trim(wf_firstdat) <> "" then date(wf_firstdat)  ELSE ?  
        wdetail.packcod       =  trim(wf_packcod)   
        wdetail.camp_no       =  trim(wf_camp_no)   
        wdetail.campen        =  trim(wf_campen) 
        wdetail.specon        =  trim(wf_specon) 
        wdetail.product       =  trim(wf_product)   
        wdetail.promo         =  trim(wf_promo )   
        wdetail.rencnt        =  trim(wf_rencnt)   
        wdetail.prepol        =  trim(wf_prepol)
        wdetail.compul        =  trim(wf_compul) 
        wdetail.instyp        =  trim(wf_instyp)
        wdetail.nv_insref     =  TRIM(wf_insref)   /*A64-0355*/
        wdetail.inslang       =  trim(wf_inslang )  
        wdetail.tiname        =  trim(wf_tiname) 
        wdetail.insnam        =  trim(wf_insnam) 
        wdetail.lastname      =  trim(wf_lastname)  
        wdetail.icno          =  trim(wf_icno ) 
        wdetail.insbr         =  trim(wf_insbr) 
        wdetail.occup         =  trim(wf_occup) 
        wdetail.addr          =  trim(wf_addr ) 
        wdetail.tambon        =  trim(wf_tambon) 
        wdetail.amper         =  trim(wf_amper) 
        wdetail.country       =  trim(wf_country)  
        wdetail.post          =  trim(wf_post)  
        wdetail.provcod       =  trim(wf_provcod)  
        wdetail.distcod       =  trim(wf_distcod)  
        wdetail.jpae          =  trim(wf_ae)         /* ae  new Xmm600 งาน Japanes */  /*A64-0355*/
        wdetail.jpjtl         =  trim(wf_jtl)        /* jtl new Xmm600 งาน Japanes */  /*A64-0355*/
        wdetail.jpts          =  trim(wf_ts)         /* ts  new Xmm600 งาน Japanes */  /*A64-0355*/
        wdetail.sdistcod      =  IF trim(wf_sdistcod) <> "" AND LENGTH(wf_sdistcod) > 2 THEN SUBSTR(wf_sdistcod,1,2) ELSE TRIM(wf_sdistcod) 
        wdetail.gender        =  trim(wf_gender) 
        wdetail.tele1         =  trim(wf_tele1) 
        wdetail.tele2         =  trim(wf_tele2) 
        wdetail.mail1         =  trim(wf_mail1) 
        wdetail.mail2         =  trim(wf_mail2) 
        wdetail.mail3         =  trim(wf_mail3) 
        wdetail.mail4         =  trim(wf_mail4) 
        wdetail.mail5         =  trim(wf_mail5) 
        wdetail.mail6         =  trim(wf_mail6)  
        wdetail.mail7         =  trim(wf_mail7)  
        wdetail.mail8         =  trim(wf_mail8)  
        wdetail.mail9         =  trim(wf_mail9)  
        wdetail.mail10        =  trim(wf_mail10)  
        wdetail.fax           =  trim(wf_fax)  
        wdetail.lineID        =  trim(wf_lineID)  
        wdetail.name2         =  trim(wf_name2)  
        wdetail.name3         =  trim(wf_name3)  
        /*wdetail.benname     =  trim(wf_benname )  */
        wdetail.payercod      =  trim(wf_payercod)  
        wdetail.vatcode       =  trim(wf_vatcode )
        wdetail.covcod        =  trim(wf_covcod)  
        wdetail.garage        =  trim(wf_garage )  
        wdetail.special       =  trim(wf_special)  
        wdetail.inspec        =  trim(wf_inspec )  
        wdetail.class70       =  IF INDEX(wf_class70,".") <> 0 THEN trim(REPLACE(wf_class70,".","")) ELSE TRIM(wf_class70) 
        wdetail.brand         =  trim(wf_brand)  
        wdetail.model         =  trim(wf_model)  
        wdetail.submodel      =  trim(wf_submodel)  
        wdetail.yrmanu        =  trim(wf_caryear)  
        wdetail.chasno        =  trim(wf_chasno)  
        wdetail.eng           =  trim(wf_eng)  
        wdetail.seat          =  if trim(wf_seat)  = "" then 0 else INTE(wf_seat)    
        wdetail.engcc         =  if trim(wf_engcc) = "" then 0 else INTE(wf_engcc)   
        wdetail.weight        =  if trim(wf_weight)= "" then 0 else DECI(wf_weight)    
        /*wdetail.watt          =  if trim(wf_watt)= ""   then 0 ELSE INTE(wf_watt) */ /*A66-0202*/
        wdetail.watt          =  if trim(wf_watt)= ""   then 0 ELSE DECI(wf_watt)  /*A66-0202*/
        wdetail.body          =  trim(wf_body)  
        wdetail.typ           =  trim(wf_type)  
        wdetail.re_year       =  trim(wf_re_year)  
        wdetail.vehreg        =  trim(wf_vehreg)  
        wdetail.re_country    =  trim(wf_re_country)
        wdetail.cargrp        =  trim(wf_cargrp)   
        wdetail.colorcar      =  trim(wf_colorcar)
        wdetail.fule          =  trim(wf_fule)  
        wdetail.compolusory   =  trim(wf_compolusory)
        wdetail.stk           =  trim(wf_barcode)  
        wdetail.class72       =  IF INDEX(wf_class72,".") <> 0 THEN trim(REPLACE(wf_class72,".","")) ELSE TRIM(wf_class72)  
        wdetail.dstf72        =  trim(wf_dstf72 )  
        wdetail.dstfprem72    =  deci(wf_dstfprem72)   
        wdetail.premt72       =  deci(wf_premt72 )     
        wdetail.rstp_t72      =  deci(wf_rstp_t72)     
        wdetail.rtax_t72      =  deci(wf_rtax_t72)     
        wdetail.comper72      =  IF trim(wf_comper72)  =  " " THEN -1 ELSE deci(wf_comper72)          /* ค่าว่างใส่ -1 ดึง comm ตามระบบ  ถ้าระบุ 0 ไม่มีค่าคอม */                        
        wdetail.comprem72     =  IF trim(wf_comprem72) =  " " THEN -1 ELSE deci(wf_comprem72)        /* ค่าว่างใส่ -1 คำนวณ comm ตามระบบ ถ้าระบุ 0 ไม่มีค่าคอม */                      
        wdetail.vehuse        =  IF INDEX("1234",trim(wf_vehuse)) <> 0 THEN wf_vehuse ELSE "" .        /* A64-0355 : vehuse 15/12/2021 */
        
        ASSIGN 
        wdetail.CLASS72       = IF LENGTH(wdetail.class72) < 3 THEN TRIM(wdetail.class72) + "0" ELSE TRIM(wdetail.class72)
        wdetail.poltyp        = "V72"
        wdetail.covcod        = "T" 
        wdetail.subclass      = IF trim(wdetail.class72) <> "" THEN TRIM(wdetail.class72) ELSE TRIM(wdetail.class70)
        wdetail.tariff        = "9"
        /*wdetail.vehuse        = IF trim(wdetail.subclass) <> "" THEN SUBSTR(wdetail.subclass,1,1) ELSE ""*/ /* A64-0355 : vehuse 15/12/2021 */
        /*wdetail.seat41        = INTE(wdetail.seat) */ /*A64-0044*/
        wdetail.seat41        =  IF int(wf_ac2) <> 0 THEN int(wf_ac2) + 1 ELSE INTE(wf_seat) /*A64-0044*/
        wdetail.comment       = ""
        wdetail.entdat        = string(TODAY)                /*entry date*/
        wdetail.enttim        = STRING(TIME,"HH:MM:SS")    /*entry time*/
        wdetail.trandat       = STRING(fi_loaddat)          /*tran date*/
        wdetail.trantim       = STRING(TIME,"HH:MM:SS")    /*tran time*/
        wdetail.n_IMPORT      = "IM"
        /*wdetail.n_EXPORT      = "" */  /*A64-0044*/
        /* Add by : A67-0029 */
        wdetail.redbook       = TRIM(wf_redbook)  /*A65-0079*/
        /*wdetail.maksi         = trim(wf_maksi) */  
        wdetail.eng_no2       = trim(wf_eng_no2)   
        wdetail.battper       = trim(wf_battper)
        wdetail.battrate      = TRIM(wf_battrate)
        wdetail.battyr        = IF trim(wf_battyr) = "" AND index(wdetail.subclass,"E") <> 0 THEN trim(wf_caryear) ELSE trim(wf_battyr)
        wdetail.battsi        = TRIM(wf_battsi)
        wdetail.battprice     = trim(wf_battprice)   
        wdetail.battno        = trim(wf_battno)   
        wdetail.battprm       = trim(wf_battprm)   
        wdetail.chargno       = trim(wf_chargno)   
        wdetail.chargsi       = trim(wf_chargsi)   
        wdetail.chargrate     = trim(wf_chargrate)   
        wdetail.chargprm      = trim(wf_chargprm) .
        /* end : A67-0029 */
    /* add by :  A64-0355 */
    IF wdetail.compolusory <> ""  THEN DO:
        IF  LENGTH(wdetail.compolusory) <> 12 THEN DO: 
           ASSIGN wdetail.comment  = wdetail.comment + "|เบอร์กรมธรรม์ พรบ. " + wdetail.compolusory + " ไม่ครบ 12 หลัก" 
                  wdetail.pass     = "N" .
        END.
        IF SUBSTR(wdetail.compolusory,3,2) <> "72" THEN DO:
           ASSIGN wdetail.comment  = wdetail.comment +  "|เบอร์กรมธรรม์ พรบ. " + wdetail.compolusory + " หลักที่ 3-4 ไม่เท่ากับ 72 "
                  wdetail.pass     = "N" .
        END.
        /* A65-0043 */
        n_chkbr = TRIM(SUBSTR(wdetail.compolusory,1,2)).
        IF SUBSTR(n_chkbr,1,1) = "D" THEN n_chkbr = trim(SUBSTR(n_chkbr,2,1)) . 
        IF  wdetail.n_branch <> n_chkbr  THEN
            ASSIGN wdetail.comment  = wdetail.comment +  "|สาขาเบอร์กรมธรรม์ พรบ. " + wdetail.compolusory + " ไม่ตรงกับสาขาของกรมธรรม์ "
                   wdetail.pass     = "N" .  
        /* end : A64-0043 */
    END.
    /* end :  A64-0355 */
    /********* ห้ามแก้ไขเบอร์กรมธรรม์ในระบบ N70 ,N72 ,R70 ,R72 เนื่องจากมีผลต่อการ Running policy no. ที่ข้อ 08.05 ************/
    IF wdetail.policyno = ""  THEN DO:
        IF ra_type = 1  THEN DO: 
            IF LENGTH(wdetail.chasno) > 9  THEN DO:
                IF wdetail.compolusory <> "" THEN ASSIGN wdetail.policyno = wdetail.compolusory. 
                ELSE ASSIGN wdetail.policyno = "N72" + STRING(int(wdetail.riskno),"999") + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 9).
                /*IF wdetail.compul = "Y" THEN  */ /* A64-0309 */
                IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */ 
                     ASSIGN wdetail.cr_2 = "N70" + STRING(int(wdetail.riskno),"999") + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 9).
                END. /* A64-0309 */ 
            END.
            ELSE DO:
                IF wdetail.compolusory <> "" THEN ASSIGN wdetail.policyno = wdetail.compolusory. 
                ELSE ASSIGN wdetail.policyno = "N72" + STRING(int(wdetail.riskno),"999") + TRIM(wdetail.chasno).
                /*IF wdetail.compul = "Y" THEN  */ /* A64-0309 */
                IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */ 
                    ASSIGN wdetail.cr_2 = "N70" + STRING(int(wdetail.riskno),"999") + TRIM(wdetail.chasno).
                END. /* A64-0309 */ 
            END.
        END.
        ELSE DO:  /* ra_poltyp = 2 (V72) 3 ( 70+72 )*/
            IF wdetail.chasno <> "" THEN DO: 
                IF LENGTH(wdetail.chasno) > 9 THEN DO:
                    IF wdetail.compolusory <> "" THEN ASSIGN wdetail.policyno = wdetail.compolusory. 
                    ELSE ASSIGN wdetail.policyno = "R72" + STRING(int(wdetail.riskno),"999") + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 9). 

                    /*IF wdetail.compul = "Y" THEN  */ /* A64-0309 */
                    IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */  
                            ASSIGN wdetail.cr_2 = "R70" + STRING(int(wdetail.riskno),"999") + SUBSTRING(wdetail.chasno,LENGTH(wdetail.chasno) - 9).
                    END.  /* A64-0309 */
                    ELSE IF wdetail.compul = "Y" AND ra_poltyp = 2 THEN  ASSIGN wdetail.cr_2 = CAPS(trim(wf_policyno)).  /*A66-00019*/
                                
                END.
                ELSE DO:
                    IF wdetail.compolusory <> "" THEN ASSIGN wdetail.policyno = wdetail.compolusory. 
                    ELSE ASSIGN wdetail.policyno = "R72" + STRING(int(wdetail.riskno),"999") + TRIM(wdetail.chasno). 

                    /*IF wdetail.compul = "Y" THEN  */ /* A64-0309 */
                    IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */
                        ASSIGN wdetail.cr_2 = "R70" + STRING(int(wdetail.riskno),"999") + TRIM(wdetail.chasno).
                    END.  /* A64-0309 */
                    ELSE IF wdetail.compul = "Y" AND ra_poltyp = 2 THEN  ASSIGN wdetail.cr_2 = CAPS(trim(wf_policyno)).  /*A66-00019*/
                END.
            END.
            ELSE DO: 
                IF wdetail.compolusory <> "" THEN ASSIGN wdetail.policyno = wdetail.compolusory. 
                ELSE ASSIGN wdetail.policyno = "R72" + STRING(int(wdetail.riskno),"999") + trim(SUBSTRING(wdetail.prepol,LENGTH(wdetail.prepol) - 6)).

                /*IF wdetail.compul = "Y" THEN  */ /* A64-0309 */
                IF wdetail.compul = "Y" AND ra_poltyp = 3 THEN DO:  /* A64-0309 */ 
                    ASSIGN wdetail.cr_2 = "R70" + STRING(int(wdetail.riskno),"999") + trim(SUBSTRING(wdetail.prepol,LENGTH(wdetail.prepol) - 6)).
                END.  /* A64-0309 */
                ELSE IF wdetail.compul = "Y" AND ra_poltyp = 2 THEN  ASSIGN wdetail.cr_2 = CAPS(trim(wf_policyno)).   /*A66-00019*/
            END.
        END.
        ASSIGN wdetail.cr_2 = CAPS(trim(wf_policyno)).  
    END.
   RUN proc_assigninit70_2.
   IF TRIM(wdetail.nv_insref) <> "" THEN  RUN proc_chkinscode .  /*A65-0043*/ 
   RELEASE wdetail.
   RELEASE wtxt.
   RELEASE wmemo.
   RELEASE wacces.
   RELEASE winst.
   RELEASE wdrive. /*A67-0029*/
END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_assignrenew C-Win 
PROCEDURE proc_assignrenew :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
ASSIGN 
    n_policy72     = ""
    np_prepol      = ""
    n_brand1       = ""
    n_body         = ""
    nn_redbook     = ""
    n_Engine       = ""
    n_Tonn70       = "".

RUN proc_initrenew.

IF NOT CONNECTED("sic_exp") THEN RUN proc_sic_exp2.

IF CONNECTED("sic_exp") THEN DO:

    ASSIGN fi_process = "Import data From Expiry " + wdetail.policyno + "...." .
    DISP fi_process WITH FRAM fr_main.

    RUN wgw\wgwexemp(INPUT-OUTPUT  wdetail.prepol,                      
                     INPUT-OUTPUT  re_rencnt ,                          
                     INPUT-OUTPUT  re_branch /*wdetail.n_branch*/ ,     
                     INPUT-OUTPUT  re_agent      ,                      
                     INPUT-OUTPUT  re_producer   ,                      
                     INPUT-OUTPUT  re_delercode,                        
                     INPUT-OUTPUT  re_fincode    ,                      
                     INPUT-OUTPUT  re_payercod   ,                      
                     INPUT-OUTPUT  re_vatcode    ,                      
                     INPUT-OUTPUT  re_insref /*wdetail.nv_insref*/ ,    
                     INPUT-OUTPUT  re_tiname,                           
                     INPUT-OUTPUT  re_insnam,                           
                     INPUT-OUTPUT  re_lastname,                         
                     INPUT-OUTPUT  re_name2,                            
                     INPUT-OUTPUT  re_name3,                            
                     INPUT-OUTPUT  re_n_addr1,                          
                     INPUT-OUTPUT  re_n_addr2,                          
                     INPUT-OUTPUT  re_n_addr3,                          
                     INPUT-OUTPUT  re_n_addr4,                          
                     INPUT-OUTPUT  re_post    ,                         
                     INPUT-OUTPUT  re_provcod ,                         
                     INPUT-OUTPUT  re_distcod ,                         
                     INPUT-OUTPUT  re_sdistcod,                         
                     INPUT-OUTPUT  re_firstdat /*wdetail.firstdat*/ ,   
                     INPUT-OUTPUT  re_comdat,                           
                     INPUT-OUTPUT  re_expdat,                           
                     INPUT-OUTPUT  re_class,                            
                     INPUT-OUTPUT  nn_redbook,                          
                     INPUT-OUTPUT  re_moddes,                           
                     INPUT-OUTPUT  re_yrmanu,                           
                     INPUT-OUTPUT  re_cargrp /*wdetail.cargrp*/ ,       
                     INPUT-OUTPUT  n_body,                              
                     INPUT-OUTPUT  n_Engine,                            
                     INPUT-OUTPUT  n_Tonn70,                            
                     INPUT-OUTPUT  re_seats,                            
                     INPUT-OUTPUT  re_vehuse,                           
                     INPUT-OUTPUT  re_covcod,                           
                     INPUT-OUTPUT  re_garage,                           
                     INPUT-OUTPUT  re_vehreg,                           
                     INPUT-OUTPUT  re_cha_no,                           
                     INPUT-OUTPUT  re_eng_no,                           
                     INPUT-OUTPUT  re_uom1_v,                           
                     INPUT-OUTPUT  re_uom2_v,                           
                     INPUT-OUTPUT  re_uom5_v,                           
                     INPUT-OUTPUT  re_si,
                     INPUT-OUTPUT  re_baseprm, 
                     INPUT-OUTPUT  re_base3 , /*A64-0257*/
                     INPUT-OUTPUT  re_41,                               
                     INPUT-OUTPUT  re_42,                               
                     INPUT-OUTPUT  re_43,                               
                     INPUT-OUTPUT  re_seat41,                           
                     INPUT-OUTPUT  re_dedod,                            
                     INPUT-OUTPUT  re_addod,                            
                     INPUT-OUTPUT  re_dedpd,                            
                     INPUT-OUTPUT  re_flet_per,                         
                     INPUT-OUTPUT  re_ncbper,                           
                     INPUT-OUTPUT  re_dss_per,                          
                     INPUT-OUTPUT  re_stf_per,                          
                     INPUT-OUTPUT  re_cl_per,                           
                     INPUT-OUTPUT  re_bennam1,
                     INPUT-OUTPUT  re_premt,
                     INPUT-OUTPUT  re_comm ,
                     INPUT-OUTPUT  re_driver,
                     INPUT-OUTPUT  re_prmtdriv,
                     INPUT-OUTPUT  re_acctxt,
                     INPUT-OUTPUT  re_adj,
                     INPUT-OUTPUT  re_chkdriv ,
                     input-output  re_chkmemo,
                     input-output  re_chktxt,
                     INPUT-OUTPUT  re_agco,   /*A64-0355 */
                     INPUT-OUTPUT  re_commco, /*A64-0355 */
                     INPUT-OUTPUT  re_watt  , /*A66-0202*/   
                     INPUT-OUTPUT  re_acctyp, /*A66-0202*/
                     INPUT-OUTPUT  re_maksi,  /*A67-0029*/
                     INPUT-OUTPUT  re_eng_no2, /*A67-0029*/
                     /*A67-0212 */
                     INPUT-OUTPUT  re_battyr   , 
                     INPUT-OUTPUT  re_battsi   ,
                     INPUT-OUTPUT  re_battprice,
                     INPUT-OUTPUT  re_battno   ,
                     INPUT-OUTPUT  re_chargno  ,
                     INPUT-OUTPUT  re_chargsi  ,
                     INPUT-OUTPUT  re_battprm  ,
                     INPUT-OUTPUT  re_chargprm ,
                     /* end : A67-0212 */
                     INPUT-OUTPUT  re_comment).  
   
   IF ra_match = 1 THEN DO:
        IF re_adj   = "NO"            THEN ASSIGN wdetail.comment = wdetail.comment + "| ยังไม่มีการปรับใบเตือน Adj = NO " .
        IF re_premt <> wdetail.premt  THEN ASSIGN wdetail.comment = wdetail.comment + "| เบี้ยใบเตือน " + string(re_premt,">>>>>>9.99") + 
                                                                    " ไม่เท่ากับไฟล์ " + STRING(wdetail.premt,">>>>>>9.99").
        IF deci(wdetail.si) <> 0      AND deci(wdetail.si)     <> deci(re_si) THEN wdetail.comment = wdetail.comment + "| ทุนประกันในไฟล์และใบเตือนไม่เท่ากัน " .
        IF deci(wdetail.siplus) <> 0  AND deci(wdetail.siplus) <> deci(re_si) THEN wdetail.comment = wdetail.comment + "| ทุนประกันในไฟล์และใบเตือนไม่เท่ากัน " .
        IF wdetail.covcod <> "" AND wdetail.covcod <> re_covcod THEN wdetail.comment = wdetail.comment + "| ความคุ้มครองในไฟล์และใบเตือนไม่เท่ากัน " .
        /* A65-0079 */
        IF trim(wdetail.subclass) <> "" AND trim(wdetail.subclass) <> trim(substr(re_class,2,LENGTH(re_class))) THEN DO:
            ASSIGN wdetail.comment = wdetail.comment + "| Class ในไฟล์และใบเตือนไม่ตรงกัน " 
                   wdetail.pass    = "N" .
        END.
        /* end : A65-0079 */
        IF re_comment <> ""   THEN ASSIGN wdetail.comment = wdetail.comment + "| " + re_comment .
        ELSE DO:
            ASSIGN np_prepol = wdetail.prepol
                   n_policy  = wdetail.cr_2
                   n_brand1  = wdetail.brand.
            IF wdetail.cr_2 <> "" THEN DO: /* ใส่ข้อมูลให้ พรบ. */
               FIND LAST wdetail WHERE wdetail.policy = n_policy AND wdetail.covcod = "T" NO-LOCK no-error .
                IF AVAIL wdetail THEN DO:
                   RUN proc_updaterenew.
                IF wdetail.class72 = "" THEN RUN proc_chkclass72.
               END.
            END.
            FIND LAST wdetail WHERE wdetail.prepol = np_prepol AND wdetail.covcod <> "T" NO-LOCK NO-ERROR . /* ใส่ข้อมูลให้ กธ. */
            IF AVAIL wdetail THEN DO:
                     RUN proc_updaterenew.
            END.
        END.
    END.
    ELSE DO:
        IF      re_chkdriv <> ""  AND /*int(wdetail.drivnam) <> 0 A67-0212 */ trim(wdetail.drivnam) <> "0"  THEN wdetail.comment = wdetail.comment + "| เช็คข้อมูลผู้ขับขี่ในระบบ กับไฟล์".
        ELSE IF re_chkdriv <> ""  AND /*int(wdetail.drivnam)  = 0 A67-0212 */ trim(wdetail.drivnam)  = "0"  THEN wdetail.comment = wdetail.comment + "| เช็คข้อมูลผู้ขับขี่ในระบบ กับไฟล์".
        ELSE IF re_chkdriv = ""   AND /*int(wdetail.drivnam) <> 0 A67-0212 */ trim(wdetail.drivnam) <> "0"  THEN wdetail.comment = wdetail.comment + "| เช็คข้อมูลผู้ขับขี่ในระบบ กับไฟล์".
                 
        IF re_acctxt  <> "" THEN  wdetail.comment = wdetail.comment + "| เช็คข้อมูล Accessory Text ในระบบกับไฟล์".
        IF re_chkmemo <> "" then  wdetail.comment = wdetail.comment + "| เช็คข้อมูล Memo Text ในระบบกับไฟล์".
        IF re_chktxt  <> "" then  wdetail.comment = wdetail.comment + "| เช็คข้อมูล Policy Text ในระบบกับไฟล์".
    END.
END.


END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_assign_ex C-Win 
PROCEDURE proc_assign_ex :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
ASSIGN fi_process = "Create data text file ....".
DISP fi_process WITH FRAM fr_main.
For each  wdetail :
    DELETE  wdetail.
End.
For each  wtxt:
    DELETE  wtxt.
End.
For each  wmemo:
    DELETE  wmemo.
End.
For each  wacces:
    DELETE  wacces.
End.
For each  winst:
    DELETE  winst.
End.
/* A67-0029 */
FOR EACH wdrive:
    DELETE wdrive.
END.
/* end : A67-0029 */
FOR EACH wuwd132:
    DELETE wuwd132.
END.
FOR EACH wuwd100:
    DELETE wuwd100.
END.
FOR EACH wuwd102:
    DELETE wuwd102.
END.
FOR EACH ws0m009:
    DELETE ws0m009.
END.
RUN proc_assigndata.
RUN proc_assign2.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_base2 C-Win 
PROCEDURE proc_base2 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DEF VAR i       AS INTE.
DEF VAR per     AS DECI.
DEF VAR f       AS DECI.
DEF VAR chk     AS LOGICAL.
DEF VAR model   AS CHAR FORMAT "x(30)".
DEF VAR aa      AS DECI.
ASSIGN fi_process = "Check Base data Load Text ...." + wdetail.policyno .
DISP fi_process WITH FRAM fr_main.
FIND sic_bran.uwm100 WHERE RECID(sic_bran.uwm100) = s_recid1 NO-WAIT NO-ERROR.
FIND sic_bran.uwm120 WHERE RECID(sic_bran.uwm120) = s_recid2 NO-WAIT NO-ERROR.
FIND sic_bran.uwm130 WHERE RECID(sic_bran.uwm130) = s_recid3 NO-WAIT NO-ERROR.
FIND sic_bran.uwm301 WHERE RECID(sic_bran.uwm301) = s_recid4 NO-WAIT NO-ERROR.

IF wdetail.poltyp = "V70" THEN DO:
    IF wdetail.base = 0 THEN DO:
       RUN wgs\wgsfbas.
       ASSIGN aa = nv_baseprm.
    END.
    ELSE aa = wdetail.base .

    IF aa = 0 THEN DO:
       RUN wgs\wgsfbas.
       ASSIGN aa = nv_baseprm.
    END.
    ASSIGN
        chk = NO
        NO_basemsg = " "
        f = DECI(wdetail.premt)
        i = 1
        nv_baseprm = aa
        nv_dss_per = 0
        nv_dss_per = deci(wdetail.dspc).

    /*RUN proc_chkdrive.*/   /*A67-0029*/
    /*-----nv_drivcod---------------------*/
    /* comment  by : A67-0029 ..
     ASSIGN nv_drivvar = ""
            nv_drivvar1 = wdetail.drivername1.
            nv_drivvar2 = wdetail.drivername2.
        IF wdetail.drivnam = "N" THEN  nv_drivno = 0.
        ELSE DO:
            IF wdetail.prepol = ""  THEN DO:
                IF wdetail.drivername1 <> ""   THEN  wdetail.drivnam  = "y".
                ELSE wdetail.drivnam  = "N".
                IF wdetail.drivername2 <> ""   THEN  nv_drivno = 2. 
                ELSE IF wdetail.drivername1 <> "" AND wdetail.drivername2 = "" THEN  nv_drivno = 1.  
                ELSE IF wdetail.drivername1  = "" AND wdetail.drivername2 = "" THEN  nv_drivno = 0.   
            END.
        END.
        
        IF wdetail.prepol = ""  THEN DO:
            If wdetail.drivnam  = "N"  Then 
                Assign nv_drivvar   = " "
                nv_drivcod   = "A000"
                nv_drivvar1  =  "     Unname Driver"
                nv_drivvar2  = "0"
                Substr(nv_drivvar,1,30)   = nv_drivvar1
                Substr(nv_drivvar,31,30)  = nv_drivvar2.
            ELSE DO:
                IF  nv_drivno  > 2  Then do:
                    Message " Driver'S NO. must not over 2. "  View-as alert-box.
                    ASSIGN wdetail.pass    = "N"
                        wdetail.comment = wdetail.comment +  "| Driver'S NO. must not over 2. ".  
                END.
                RUN proc_usdcod.
                Assign  nv_drivvar  = ""
                nv_drivvar     = nv_drivcod
                nv_drivvar1    = "     Driver name person = "
                nv_drivvar2    = String(nv_drivno)
                Substr(nv_drivvar,1,30)  = nv_drivvar1
                Substr(nv_drivvar,31,30) = nv_drivvar2.
            END.
        END.
        ...end A67-0029..*/
        /*-------nv_baseprm----------*/
        IF NO_basemsg <> " " THEN  wdetail.WARNING = no_basemsg.
        IF nv_baseprm = 0  Then 
            ASSIGN  wdetail.pass    = "N"
            wdetail.comment = wdetail.comment + "| Base Premium is Mandatory field. ".  
        ASSIGN nv_basevar = " "
            nv_prem1 = nv_baseprm
            nv_basecod  = "BASE"
            nv_basevar1 = "     Base Premium = "
            nv_basevar2 = STRING(nv_baseprm)
            SUBSTRING(nv_basevar,1,30)   = nv_basevar1
            SUBSTRING(nv_basevar,31,30)  = nv_basevar2.
        /*-------nv_add perils----------*/
        
        Assign  nv_411var = ""   nv_412var = ""                                                  
            nv_41cod1   = "411"
            nv_411var1  = "     PA Driver = "
            nv_411var2  =  STRING(wdetail.no_411)
            SUBSTRING(nv_411var,1,30)    = nv_411var1
            SUBSTRING(nv_411var,31,30)   = nv_411var2

            nv_41cod2   = "412"
            nv_412var1  = "     PA Passengers = "
            nv_412var2  =  STRING(wdetail.NO_412)
            SUBSTRING(nv_412var,1,30)   = nv_412var1
            SUBSTRING(nv_412var,31,30)  = nv_412var2
            nv_411prm  = wdetail.no_411
            nv_412prm  = wdetail.no_412.
         /* -------fi_42---------*/
        ASSIGN nv_42var    = " "  
            nv_42cod   = "42".
            nv_42var1  = "     Medical Expense = ".
            nv_42var2  = STRING(wdetail.no_42).
            SUBSTRING(nv_42var,1,30)   = nv_42var1.
            SUBSTRING(nv_42var,31,30)  = nv_42var2.
          /*---------fi_43--------*/
        ASSIGN nv_43var    = " "
            nv_43prm = nv_43
            nv_43cod   = "43"
            nv_43var1  = "     Airfrieght = "
            nv_43var2  =  STRING(wdetail.no_43)
            SUBSTRING(nv_43var,1,30)   = nv_43var1
            SUBSTRING(nv_43var,31,30)  = nv_43var2.
       /* Add by : A64-0355 */ 
       nv_413var = "" .
       IF wdetail.NO_413 <> 0 THEN DO:
           Assign  nv_413var = ""                                                  
            nv_41cod3   = "413"
            nv_413var1  = "     PA Temp. Driver = "
            nv_413var2  =  STRING(wdetail.no_413)
            SUBSTRING(nv_413var,1,30)    = nv_413var1
            SUBSTRING(nv_413var,31,30)   = nv_413var2.
       END.
       nv_414var = "" .
       IF wdetail.NO_414 <> 0 THEN DO:
           Assign  nv_414var = ""                                                  
            nv_41cod4   = "414"
            nv_414var1  = "     PA Temp. Driver = "
            nv_414var2  =  STRING(wdetail.no_414)
            SUBSTRING(nv_414var,1,30)    = nv_414var1
            SUBSTRING(nv_414var,31,30)   = nv_414var2.
       END.
       /* end : A64-0355 */ 
        /*------nv_usecod------------*/
        ASSIGN nv_usevar = ""
            nv_usecod  = "USE" + TRIM(wdetail.vehuse)
            nv_usevar1 = "     Vehicle Use = "
            nv_usevar2 =  wdetail.vehuse
            Substring(nv_usevar,1,30)   = nv_usevar1
            Substring(nv_usevar,31,30) = nv_usevar2.
        /*-----nv_engcod-----------------*/
        ASSIGN nv_sclass =  wdetail.subclass.       
        RUN wgs\wgsoeng.   
        /*-----nv_yrcod----------------------------*/  
        ASSIGN nv_yrvar = ""
            nv_caryr   = (Year(nv_comdat)) - integer(wdetail.yrmanu) + 1
            nv_yrvar1  = "     Vehicle Year = "
            nv_yrvar2  =  wdetail.yrmanu
            nv_yrcod   = If nv_caryr <= 10 Then "YR" + String(nv_caryr) Else "YR99"
            Substr(nv_yrvar,1,30)    = nv_yrvar1
            Substr(nv_yrvar,31,30)   = nv_yrvar2.  
     /*-----nv_sicod----------------------------*/                    
     Assign  nv_sivar   = "" 
             nv_totsi     = 0
             nv_sicod     = "SI"
             nv_sivar1    = "     Own Damage = "
             nv_sivar2    =  STRING(wdetail.si)
             SUBSTRING(nv_sivar,1,30)  = nv_sivar1
             SUBSTRING(nv_sivar,31,30) = string(deci(nv_sivar2))
             nv_totsi     =  DECI(wdetail.si).
     /*----------nv_grpcod--------------------*/
     ASSIGN nv_grpvar  = "" 
         nv_grpcod      = "GRP" + wdetail.cargrp
         nv_grpvar1     = "     Vehicle Group = "
         nv_grpvar2     = wdetail.cargrp
         Substr(nv_grpvar,1,30)  = nv_grpvar1
         Substr(nv_grpvar,31,30) = nv_grpvar2.
     /*-------------nv_bipcod--------------------*/
     ASSIGN nv_bipvar  = ""
         nv_bipcod      = "BI1"
         nv_bipvar1     = "     BI per Person = "
         nv_bipvar2     = STRING(sic_bran.uwm130.uom1_v)
         SUBSTRING(nv_bipvar,1,30)   = nv_bipvar1
         SUBSTRING(nv_bipvar,31,30)  = nv_bipvar2.
     /*-------------nv_biacod--------------------*/
     Assign nv_biavar  = ""
         nv_biacod      = "BI2"
         nv_biavar1     = "     BI per Accident = "
         nv_biavar2     = STRING(sic_bran.uwm130.uom2_v)
         SUBSTRING(nv_biavar,1,30)  = nv_biavar1
         SUBSTRING(nv_biavar,31,30) = nv_biavar2.
     /*-------------nv_pdacod--------------------*/
     ASSIGN nv_pdavar  = ""
         nv_pdacod      = "PD"
         nv_pdavar1     = "     PD per Accident = "
         nv_pdavar2     = string(deci(sic_bran.uwm130.uom5_v)) 
         SUBSTRING(nv_pdavar,1,30)  = nv_pdavar1
         SUBSTRING(nv_pdavar,31,30) = nv_pdavar2.
     /*--------------- deduct ----------------*/
     ASSIGN dod0 = 0
            dod1 = 0
            dod2 = 0
            dpd0 = 0 .
     nv_dedod1var  = "".
     nv_dedod2var  = "".
     IF wdetail.dod <> 0 AND wdetail.dod1 = 0  THEN DO:
         dod0 = wdetail.dod.
         /*IF TRIM(wdetail.body) = "MOTORCYCLE"  THEN DO:*/ /*A65-0043*/
         IF SUBSTR(wdetail.subclass,1,1) = "6"  THEN DO:    /*A65-0043*/
             IF dod0 > 1000 THEN DO:
                dod1 = 1000.
                dod2 = dod0 - dod1.
            END.
            ELSE dod1 = dod0.
         END.
         ELSE DO:
            IF dod0 > 3000 THEN DO:
                dod1 = 3000.
                dod2 = dod0 - dod1.
            END.
            ELSE dod1 = dod0.
         END.
     END.
     /* A67-0029*/
     ELSE DO:
         ASSIGN dod1 = wdetail.dod
                dod2 = wdetail.dod1.
     END.
     /* end : A67-0029*/
     IF dod1 <> 0 THEN
      ASSIGN
          nv_odcod    = "DC01"
          nv_prem     =  dod1
          nv_sivar2   = "" .  
      RUN Wgs\Wgsmx024( nv_tariff,              
                        nv_odcod,
                        nv_class,
                        nv_key_b,
                        nv_comdat,
                        INPUT-OUTPUT nv_prem,
                        OUTPUT nv_chk ,
                        OUTPUT nv_baseap).
      IF NOT nv_chk THEN DO:
          MESSAGE  " DEDUCTIBLE EXCEED THE LIMIT " nv_baseap  View-as alert-box.
          ASSIGN
              wdetail.pass    = "N"
              wdetail.comment = wdetail.comment + "| DEDUCTIBLE EXCEED THE LIMIT ".
      END.
     IF dod1 <> 0 THEN
         ASSIGN 
             nv_dedod1var  = ""
             nv_ded1prm    = nv_prem
             nv_dedod1_prm = nv_prem
             nv_dedod1_cod = "DOD"
             nv_dedod1var1 = "     Deduct OD = "
             nv_dedod1var2 = STRING(dod1)
             SUBSTRING(nv_dedod1var,1,30)  = nv_dedod1var1
             SUBSTRING(nv_dedod1var,31,30) = nv_dedod1var2.
     
     /*add od*/
     Assign  
       nv_dedod2var   = " "
       nv_cons  = "AD"
       nv_ded   = dod2.
     IF dod2 <> 0  THEN
       Assign
       nv_dedod2_cod   = "DOD2"
       nv_dedod2var1   = "     Add Ded.OD = "
       nv_dedod2var2   =  STRING(dod2)
       SUBSTRING(nv_dedod2var,1,30)  = nv_dedod2var1
       SUBSTRING(nv_dedod2var,31,30) = nv_dedod2var2 .
      
     /***** pd *******/
     IF wdetail.DPD <> 0 THEN DO:
        Assign
            dpd0         = 0
            dpd0         = wdetail.dpd
            nv_dedpdvar  = " "
            nv_cons  = "PD"
            nv_ded   = dpd0.
        ASSIGN
            nv_dedpd_cod   = "DPD"
            nv_dedpdvar1   = "     Deduct PD = "
            nv_dedpdvar2   =  STRING(nv_ded)
            SUBSTRING(nv_dedpdvar,1,30)    = nv_dedpdvar1
            SUBSTRING(nv_dedpdvar,31,30)   = nv_dedpdvar2 .
     END.
     /*---------- fleet -------------------*/
     ASSIGN nv_flet_per = 0
            nv_flet_per = INTE(wdetail.fleet).
     IF nv_flet_per <> 0 AND  nv_flet_per <> 10 Then do:
         Message  " Fleet Percent must be 0 or 10. " View-as alert-box.
         ASSIGN
             wdetail.pass    = "N"
             wdetail.comment = wdetail.comment + "| Fleet Percent must be 0 or 10. ".
     End.
     IF nv_flet_per = 0 Then do:
         ASSIGN nv_flet     = 0
                nv_fletvar  = " ".
     End.
     ELSE DO:
        ASSIGN  
            nv_fletvar     = " "      
            nv_fletvar1    = "     Fleet % = "
            nv_fletvar2    =  STRING(nv_flet_per)
            SUBSTRING(nv_fletvar,1,30)     = nv_fletvar1
            SUBSTRING(nv_fletvar,31,30)    = nv_fletvar2.
     END.
     IF nv_flet   = 0  THEN nv_fletvar  = " ".
     /*---------------- NCB -------------------*/
     ASSIGN NV_NCBPER = 0
            NV_NCBPER = INTE(WDETAIL.NCB).
     nv_ncbvar = " ".
     If nv_ncbper  <> 0 Then do:
         Find first sicsyac.xmm104 Use-index xmm10401 Where
             sicsyac.xmm104.tariff = nv_tariff           AND
             sicsyac.xmm104.class  = nv_class            AND 
             sicsyac.xmm104.covcod = nv_covcod           AND 
             sicsyac.xmm104.ncbper   = INTE(wdetail.ncb) No-lock no-error no-wait.
         IF not avail  sicsyac.xmm104  Then do:
             Message " This NCB Step not on NCB Rates file xmm104. " View-as alert-box.
             ASSIGN wdetail.pass    = "N"
                 wdetail.comment = wdetail.comment + "| This NCB Step not on NCB Rates file xmm104. ".
         END.
         ELSE ASSIGN nv_ncbper = xmm104.ncbper   
                     nv_ncbyrs = xmm104.ncbyrs.
     END.
     Else do:  
         ASSIGN nv_ncbyrs =   0
                nv_ncbper =   0
                nv_ncb    =   0.
     END.
     
     nv_ncbvar   = " ".
     IF  nv_ncb <> 0  THEN
         ASSIGN 
         nv_ncbvar1   = "     NCB % = "
         nv_ncbvar2   =  STRING(nv_ncbper)
         SUBSTRING(nv_ncbvar,1,30)    = nv_ncbvar1
         SUBSTRING(nv_ncbvar,31,30)   = nv_ncbvar2.
    
     nv_dsspcvar   = " ".
     IF  nv_dss_per   <> 0  THEN
       Assign
       nv_dsspcvar1   = "     Discount Special % = "
       nv_dsspcvar2   =  STRING(nv_dss_per)
       SUBSTRING(nv_dsspcvar,1,30)    = nv_dsspcvar1
       SUBSTRING(nv_dsspcvar,31,30)   = nv_dsspcvar2.
    /*----------- CL ------------*/
    nv_clmvar  = " ".                                    
    nv_cl_per  = DECI(wdetail.claim).       
    IF nv_cl_per  <> 0  THEN                             
        Assign                                           
        nv_clmvar1   = " Load Claim % = "                
        nv_clmvar2   =  STRING(nv_cl_per)                
        SUBSTRING(nv_clmvar,1,30)    = nv_clmvar1        
        SUBSTRING(nv_clmvar,31,30)   = nv_clmvar2.
                                                      
    /* *------------------ stf ---------------*/         
    nv_stfvar   = " ".                                   
    nv_stf_per  = DECI(wdetail.dstf).     
    IF  nv_stf_per   <> 0  THEN                          
     Assign                                               
       nv_stfvar1   = "     Discount Staff"            
       nv_stfvar2   =  STRING(nv_stf_per)              
       SUBSTRING(nv_stfvar,1,30)    = nv_stfvar1       
       SUBSTRING(nv_stfvar,31,30)   = nv_stfvar2.  

 /*
   IF nv_packatt <> ""  THEN DO:
       FIND FIRST sicsyac.xmm106 USE-INDEX xmm10601 WHERE
               sicsyac.xmm106.tariff  = nv_tariff  AND
               sicsyac.xmm106.bencod  = nv_packatt AND
               sicsyac.xmm106.CLASS   = "AR01"     AND
               sicsyac.xmm106.key_a   = 0          AND
               sicsyac.xmm106.key_b   = 0          AND
               sicsyac.xmm106.effdat <= nv_comdat  NO-LOCK NO-ERROR NO-WAIT.
        IF AVAIL xmm106 THEN DO:
            nv_ratatt = sicsyac.xmm106.appinc.
        END.
        ELSE DO:
            ASSIGN 
                nv_packatt = ""
                nv_ratatt  = 0.
        END.
        
        nv_packattvar = "".
        IF nv_packatt <> "" THEN DO:
            ASSIGN
                nv_packattvar1 = "     RATE Attach % = "
                nv_packattvar2 = STRING(nv_ratatt)
                SUBSTRING(nv_packattvar,1,30)    = nv_packattvar1
                SUBSTRING(nv_packattvar,31,30)   = nv_packattvar2.
        END.
   END.


    nv_siattvar = "".
    IF nv_siatt <> 0 THEN DO:
        ASSIGN 
            nv_siattvar1 = "     Sum Attach = "
            nv_siattcod  = "RSI"
            nv_siattvar2 = STRING(nv_siatt)
            SUBSTRING(nv_siattvar,1,30)    = nv_siattvar1
            SUBSTRING(nv_siattvar,31,30)   = nv_siattvar2.
        
    END.
    
    nv_fltattvar = "".
    IF nv_fltatt <> 0 THEN DO:
        ASSIGN 
            nv_fltattvar1 = "     Fleet Attach % = "
            nv_fltattcod  = "RFET"
            nv_fltattvar2 = STRING(nv_fltatt)
            SUBSTRING(nv_fltattvar,1,30)    = nv_fltattvar1
            SUBSTRING(nv_fltattvar,31,30)   = nv_fltattvar2.
    END.
    
    nv_ncbattvar = "".
    IF nv_ncbatt <> 0 THEN DO:
        ASSIGN 
            nv_ncbattvar1 = "     NCB Attach % = "
            nv_ncbattcod  = "RNCB"
            nv_ncbattvar2 = STRING(nv_ncbatt)
            SUBSTRING(nv_ncbattvar,1,30)    = nv_ncbattvar1
            SUBSTRING(nv_ncbattvar,31,30)   = nv_ncbattvar2.
    END.
    
    nv_dscattvar = "". 
    IF nv_dscatt <> 0 THEN DO:
        ASSIGN
            nv_dscattvar1 = "     Discount Attach % = "
            nv_dscattcod  = "RDST"
            nv_dscattvar2 = STRING(nv_dscatt)
            SUBSTRING(nv_dscattvar,1,30)    = nv_dscattvar1
            SUBSTRING(nv_dscattvar,31,30)   = nv_dscattvar2.
    END.*/
   
END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_base2plus C-Win 
PROCEDURE proc_base2plus :
DEF VAR chk     AS LOGICAL.
DEF VAR model   AS CHAR FORMAT "x(30)".
DEF VAR aa      AS DECI.
ASSIGN fi_process = "Check Base Plus Data Text 2+3+...." + wdetail.policyno .
DISP fi_process WITH FRAM fr_main.
FIND sic_bran.uwm100 WHERE RECID(sic_bran.uwm100) = s_recid1 NO-WAIT NO-ERROR.
FIND sic_bran.uwm120 WHERE RECID(sic_bran.uwm120) = s_recid2 NO-WAIT NO-ERROR.
FIND sic_bran.uwm130 WHERE RECID(sic_bran.uwm130) = s_recid3 NO-WAIT NO-ERROR.
FIND sic_bran.uwm301 WHERE RECID(sic_bran.uwm301) = s_recid4 NO-WAIT NO-ERROR.
IF wdetail.poltyp = "v70" THEN DO:
    IF wdetail.base <> 0 THEN aa = wdetail.base .
    ELSE IF (wdetail.covcod = "2.1") OR (wdetail.covcod = "3.1") OR (wdetail.covcod = "2.2") OR (wdetail.covcod = "3.2") THEN DO: 
        RUN wgs\wgsfbas.
        ASSIGN aa = nv_baseprm.
    END.
    IF aa = 0 THEN DO:
        RUN wgs\wgsfbas.
        ASSIGN aa = nv_baseprm.
    END.
    ASSIGN
        chk = NO
        NO_basemsg  = " "
        nv_baseprm  = aa
        nv_dss_per  = 0 
        nv_dss_per  = deci(wdetail.dspc) .
   /* RUN proc_chkdrive. A67-0029 */
    /*-----nv_drivcod---------------------*/
       /* nv_drivvar1 = wdetail.drivername1 */ /*A67-0029*/  
       /* nv_drivvar2 = wdetail.drivername2.*/ /*A67-0029*/
    /* comment by : A67-0029....
    IF wdetail.drivnam = "n" THEN  nv_drivno = 0.
    ELSE DO:
        IF      wdetail.drivername1 <> ""   THEN  wdetail.drivnam  = "y".
        ELSE    wdetail.drivnam     = "N".

        IF      wdetail.drivername2 <> ""   THEN  nv_drivno = 2. 
        ELSE IF wdetail.drivername1 <> "" AND wdetail.drivername2 = "" THEN  nv_drivno = 1.  
        ELSE IF wdetail.drivername1  = "" AND wdetail.drivername2 = "" THEN  nv_drivno = 0.   
    END.
    If wdetail.drivnam  = "N"  Then 
        Assign nv_drivvar   = " "
        nv_drivcod   = "A000"
        nv_drivvar1  =  "     Unname Driver"
        nv_drivvar2  = "0"
        Substr(nv_drivvar,1,30)   = nv_drivvar1
        Substr(nv_drivvar,31,30)  = nv_drivvar2.
    ELSE DO:
        IF  nv_drivno  > 2  Then do:
            Message " Driver'S NO. must not over 2. "  View-as alert-box.
            ASSIGN wdetail.pass    = "N"
                    wdetail.comment = wdetail.comment +  "| Driver'S NO. must not over 2. ".  
        END.
        RUN proc_usdcod.
        ASSIGN nv_drivvar  = " "
            nv_drivvar     = nv_drivcod
            nv_drivvar1    = "     Driver name person = "
            nv_drivvar2    = String(nv_drivno)
            Substr(nv_drivvar,1,30)  = nv_drivvar1
            Substr(nv_drivvar,31,30) = nv_drivvar2.
    END.
    ....end A67-0029..*/
    /*-------nv_baseprm----------*/
    nv_basevar = "" .
    IF NO_basemsg <> " " THEN  wdetail.WARNING = no_basemsg.
    IF nv_baseprm = 0  Then 
        ASSIGN  wdetail.pass    = "N"
        wdetail.comment = wdetail.comment + "| Base Premium is Mandatory field. ".  
    ASSIGN nv_prem1 = nv_baseprm
        nv_basecod  = "BASE"
        nv_basevar1 = "     Base Premium = "
        nv_basevar2 = STRING(nv_baseprm)
        SUBSTRING(nv_basevar,1,30)   = nv_basevar1
        SUBSTRING(nv_basevar,31,30)  = nv_basevar2.
    ASSIGN  nv_seat41 = integer(wdetail.seat41).
    
    Assign nv_411var = ""   nv_412var = ""                                                  
        nv_41cod1   = "411"
        nv_411var1  = "     PA Driver = "
        nv_411var2  =  STRING(wdetail.NO_411)
        SUBSTRING(nv_411var,1,30)    = nv_411var1
        SUBSTRING(nv_411var,31,30)   = nv_411var2
        nv_41cod2   = "412"
        nv_412var1  = "     PA Passengers = "
        nv_412var2  =  STRING(wdetail.NO_412)
        SUBSTRING(nv_412var,1,30)   = nv_412var1
        SUBSTRING(nv_412var,31,30)  = nv_412var2
        nv_411prm  = nv_41 
        nv_412prm  = nv_41 .
    ASSIGN  nv_42var    = " "     /* -------fi_42---------*/
        nv_42cod   = "42"
        nv_42var1  = "     Medical Expense = "
        nv_42var2  = STRING(wdetail.no_42)
        SUBSTRING(nv_42var,1,30)   = nv_42var1
        SUBSTRING(nv_42var,31,30)  = nv_42var2 .
   ASSIGN  nv_43var    = " "     /*---------fi_43--------*/
        nv_43prm = nv_43
        nv_43cod   = "43"
        nv_43var1  = "     Airfrieght = "
        nv_43var2  =  STRING(wdetail.no_43)
        SUBSTRING(nv_43var,1,30)   = nv_43var1
        SUBSTRING(nv_43var,31,30)  = nv_43var2.
   /* Add by : A64-0355 */ 
   nv_413var = "" .
   IF wdetail.NO_413 <> 0 THEN DO:
       Assign  nv_413var = ""                                                  
        nv_41cod3   = "413"
        nv_413var1  = "     PA Temp. Driver = "
        nv_413var2  =  STRING(wdetail.no_413)
        SUBSTRING(nv_413var,1,30)    = nv_413var1
        SUBSTRING(nv_413var,31,30)   = nv_413var2.
   END.
   nv_414var = "" .
   IF wdetail.NO_414 <> 0 THEN DO:
       Assign  nv_414var = ""                                                  
        nv_41cod4   = "414"
        nv_414var1  = "     PA Temp. Driver = "
        nv_414var2  =  STRING(wdetail.no_414)
        SUBSTRING(nv_414var,1,30)    = nv_414var1
        SUBSTRING(nv_414var,31,30)   = nv_414var2.
   END.
   /* end : A64-0355 */ 
    /*------nv_usecod------------*/
    ASSIGN nv_usevar = ""
        nv_usecod  = "USE" + TRIM(wdetail.vehuse)
        nv_usevar1 = "     Vehicle Use = "
        nv_usevar2 =  wdetail.vehuse
        Substring(nv_usevar,1,30)   = nv_usevar1
        Substring(nv_usevar,31,30) = nv_usevar2.
    /*-----nv_engcod-----------------*/
    ASSIGN nv_sclass =  wdetail.subclass.       
    RUN wgs\wgsoeng.

    /*-----nv_yrcod---------- 1. ------------------*/  
    ASSIGN nv_yrvar = ""
        nv_caryr   = (Year(nv_comdat)) - integer(wdetail.yrmanu) + 1
        nv_yrvar1  = "     Vehicle Year = "
        nv_yrvar2  =  wdetail.yrmanu
        nv_yrcod   = If nv_caryr <= 10 Then "YR" + String(nv_caryr) Else "YR99"
        Substr(nv_yrvar,1,30)    = nv_yrvar1
        Substr(nv_yrvar,31,30)   = nv_yrvar2.  
    /*-----nv_sicod----------------------------*/  
    Assign nv_sivar = " " 
        nv_totsi = 0        nv_sicod     = "SI"
        nv_sivar1    = "     Own Damage = "
        nv_sivar2    =  STRING(wdetail.siplus)       
        wdetail.si   =  wdetail.siplus       
        SUBSTRING(nv_sivar,1,30)  = nv_sivar1
        SUBSTRING(nv_sivar,31,30) = string(deci(nv_sivar2))
        nv_totsi     = deci(wdetail.siplus) .  /*A62-0215*/
    /*----------nv_grpcod--------------------*/
    ASSIGN  nv_grpvar  = ""
        nv_grpcod      = "GRP" + wdetail.cargrp
        nv_grpvar1     = "     Vehicle Group = "
        nv_grpvar2     = wdetail.cargrp
        Substr(nv_grpvar,1,30)  = nv_grpvar1
        Substr(nv_grpvar,31,30) = nv_grpvar2.
    /*-------------nv_bipcod--------------------*/
    ASSIGN nv_bipvar   = ""
        nv_bipcod      = "BI1"
        nv_bipvar1     = "     BI per Person = "
        nv_bipvar2     = STRING(sic_bran.uwm130.uom1_v)
        SUBSTRING(nv_bipvar,1,30)   = nv_bipvar1
        SUBSTRING(nv_bipvar,31,30)  = nv_bipvar2.
    /*-------------nv_biacod--------------------*/
    Assign nv_biavar  = ""
        nv_biacod      = "BI2"
        nv_biavar1     = "     BI per Accident = "
        nv_biavar2     = STRING(sic_bran.uwm130.uom2_v)
        SUBSTRING(nv_biavar,1,30)  = nv_biavar1
        SUBSTRING(nv_biavar,31,30) = nv_biavar2.
    /*-------------nv_pdacod--------------------*/
    IF (wdetail.covcod = "2.1") THEN nv_usecod3 = "U" + TRIM(nv_vehuse) + "21" .
    ELSE IF (wdetail.covcod = "2.2") THEN nv_usecod3 = "U" + TRIM(nv_vehuse) + "22" .  /*a62-0215*/
    ELSE IF (wdetail.covcod = "3.2") THEN nv_usecod3 = "U" + TRIM(nv_vehuse) + "32" .  /*a62-0215*/
    ELSE nv_usecod3 = "U" + TRIM(nv_vehuse) + "31" .
    ASSIGN nv_usevar3  = ""  
        nv_usevar4 = "     Vehicle Use = "
        nv_usevar5 =  wdetail.vehuse
        Substring(nv_usevar3,1,30)   = nv_usevar4
        Substring(nv_usevar3,31,30)  = nv_usevar5.
    /*------------ base3 --------------*/
    ASSIGN  nv_basecod3 = IF (wdetail.covcod = "2.1") THEN "BA21" 
                          ELSE IF (wdetail.covcod = "2.2") THEN "BA22"
                          ELSE IF (wdetail.covcod = "3.1") THEN "BA31" ELSE "BA32". 
    IF wdetail.baseplus = 0 THEN DO:
     FIND FIRST sicsyac.xmm106 USE-INDEX xmm10601 WHERE
         sicsyac.xmm106.tariff = nv_tariff   AND
         sicsyac.xmm106.bencod = nv_basecod3 AND
         sicsyac.xmm106.covcod = nv_covcod   AND
         sicsyac.xmm106.class  = nv_class    AND
         sicsyac.xmm106.key_b  GE nv_key_b   AND
         sicsyac.xmm106.effdat LE nv_comdat  NO-LOCK NO-ERROR NO-WAIT.
     IF AVAIL sicsyac.xmm106 THEN  nv_baseprm3 = xmm106.min_ap.
     ELSE  nv_baseprm3 = 0.
    END.
    ELSE nv_baseprm3 = wdetail.baseplus .
    ASSIGN nv_basevar3 = ""
        nv_basevar4 = "     Base Premium3 = "
        nv_basevar5 = STRING(nv_baseprm3)
        SUBSTRING(nv_basevar3,1,30)   = nv_basevar4
        SUBSTRING(nv_basevar3,31,30)  = nv_basevar5. 
    /*---------- SI plus -------------*/
     ASSIGN nv_sivar3 = ""
        nv_sicod3    = IF (wdetail.covcod = "2.1") THEN "SI21"
                       ELSE IF (wdetail.covcod = "2.2") THEN "SI22" 
                       ELSE IF (wdetail.covcod = "3.1") THEN "SI31"  ELSE "SI32" 
        nv_sivar4    = "     Own Damage = "                                                                                              
        nv_sivar5    =  string(INT(wdetail.siplus)) 
        wdetail.si   =  INT(wdetail.siplus) 
        SUBSTRING(nv_sivar3,1,30)  = nv_sivar4
        SUBSTRING(nv_sivar3,31,30) = nv_sivar5 .
        nv_siprm3    = DECI(wdetail.siplus) .
    /*----------- PD --------------*/
    ASSIGN nv_pdavar    = ""
         nv_pdacod      = "PD"
         nv_pdavar1     = "     PD per Accident = " 
         nv_pdavar2     = string(deci(sic_bran.uwm130.uom5_v))        
         SUBSTRING(nv_pdavar,1,30)  = nv_pdavar1
         SUBSTRING(nv_pdavar,31,30) = nv_pdavar2.
     
     /*--------------- deduct ----------------*/
     /* caculate deduct OD  */
     ASSIGN dod0 = 0
            dod1 = 0
            dod2 = 0
            dpd0 = 0 .
     IF wdetail.dod <> 0  THEN DO:
         dod0 = wdetail.dod.
         /*IF TRIM(wdetail.body) = "MOTORCYCLE"  THEN DO:*/ /*A65-0043*/
         IF SUBSTR(wdetail.subclass,1,1) = "6"  THEN DO:    /*A65-0043*/
             IF dod0 > 1000 THEN DO:
                dod1 = 1000.
                dod2 = dod0 - dod1.
            END.
            ELSE dod1 = dod0.
         END.
         ELSE DO:
            IF dod0 > 3000 THEN DO:
                dod1 = 3000.
                dod2 = dod0 - dod1.
            END.
            ELSE dod1 = dod0.
         END.
     END.

     nv_dedod1var = "" . 
     nv_dedod2var = "" .
     IF dod1 <> 0 THEN DO:
        ASSIGN DOD2        = 0
             nv_odcod    = "DC01"
             nv_prem     =  dod1 
             nv_sivar2   =  "" . 
         RUN Wgs\Wgsmx024( nv_tariff,              
                           nv_odcod,
                           nv_class,
                           nv_key_b,
                           nv_comdat,
                           INPUT-OUTPUT nv_prem,
                           OUTPUT nv_chk ,
                           OUTPUT nv_baseap). 
         IF NOT nv_chk THEN DO:
             MESSAGE  " DEDUCTIBLE EXCEED THE LIMIT " nv_baseap nv_prem   View-as alert-box.
             ASSIGN
                 wdetail.pass    = "N"
                 wdetail.comment = wdetail.comment + "| DEDUCTIBLE EXCEED THE LIMIT ".
         END.
         /*dod*/
    
      ASSIGN
          nv_dedod1var      = ""
          nv_dedod1_cod     = "DOD"
          nv_dedod1var1     = "     Deduct OD = "
          nv_dedod1var2     = STRING(dod1)
          SUBSTRING(nv_dedod1var,1,30)  = nv_dedod1var1
          SUBSTRING(nv_dedod1var,31,30) = nv_dedod1var2  .
     END.
      /*add od*/
      IF dod2 <> 0 THEN
         Assign  
             nv_dedod2var   = " "
             nv_cons  = "AD"
             nv_ded   = dod2.
         Assign
             nv_aded1prm     = nv_prem
             nv_dedod2_cod   = "DOD2"
             nv_dedod2var1   = "     Add Ded.OD = "
             nv_dedod2var2   =  STRING(dod2)
             SUBSTRING(nv_dedod2var,1,30)  = nv_dedod2var1
             SUBSTRING(nv_dedod2var,31,30) = nv_dedod2var2
             nv_dedod2_prm   = nv_prem.
  
     /***** pd *******/
     nv_dedpdvar = "" .
     IF wdetail.dpd <> 0  THEN DO:
         dpd0 = wdetail.dpd .
        Assign
            nv_dedpdvar  = " "
            nv_cons  = "PD"
            nv_ded   = dpd0.
        ASSIGN
            nv_dedpd_cod   = "DPD"
            nv_dedpdvar1   = "     Deduct PD = "
            nv_dedpdvar2   =  STRING(nv_ded)
            SUBSTRING(nv_dedpdvar,1,30)    = nv_dedpdvar1
            SUBSTRING(nv_dedpdvar,31,30)   = nv_dedpdvar2
            nv_dedpd_prm  = nv_prem  .    /*A57-0177*/
     END.
      /*---------- fleet -------------------*/
     nv_flet_per = INTE(wdetail.fleet).
     IF nv_flet_per <> 0 AND  nv_flet_per <> 10 Then do:
         Message  " Fleet Percent must be 0 or 10. " View-as alert-box.
         ASSIGN
             wdetail.pass    = "N"
             wdetail.comment = wdetail.comment + "| Fleet Percent must be 0 or 10. ".
     End.
     IF nv_flet_per = 0 Then do:
         ASSIGN nv_flet     = 0
             nv_fletvar  = " ".
     End.
     ELSE DO:
        ASSIGN  nv_fletvar     = " "
            nv_fletvar1    = "     Fleet % = "
            nv_fletvar2    =  STRING(nv_flet_per)
            SUBSTRING(nv_fletvar,1,30)     = nv_fletvar1
            SUBSTRING(nv_fletvar,31,30)    = nv_fletvar2.
     END.
     IF nv_flet   = 0  THEN nv_fletvar  = " ".
     /*---------------- NCB -------------------*/
     NV_NCBPER = INTE(WDETAIL.NCB).
     nv_ncbvar = " ".
     If nv_ncbper  <> 0 Then do:
         Find first sicsyac.xmm104 Use-index xmm10401 Where
             sicsyac.xmm104.tariff = nv_tariff           AND
             sicsyac.xmm104.class  = nv_class            AND 
             sicsyac.xmm104.covcod = nv_covcod           AND 
             sicsyac.xmm104.ncbper   = INTE(wdetail.ncb) No-lock no-error no-wait.
         IF not avail  sicsyac.xmm104  Then do:
             Message " This NCB Step not on NCB Rates file xmm104. " View-as alert-box.
             ASSIGN 
                 wdetail.pass    = "N"
                 wdetail.comment = wdetail.comment + "| This NCB Step not on NCB Rates file xmm104. ".
         END.
         ELSE ASSIGN nv_ncbper = sicsyac.xmm104.ncbper   
                     nv_ncbyrs = sicsyac.xmm104.ncbyrs.
     END.
     Else do:  
         ASSIGN nv_ncbyrs =   0
             nv_ncbper    =   0
             nv_ncb       =   0.
     END.
     
     nv_ncbvar   = " ".
     IF  nv_ncb <> 0  THEN
         ASSIGN 
         nv_ncbvar1   = "     NCB % = "
         nv_ncbvar2   =  STRING(nv_ncbper)
         SUBSTRING(nv_ncbvar,1,30)    = nv_ncbvar1
         SUBSTRING(nv_ncbvar,31,30)   = nv_ncbvar2.
     
     /*------------------ dsspc ---------------*/
      IF  nv_dss_per   <> 0  THEN 
          ASSIGN nv_dsspcvar = " "
          nv_dsspcvar1   = "     Discount Special % = "
          nv_dsspcvar2   =  STRING(nv_dss_per)
          SUBSTRING(nv_dsspcvar,1,30)    = nv_dsspcvar1
          SUBSTRING(nv_dsspcvar,31,30)   = nv_dsspcvar2.
      /*--------------------------*/
    /*----------- CL ------------*/
    nv_clmvar  = " ".                                    
    nv_cl_per  = DECI(wdetail.claim). /*A60-0150*/      
    IF nv_cl_per  <> 0  THEN                             
        Assign                                           
        nv_clmvar1   = " Load Claim % = "                
        nv_clmvar2   =  STRING(nv_cl_per)                
        SUBSTRING(nv_clmvar,1,30)    = nv_clmvar1        
        SUBSTRING(nv_clmvar,31,30)   = nv_clmvar2.       
              
                                                         
    /* *------------------ stf ---------------*/         
    nv_stfvar   = " ".                                   
    nv_stf_per  = DECI(wdetail.dstf). /*A60-0150*/    
    IF  nv_stf_per   <> 0  THEN                          
    Assign                                               
         nv_stfvar1   = "     Discount Staff"            
         nv_stfvar2   =  STRING(nv_stf_per)              
         SUBSTRING(nv_stfvar,1,30)    = nv_stfvar1       
         SUBSTRING(nv_stfvar,31,30)   = nv_stfvar2.  
   
END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_baseplus C-Win 
PROCEDURE proc_baseplus :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
ASSIGN 
    nv_baseprm3 = 0 
    NO_basemsg = " " .  
    FIND FIRST sicsyac.xmm106 USE-INDEX xmm10601 WHERE
           sicsyac.xmm106.tariff =  nv_tariff   AND
           sicsyac.xmm106.bencod =  nv_basecod3 AND
           sicsyac.xmm106.covcod =  nv_covcod   AND
           sicsyac.xmm106.class  =  nv_class    AND
           sicsyac.xmm106.key_b  GE nv_key_b    AND
           sicsyac.xmm106.effdat LE nv_comdat
        NO-LOCK NO-ERROR NO-WAIT.
    IF AVAIL sicsyac.xmm106 THEN DO:
       nv_baseprm3 = sicsyac.xmm106.min_ap.
    END.

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_calpremt_EV C-Win 
PROCEDURE proc_calpremt_EV :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DEF VAR chk     AS LOGICAL.
DEF VAR n_prem  AS DECI.
FIND sic_bran.uwm100 WHERE RECID(sic_bran.uwm100) = s_recid1 NO-WAIT NO-ERROR.
FIND sic_bran.uwm120 WHERE RECID(sic_bran.uwm120) = s_recid2 NO-WAIT NO-ERROR.
FIND sic_bran.uwm130 WHERE RECID(sic_bran.uwm130) = s_recid3 NO-WAIT NO-ERROR.
FIND sic_bran.uwm301 WHERE RECID(sic_bran.uwm301) = s_recid4 NO-WAIT NO-ERROR.
IF wdetail.poltyp = "V70" THEN DO:
        ASSIGN fi_process = "Create data to base..." + wdetail.policy .
        DISP fi_process WITH FRAM fr_main.
        RUN proc_initcal.
        ASSIGN               
            nv_covcod  = wdetail.covcod                                              
            nv_class   = trim(wdetail.prempa) + trim(wdetail.subclass)     /* T110 */                                     
            nv_vehuse  = wdetail.vehuse       
            nv_driage1 = nv_drivage1                                 
            nv_driage2 = nv_drivage2                                    
            nv_yrmanu  = INT(wdetail.yrmanu)         
            nv_totsi   = IF sic_bran.uwm130.uom6_v = 0 THEN sic_bran.uwm130.uom7_v ELSE sic_bran.uwm130.uom6_v /*A66-0202*/
            nv_totfi   = sic_bran.uwm130.uom7_v
            nv_vehgrp  = wdetail.cargrp                                                     
            nv_access  = IF wdetail.special <> "A" THEN "" ELSE TRIM(wdetail.special) 
            nv_tpbi1si = nv_uom1_v             
            nv_tpbi2si = nv_uom2_v             
            nv_tppdsi  = nv_uom5_v             
            nv_411si   = wdetail.NO_411       
            nv_412si   = wdetail.NO_412       
            nv_413si   = wdetail.NO_413                       
            nv_414si   = wdetail.NO_414                     
            nv_42si    = wdetail.no_42                
            nv_43si    = wdetail.no_43 
            nv_41prmt  = wdetail.ry01   
            nv_412prmt = wdetail.ry412  
            nv_413prmt = wdetail.ry413  
            nv_414prmt = wdetail.ry414  
            nv_42prmt  = wdetail.ry02   
            nv_43prmt  = wdetail.ry03   
            nv_seat41  = wdetail.seat41  
            nv_dedod   = dod1      
            nv_addod   = dod2                                
            nv_dedpd   = deci(wdetail.DPD)                                    
            nv_ncbp    = deci(wdetail.ncb)                                     
            nv_fletp   = deci(wdetail.fleet)                                  
            nv_dspcp   = deci(wdetail.dspc)                                      
            nv_dstfp   = deci(wdetail.dstf)                                                    
            nv_clmp    = deci(wdetail.claim)
            /* Add : A65-0079 */
            nv_mainprm  = IF INT(wdetail.unname) <> 0 THEN deci(wdetail.unname) ELSE deci(wdetail.nname) 
            nv_dodamt   = deci(wdetail.dod_prm)  /* ระบุเบี้ย DOD */   
            nv_dadamt   = deci(wdetail.dod1_prm) /* ระบุเบี้ย DOD1 */  
            nv_dpdamt   = deci(wdetail.dpd_prm)  /* ระบุเบี้ย DPD */   
            nv_ncbamt   = deci(wdetail.ncbprem)  /* ระบุเบี้ย NCB PREMIUM */           
            nv_fletamt  = deci(wdetail.fleetprem)/* ระบุเบี้ย FLEET PREMIUM */          
            nv_dspcamt  = deci(wdetail.dspcprem) /* ระบุเบี้ย DSPC PREMIUM */           
            nv_dstfamt  = deci(wdetail.dstfprem) /* ระบุเบี้ย DSTF PREMIUM */           
            nv_clmamt   = deci(wdetail.clprem)   /* ระบุเบี้ย LOAD CLAIM PREMIUM */    
            /* end : A65-0079*/
            nv_baseprm  = deci(wdetail.base)
            nv_baseprm3 = deci(wdetail.baseplus) 
            nv_netprem  = DECI(wdetail.premt) /* เบี้ยสุทธิ เบี้ยเต็มปี */  
            nv_pdprem   = DECI(wdetail.premt) /* เบี้ยสุทธิ เบี้ยเต็มปี */
            nv_gapprem  = DECI(wdetail.premt)
            nv_gapprm   = 0                                                     
            nv_flagprm  = "N"  /* N = เบี้ยสุทธิ, G = เบี้ยรวม */                                    
            nv_effdat   = sic_bran.uwm100.comdat
            nv_ratatt   = deci(wdetail.dgrate)                        
            nv_siatt    = deci(wdetail.dgsi)                                                        
            nv_netatt   = deci(wdetail.dgprem)          
            nv_fltatt   = deci(wdetail.dgfeet)         
            nv_ncbatt   = deci(wdetail.dgncb)          
            nv_dscatt   = deci(wdetail.dgdisc)
            nv_attgap   = deci(wdetail.dgatt) 
            nv_atfltgap = deci(wdetail.dgfeetprm)
            nv_atncbgap = deci(wdetail.dgncbprm)
            nv_atdscgap = deci(wdetail.dgdiscprm) 
            nv_packatt  = trim(wdetail.dgpackge)
            nv_flgsht   = IF wdetail.srate = "Y" THEN "S" ELSE "P" /*A65-0079*/
            nv_fcctv    = IF wdetail.cctv <> "" THEN YES ELSE NO 
            /* A67-0029*/
            nv_level      = INTE(wdetail.drilevel)   
            nv_levper     = nv_dlevper 
            nv_tariff     = wdetail.tariff
            nv_adjpaprm   = IF nv_41prmt <> 0 OR nv_412prmt <> 0 OR nv_413prmt <> 0 OR nv_414prmt <> 0 OR nv_42prmt <> 0 OR nv_43prmt <> 0 THEN YES ELSE NO
            nv_flgpol     = IF wdetail.prepol = "" THEN "NR" ELSE "RN" /*NR=New RedPlate, NU=New Used Car, RN=Renew*/                   
            nv_flgclm     = IF nv_clmp <> 0 THEN "WC" ELSE "NC"  /*NC=NO CLAIM , WC=With Claim*/  
            nv_chgflg     = IF DECI(wdetail.chargprm) <> 0 THEN YES ELSE NO    
            nv_chgrate    = DECI(wdetail.chargrate)                     
            nv_chgsi      = INTE(wdetail.chargsi)                                     
            nv_chgpdprm   = DECI(wdetail.chargprm)                                     
            nv_chggapprm  = 0                                     
            nv_battflg    = IF DECI(wdetail.battprm) <> 0 THEN YES ELSE NO                                    
            nv_battrate   = DECI(wdetail.battrate)                                    
            nv_battsi     = INTE(wdetail.battsi)                                     
            nv_battprice  = INTE(wdetail.battprice)                     
            nv_battpdprm  = DECI(wdetail.battprm)                                     
            nv_battgapprm = 0                                                                                                                     
            nv_battyr     = INTE(wdetail.battyr)    
            nv_battper    = DECI(wdetail.battper)
            nv_evflg      = IF index(wdetail.subclass,"E") <> 0 THEN YES ELSE NO  
            nv_compprm    = 0       nv_uom9_v     = 0 
            /* end A67-0029*/
            nv_flag     = IF index(wdetail.subclass,"E") <> 0 THEN NO ELSE tg_flag  /*A68-0044*/   
            nv_garage   = TRIM(wdetail.garage) 
            nv_31prmt   = DECI(wdetail.prmt31)    /*A68-0044*/
            nv_31rate   = DECI(wdetail.rate31) .  /*A68-0044*/
         FIND FIRST stat.clastab_fil USE-INDEX clastab01 WHERE clastab_fil.CLASS  = nv_class  AND clastab_fil.covcod = wdetail.covcod NO-LOCK NO-ERROR.
            IF AVAIL stat.clastab_fil THEN DO:
                IF clastab_fil.unit = "C" THEN DO:
                    ASSIGN nv_cstflg = IF SUBSTR(nv_class,5,1) = "E" OR SUBSTR(nv_class,2,1) = "E" THEN "H" ELSE clastab_fil.unit
                           nv_engine = IF SUBSTR(nv_class,5,1) = "E" OR SUBSTR(nv_class,2,1) = "E" THEN DECI(wdetail.watt) ELSE INT(wdetail.engcc).
                END.
                ELSE IF clastab_fil.unit = "S" THEN DO:
                    ASSIGN nv_cstflg = clastab_fil.unit     nv_engine = INT(wdetail.seat).
                END.
                ELSE IF clastab_fil.unit = "T" THEN DO:
                    ASSIGN nv_cstflg = clastab_fil.unit     nv_engine = DECI(sic_bran.uwm301.Tons).
                END.
                ELSE IF clastab_fil.unit = "H" THEN DO:
                    ASSIGN nv_cstflg = clastab_fil.unit     nv_engine = DECI(wdetail.watt). 
                END.
                nv_engcst = nv_engine .
            END.
        IF wdetail.redbook = ""  THEN DO:
            IF nv_cstflg = "W" OR nv_cstflg = "H" THEN DO:
                 RUN wgw/wgwredbev(input  wdetail.brand       , input  wdetail.model  ,  
                                   input  INT(wdetail.si)     , INPUT  wdetail.tariff ,  
                                   input  SUBSTR(nv_class,2,5), input  wdetail.yrmanu , 
                                   input  nv_engine ,input  0 , 
                                   INPUT-OUTPUT wdetail.maksi ,
                                   INPUT-OUTPUT wdetail.redbook) .
            END.
            ELSE IF nv_cstflg <> "T" THEN DO:
                RUN wgw/wgwredbk1(input  wdetail.brand ,       /*A65=0079*/
                               input  wdetail.model ,  
                               input  nv_totsi      ,  
                               INPUT  wdetail.tariff,  
                               input  SUBSTR(nv_class,2,5),   
                               input  wdetail.yrmanu, 
                               input  nv_engine  ,
                               input  0 , 
                               INPUT-OUTPUT wdetail.redbook) .
            END.
            ELSE DO:
                 RUN wgw/wgwredbk1(input  wdetail.brand ,       /*A65=0079*/  
                               input  wdetail.model ,  
                               input  INT(wdetail.si) ,  
                               INPUT  wdetail.tariff,  
                               input  SUBSTR(nv_class,2,5),   
                               input  wdetail.yrmanu, 
                               input  0  ,
                               input  nv_engine , 
                               INPUT-OUTPUT wdetail.redbook) .
            END.
            IF wdetail.redbook <> "" THEN RUN proc_chkredbook. /* A68-0044*/
            ELSE DO:
             ASSIGN wdetail.comment = wdetail.comment + "| " + "Redbook is Null !! "
                    wdetail.WARNING = "Redbook เป็นค่าว่างไม่สามารถนำเข้ามูลเข้าได้ "  .
                    wdetail.pass    = "N". /*A65-0079*/
            END.
        END.
        FIND LAST stat.maktab_fil WHERE maktab_fil.makdes   =  wdetail.brand AND maktab_fil.sclass   =  trim(SUBSTR(nv_class,2,4)) NO-LOCK NO-ERROR.
            IF AVAIL stat.maktab_fil THEN nv_supe = maktab_fil.impchg.
        IF sic_bran.uwm100.expdat NE ? AND sic_bran.uwm100.comdat NE ? THEN DO:
            IF ( DAY(sic_bran.uwm100.comdat)     =  DAY(sic_bran.uwm100.expdat)     AND
               MONTH(sic_bran.uwm100.comdat)     =  MONTH(sic_bran.uwm100.expdat)   AND
                YEAR(sic_bran.uwm100.comdat) + 1 =  YEAR(sic_bran.uwm100.expdat) )  OR
               ( DAY(sic_bran.uwm100.comdat)     =   29      AND
               MONTH(sic_bran.uwm100.comdat)     =   02      AND
                 DAY(sic_bran.uwm100.expdat)     =   01      AND
               MONTH(sic_bran.uwm100.expdat)     =   03      AND
                YEAR(sic_bran.uwm100.comdat) + 1 =  YEAR(sic_bran.uwm100.expdat) )
            THEN DO:
              nv_polday = 365.
            END.
            ELSE DO:
              nv_polday = (sic_bran.uwm100.expdat  - sic_bran.uwm100.comdat ) + 1 .     /*    =  366  วัน */
            END.
        END.
        IF nv_polday < 365 THEN DO:
            nv_polday  = (sic_bran.uwm100.expdat  - sic_bran.uwm100.comdat) + 1. /*F67-0001*/
        END.
   /* RUN WUW\WUWMCP01.P(INPUT sic_bran.uwm100.policy, */ /*A68-0044*/
    RUN WUW\WUWMCP02.P(INPUT sic_bran.uwm100.policy,       /*A68-0044*/
                     INPUT nv_campcd ,
                     INPUT sic_bran.uwm100.rencnt,
                     INPUT sic_bran.uwm100.endcnt,
                     INPUT 0  , /*nv_riskgp*/
                     INPUT nv_riskno ,
                     INPUT nv_itemno ,
                     INPUT nv_batchyr,
                     INPUT nv_batchno,
                     INPUT nv_batcnt ,
                     INPUT nv_polday ,
                     INPUT nv_usrid  ,
                     INPUT "wgwloadem"  ,
                     INPUT 3, /*nv_diffprm*/
                     INPUT nv_tariff,
                     INPUT nv_covcod,
                     INPUT nv_class ,
                     INPUT nv_vehuse,
                     INPUT nv_cstflg,
                     INPUT nv_engcst,
                     INPUT nv_drivno,
                     INPUT nv_driage1,
                     INPUT nv_driage2,
                     INPUT nv_level ,
                     INPUT nv_levper ,
                     INPUT nv_yrmanu,
                     INPUT nv_totsi ,
                     INPUT nv_totfi ,
                     INPUT nv_vehgrp,
                     INPUT nv_access,
                     INPUT nv_supe,
                     INPUT nv_tpbi1si,
                     INPUT nv_tpbi2si,
                     INPUT nv_tppdsi,
                     INPUT nv_411si,
                     INPUT nv_412si,
                     INPUT nv_413si,
                     INPUT nv_414si,
                     INPUT nv_42si,
                     INPUT nv_43si,
                     INPUT nv_41prmt,   
                     INPUT nv_412prmt,   
                     INPUT nv_413prmt,  
                     INPUT nv_414prmt,   
                     INPUT nv_42prmt,  
                     INPUT nv_43prmt,   
                     INPUT nv_seat41,
                     INPUT nv_dedod,
                     INPUT nv_addod,
                     INPUT nv_dedpd,
                     INPUT nv_dodamt,   
                     INPUT nv_dadamt,   
                     INPUT nv_dpdamt,   
                     INPUT nv_pdprem,
                     INPUT nv_gapprem,
                     INPUT nv_flagprm,
                     INPUT nv_effdat,
                     INPUT nv_adjpaprm,  /* yes/ No*/
                     INPUT YES ,         /* nv_adjprem yes/ No*/
                     INPUT nv_flgpol ,  /*NR=New RedPlate, NU=New Used Car, RN=Renew*/                   
                     INPUT nv_flgclm ,  /*NC=NO CLAIM , WC=With Claim*/                                  
                     INPUT 10,    /*cv_lfletper  = Limit Fleet % 10%*/                                                                                                                          
                     INPUT cv_lncbper , /*50,*/ /*  = Limit NCB %  50%*/                                                                                                                           
                     INPUT 35,    /*cv_ldssper  = Limit DSPC % กรณีป้ายแดง 110  ส่ง 45%  นอกนั้นส่ง 30% 35%*/                                                                                  
                     INPUT 0 ,    /*cv_lclmper  = Limit Claim % กรณีให้ Load Claim ได้ New 0% or 50% , Renew 0% or 20 - 50%  0%*/                                                              
                     INPUT 0 ,    /*cv_ldstfper = Limit DSTF % 0%*/                                                                                                                            
                     INPUT NO,   /*nv_reflag   = กรณีไม่ต้องการ Re-Calculate ใส่ Yes*/                                                                                                        
                     INPUT-OUTPUT nv_ncbyrs ,                                                                                                                                                                 
                     INPUT-OUTPUT nv_ncbp,
                     INPUT-OUTPUT nv_fletp,
                     INPUT-OUTPUT nv_dspcp,
                     INPUT-OUTPUT nv_dstfp,
                     INPUT-OUTPUT nv_clmp,
                     INPUT-OUTPUT nv_pdprm0,
                     INPUT-OUTPUT nv_ncbamt ,  
                     INPUT-OUTPUT nv_fletamt, 
                     INPUT-OUTPUT nv_dspcamt,  /*  DSPC PREMIUM */
                     INPUT-OUTPUT nv_dstfamt,  /*  DSTF PREMIUM */
                     INPUT-OUTPUT nv_clmamt ,  /*  LOAD CLAIM PREMIUM */
                     INPUT-OUTPUT nv_baseprm,
                     INPUT-OUTPUT nv_baseprm3,
                     INPUT-OUTPUT nv_mainprm,  /* Main Premium Name/Unname Premium (HG) */
                     INPUT-OUTPUT nv_ratatt,
                     INPUT-OUTPUT nv_siatt ,
                     INPUT-OUTPUT nv_netatt,
                     INPUT-OUTPUT nv_fltatt,
                     INPUT-OUTPUT nv_ncbatt,
                     INPUT-OUTPUT nv_dscatt,
                     INPUT-OUTPUT nv_attgap ,   /*a65-0079*/
                     INPUT-OUTPUT nv_atfltgap,  /*a65-0079*/
                     INPUT-OUTPUT nv_atncbgap,  /*a65-0079*/
                     INPUT-OUTPUT nv_atdscgap,  /*a65-0079*/
                     INPUT-OUTPUT nv_packatt ,  /*a65-0079*/
                     INPUT-OUTPUT nv_chgflg     ,
                     INPUT-OUTPUT nv_chgrate    ,
                     INPUT-OUTPUT nv_chgsi      ,
                     INPUT-OUTPUT nv_chgpdprm   ,
                     INPUT-OUTPUT nv_chggapprm  ,
                     INPUT-OUTPUT nv_battflg    ,
                     INPUT-OUTPUT nv_battrate   ,
                     INPUT-OUTPUT nv_battsi     ,
                     INPUT-OUTPUT nv_battprice  ,
                     INPUT-OUTPUT nv_battpdprm  ,
                     INPUT-OUTPUT nv_battgapprm ,
                     INPUT-OUTPUT nv_battyr     ,
                     INPUT-OUTPUT nv_battper    ,
                     INPUT-OUTPUT nv_flag,    /* tariff flag = yes/no A68-0044*/ 
                     INPUT-OUTPUT nv_garage , /* A68-0044*/                      
                     INPUT-OUTPUT nv_31rate , /*a68-0044*/                       
                     INPUT-OUTPUT nv_31prmt , /* A68-0044*/                      
                     INPUT-OUTPUT nv_compprm ,
                     INPUT-OUTPUT nv_uom9_v  ,
                     INPUT-OUTPUT nv_fcctv ,  /* cctv = yes/no */
                     INPUT-OUTPUT nv_flgsht , /* Short rate = "S" , Pro rate = "P" */
                     INPUT-OUTPUT nv_evflg ,  /* EV = yes/no */
                     OUTPUT nv_uom1_c,
                     OUTPUT nv_uom2_c,
                     OUTPUT nv_uom5_c,
                     OUTPUT nv_uom6_c,
                     OUTPUT nv_uom7_c,
                     output nv_gapprm,
                     output nv_pdprm ,
                     OUTPUT nv_status,
                     OUTPUT nv_message).
    ASSIGN sic_bran.uwm130.uom1_c  = nv_uom1_c      sic_bran.uwm130.uom2_c  = nv_uom2_c
           sic_bran.uwm130.uom5_c  = nv_uom5_c      sic_bran.uwm130.uom6_c  = nv_uom6_c
           sic_bran.uwm130.uom7_c  = nv_uom7_c .
    IF nv_drivno <> 0  THEN ASSIGN sic_bran.uwm301.actprm = nv_pdprm0. 
    ASSIGN sic_bran.uwm130.chr3 = IF nv_adjpaprm = YES THEN "YES" ELSE "NO" .   /*F68-0001*/
    IF nv_message <> "" THEN DO:   /*A65-0079*/
        IF INDEX(nv_message,"Not Found Benefit") <> 0 THEN ASSIGN wdetail.pass  = "N". /*A65-0043*/
        ASSIGN  wdetail.comment = wdetail.comment + "|" + nv_message
                wdetail.WARNING = wdetail.WARNING + "|" + nv_message.
    END.
END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_campaign110 C-Win 
PROCEDURE proc_campaign110 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes: create by a64-0044       
------------------------------------------------------------------------------*/
def var n_model    as char format "x(30)" init "" .
DO:
    IF wdetail.engcc <= 2000  THEN DO:  /* 2000 CC */
        IF wdetail.cargrp <> "" AND wdetail.vehuse <> ""  THEN DO:
         FIND LAST stat.campaign_fil USE-INDEX campfil04  WHERE 
             stat.campaign_fil.camcod = wdetail.packcod   AND /* campaign no */
             stat.campaign_fil.sclass = wdetail.subclass  AND /* class 110 210 320 */
             stat.campaign_fil.covcod = wdetail.covcod    AND /* cover 1 2 3 2.1 2.2 3.1 3.2 */
             stat.campaign_fil.vehgrp = wdetail.cargrp    AND /* group car */
             stat.campaign_fil.vehuse = wdetail.vehuse    AND /* ประเภทการใช้รถ */
             stat.campaign_fil.garage = wdetail.garage          AND /* การซ่อม */
             stat.campaign_fil.maxyea = n_yr                    AND /* อายุรถ */
             stat.campaign_fil.engine <= 2000             AND /* cc */  
             stat.campaign_fil.simax  = deci(wdetail.si)        AND  /* ทุน */
             stat.campaign_fil.makdes = wdetail.brand     AND 
             (index(wdetail.model,stat.campaign_fil.moddes) <> 0  OR   /* Model */
             index(stat.campaign_fil.moddes,wdetail.model) <> 0 ) AND   /* Model */ /*A64-0044*/
             stat.campaign_fil.netprm  = wdetail.premt         NO-LOCK NO-ERROR.   
        END.
        ELSE DO:
            FIND LAST stat.campaign_fil USE-INDEX campfil04  WHERE 
             stat.campaign_fil.camcod = wdetail.packcod   AND /* campaign no */
             stat.campaign_fil.sclass = wdetail.subclass  AND /* class 110 210 320 */
             stat.campaign_fil.covcod = wdetail.covcod    AND /* cover 1 2 3 2.1 2.2 3.1 3.2 */
             stat.campaign_fil.garage = wdetail.garage    AND /* การซ่อม */
             stat.campaign_fil.maxyea = n_yr              AND /* อายุรถ */
             stat.campaign_fil.engine <= 2000             AND /* cc */  
             stat.campaign_fil.simax  = deci(wdetail.si)  AND  /* ทุน */
             stat.campaign_fil.makdes = wdetail.brand     AND 
             (index(wdetail.model,stat.campaign_fil.moddes) <> 0  OR   /* Model */
             index(stat.campaign_fil.moddes,wdetail.model) <> 0 ) AND   /* Model */ /*A64-0044*/
             stat.campaign_fil.netprm  = wdetail.premt         NO-LOCK NO-ERROR. 
        END.
    END.
    ELSE DO:  /* > 2000 CC */
        IF wdetail.cargrp <> "" AND wdetail.vehuse <> ""  THEN DO:
            FIND LAST stat.campaign_fil USE-INDEX campfil04  WHERE 
                stat.campaign_fil.camcod = wdetail.packcod   AND /* campaign no */
                stat.campaign_fil.sclass = wdetail.subclass  AND /* class 110 210 320 */
                stat.campaign_fil.covcod = wdetail.covcod    AND /* cover 1 2 3 2.1 2.2 3.1 3.2 */
                stat.campaign_fil.vehgrp = wdetail.cargrp    AND /* group car */
                stat.campaign_fil.vehuse = wdetail.vehuse    AND /* ประเภทการใช้รถ */
                stat.campaign_fil.garage = wdetail.garage          AND /* การซ่อม */
                stat.campaign_fil.maxyea = n_yr                    AND /* อายุรถ */
                stat.campaign_fil.engine > 2000             AND /* cc */  
                stat.campaign_fil.simax  = deci(wdetail.si)        AND  /* ทุน */
                stat.campaign_fil.makdes = wdetail.brand     AND 
                (index(wdetail.model,stat.campaign_fil.moddes) <> 0  OR   /* Model */
                index(stat.campaign_fil.moddes,wdetail.model) <> 0 ) AND   /* Model */ /*A64-0044*/
                stat.campaign_fil.netprm  = wdetail.premt         NO-LOCK NO-ERROR.   
       END.
       ELSE DO:
           FIND LAST stat.campaign_fil USE-INDEX campfil04  WHERE 
                stat.campaign_fil.camcod = wdetail.packcod   AND /* campaign no */
                stat.campaign_fil.sclass = wdetail.subclass  AND /* class 110 210 320 */
                stat.campaign_fil.covcod = wdetail.covcod    AND /* cover 1 2 3 2.1 2.2 3.1 3.2 */
                stat.campaign_fil.garage = wdetail.garage    AND /* การซ่อม */
                stat.campaign_fil.maxyea = n_yr              AND /* อายุรถ */
                stat.campaign_fil.engine > 2000              AND /* cc */  
                stat.campaign_fil.simax  = deci(wdetail.si)  AND  /* ทุน */
                stat.campaign_fil.makdes = wdetail.brand     AND 
                (index(wdetail.model,stat.campaign_fil.moddes) <> 0  OR   /* Model */
                index(stat.campaign_fil.moddes,wdetail.model) <> 0 ) AND   /* Model */ /*A64-0044*/
                stat.campaign_fil.netprm  = wdetail.premt         NO-LOCK NO-ERROR. 
       END.
    END.
    IF AVAIL stat.campaign_fil THEN 
        ASSIGN   wdetail.polmaster = stat.campaign_fil.polmst
                 wdetail.seat41    = stat.campaign_fil.seat41. 
    ELSE DO: 
        IF deci(wdetail.si) > 1000000 THEN DO:
           ASSIGN nv_si = 0
                  nv_si = deci(wdetail.si) + 40000 .
           IF wdetail.engcc <= 2000  THEN DO:  /* 2000 CC */
             FIND LAST stat.campaign_fil USE-INDEX campfil04  WHERE 
              stat.campaign_fil.camcod = wdetail.packcod   AND /* campaign no */
              stat.campaign_fil.sclass = wdetail.subclass  AND /* class 110 210 320 */
              stat.campaign_fil.covcod = wdetail.covcod    AND /* cover 1 2 3 2.1 2.2 3.1 3.2 */
              stat.campaign_fil.garage = wdetail.garage    AND /* การซ่อม */
              stat.campaign_fil.maxyea = n_yr              AND /* อายุรถ */
              stat.campaign_fil.engine <= 2000             AND /* cc */  
              stat.campaign_fil.simax  >= deci(wdetail.si) AND
              stat.campaign_fil.simax  <= nv_si            AND
              stat.campaign_fil.makdes = wdetail.brand     AND 
              (index(wdetail.model,stat.campaign_fil.moddes) <> 0  OR   /* Model */
              index(stat.campaign_fil.moddes,wdetail.model) <> 0 ) AND   /* Model */ /*A64-0044*/
              stat.campaign_fil.netprm   = wdetail.premt           NO-LOCK NO-ERROR.   /* Model */
           END.
           ELSE DO:
              FIND LAST stat.campaign_fil USE-INDEX campfil04  WHERE 
                stat.campaign_fil.camcod = wdetail.packcod   AND /* campaign no */
                stat.campaign_fil.sclass = wdetail.subclass  AND /* class 110 210 320 */
                stat.campaign_fil.covcod = wdetail.covcod    AND /* cover 1 2 3 2.1 2.2 3.1 3.2 */
                stat.campaign_fil.garage = wdetail.garage    AND /* การซ่อม */
                stat.campaign_fil.maxyea = n_yr              AND /* อายุรถ */
                stat.campaign_fil.engine > 2000             AND /* cc */  
                stat.campaign_fil.simax  >= deci(wdetail.si) AND
                stat.campaign_fil.simax  <= nv_si            AND
                stat.campaign_fil.makdes = wdetail.brand     AND 
                (index(wdetail.model,stat.campaign_fil.moddes) <> 0  OR   /* Model */
                index(stat.campaign_fil.moddes,wdetail.model) <> 0 ) AND   /* Model */ /*A64-0044*/
                stat.campaign_fil.netprm   = wdetail.premt           NO-LOCK NO-ERROR.   /* Model */
           END.
           IF AVAIL stat.campaign_fil THEN 
               ASSIGN   wdetail.polmaster = stat.campaign_fil.polmst
                        wdetail.seat41    = stat.campaign_fil.seat41. 
           ELSE ASSIGN wdetail.polmaster = "" . 
        END. /* end si > 1000000 */
    END.
    /* ไม่เช็คอายุรถ */
    IF wdetail.polmaster = "" THEN DO:  /*A64-0044*/
        n_model = "" .
        IF INDEX(wdetail.model," ") <> 0 THEN ASSIGN n_model = SUBSTR(wdetail.model,1,INDEX(wdetail.model," ") - 1).
        ELSE n_model = TRIM(wdetail.model) .
        IF wdetail.engcc <= 2000 THEN DO:
            FIND LAST stat.campaign_fil /*USE-INDEX campfil01*/  WHERE 
                stat.campaign_fil.camcod = wdetail.packcod     AND /* campaign no */
                stat.campaign_fil.sclass = wdetail.subclass    AND /* class 110 210 320 */
                stat.campaign_fil.covcod = wdetail.covcod      AND /* cover 1 2 3 2.1 2.2 3.1 3.2 */
                stat.campaign_fil.garage = wdetail.garage      AND /* การซ่อม */
                stat.campaign_fil.maxyea = 1                   AND /* อายุรถ */
                stat.campaign_fil.engine <= 2000               AND /* cc */ 
                stat.campaign_fil.simax  = deci(wdetail.si)    AND  /* ทุน */
                stat.campaign_fil.makdes = wdetail.brand       AND 
                (index(n_model,stat.campaign_fil.moddes) <> 0  OR   /* Model */
                index(stat.campaign_fil.moddes,n_model) <> 0 ) AND   /* Model */ /*A64-0044*/
                stat.campaign_fil.netprm  = wdetail.premt         NO-LOCK NO-ERROR. 
        END.
        ELSE DO:
             FIND LAST stat.campaign_fil /*USE-INDEX campfil01*/  WHERE 
                stat.campaign_fil.camcod = wdetail.packcod     AND /* campaign no */
                stat.campaign_fil.sclass = wdetail.subclass    AND /* class 110 210 320 */
                stat.campaign_fil.covcod = wdetail.covcod      AND /* cover 1 2 3 2.1 2.2 3.1 3.2 */
                stat.campaign_fil.garage = wdetail.garage      AND /* การซ่อม */
                stat.campaign_fil.maxyea = 1                   AND /* อายุรถ */
                stat.campaign_fil.engine > 2000                AND /* cc */ 
                stat.campaign_fil.simax  = deci(wdetail.si)    AND  /* ทุน */
                stat.campaign_fil.makdes = wdetail.brand       AND 
                (index(n_model,stat.campaign_fil.moddes) <> 0  OR   /* Model */
                index(stat.campaign_fil.moddes,n_model) <> 0 ) AND   /* Model */ /*A64-0044*/
                stat.campaign_fil.netprm  = wdetail.premt         NO-LOCK NO-ERROR. 
        END.
        IF AVAIL stat.campaign_fil THEN 
         ASSIGN   wdetail.polmaster = stat.campaign_fil.polmst
                  wdetail.seat41    = stat.campaign_fil.seat41. 
        ELSE DO:
            FIND LAST stat.campaign_fil /*USE-INDEX campfil01*/  WHERE 
                stat.campaign_fil.camcod = wdetail.packcod     AND /* campaign no */
                stat.campaign_fil.sclass = wdetail.subclass    AND /* class 110 210 320 */
                stat.campaign_fil.covcod = wdetail.covcod      AND /* cover 1 2 3 2.1 2.2 3.1 3.2 */
                stat.campaign_fil.garage = wdetail.garage      AND /* การซ่อม */
                stat.campaign_fil.maxyea = 1                   AND /* อายุรถ */
                stat.campaign_fil.simax  = deci(wdetail.si)    AND  /* ทุน */
                stat.campaign_fil.makdes = wdetail.brand       AND 
                (index(n_model,stat.campaign_fil.moddes) <> 0  OR   /* Model */
                index(stat.campaign_fil.moddes,n_model) <> 0 ) AND   /* Model */ /*A64-0044*/
                stat.campaign_fil.netprm  = wdetail.premt         NO-LOCK NO-ERROR. 
             IF AVAIL stat.campaign_fil THEN 
               ASSIGN   wdetail.polmaster = stat.campaign_fil.polmst
                        wdetail.seat41    = stat.campaign_fil.seat41. 
        END.
    END.
END. 

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_chassic C-Win 
PROCEDURE proc_chassic :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DEFINE VAR nv_chanew AS CHAR.
DEFINE VAR nv_len AS INTE INIT 0.
ASSIGN nv_uwm301trareg = wdetail.chasno.
    loop_chk1:
    REPEAT:
        IF INDEX(nv_uwm301trareg,"-") <> 0 THEN DO:
            nv_len = LENGTH(nv_uwm301trareg).
            nv_uwm301trareg = SUBSTRING(nv_uwm301trareg,1,INDEX(nv_uwm301trareg,"-") - 1) +
                SUBSTRING(nv_uwm301trareg,INDEX(nv_uwm301trareg,"-") + 1, nv_len ) .
        END.
        ELSE LEAVE loop_chk1.
    END.
    loop_chk2:
    REPEAT:
        IF INDEX(nv_uwm301trareg,"/") <> 0 THEN DO:
            nv_len = LENGTH(nv_uwm301trareg).
            nv_uwm301trareg = SUBSTRING(nv_uwm301trareg,1,INDEX(nv_uwm301trareg,"/") - 1) +
                SUBSTRING(nv_uwm301trareg,INDEX(nv_uwm301trareg,"/") + 1, nv_len ) .
        END.
        ELSE LEAVE loop_chk2.
    END.
    loop_chk3:
    REPEAT:
        IF INDEX(nv_uwm301trareg,";") <> 0 THEN DO:
            nv_len = LENGTH(nv_uwm301trareg).
            nv_uwm301trareg = SUBSTRING(nv_uwm301trareg,1,INDEX(nv_uwm301trareg,";") - 1) +
                SUBSTRING(nv_uwm301trareg,INDEX(nv_uwm301trareg,";") + 1, nv_len ) .
        END.
        ELSE LEAVE loop_chk3.
    END.
    loop_chk4:
    REPEAT:
        IF INDEX(nv_uwm301trareg,".") <> 0 THEN DO:
            nv_len = LENGTH(nv_uwm301trareg).
            nv_uwm301trareg = SUBSTRING(nv_uwm301trareg,1,INDEX(nv_uwm301trareg,".") - 1) +
                SUBSTRING(nv_uwm301trareg,INDEX(nv_uwm301trareg,".") + 1, nv_len ) .
            
        END.
        ELSE LEAVE loop_chk4.
    END.
    loop_chk5:
    REPEAT:
        IF INDEX(nv_uwm301trareg,",") <> 0 THEN DO:
            nv_len = LENGTH(nv_uwm301trareg).
            nv_uwm301trareg = SUBSTRING(nv_uwm301trareg,1,INDEX(nv_uwm301trareg,",") - 1) +
                SUBSTRING(nv_uwm301trareg,INDEX(nv_uwm301trareg,",") + 1, nv_len ) .
            
        END.
        ELSE LEAVE loop_chk5.
    END.
    loop_chk6:
    REPEAT:
        IF INDEX(nv_uwm301trareg," ") <> 0 THEN DO:
            nv_len = LENGTH(nv_uwm301trareg).
            nv_uwm301trareg = SUBSTRING(nv_uwm301trareg,1,INDEX(nv_uwm301trareg," ") - 1) +
                SUBSTRING(nv_uwm301trareg,INDEX(nv_uwm301trareg," ") + 1, nv_len ) .
            
        END.
        ELSE LEAVE loop_chk6.
    END.
    loop_chk7:
    REPEAT:
        IF INDEX(nv_uwm301trareg,"\") <> 0 THEN DO:
            nv_len = LENGTH(nv_uwm301trareg).
            nv_uwm301trareg = SUBSTRING(nv_uwm301trareg,1,INDEX(nv_uwm301trareg,"\") - 1) +
                SUBSTRING(nv_uwm301trareg,INDEX(nv_uwm301trareg,"\") + 1, nv_len ) .
            
        END.
        ELSE LEAVE loop_chk7.
    END.
    loop_chk8:
    REPEAT:
        IF INDEX(nv_uwm301trareg,":") <> 0 THEN DO:
            nv_len = LENGTH(nv_uwm301trareg).
            nv_uwm301trareg = SUBSTRING(nv_uwm301trareg,1,INDEX(nv_uwm301trareg,":") - 1) +
                SUBSTRING(nv_uwm301trareg,INDEX(nv_uwm301trareg,":") + 1, nv_len ) .
            
        END.
        ELSE LEAVE loop_chk8.
    END.
    loop_chk9:
    REPEAT:
        IF INDEX(nv_uwm301trareg,"|") <> 0 THEN DO:
            nv_len = LENGTH(nv_uwm301trareg).
            nv_uwm301trareg = SUBSTRING(nv_uwm301trareg,1,INDEX(nv_uwm301trareg,"|") - 1) +
                SUBSTRING(nv_uwm301trareg,INDEX(nv_uwm301trareg,"|") + 1, nv_len ) .
            
        END.
        ELSE LEAVE loop_chk9.
    END.
    loop_chk10:
    REPEAT:
        IF INDEX(nv_uwm301trareg,"+") <> 0 THEN DO:
            nv_len = LENGTH(nv_uwm301trareg).
            nv_uwm301trareg = SUBSTRING(nv_uwm301trareg,1,INDEX(nv_uwm301trareg,"+") - 1) +
                SUBSTRING(nv_uwm301trareg,INDEX(nv_uwm301trareg,"+") + 1, nv_len ) .
            
        END.
        ELSE LEAVE loop_chk10.
    END.
    loop_chk11:
    REPEAT:
        IF INDEX(nv_uwm301trareg,"#") <> 0 THEN DO:
            nv_len = LENGTH(nv_uwm301trareg).
            nv_uwm301trareg = SUBSTRING(nv_uwm301trareg,1,INDEX(nv_uwm301trareg,"#") - 1) +
                SUBSTRING(nv_uwm301trareg,INDEX(nv_uwm301trareg,"#") + 1, nv_len ) .
            
        END.
        ELSE LEAVE loop_chk11.
    END.
    loop_chk12:
    REPEAT:
        IF INDEX(nv_uwm301trareg,"[") <> 0 THEN DO:
            nv_len = LENGTH(nv_uwm301trareg).
            nv_uwm301trareg = SUBSTRING(nv_uwm301trareg,1,INDEX(nv_uwm301trareg,"[") - 1) +
                SUBSTRING(nv_uwm301trareg,INDEX(nv_uwm301trareg,"[") + 1, nv_len ) .
            
        END.
        ELSE LEAVE loop_chk12.
    END.
    loop_chk13:
    REPEAT:
        IF INDEX(nv_uwm301trareg,"]") <> 0 THEN DO:
            nv_len = LENGTH(nv_uwm301trareg).
            nv_uwm301trareg = SUBSTRING(nv_uwm301trareg,1,INDEX(nv_uwm301trareg,"]") - 1) +
                SUBSTRING(nv_uwm301trareg,INDEX(nv_uwm301trareg,"]") + 1, nv_len ) .
            
        END.
        ELSE LEAVE loop_chk13.
    END.
    loop_chk14:
    REPEAT:
        IF INDEX(nv_uwm301trareg,"'") <> 0 THEN DO:
            nv_len = LENGTH(nv_uwm301trareg).
            nv_uwm301trareg = SUBSTRING(nv_uwm301trareg,1,INDEX(nv_uwm301trareg,"'") - 1) +
                SUBSTRING(nv_uwm301trareg,INDEX(nv_uwm301trareg,"+") + 1, nv_len ) .
            
        END.
        ELSE LEAVE loop_chk14.
    END.
    loop_chk15:
    REPEAT:
        IF INDEX(nv_uwm301trareg,"(") <> 0 THEN DO:
            nv_len = LENGTH(nv_uwm301trareg).
            nv_uwm301trareg = SUBSTRING(nv_uwm301trareg,1,INDEX(nv_uwm301trareg,"(") - 1) +
                SUBSTRING(nv_uwm301trareg,INDEX(nv_uwm301trareg,"(") + 1, nv_len ) .
            
        END.
        ELSE LEAVE loop_chk15.
    END.
    loop_chk16:
    REPEAT:
        IF INDEX(nv_uwm301trareg,"_") <> 0 THEN DO:
            nv_len = LENGTH(nv_uwm301trareg).
            nv_uwm301trareg = SUBSTRING(nv_uwm301trareg,1,INDEX(nv_uwm301trareg,"_") - 1) +
                SUBSTRING(nv_uwm301trareg,INDEX(nv_uwm301trareg,"_") + 1, nv_len ) .
            
        END.
        ELSE LEAVE loop_chk16.
    END.
    loop_chk17:
    REPEAT:
        IF INDEX(nv_uwm301trareg,"*") <> 0 THEN DO:
            nv_len = LENGTH(nv_uwm301trareg).
            nv_uwm301trareg = SUBSTRING(nv_uwm301trareg,1,INDEX(nv_uwm301trareg,"*") - 1) +
                SUBSTRING(nv_uwm301trareg,INDEX(nv_uwm301trareg,"*") + 1, nv_len ) .
            
        END.
        ELSE LEAVE loop_chk17.
    END.
     loop_chk18:
    REPEAT:
        IF INDEX(nv_uwm301trareg,")") <> 0 THEN DO:
            nv_len = LENGTH(nv_uwm301trareg).
            nv_uwm301trareg = SUBSTRING(nv_uwm301trareg,1,INDEX(nv_uwm301trareg,")") - 1) +
                SUBSTRING(nv_uwm301trareg,INDEX(nv_uwm301trareg,")") + 1, nv_len ) .
            
        END.
        ELSE LEAVE loop_chk18.
    END.
    loop_chk19:
    REPEAT:
        IF INDEX(nv_uwm301trareg,"=") <> 0 THEN DO:
            nv_len = LENGTH(nv_uwm301trareg).
            nv_uwm301trareg = SUBSTRING(nv_uwm301trareg,1,INDEX(nv_uwm301trareg,"=") - 1) +
                SUBSTRING(nv_uwm301trareg,INDEX(nv_uwm301trareg,"=") + 1, nv_len ) .
            
        END.
        ELSE LEAVE loop_chk19.
    END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_chkcampaign C-Win 
PROCEDURE proc_chkcampaign :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DO:
    ASSIGN fi_process = "check Campiagn code..." + wdetail.camp_no + ".....".
    DISP fi_process WITH FRAM fr_main.

    FIND LAST stat.campaign_br USE-INDEX campbr01  WHERE campaign_br.campcode = campaign_master.campcode AND
         campaign_br.branch = wdetail.n_branch  NO-LOCK NO-ERROR .
    IF NOT AVAIL campaign_br THEN 
         ASSIGN wdetail.comment = wdetail.comment + "|ไม่พบข้อมูล Branch " + wdetail.n_branch + " ของแคมเปญ " + wdetail.camp_no + " ในระบบ (Campaign_br) "
                wdetail.pass    = "N" 
                wdetail.OK_GEN  = "N".

    FIND LAST stat.campaign_acno USE-INDEX campacno01  WHERE campaign_acno.campcode = campaign_master.campcode AND
         campaign_acno.acno = wdetail.producer  NO-LOCK NO-ERROR .
    IF NOT AVAIL campaign_acno THEN DO:
        FIND LAST campaign_acno USE-INDEX campacno01  WHERE campaign_acno.campcode = campaign_master.campcode AND
         campaign_acno.acno = "ALL" NO-LOCK NO-ERROR .
        IF NOT AVAIL campaign_acno THEN 
            ASSIGN wdetail.comment = wdetail.comment + "| ไม่พบข้อมูล Acno " + wdetail.producer + " ของแคมเปญ " + wdetail.camp_no + " ในระบบ (Campaign_acno) "
                   wdetail.pass    = "N" 
                   wdetail.OK_GEN  = "N".
    END.

    FIND LAST stat.campaign_poltyp USE-INDEX camppoltyp01  WHERE campaign_poltyp.campcode = campaign_master.campcode AND
         campaign_poltyp.poltyp = wdetail.poltyp  NO-LOCK NO-ERROR .
    IF NOT AVAIL campaign_poltyp THEN
        ASSIGN wdetail.comment = wdetail.comment + "| ไม่พบข้อมูล Poltyp " + wdetail.poltyp + " ของแคมเปญ " + wdetail.camp_no + " ในระบบ (Campaign_poltyp) "
               wdetail.pass    = "N" 
               wdetail.OK_GEN  = "N".

    release stat.campaign_br.
    release stat.campaign_acno.
    release stat.campaign_poltyp.
END.

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_chkclass72 C-Win 
PROCEDURE proc_chkclass72 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DEF VAR nv_class AS CHAR INIT "" .
DO:
 /* add by : Ranu I. A64-0044 */
 IF LENGTH(re_class) > 3 THEN ASSIGN nv_class = SUBSTR(re_class,2,3) .
 ELSE nv_class = TRIM(re_class) .
 /* end : A64-0044 */

 FIND FIRST sicsyac.xzmcom WHERE /*sicsyac.xzmcom.class    = re_class   AND */ /*A64-0044*/
                                 sicsyac.xzmcom.class    = nv_class   AND     /*A64-0044*/
                                 sicsyac.xzmcom.garage   = re_garage  AND
                                 sicsyac.xzmcom.var_amt >= deci(n_Tonn70)   AND
                                 sicsyac.xzmcom.vehuse   = re_vehuse NO-LOCK NO-ERROR NO-WAIT.
     IF AVAILABLE sicsyac.xzmcom THEN 
         ASSIGN wdetail.subCLASS = sicsyac.xzmcom.comp_cod.
     ELSE DO:
         FIND FIRST sicsyac.xzmcom WHERE
             /*sicsyac.xzmcom.class    = re_class     AND */ /*A64-0044*/
             sicsyac.xzmcom.class    = nv_class     AND     /*A64-0044*/
             sicsyac.xzmcom.garage   = re_garage    AND
             sicsyac.xzmcom.vehuse   = re_vehuse  NO-LOCK NO-ERROR NO-WAIT.
             IF AVAILABLE sicsyac.xzmcom THEN 
                 ASSIGN wdetail.subCLASS = sicsyac.xzmcom.comp_cod.
             ELSE DO:
                 FIND FIRST sicsyac.xzmcom WHERE 
                     /*sicsyac.xzmcom.class    = re_class   AND*/ /*A64-0044*/
                     sicsyac.xzmcom.class    = nv_class   AND    /*A64-0044*/
                     sicsyac.xzmcom.vehuse   = re_vehuse  NO-LOCK NO-ERROR NO-WAIT.
                     IF AVAILABLE sicsyac.xzmcom THEN 
                         ASSIGN wdetail.subCLASS = sicsyac.xzmcom.comp_cod.
             END.
     END.

 IF INDEX(wdetail.subCLASS,".") <> 0 THEN 
    ASSIGN wdetail.subCLASS = trim(REPLACE(wdetail.subCLASS,".","")).
 ELSE 
    ASSIGN wdetail.subCLASS = trim(wdetail.subCLASS).
END.
RELEASE sicsyac.xzmcom .

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_chkco-broker C-Win 
PROCEDURE proc_chkco-broker :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:   add by : Ranu I. A64-0355     
------------------------------------------------------------------------------*/
DEF VAR nv_comper AS DECI INIT 0 . /* A64-0355*/
DO:
    IF wdetail.agco70 <> "" AND wdetail.agco70 <> "Null" THEN DO:
        FIND LAST sicsyac.xmm600 USE-INDEX xmm60001 WHERE xmm600.acno = TRIM(wdetail.agco70) NO-LOCK NO-ERROR.
        IF NOT AVAIL xmm600 THEN 
            ASSIGN wdetail.comment = wdetail.comment + "| Agent code Co-Broker " + wdetail.agco70 + "(xmm600)" 
               wdetail.pass    = "N" 
               wdetail.OK_GEN  = "N".
        ELSE DO:
            IF xmm600.closed <> ? AND xmm600.closed < TODAY THEN
            ASSIGN wdetail.comment = wdetail.comment + "| Agent code Co-Broker " + wdetail.agco70 + " Closed Date: " + STRING(xmm600.closed,"99/99/9999") 
                wdetail.pass    = "N" 
                wdetail.OK_GEN  = "N".
       END.

       IF (DECI(wdetail.comco_prem70) <> (-1)) AND DECI(wdetail.comco_per70) = (-1)  THEN 
        ASSIGN wdetail.comment = wdetail.comment + "|กรมธรรม์ระบุ Comm. Amount co-broker " + string(wdetail.comco_prem70) + " แต่ไม่ระบุ Comm. co-broker% "
            wdetail.pass    = "N" 
            wdetail.OK_GEN  = "N".

       IF DECI(wdetail.comper70) = (-1) AND DECI(wdetail.comco_per70) = (-1) THEN DO:
            ASSIGN wdetail.comment = wdetail.comment + "|กรมธรรม์ Co-broker กรุณาระบุ Commission% หรือ Commission co-broker% "
               wdetail.pass    = "N" 
               wdetail.OK_GEN  = "N".
       END.
       ELSE DO:
         ASSIGN nv_comper = DECI(wdetail.comco_per70) + DECI(wdetail.comper70) .
         IF DECI(wdetail.comco_per70) = 0 THEN
           ASSIGN wdetail.comment = wdetail.comment + "|กรมธรรม์ Co-broker ระบุ Commission co-broker = 0 "
                 wdetail.pass    = "N" 
                 wdetail.OK_GEN  = "N".
         IF nv_comper > 18 THEN 
           ASSIGN wdetail.comment = wdetail.comment + "|ยอดรวม (Commission%) + (Commission co-broker%) มากกกว่า 18% "
             wdetail.pass    = "N" 
             wdetail.OK_GEN  = "N".
       END.
    END.
     
END.

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_chkcomp C-Win 
PROCEDURE proc_chkcomp :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DEF VAR nv_premt72  AS DECI init 0 .
DEF VAR nv_stf_perm AS DECI init 0 .
DO:
    IF      INT(wdetail.dstfprem72) <> 0 THEN  nv_premt72 = wdetail.premt72 + wdetail.dstfprem72 . /* เบี้ยสุทธิ + เบี้ยส่วนลด */
    ELSE IF INT(wdetail.dstf72) <> 0 THEN  DO:
        FIND FIRST sicsyac.xmm106 USE-INDEX xmm10601    WHERE
                   sicsyac.xmm106.tariff  = wdetail.tarif   AND 
                   sicsyac.xmm106.bencod  = "COMP"          AND    
                   sicsyac.xmm106.class   = wdetail.class72 AND 
                   sicsyac.xmm106.covcod  = wdetail.covcod  AND 
                   sicsyac.xmm106.effdat <= wdetail.comdat NO-LOCK NO-ERROR NO-WAIT.
        IF AVAILABLE sicsyac.xmm106 THEN nv_premt72 =  sicsyac.xmm106.baseap .
        IF nv_premt72 <> 0 THEN nv_stf_perm   = ROUND(nv_premt72 * int(wdetail.dstf72) / 100,2).

        nv_premt72 = wdetail.premt72 + nv_stf_perm . /* เบี้ยสุทธิ + เบี้ยส่วนลด */
    END.
    ELSE nv_premt72 = wdetail.premt72. 

    IF nv_premt72 <> 0 THEN DO:
        FIND FIRST sicsyac.xmm106 USE-INDEX xmm10601    WHERE
                   sicsyac.xmm106.tariff  = wdetail.tariff   AND 
                   sicsyac.xmm106.bencod  = "COMP"          AND    
                   sicsyac.xmm106.class   = wdetail.class72 AND 
                   sicsyac.xmm106.covcod  = wdetail.covcod  AND 
                   sicsyac.xmm106.effdat <= wdetail.comdat NO-LOCK NO-ERROR NO-WAIT.
        IF AVAILABLE sicsyac.xmm106 THEN DO: 
            IF ( nv_polday = 365 OR nv_polday = 366 ) THEN DO:  /* A65-0043 */
                IF nv_premt72 <> sicsyac.xmm106.baseap THEN 
                    ASSIGN wdetail.comment = wdetail.comment + "|ตรวจสอบ Class " + wdetail.CLASS72 + " กับเบี้ย พรบ." + STRING(wdetail.premt72) .
            END.
        END.
    END.
    RELEASE sicsyac.xmm106 .

    /*----รถจักรยานยนต์------*/
    /* รถส่วนบุคคล */
   /*130A       150.00 
   130B       300.00 
   130C       400.00 
   130D       600.00 
  /* รถรับจ้างให้เช่า */
    2.30A     150.00
    2.30B       350.00
    2.30C       400.00
    2.30D       600.00
    /* สาธารณะ */
    3.30A   150.00
    3.30B   350.00
    3.30C   400.00
    3.30D   600.00
    /*-------------------------*/
    
    /*----รถสามล้อเครื่อง------*/
    /* รถส่วนบุคคล */
    1.70A       720.00
    1.70B       400.00
    1.71        400.00
    /* รถรับจ้างให้เช่า */
    2.70A       1,440.00
    2.70B       400.00
    2.71        400.00
    /* สาธาระณะ */
    3.70A       1,440.00
    3.70B       400.00
    3.71        400.00
    /*--------------------------*/
    
    /*--รถยนต์นั่งไม่เกิน 7 คน --*/
    /* รถส่วนบุคคล */
    1.10        600.00
    /* รถรับจ้างให้เช่า */
    2.10        1,900.00
    /* สาธารณะ */
    3.10        1,900.00
    /*-----------------------*/
    
    /*รถยนต์โดยสารเกิน 7 คน ขนาดที่นั่ง*/
    /* รถส่วนบุคคล */
    1.20A       1,100.00
    1.20B       2,050.00
    1.20C       3,200.00
    1.20D       3,740.00
    /* รับจ้างให้เช่า */
    2.20A       2,320.00
    2.20B       3,480.00
    2.20C       6,660.00
    2.20D       7,520.00
    /* สาธารณะ */
    3.20A       2,320.00
    3.20B       3,480.00
    3.20C       6,660.00
    3.20D       7,520.00
    /*------------------*/
    
    /*----รถโดยสาร รับจ้าง ----*/
    /* รับจ้างให้เช่า */
    2.20E       1,580.00
    2.20F       2,260.00
    2.20G       3,810.00
    2.20H       4,630.00
    /* สาธารณะ */
    3.20E       1,580.00
    3.20F       2,260.00
    3.20G       3,810.00
    3.20H       4,630.00
    /*----------------------*/
    
    /*----รถยนต์บรรทุก -----*/
    /* รถส่วนบุคคล */
    1.40A       900.00
    1.40B       1,220.00
    1.40C       1,310.00
    1.40D       1,700.00
    /* รับจ้างให้เช่า */
    2.40A       1,760.00
    2.40B       1,830.00
    2.40C       1,980.00
    2.40D       2,530.00
    /* สาธารณะ */
    3.40A       1,760.00
    3.40B       1,830.00
    3.40C       1,980.00
    3.40D       2,530.00
    /*------------------------*/
    
    /*---รถยนต์บรรทุกน้ำมันเชื้อเพลิง แก็ส หรือ กรด---*/
    /* รถส่วนบุคคล */
    1.42A       1,680.00
    1.42B       2,320.00
    /* รับจ้างให้เช่า */
    2.42A       1,980.00
    2.42B       3,060.00
    /* สาธารณะ */
    3.42A   1,980.00
    3.42B   3,060.00
    /*--------------------------*/
    
    /*------หัวรถลากจูง--------*/
    /* รถส่วนบุคคล */
    1.50        2,370.00
    /* รับจ้างให้เช่า */
    2.50        3,160.00
    /* สาธารณะ */
    3.50        3,160.00
    /*-------------------------*/
    
    /*------รถพ่วง-------------*/
    /* รถส่วนบุคคล */
    1.60        600.00
    /* รับจ้างให้เช่า */
    2.60        600.00
    /* สาธารณะ */
    3.60        600.00
    /*---------------------------*/
    
    /*รถยนต์ป้ายแดง (การค้ารถยนต์)*/
    /* ทุกประเภทการใช้รถ */
    4.01        1,530.00
    
    /*รถยนต์ที่ใช้ในการเกษตร*/
    /* ทุกประเภทการใช้รถ */
    4.06        90.00
    
    /*รถยนต์ประเภทอื่น ๆ*/
    /* ทุกประเภทการใช้รถ */
    4.07        770.00
    
    /*------ รถไฟฟ้า ------*/
    /* รถส่วนบุคคล */
    1.30E       300.00
    1.70E       500.00
    1.10E       600.00
    /* รับจ้างให้เช่า */
    2.30E       350.00
    2.70E       1,440.00
    2.10E       1,900.00
    /* สาธารณะ */
    3.30E       350.00
    3.70E       1,440.00
    3.10E       1,900.00*/
    /*--------------------*/

END.

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_chkdate C-Win 
PROCEDURE proc_chkdate :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DEF VAR nv_commdate AS CHAR .
DEF VAR nv_expdate  AS CHAR .
DO:
     /* เช็ควันที่คุ้มครอง - หมดอายุ */
     IF (wdetail.expDat = wdetail.comDat)  THEN DO:
       ASSIGN wdetail.comment = wdetail.comment + "|" + STRING(wdetail.expdat,"99/99/9999") + " วันที่สิ้นสุดความคุ้มครองเท่ากับวันที่คุ้มครอง " 
               wdetail.pass    = "N" 
               wdetail.OK_GEN  = "N".
     END.
     IF wdetail.comDat = ? THEN DO :
         ASSIGN wdetail.comment = wdetail.comment + "| วันที่เริ่มคุ้มครองเป็นค่าว่าง "
                wdetail.pass    = "N" 
                wdetail.OK_GEN  = "N".
     END.
     IF wdetail.expDat = ? THEN DO:
         ASSIGN wdetail.comment = wdetail.comment + "| วันที่สิ้นสุดความคุ้มครองเป็นค่าว่าง "
                wdetail.pass    = "N" 
                wdetail.OK_GEN  = "N".
     END.
     /* Add by : Ranu i. A64-0355 */  
     IF wdetail.comdat <> ? AND (YEAR(wdetail.comdat) < (YEAR(TODAY) - 1) OR (YEAR(wdetail.comdat) > YEAR(TODAY) + 1)) THEN DO:
        ASSIGN wdetail.comment = wdetail.comment + "|" + STRING(YEAR(wdetail.comdat),"9999") + " ปีที่เริ่มคุ้มครองไม่ถูกต้อง ! "
                wdetail.pass    = "N" 
                wdetail.OK_GEN  = "N".
     END.
     IF wdetail.expDat <> ? AND (YEAR(wdetail.expDat) < (YEAR(TODAY)) OR (YEAR(wdetail.expDat) > YEAR(TODAY) + 2) ) THEN DO:
        ASSIGN wdetail.comment = wdetail.comment + "|" + STRING(YEAR(wdetail.expdat),"9999") + " ปีที่สิ้นสุดความคุ้มครองไม่ถูกต้อง ! "
                wdetail.pass    = "N" 
                wdetail.OK_GEN  = "N".
     END.
     IF (wdetail.expDat < wdetail.comDat)  THEN DO:
        ASSIGN wdetail.comment = wdetail.comment + "|" + STRING(wdetail.expdat,"99/99/9999") + " วันที่สิ้นสุดความคุ้มครองน้อยกว่าวันที่คุ้มครอง " + 
                                 STRING(wdetail.comdat,"99/99/9999")
                wdetail.pass   = "N" 
                wdetail.OK_GEN = "N".
     END.
    /* end: Ranu i. A64-0355 */
    /* Add by : A65-0043 */
    nv_polday = 0 .
    IF wdetail.expdat NE ? AND wdetail.comdat NE ? THEN DO:
        IF ( DAY(wdetail.comdat)     =  DAY(wdetail.expdat)     AND
           MONTH(wdetail.comdat)     =  MONTH(wdetail.expdat)   AND
            YEAR(wdetail.comdat) + 1 =  YEAR(wdetail.expdat) )  OR
           ( DAY(wdetail.comdat)     =   29                             AND
           MONTH(wdetail.comdat)     =   02                             AND
             DAY(wdetail.expdat)     =   01                             AND
           MONTH(wdetail.expdat)     =   03                             AND
            YEAR(wdetail.comdat) + 1 =  YEAR(wdetail.expdat) )
        THEN DO:
          nv_polday = 365.
        END.
        ELSE DO:
          nv_polday = (wdetail.expdat  - wdetail.comdat ) + 1 .     /*    =  366  วัน */
        END.
    END.
    IF nv_polday < 365 THEN DO:
        nv_polday  = (wdetail.expdat  - wdetail.comdat) + 1 .
    END.

    IF wdetail.poltyp = "V70" AND nv_polday > 366  THEN DO: 
        ASSIGN wdetail.comment = wdetail.comment + "|ตรวจสอบวันที่คุ้มครอง และวันที่หมดอายุ เนื่องจากวันที่รับประกันภัยของ กธ.เกิน 1 ปี / " +
                                 STRING(nv_polday,"->>>9") + " วัน" .
    END.
    IF wdetail.poltyp = "V72" AND nv_polday > 731 THEN DO:
        ASSIGN wdetail.comment = wdetail.comment + "|ตรวจสอบวันที่คุ้มครอง และวันที่หมดอายุ เนื่องจากวันที่รับประกันภัยของ พรบ.เกิน 2 ปี / " +
                                 STRING(nv_polday,"->>>9") + " วัน" .
   END.
    /* end : A65-0043 */
END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_chkDG C-Win 
PROCEDURE proc_chkDG :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes: add by : A64-0355 ความคุ้มครองวัตถุอันตราย      
------------------------------------------------------------------------------*/
DO:
       /*wdetail.dgpackge      =  trim(wf_dgpackge)
        wdetail.danger1       =  trim(wf_danger1)   
        wdetail.danger2       =  trim(wf_danger2)   
        wdetail.dgsi          =  inte(wf_dgsi)
        wdetail.dgrate        =  trim(wf_dgrate)   
        wdetail.dgfeet        =  trim(wf_dgfeet)   
        wdetail.dgncb         =  trim(wf_dgncb )   
        wdetail.dgdisc        =  trim(wf_dgdisc)  
        wdetail.dgwdisc       =  trim(wf_dgwdisc) 
        wdetail.dgatt         =  INTE(wf_dgatt)    
        wdetail.dgfeetprm     =  deci(wf_dgfeetprm)
        wdetail.dgncbprm      =  deci(wf_dgncbprm) 
        wdetail.dgdiscprm     =  deci(wf_dgdiscprm) 
        wdetail.dgWdiscprm    =  deci(wf_dgWdiscprm) */

    IF wdetail.dgprem <> 0 AND (wdetail.dgpackge = "" AND wdetail.dgrate = "" ) THEN DO:
        ASSIGN wdetail.comment = wdetail.comment + "| กรมธรรม์ระบุเบี้ย รยต. แต่ข้อมูล Package (Attach Coverage) และ Rate% เป็นค่าว่าง " 
               wdetail.pass    = "N" 
               wdetail.OK_GEN  = "N".
    END.
    ELSE IF wdetail.dgprem = 0 AND (wdetail.dgpackge <> "") THEN DO:
        ASSIGN wdetail.comment = wdetail.comment + "| กรมธรรม์ระบุข้อมูล รยต. Package (Attach Coverage) แต่เบี้ย รยต. = 0 "  
               wdetail.pass    = "N" 
               wdetail.OK_GEN  = "N".
    END.

    IF wdetail.dgpackge <> "" /*AND wdetail.dgrate = "" */ THEN DO:
        FIND FIRST sicsyac.xmm106 USE-INDEX xmm10601 WHERE
                   sicsyac.xmm106.tariff  = wdetail.tariff  AND
                   sicsyac.xmm106.bencod  = wdetail.dgpackge AND
                   sicsyac.xmm106.CLASS   = "AR01"     AND
                   sicsyac.xmm106.key_a   = 0          AND
                   sicsyac.xmm106.key_b   = 0          AND
                   sicsyac.xmm106.effdat <= wdetail.comdat  NO-LOCK NO-ERROR NO-WAIT.
        IF AVAIL xmm106 THEN DO:
            ASSIGN wdetail.dgrate = string(sicsyac.xmm106.appinc).
        END.
        ELSE DO:
             ASSIGN wdetail.comment = wdetail.comment + "| ติดต่อเจ้าหน้าที่UW เนื่องจากไม่พบข้อมูล Rate% รยต.ของ Package: " + wdetail.dgpackge 
                    wdetail.pass    = "N" 
                    wdetail.OK_GEN  = "N".
        END.
    END.
    ELSE IF wdetail.dgrate <> "" THEN DO:
        FIND FIRST sicsyac.xmm106 /*USE-INDEX xmm10601*/ WHERE
                   sicsyac.xmm106.tariff  = wdetail.tariff  AND
                   sicsyac.xmm106.appinc  = DECI(wdetail.dgrate) AND
                   sicsyac.xmm106.CLASS   = "AR01"     AND
                   sicsyac.xmm106.key_a   = 0          AND
                   sicsyac.xmm106.key_b   = 0          AND
                   sicsyac.xmm106.effdat <= wdetail.comdat  NO-LOCK NO-ERROR NO-WAIT.
        IF AVAIL xmm106 THEN DO:
            ASSIGN wdetail.dgpackge = string(sicsyac.xmm106.bencod).
        END.
        ELSE DO:
             ASSIGN wdetail.comment = wdetail.comment + "| ติดต่อเจ้าหน้าที่UW เนื่องจากไม่พบข้อมูล Package รยต.ที่ใช้ Rate% : " + wdetail.dgrate 
                    wdetail.pass    = "N" 
                    wdetail.OK_GEN  = "N".
        END.
    END.
    
END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_chkdrive C-Win 
PROCEDURE proc_chkdrive :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
IF  wdetail.drivnam = "Y" THEN DO :      /*note add 07/11/2005*/
    ASSIGN no_policy    = ""            nv_drivage1  = 0        nv_drivbir1  = ""    
           no_rencnt    = ""            nv_drivage2  = 0        nv_drivbir2  = ""    
           no_endcnt    = ""            nv_drivage3  = 0        nv_drivbir3  = ""    
           no_riskno    = ""            nv_drivage4  = 0        nv_drivbir4  = ""    
           no_itemno    = ""            nv_drivage5  = 0        nv_drivbir5  = "" 
           nv_dribirth  = ""            nv_dlevel    = 0        nv_dlevper   = 0
           nv_dconsent  = ""
           no_policy = sic_bran.uwm301.policy 
           no_rencnt = STRING(sic_bran.uwm301.rencnt,"99") 
           no_endcnt = STRING(sic_bran.uwm301.endcnt,"999") 
           no_riskno = "001"
           no_itemno = "001"
           n_count   = 0.

  FIND LAST wdrive WHERE wdrive.policy  = wdetail.policy NO-LOCK NO-ERROR.
    IF AVAIL wdrive THEN DO:
       ASSIGN wdrive.dbirth1   = if trim(wdrive.dbirth1) <> "" then STRING(DATE(wdrive.dbirth1),"99/99/9999") else ""
              wdrive.dbirth2   = if trim(wdrive.dbirth2) <> "" then STRING(DATE(wdrive.dbirth2),"99/99/9999") else ""
              wdrive.dbirth3   = if trim(wdrive.dbirth3) <> "" then STRING(DATE(wdrive.dbirth3),"99/99/9999") else ""
              wdrive.dbirth4   = if trim(wdrive.dbirth4) <> "" then STRING(DATE(wdrive.dbirth4),"99/99/9999") else ""
              wdrive.dbirth5   = if trim(wdrive.dbirth5) <> "" then STRING(DATE(wdrive.dbirth5),"99/99/9999") else ""
              nv_drivage1      = IF TRIM(wdrive.dbirth1) <> "" THEN INT(SUBSTR(wdrive.dbirth1,7,4)) ELSE 0
              nv_drivage2      = IF TRIM(wdrive.dbirth2) <> "" THEN INT(SUBSTR(wdrive.dbirth2,7,4)) ELSE 0
              nv_drivage3      = IF TRIM(wdrive.dbirth3) <> "" THEN INT(SUBSTR(wdrive.dbirth3,7,4)) ELSE 0
              nv_drivage4      = IF TRIM(wdrive.dbirth4) <> "" THEN INT(SUBSTR(wdrive.dbirth4,7,4)) ELSE 0
              nv_drivage5      = IF TRIM(wdrive.dbirth5) <> "" THEN INT(SUBSTR(wdrive.dbirth5,7,4)) ELSE 0 .
        
        IF wdrive.name1 <> " " THEN DO: 
            RUN proc_clearmailtxt .
            IF nv_drivage1 > 0 THEN DO:
                if nv_drivage1 < year(today) then do:
                    nv_drivage1 =  YEAR(TODAY) - nv_drivage1  .
                    ASSIGN nv_dribirth    = STRING(DATE(wdrive.dbirth1),"99/99/9999") /* ค.ศ. */
                           nv_drivbir1    = STRING(INT(SUBSTR(wdrive.dbirth1,7,4))  + 543 )
                           wdrive.dbirth1 = SUBSTR(wdrive.dbirth1,1,6) + nv_drivbir1
                           wdrive.dbirth1 = STRING(DATE(wdrive.dbirth1),"99/99/9999") . /* พ.ศ. */
                END.
                ELSE DO:
                    nv_drivage1 =  YEAR(TODAY) - (nv_drivage1 - 543).
                    ASSIGN nv_drivbir1    = STRING(INT(SUBSTR(wdrive.dbirth1,7,4)))
                           nv_dribirth    = SUBSTR(wdrive.dbirth1,1,6) + STRING((INTE(nv_drivbir1) - 543),"9999")  /* ค.ศ. */
                           wdrive.dbirth1 = SUBSTR(wdrive.dbirth1,1,6) + nv_drivbir1   
                           wdrive.dbirth1 = STRING(DATE(wdrive.dbirth1),"99/99/9999")  . /* พ.ศ. */
                END.
            END.
            ASSIGN  n_count        = 1
                    nv_ntitle   = trim(wdrive.ntitle1)  
                    nv_name     = trim(wdrive.name1 )  
                    nv_lname    = trim(wdrive.lname1) 
                    nv_drinam   = nv_ntitle + " " + nv_name  + " " + nv_lname
                    nv_dicno    = trim(wdrive.dicno1)  
                    nv_dgender  = IF trim(wdrive.dgender1) = "M" THEN "MALE" ELSE "FEMALE" 
                    nv_dbirth   = trim(wdrive.dbirth1)
                    nv_dage     = nv_drivage1
                    nv_doccup   = trim(wdrive.doccup1) 
                    nv_ddriveno = trim(wdrive.ddriveno1) 
                    nv_drivexp  = trim(wdrive.drivexp1)
                    nv_dconsent = TRIM(wdrive.dconsen1)
                    nv_dlevel   = INTE(wdrive.dlevel1)
                    wdetail.drilevel = STRING(nv_dlevel) 
                    nv_dlevper  = IF      inte(nv_dlevel) = 1 THEN 100 ELSE IF inte(nv_dlevel) = 2 THEN 90 
                                  ELSE IF inte(nv_dlevel) = 3 THEN 80  ELSE IF inte(nv_dlevel) = 4 THEN 70 ELSE 60      .
            RUN proc_mailtxt.
        END.
        
        IF wdrive.name2 <> " " THEN DO: 
            RUN proc_clearmailtxt .
            IF nv_drivage2 > 0 THEN DO:
                if nv_drivage2 < year(today) then do:
                    nv_drivage2 =  YEAR(TODAY) - nv_drivage2  .
                    ASSIGN nv_dribirth    = STRING(DATE(wdrive.dbirth2),"99/99/9999") /* ค.ศ. */
                           nv_drivbir2    = STRING(INT(SUBSTR(wdrive.dbirth2,7,4))  + 543 )
                           wdrive.dbirth2 = SUBSTR(wdrive.dbirth2,1,6) + nv_drivbir2
                           wdrive.dbirth2 = STRING(DATE(wdrive.dbirth2),"99/99/9999") . /* พ.ศ. */
                END.
                ELSE DO:
                    nv_drivage2 =  YEAR(TODAY) - (nv_drivage2 - 543).
                    ASSIGN nv_drivbir2    = STRING(INT(SUBSTR(wdrive.dbirth2,7,4)))
                           nv_dribirth    = SUBSTR(wdrive.dbirth2,1,6) + STRING((INTE(nv_drivbir2) - 543),"9999")  /* ค.ศ. */
                           wdrive.dbirth2 = SUBSTR(wdrive.dbirth2,1,6) + nv_drivbir2   
                           wdrive.dbirth2 = STRING(DATE(wdrive.dbirth2),"99/99/9999")  . /* พ.ศ. */
                END.
            END.
            ASSIGN  n_count        = 2
                    nv_ntitle   = trim(wdrive.ntitle2)  
                    nv_name     = trim(wdrive.name2 )  
                    nv_lname    = trim(wdrive.lname2)
                    nv_drinam   = nv_ntitle + " " + nv_name  + " " + nv_lname
                    nv_dicno    = trim(wdrive.dicno2)  
                    nv_dgender  = IF trim(wdrive.dgender2) = "M" THEN "MALE" ELSE "FEMALE" 
                    nv_dbirth   = trim(wdrive.dbirth2)
                    nv_dage     = nv_drivage2
                    nv_doccup   = trim(wdrive.doccup2) 
                    nv_ddriveno = trim(wdrive.ddriveno2) 
                    nv_drivexp  = trim(wdrive.drivexp2)
                    nv_dconsent = TRIM(wdrive.dconsen2)
                    nv_dlevel   = INTE(wdrive.dlevel2)
                    wdetail.drilevel = IF INTE(nv_dlevel) < INTE(wdetail.drilevel) THEN string(nv_dlevel) ELSE wdetail.drilevel 
                    nv_dlevper  = IF      inte(nv_dlevel) = 1 THEN 100 ELSE IF inte(nv_dlevel) = 2 THEN 90 
                                  ELSE IF inte(nv_dlevel) = 3 THEN 80  ELSE IF inte(nv_dlevel) = 4 THEN 70 ELSE 60      .
            RUN proc_mailtxt.
        END.
        
        IF wdrive.name3 <> " " THEN DO:
            RUN proc_clearmailtxt .
            IF nv_drivage3 > 0 THEN DO:
                if nv_drivage3 < year(today) then do:
                    nv_drivage3 =  YEAR(TODAY) - nv_drivage3  .
                    ASSIGN nv_dribirth    = STRING(DATE(wdrive.dbirth3),"99/99/9999") /* ค.ศ. */
                           nv_drivbir3    = STRING(INT(SUBSTR(wdrive.dbirth3,7,4))  + 543 )
                           wdrive.dbirth3 = SUBSTR(wdrive.dbirth3,1,6) + nv_drivbir3
                           wdrive.dbirth3 = STRING(DATE(wdrive.dbirth3),"99/99/9999") . /* พ.ศ. */
                END.
                ELSE DO:
                    nv_drivage3 =  YEAR(TODAY) - (nv_drivage3 - 543).
                    ASSIGN nv_drivbir3    = STRING(INT(SUBSTR(wdrive.dbirth3,7,4)))
                           nv_dribirth    = SUBSTR(wdrive.dbirth3,1,6) + STRING((INTE(nv_drivbir3) - 543),"9999")  /* ค.ศ. */
                           wdrive.dbirth3 = SUBSTR(wdrive.dbirth3,1,6) + nv_drivbir3   
                           wdrive.dbirth3 = STRING(DATE(wdrive.dbirth3),"99/99/9999")  . /* พ.ศ. */
                END.
            END.
            ASSIGN  n_count        = 3
                    nv_ntitle   = trim(wdrive.ntitle3)  
                    nv_name     = trim(wdrive.name3 )  
                    nv_lname    = trim(wdrive.lname3) 
                    nv_drinam   = nv_ntitle + " " + nv_name  + " " + nv_lname
                    nv_dicno    = trim(wdrive.dicno3)  
                    nv_dgender  = IF trim(wdrive.dgender3) = "M" THEN "MALE" ELSE "FEMALE" 
                    nv_dbirth   = trim(wdrive.dbirth3)
                    nv_dage     = nv_drivage3
                    nv_doccup   = trim(wdrive.doccup3) 
                    nv_ddriveno = trim(wdrive.ddriveno3) 
                    nv_drivexp  = trim(wdrive.drivexp3)
                    nv_dconsent = TRIM(wdrive.dconsen3)
                    nv_dlevel   = INTE(wdrive.dlevel3) 
                    wdetail.drilevel = IF INTE(nv_dlevel) < INTE(wdetail.drilevel) THEN string(nv_dlevel) ELSE wdetail.drilevel 
                    nv_dlevper  = IF      inte(nv_dlevel) = 1 THEN 100 ELSE IF inte(nv_dlevel) = 2 THEN 90 
                                  ELSE IF inte(nv_dlevel) = 3 THEN 80  ELSE IF inte(nv_dlevel) = 4 THEN 70 ELSE 60      .
            RUN proc_mailtxt.
        END.
        
        IF wdrive.name4 <> " " THEN DO: 
            RUN proc_clearmailtxt .
            IF nv_drivage4 > 0  THEN DO:
                if nv_drivage4 < year(today) then do:
                    nv_drivage4 =  YEAR(TODAY) - nv_drivage4  .
                    ASSIGN nv_dribirth    = STRING(DATE(wdrive.dbirth4),"99/99/9999") /* ค.ศ. */
                           nv_drivbir4    = STRING(INT(SUBSTR(wdrive.dbirth4,7,4))  + 543 )
                           wdrive.dbirth4 = SUBSTR(wdrive.dbirth4,1,6) + nv_drivbir4
                           wdrive.dbirth4 = STRING(DATE(wdrive.dbirth4),"99/99/9999") . /* พ.ศ. */
                END.
                ELSE DO:
                    nv_drivage4 =  YEAR(TODAY) - (nv_drivage4 - 543).
                    ASSIGN nv_drivbir4    = STRING(INT(SUBSTR(wdrive.dbirth4,7,4)))
                           nv_dribirth    = SUBSTR(wdrive.dbirth4,1,6) + STRING((INTE(nv_drivbir4) - 543),"9999")  /* ค.ศ. */
                           wdrive.dbirth4 = SUBSTR(wdrive.dbirth4,1,6) + nv_drivbir4   
                           wdrive.dbirth4 = STRING(DATE(wdrive.dbirth4),"99/99/9999")  . /* พ.ศ. */
                END.
            END.
            ASSIGN  n_count        = 4
                    nv_ntitle   = trim(wdrive.ntitle4)  
                    nv_name     = trim(wdrive.name4 )  
                    nv_lname    = trim(wdrive.lname4)
                    nv_drinam   = nv_ntitle + " " + nv_name  + " " + nv_lname
                    nv_dicno    = trim(wdrive.dicno4)  
                    nv_dgender  = IF trim(wdrive.dgender4) = "M" THEN "MALE" ELSE "FEMALE"  
                    nv_dbirth   = trim(wdrive.dbirth4)
                    nv_dage     = nv_drivage4
                    nv_doccup   = trim(wdrive.doccup4) 
                    nv_ddriveno = trim(wdrive.ddriveno4) 
                    nv_drivexp  = trim(wdrive.drivexp4) 
                    nv_dconsent = TRIM(wdrive.dconsen4)
                    nv_dlevel   = INTE(wdrive.dlevel4) 
                    wdetail.drilevel = IF INTE(nv_dlevel) < INTE(wdetail.drilevel) THEN string(nv_dlevel) ELSE wdetail.drilevel 
                    nv_dlevper  = IF      inte(nv_dlevel) = 1 THEN 100 ELSE IF inte(nv_dlevel) = 2 THEN 90 
                                  ELSE IF inte(nv_dlevel) = 3 THEN 80  ELSE IF inte(nv_dlevel) = 4 THEN 70 ELSE 60      .
            RUN proc_mailtxt.
        END.
        
        IF wdrive.name5 <> " " THEN DO:
            RUN proc_clearmailtxt .
            IF nv_drivage5 > 0 THEN DO:
                if nv_drivage5 < year(today) then do:
                    nv_drivage5 =  YEAR(TODAY) - nv_drivage5  .
                    ASSIGN nv_dribirth    = STRING(DATE(wdrive.dbirth5),"99/99/9999") /* ค.ศ. */
                           nv_drivbir5    = STRING(INT(SUBSTR(wdrive.dbirth5,7,4))  + 543 )
                           wdrive.dbirth5 = SUBSTR(wdrive.dbirth5,1,6) + nv_drivbir5
                           wdrive.dbirth5 = STRING(DATE(wdrive.dbirth5),"99/99/9999") . /* พ.ศ. */
                END.
                ELSE DO:
                    nv_drivage5 =  YEAR(TODAY) - (nv_drivage5 - 543).
                    ASSIGN nv_drivbir5    = STRING(INT(SUBSTR(wdrive.dbirth5,7,4)))
                           nv_dribirth    = SUBSTR(wdrive.dbirth5,1,6) + STRING((INTE(nv_drivbir5) - 543),"9999")  /* ค.ศ. */
                           wdrive.dbirth5 = SUBSTR(wdrive.dbirth5,1,6) + nv_drivbir5   
                           wdrive.dbirth5 = STRING(DATE(wdrive.dbirth5),"99/99/9999")  . /* พ.ศ. */
                END.
            END.
            ASSIGN  n_count        = 5
                    nv_ntitle   = trim(wdrive.ntitle5)  
                    nv_name     = trim(wdrive.name5 )  
                    nv_lname    = trim(wdrive.lname5)
                    nv_drinam   = nv_ntitle + " " + nv_name  + " " + nv_lname
                    nv_dicno    = trim(wdrive.dicno5)  
                    nv_dgender  = IF trim(wdrive.dgender5) = "M" THEN "MALE" ELSE "FEMALE" 
                    nv_dbirth   = trim(wdrive.dbirth5)
                    nv_dage     = nv_drivage5
                    nv_doccup   = trim(wdrive.doccup5) 
                    nv_ddriveno = trim(wdrive.ddriveno5) 
                    nv_drivexp  = trim(wdrive.drivexp5)
                    nv_dconsent = TRIM(wdrive.dconsen5)
                    nv_dlevel   = INTE(wdrive.dlevel5) 
                    wdetail.drilevel = IF INTE(nv_dlevel) < INTE(wdetail.drilevel) THEN string(nv_dlevel) ELSE wdetail.drilevel 
                    nv_dlevper  = IF      inte(nv_dlevel) = 1 THEN 100 ELSE IF inte(nv_dlevel) = 2 THEN 90 
                                  ELSE IF inte(nv_dlevel) = 3 THEN 80  ELSE IF inte(nv_dlevel) = 4 THEN 70 ELSE 60      .
            RUN proc_mailtxt.
        END.
    END.
END. /*note add for mailtxt 07/11/2005*/
/*-----nv_drivcod---------------------*/
ASSIGN nv_drivcod = ""
       nv_drivvar = ""
       nv_drivvar1 = "".
       nv_drivvar2 = "".
IF wdetail.drivnam = "N" THEN ASSIGN  nv_drivno = 0.
ELSE ASSIGN  nv_drivno = n_count. 

IF wdetail.prepol = ""  THEN DO:
   IF nv_drivno = 0 Then DO:
        Assign nv_drivvar   = " "
            nv_drivcod   = "A000"
            nv_drivvar1  =  "     Unname Driver"
            nv_drivvar2  = "0"
            Substr(nv_drivvar,1,30)   = nv_drivvar1
            Substr(nv_drivvar,31,30)  = nv_drivvar2.
    END.
    ELSE DO:
        IF tg_flag = NO THEN DO: /*A68-0044*/
            /*IF  nv_drivno  > 2 AND wdetail.subclass <> "E11" Then do:*/ /*A68-0044*/
            IF  nv_drivno  > 2 AND wdetail.subclass <> "E11" AND wdetail.subclass <> "E12"  AND wdetail.subclass <> "E21" AND wdetail.subclass <> "E61" Then do: /*A68-0044*/
                Message " Driver'S NO. must not over 2. "  View-as alert-box.
                ASSIGN wdetail.pass    = "N"
                       wdetail.comment = wdetail.comment +  "| Driver'S NO. must not over 2. ".  
            END.
            /*IF SUBSTR(wdetail.subclass,1,1) <> "E" THEN DO:*/ /*A68-0044*/ 
            IF  wdetail.subclass <> "E11" AND wdetail.subclass <> "E12" AND wdetail.subclass <> "E21"  AND wdetail.subclass <> "E61" THEN DO:
                RUN proc_usdcod.
            END.
            ELSE DO:
                ASSIGN nv_drivcod = "AL0" + TRIM(wdetail.drilevel).
                FIND FIRST sicsyac.xmm106 USE-INDEX xmm10601 WHERE
                           xmm106.tariff = wdetail.tariff  AND
                           xmm106.bencod = nv_drivcod   AND
                           xmm106.CLASS  = wdetail.subclass   AND
                           xmm106.covcod = wdetail.covcod  AND
                           xmm106.KEY_a  = 0          AND
                           xmm106.KEY_b  = 0          AND
                           xmm106.effdat <= wdetail.comdat NO-LOCK NO-ERROR NO-WAIT.
                IF AVAIL xmm106 THEN DO:
                    nv_dlevper = xmm106.appinc.
                END.
                ELSE ASSIGN nv_dlevper = 0.
            END.
        END.
        /* Add by : A68-0044 */
        ELSE DO:
            IF INDEX(wdetail.subclass,"11") = 0 AND INDEX(wdetail.subclass,"21") = 0 AND INDEX(wdetail.subclass,"61") = 0 AND wdetail.subclass <> "E12" THEN DO:  
                RUN proc_usdcod.
            END.
            ELSE DO:
                ASSIGN nv_drivcod = "AL0" + TRIM(wdetail.drilevel).
                FIND FIRST sicsyac.xmm106 USE-INDEX xmm10601 WHERE
                           xmm106.tariff = wdetail.tariff  AND
                           xmm106.bencod = nv_drivcod   AND
                           xmm106.CLASS  = wdetail.subclass   AND
                           xmm106.covcod = wdetail.covcod  AND
                           xmm106.KEY_a  = 0          AND
                           xmm106.KEY_b  = 0          AND
                           xmm106.effdat <= wdetail.comdat NO-LOCK NO-ERROR NO-WAIT.
                IF AVAIL xmm106 THEN DO:
                    nv_dlevper = xmm106.appinc.
                END.
                ELSE ASSIGN nv_dlevper = 0.
            END.
        END.
        /* end : A68-0044 */
        Assign  nv_drivvar  = ""
        nv_drivvar     = nv_drivcod
        nv_drivvar1    = "     Driver name person = "
        nv_drivvar2    = String(nv_drivno)
        Substr(nv_drivvar,1,30)  = nv_drivvar1 
        Substr(nv_drivvar,31,30) = nv_drivvar2.
    END.
END.
    
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_chkdrive-old C-Win 
PROCEDURE proc_chkdrive-old :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
/*IF  wdetail.drivnam = "Y" THEN DO :      /*note add 07/11/2005*/
    ASSIGN no_policy    = ""            nv_drivage1  = 0        nv_drivbir1  = ""    
           no_rencnt    = ""            nv_drivage2  = 0        nv_drivbir2  = ""    
           no_endcnt    = ""            nv_drivage3  = 0        nv_drivbir3  = ""    
           no_riskno    = ""            nv_drivage4  = 0        nv_drivbir4  = ""    
           no_itemno    = ""            nv_drivage5  = 0        nv_drivbir5  = "" 
           nv_dribirth  = ""            nv_dlevel    = 0        nv_dlevper   = 0
           nv_dconsent  = ""
           no_policy = sic_bran.uwm301.policy 
           no_rencnt = STRING(sic_bran.uwm301.rencnt,"99") 
           no_endcnt = STRING(sic_bran.uwm301.endcnt,"999") 
           no_riskno = "001"
           no_itemno = "001"
           n_count   = 0.

  FIND LAST wdrive WHERE wdrive.policy  = wdetail.policy NO-LOCK NO-ERROR.
    IF AVAIL wdrive THEN DO:
       ASSIGN wdrive.dbirth1   = STRING(DATE(wdrive.dbirth1),"99/99/9999")
              wdrive.dbirth2   = STRING(DATE(wdrive.dbirth2),"99/99/9999")
              wdrive.dbirth3   = STRING(DATE(wdrive.dbirth3),"99/99/9999") 
              wdrive.dbirth4   = STRING(DATE(wdrive.dbirth4),"99/99/9999") 
              wdrive.dbirth5   = STRING(DATE(wdrive.dbirth5),"99/99/9999") 
              nv_drivage1       = IF TRIM(wdrive.dbirth1) <> "?" THEN  INT(SUBSTR(wdrive.dbirth1,7,4)) ELSE 0
              nv_drivage2       = IF TRIM(wdrive.dbirth2) <> "?" THEN  INT(SUBSTR(wdrive.dbirth2,7,4)) ELSE 0
              nv_drivage3       = IF TRIM(wdrive.dbirth3) <> "?" THEN  INT(SUBSTR(wdrive.dbirth3,7,4)) ELSE 0
              nv_drivage4       = IF TRIM(wdrive.dbirth4) <> "?" THEN  INT(SUBSTR(wdrive.dbirth4,7,4)) ELSE 0
              nv_drivage5       = IF TRIM(wdrive.dbirth5) <> "?" THEN  INT(SUBSTR(wdrive.dbirth5,7,4)) ELSE 0 .
        
        IF wdrive.dbirth1 <> " "  AND wdrive.name1 <> " " THEN DO: 
            RUN proc_clearmailtxt .
            if nv_drivage1 < year(today) then do:
                nv_drivage1 =  YEAR(TODAY) - nv_drivage1  .
                ASSIGN nv_dribirth    = STRING(DATE(wdrive.dbirth1),"99/99/9999") /* ค.ศ. */
                       nv_drivbir1    = STRING(INT(SUBSTR(wdrive.dbirth1,7,4))  + 543 )
                       wdrive.dbirth1 = SUBSTR(wdrive.dbirth1,1,6) + nv_drivbir1
                       wdrive.dbirth1 = STRING(DATE(wdrive.dbirth1),"99/99/9999") . /* พ.ศ. */
            END.
            ELSE DO:
                nv_drivage1 =  YEAR(TODAY) - (nv_drivage1 - 543).
                ASSIGN nv_drivbir1    = STRING(INT(SUBSTR(wdrive.dbirth1,7,4)))
                       nv_dribirth    = SUBSTR(wdrive.dbirth1,1,6) + STRING((INTE(nv_drivbir1) - 543),"9999")  /* ค.ศ. */
                       wdrive.dbirth1 = SUBSTR(wdrive.dbirth1,1,6) + nv_drivbir1   
                       wdrive.dbirth1 = STRING(DATE(wdrive.dbirth1),"99/99/9999")  . /* พ.ศ. */
            END.
            ASSIGN  n_count        = 1
                    nv_ntitle   = trim(wdrive.ntitle1)  
                    nv_name     = trim(wdrive.name1 )  
                    nv_lname    = trim(wdrive.lname1) 
                    nv_drinam   = nv_ntitle + " " + nv_name  + " " + nv_lname
                    nv_dicno    = trim(wdrive.dicno1)  
                    nv_dgender  = IF trim(wdrive.dgender1) = "M" THEN "MALE" ELSE "FEMALE" 
                    nv_dbirth   = trim(wdrive.dbirth1)
                    nv_dage     = nv_drivage1
                    nv_doccup   = trim(wdrive.doccup1) 
                    nv_ddriveno = trim(wdrive.ddriveno1) 
                    nv_drivexp  = trim(wdrive.drivexp1)
                    nv_dconsent = TRIM(wdrive.dconsen1)
                    nv_dlevel   = INTE(wdrive.dlevel1)
                    wdetail.drilevel = STRING(nv_dlevel) 
                    nv_dlevper  = IF      inte(nv_dlevel) = 1 THEN 100 ELSE IF inte(nv_dlevel) = 2 THEN 90 
                                  ELSE IF inte(nv_dlevel) = 3 THEN 80  ELSE IF inte(nv_dlevel) = 4 THEN 70 ELSE 60      .
            RUN proc_mailtxt.
        END.
        
        IF wdrive.dbirth2 <> " "  AND wdrive.name2 <> " " THEN DO: 
            RUN proc_clearmailtxt .
            if nv_drivage2 < year(today) then do:
                nv_drivage2 =  YEAR(TODAY) - nv_drivage2  .
                ASSIGN nv_dribirth    = STRING(DATE(wdrive.dbirth2),"99/99/9999") /* ค.ศ. */
                       nv_drivbir2    = STRING(INT(SUBSTR(wdrive.dbirth2,7,4))  + 543 )
                       wdrive.dbirth2 = SUBSTR(wdrive.dbirth2,1,6) + nv_drivbir2
                       wdrive.dbirth2 = STRING(DATE(wdrive.dbirth2),"99/99/9999") . /* พ.ศ. */
            END.
            ELSE DO:
                nv_drivage2 =  YEAR(TODAY) - (nv_drivage2 - 543).
                ASSIGN nv_drivbir2    = STRING(INT(SUBSTR(wdrive.dbirth2,7,4)))
                       nv_dribirth    = SUBSTR(wdrive.dbirth2,1,6) + STRING((INTE(nv_drivbir2) - 543),"9999")  /* ค.ศ. */
                       wdrive.dbirth2 = SUBSTR(wdrive.dbirth2,1,6) + nv_drivbir2   
                       wdrive.dbirth2 = STRING(DATE(wdrive.dbirth2),"99/99/9999")  . /* พ.ศ. */
            END.
            ASSIGN  n_count        = 2
                    nv_ntitle   = trim(wdrive.ntitle2)  
                    nv_name     = trim(wdrive.name2 )  
                    nv_lname    = trim(wdrive.lname2)
                    nv_drinam   = nv_ntitle + " " + nv_name  + " " + nv_lname
                    nv_dicno    = trim(wdrive.dicno2)  
                    nv_dgender  = IF trim(wdrive.dgender2) = "M" THEN "MALE" ELSE "FEMALE" 
                    nv_dbirth   = trim(wdrive.dbirth2)
                    nv_dage     = nv_drivage2
                    nv_doccup   = trim(wdrive.doccup2) 
                    nv_ddriveno = trim(wdrive.ddriveno2) 
                    nv_drivexp  = trim(wdrive.drivexp2)
                    nv_dconsent = TRIM(wdrive.dconsen2)
                    nv_dlevel   = INTE(wdrive.dlevel2)
                    wdetail.drilevel = IF INTE(nv_dlevel) < INTE(wdetail.drilevel) THEN string(nv_dlevel) ELSE wdetail.drilevel 
                    nv_dlevper  = IF      inte(nv_dlevel) = 1 THEN 100 ELSE IF inte(nv_dlevel) = 2 THEN 90 
                                  ELSE IF inte(nv_dlevel) = 3 THEN 80  ELSE IF inte(nv_dlevel) = 4 THEN 70 ELSE 60      .
            RUN proc_mailtxt.
        END.
        
        IF wdrive.dbirth3 <> " "  AND wdrive.name3 <> " " THEN DO:
            RUN proc_clearmailtxt .
            if nv_drivage3 < year(today) then do:
                nv_drivage3 =  YEAR(TODAY) - nv_drivage3  .
                ASSIGN nv_dribirth    = STRING(DATE(wdrive.dbirth3),"99/99/9999") /* ค.ศ. */
                       nv_drivbir3    = STRING(INT(SUBSTR(wdrive.dbirth3,7,4))  + 543 )
                       wdrive.dbirth3 = SUBSTR(wdrive.dbirth3,1,6) + nv_drivbir3
                       wdrive.dbirth3 = STRING(DATE(wdrive.dbirth3),"99/99/9999") . /* พ.ศ. */
            END.
            ELSE DO:
                nv_drivage3 =  YEAR(TODAY) - (nv_drivage3 - 543).
                ASSIGN nv_drivbir3    = STRING(INT(SUBSTR(wdrive.dbirth3,7,4)))
                       nv_dribirth    = SUBSTR(wdrive.dbirth3,1,6) + STRING((INTE(nv_drivbir3) - 543),"9999")  /* ค.ศ. */
                       wdrive.dbirth3 = SUBSTR(wdrive.dbirth3,1,6) + nv_drivbir3   
                       wdrive.dbirth3 = STRING(DATE(wdrive.dbirth3),"99/99/9999")  . /* พ.ศ. */
            END.
            ASSIGN  n_count        = 3
                    nv_ntitle   = trim(wdrive.ntitle3)  
                    nv_name     = trim(wdrive.name3 )  
                    nv_lname    = trim(wdrive.lname3) 
                    nv_drinam   = nv_ntitle + " " + nv_name  + " " + nv_lname
                    nv_dicno    = trim(wdrive.dicno3)  
                    nv_dgender  = IF trim(wdrive.dgender3) = "M" THEN "MALE" ELSE "FEMALE" 
                    nv_dbirth   = trim(wdrive.dbirth3)
                    nv_dage     = nv_drivage3
                    nv_doccup   = trim(wdrive.doccup3) 
                    nv_ddriveno = trim(wdrive.ddriveno3) 
                    nv_drivexp  = trim(wdrive.drivexp3)
                    nv_dconsent = TRIM(wdrive.dconsen3)
                    nv_dlevel   = INTE(wdrive.dlevel3) 
                    wdetail.drilevel = IF INTE(nv_dlevel) < INTE(wdetail.drilevel) THEN string(nv_dlevel) ELSE wdetail.drilevel 
                    nv_dlevper  = IF      inte(nv_dlevel) = 1 THEN 100 ELSE IF inte(nv_dlevel) = 2 THEN 90 
                                  ELSE IF inte(nv_dlevel) = 3 THEN 80  ELSE IF inte(nv_dlevel) = 4 THEN 70 ELSE 60      .
            RUN proc_mailtxt.
        END.
        
        IF wdrive.dbirth4 <> " "  AND wdrive.name4 <> " " THEN DO: 
            RUN proc_clearmailtxt .
            if nv_drivage4 < year(today) then do:
                nv_drivage4 =  YEAR(TODAY) - nv_drivage4  .
                ASSIGN nv_dribirth    = STRING(DATE(wdrive.dbirth4),"99/99/9999") /* ค.ศ. */
                       nv_drivbir4    = STRING(INT(SUBSTR(wdrive.dbirth4,7,4))  + 543 )
                       wdrive.dbirth4 = SUBSTR(wdrive.dbirth4,1,6) + nv_drivbir4
                       wdrive.dbirth4 = STRING(DATE(wdrive.dbirth4),"99/99/9999") . /* พ.ศ. */
            END.
            ELSE DO:
                nv_drivage4 =  YEAR(TODAY) - (nv_drivage4 - 543).
                ASSIGN nv_drivbir4    = STRING(INT(SUBSTR(wdrive.dbirth4,7,4)))
                       nv_dribirth    = SUBSTR(wdrive.dbirth4,1,6) + STRING((INTE(nv_drivbir4) - 543),"9999")  /* ค.ศ. */
                       wdrive.dbirth4 = SUBSTR(wdrive.dbirth4,1,6) + nv_drivbir4   
                       wdrive.dbirth4 = STRING(DATE(wdrive.dbirth4),"99/99/9999")  . /* พ.ศ. */
            END.
            ASSIGN  n_count        = 4
                    nv_ntitle   = trim(wdrive.ntitle4)  
                    nv_name     = trim(wdrive.name4 )  
                    nv_lname    = trim(wdrive.lname4)
                    nv_drinam   = nv_ntitle + " " + nv_name  + " " + nv_lname
                    nv_dicno    = trim(wdrive.dicno4)  
                    nv_dgender  = IF trim(wdrive.dgender4) = "M" THEN "MALE" ELSE "FEMALE"  
                    nv_dbirth   = trim(wdrive.dbirth4)
                    nv_dage     = nv_drivage4
                    nv_doccup   = trim(wdrive.doccup4) 
                    nv_ddriveno = trim(wdrive.ddriveno4) 
                    nv_drivexp  = trim(wdrive.drivexp4) 
                    nv_dconsent = TRIM(wdrive.dconsen4)
                    nv_dlevel   = INTE(wdrive.dlevel4) 
                    wdetail.drilevel = IF INTE(nv_dlevel) < INTE(wdetail.drilevel) THEN string(nv_dlevel) ELSE wdetail.drilevel 
                    nv_dlevper  = IF      inte(nv_dlevel) = 1 THEN 100 ELSE IF inte(nv_dlevel) = 2 THEN 90 
                                  ELSE IF inte(nv_dlevel) = 3 THEN 80  ELSE IF inte(nv_dlevel) = 4 THEN 70 ELSE 60      .
            RUN proc_mailtxt.
        END.
        
        IF wdrive.dbirth5 <> " "  AND wdrive.name5 <> " " THEN DO:
            RUN proc_clearmailtxt .
            if nv_drivage5 < year(today) then do:
                nv_drivage5 =  YEAR(TODAY) - nv_drivage5  .
                ASSIGN nv_dribirth    = STRING(DATE(wdrive.dbirth5),"99/99/9999") /* ค.ศ. */
                       nv_drivbir5    = STRING(INT(SUBSTR(wdrive.dbirth5,7,4))  + 543 )
                       wdrive.dbirth5 = SUBSTR(wdrive.dbirth5,1,6) + nv_drivbir5
                       wdrive.dbirth5 = STRING(DATE(wdrive.dbirth5),"99/99/9999") . /* พ.ศ. */
            END.
            ELSE DO:
                nv_drivage5 =  YEAR(TODAY) - (nv_drivage5 - 543).
                ASSIGN nv_drivbir5    = STRING(INT(SUBSTR(wdrive.dbirth5,7,4)))
                       nv_dribirth    = SUBSTR(wdrive.dbirth5,1,6) + STRING((INTE(nv_drivbir5) - 543),"9999")  /* ค.ศ. */
                       wdrive.dbirth5 = SUBSTR(wdrive.dbirth5,1,6) + nv_drivbir5   
                       wdrive.dbirth5 = STRING(DATE(wdrive.dbirth5),"99/99/9999")  . /* พ.ศ. */
            END.
            ASSIGN  n_count        = 5
                    nv_ntitle   = trim(wdrive.ntitle5)  
                    nv_name     = trim(wdrive.name5 )  
                    nv_lname    = trim(wdrive.lname5)
                    nv_drinam   = nv_ntitle + " " + nv_name  + " " + nv_lname
                    nv_dicno    = trim(wdrive.dicno5)  
                    nv_dgender  = IF trim(wdrive.dgender5) = "M" THEN "MALE" ELSE "FEMALE" 
                    nv_dbirth   = trim(wdrive.dbirth5)
                    nv_dage     = nv_drivage5
                    nv_doccup   = trim(wdrive.doccup5) 
                    nv_ddriveno = trim(wdrive.ddriveno5) 
                    nv_drivexp  = trim(wdrive.drivexp5)
                    nv_dconsent = TRIM(wdrive.dconsen5)
                    nv_dlevel   = INTE(wdrive.dlevel5) 
                    wdetail.drilevel = IF INTE(nv_dlevel) < INTE(wdetail.drilevel) THEN string(nv_dlevel) ELSE wdetail.drilevel 
                    nv_dlevper  = IF      inte(nv_dlevel) = 1 THEN 100 ELSE IF inte(nv_dlevel) = 2 THEN 90 
                                  ELSE IF inte(nv_dlevel) = 3 THEN 80  ELSE IF inte(nv_dlevel) = 4 THEN 70 ELSE 60      .
            RUN proc_mailtxt.
        END.
    END.
END. /*note add for mailtxt 07/11/2005*/
/*-----nv_drivcod---------------------*/
ASSIGN nv_drivcod = ""
       nv_drivvar = ""
       nv_drivvar1 = "".
       nv_drivvar2 = "".
IF wdetail.drivnam = "N" THEN ASSIGN  nv_drivno = 0.
ELSE ASSIGN  nv_drivno = n_count. 

IF wdetail.prepol = ""  THEN DO:
   IF nv_drivno = 0 Then DO:
        Assign nv_drivvar   = " "
            nv_drivcod   = "A000"
            nv_drivvar1  =  "     Unname Driver"
            nv_drivvar2  = "0"
            Substr(nv_drivvar,1,30)   = nv_drivvar1
            Substr(nv_drivvar,31,30)  = nv_drivvar2.
    END.
    ELSE DO:
        IF tg_flag = NO THEN DO: /*A68-0044*/
            /*IF  nv_drivno  > 2 AND wdetail.subclass <> "E11" Then do:*/ /*A68-0044*/
            IF  nv_drivno  > 2 AND wdetail.subclass <> "E11" AND wdetail.subclass <> "E12"  AND wdetail.subclass <> "E21" AND wdetail.subclass <> "E61" Then do: /*A68-0044*/
                Message " Driver'S NO. must not over 2. "  View-as alert-box.
                ASSIGN wdetail.pass    = "N"
                       wdetail.comment = wdetail.comment +  "| Driver'S NO. must not over 2. ".  
            END.
            /*IF SUBSTR(wdetail.subclass,1,1) <> "E" THEN DO:*/ /*A68-0044*/ 
            IF  wdetail.subclass <> "E11" AND wdetail.subclass <> "E12" AND wdetail.subclass <> "E21"  AND wdetail.subclass <> "E61" THEN DO:
                RUN proc_usdcod.
            END.
            ELSE DO:
                ASSIGN nv_drivcod = "AL0" + TRIM(wdetail.drilevel).
                FIND FIRST sicsyac.xmm106 USE-INDEX xmm10601 WHERE
                           xmm106.tariff = wdetail.tariff  AND
                           xmm106.bencod = nv_drivcod   AND
                           xmm106.CLASS  = wdetail.subclass   AND
                           xmm106.covcod = wdetail.covcod  AND
                           xmm106.KEY_a  = 0          AND
                           xmm106.KEY_b  = 0          AND
                           xmm106.effdat <= wdetail.comdat NO-LOCK NO-ERROR NO-WAIT.
                IF AVAIL xmm106 THEN DO:
                    nv_dlevper = xmm106.appinc.
                END.
                ELSE ASSIGN nv_dlevper = 0.
            END.
        END.
        /* Add by : A68-0044 */
        ELSE DO:
            IF INDEX(wdetail.subclass,"11") = 0 AND INDEX(wdetail.subclass,"21") = 0 AND INDEX(wdetail.subclass,"61") = 0 AND wdetail.subclass <> "E12" THEN DO:  
                RUN proc_usdcod.
            END.
            ELSE DO:
                ASSIGN nv_drivcod = "AL0" + TRIM(wdetail.drilevel).
                FIND FIRST sicsyac.xmm106 USE-INDEX xmm10601 WHERE
                           xmm106.tariff = wdetail.tariff  AND
                           xmm106.bencod = nv_drivcod   AND
                           xmm106.CLASS  = wdetail.subclass   AND
                           xmm106.covcod = wdetail.covcod  AND
                           xmm106.KEY_a  = 0          AND
                           xmm106.KEY_b  = 0          AND
                           xmm106.effdat <= wdetail.comdat NO-LOCK NO-ERROR NO-WAIT.
                IF AVAIL xmm106 THEN DO:
                    nv_dlevper = xmm106.appinc.
                END.
                ELSE ASSIGN nv_dlevper = 0.
            END.
        END.
        /* end : A68-0044 */
        Assign  nv_drivvar  = ""
        nv_drivvar     = nv_drivcod
        nv_drivvar1    = "     Driver name person = "
        nv_drivvar2    = String(nv_drivno)
        Substr(nv_drivvar,1,30)  = nv_drivvar1 
        Substr(nv_drivvar,31,30) = nv_drivvar2.
    END.
END.*/
    
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_chkdrivnam C-Win 
PROCEDURE proc_chkdrivnam :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes: create by A68-0044      
------------------------------------------------------------------------------*/
DO:
     IF (INDEX(wdetail.subclass,"11") <> 0 OR INDEX(wdetail.subclass,"21") <> 0  OR INDEX(wdetail.subclass,"61") <> 0 OR trim(wdetail.subclass) = "E12") THEN DO:
 
       IF  TRIM(wdetail.prepol) = "" THEN DO: 
           IF trim(wdetail.drivnam) = "0" OR TRIM(wdetail.drivnam) = ""   THEN DO:
             ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถ" + wdetail.subclass + " กรุณาระบุผู้ขับขี่ " 
                    WDETAIL.OK_GEN  = "N"     
                    wdetail.pass    = "N".
           END.
           ELSE DO:
               FIND LAST wdrive WHERE wdrive.policy = wdetail.policy NO-LOCK NO-ERROR.
               IF AVAIL wdrive THEN DO:
                   IF wdrive.name1 = "" AND wdrive.name2 = "" AND wdrive.name3 = "" AND wdrive.name4 = "" AND wdrive.name5 = "" THEN DO:
                         ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถ" + wdetail.subclass + " กรุณาระบุชื่อผู้ขับขี่" 
                           WDETAIL.OK_GEN  = "N"     
                           wdetail.pass    = "N".
                   END.
                   IF wdrive.name1 <> "" AND (wdrive.ddriveno1 = ""  OR  wdrive.dicno1 = "" ) THEN DO:
                     ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถ" + wdetail.subclass + " เลขที่บัตรประชาชน หรือเลขที่ใบอนุญาตขับขี่ผู้ขับขี่ 1 ต้องระบุข้อมูล" 
                           WDETAIL.OK_GEN  = "N"     
                           wdetail.pass    = "N".
                   END.
                   IF wdrive.name2 <> "" AND (wdrive.ddriveno2 = ""  OR  wdrive.dicno2 = "" ) THEN DO:
                     ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถ" + wdetail.subclass + " เลขที่บัตรประชาชน หรือเลขที่ใบอนุญาตขับขี่ผู้ขับขี่ 2 ต้องระบุข้อมูล" 
                           WDETAIL.OK_GEN  = "N"     
                           wdetail.pass    = "N".
                   END.
                   IF wdrive.name3 <> "" AND (wdrive.ddriveno3 = ""  OR  wdrive.dicno3 = "" ) THEN DO:
                     ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถ" + wdetail.subclass + " เลขที่บัตรประชาชน หรือเลขที่ใบอนุญาตขับขี่ผู้ขับขี่ 3 ต้องระบุข้อมูล" 
                           WDETAIL.OK_GEN  = "N"     
                           wdetail.pass    = "N".
                   END.
                   IF wdrive.name4 <> "" AND (wdrive.ddriveno4 = ""  OR  wdrive.dicno4 = "" ) THEN DO:
                     ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถ" + wdetail.subclass + " เลขที่บัตรประชาชน หรือเลขที่ใบอนุญาตขับขี่ผู้ขับขี่ 4 ต้องระบุข้อมูล" 
                           WDETAIL.OK_GEN  = "N"     
                           wdetail.pass    = "N".
                   END.
                   IF wdrive.name5 <> "" AND (wdrive.ddriveno5 = ""  OR  wdrive.dicno5 = "" ) THEN DO:
                     ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถ" + wdetail.subclass + " เลขที่บัตรประชาชน หรือเลขที่ใบอนุญาตขับขี่ผู้ขับขี่ 5 ต้องระบุข้อมูล" 
                           WDETAIL.OK_GEN  = "N"     
                           wdetail.pass    = "N".
                   END.
               END.
               ELSE DO:
                   ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถ" + wdetail.subclass + " ไม่พบข้อมูลผู้ขับขี่ " 
                    WDETAIL.OK_GEN  = "N"     
                    wdetail.pass    = "N".
               END.
           END.
       END.
       /* add by : A67-0212 Renew*/
       ELSE DO: 
           IF (trim(wdetail.drivnam) = "" OR trim(wdetail.drivnam) = "0" ) THEN DO:
             ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถ " + wdetail.subclass + " กรุณาระบุผู้ขับขี่ " 
                    WDETAIL.OK_GEN  = "N"     
                    wdetail.pass    = "N".
           END.
           ELSE IF TRIM(wdetail.drivnam) <> "0" AND wdetail.driver = "" THEN DO: /*ระบุในไฟล์ */
               FIND LAST wdrive WHERE wdrive.policy = wdetail.policy NO-LOCK NO-ERROR.
               IF AVAIL wdrive THEN DO:
                   IF wdrive.name1 = "" AND wdrive.name2 = "" AND wdrive.name3 = "" AND wdrive.name4 = "" AND wdrive.name5 = "" THEN DO:
                         ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถ" + wdetail.subclass + " กรุณาระบุชื่อผู้ขับขี่" 
                           WDETAIL.OK_GEN  = "N"     
                           wdetail.pass    = "N".
                   END.
                   IF wdrive.name1 <> "" AND (wdrive.ddriveno1 = ""  OR  wdrive.dicno1 = "" ) THEN DO:
                     ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถ" + wdetail.subclass + " เลขที่บัตรประชาชน หรือเลขที่ใบอนุญาตขับขี่ผู้ขับขี่ 1 ต้องระบุข้อมูล" 
                           WDETAIL.OK_GEN  = "N"     
                           wdetail.pass    = "N".
                   END.
                   IF wdrive.name2 <> "" AND (wdrive.ddriveno2 = ""  OR  wdrive.dicno2 = "" ) THEN DO:
                     ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถ" + wdetail.subclass + " เลขที่บัตรประชาชน หรือเลขที่ใบอนุญาตขับขี่ผู้ขับขี่ 2 ต้องระบุข้อมูล" 
                           WDETAIL.OK_GEN  = "N"     
                           wdetail.pass    = "N".
                   END.
                   IF wdrive.name3 <> "" AND (wdrive.ddriveno3 = ""  OR  wdrive.dicno3 = "" ) THEN DO:
                     ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถ" + wdetail.subclass + " เลขที่บัตรประชาชน หรือเลขที่ใบอนุญาตขับขี่ผู้ขับขี่ 3 ต้องระบุข้อมูล" 
                           WDETAIL.OK_GEN  = "N"     
                           wdetail.pass    = "N".
                   END.
                   IF wdrive.name4 <> "" AND (wdrive.ddriveno4 = ""  OR  wdrive.dicno4 = "" ) THEN DO:
                     ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถ" + wdetail.subclass + " เลขที่บัตรประชาชน หรือเลขที่ใบอนุญาตขับขี่ผู้ขับขี่ 4 ต้องระบุข้อมูล" 
                           WDETAIL.OK_GEN  = "N"     
                           wdetail.pass    = "N".
                   END.
                   IF wdrive.name5 <> "" AND (wdrive.ddriveno5 = ""  OR  wdrive.dicno5 = "" ) THEN DO:
                     ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถ" + wdetail.subclass + " เลขที่บัตรประชาชน หรือเลขที่ใบอนุญาตขับขี่ผู้ขับขี่ 5 ต้องระบุข้อมูล" 
                           WDETAIL.OK_GEN  = "N"     
                           wdetail.pass    = "N".
                   END.
               END.
               ELSE DO:
                   ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถ" + wdetail.subclass + " ไม่พบข้อมูลผู้ขับขี่ " 
                    WDETAIL.OK_GEN  = "N"     
                    wdetail.pass    = "N".
               END.
           END.
       END.
   END.
END.

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_chkinscode C-Win 
PROCEDURE proc_chkinscode :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes: Add by A64-0355      
------------------------------------------------------------------------------*/
DO:
    FIND sicsyac.xmm600 USE-INDEX xmm60001 WHERE xmm600.acno = TRIM(wdetail.nv_insref) NO-LOCK NO-ERROR.
    IF AVAIL xmm600 THEN DO:
       ASSIGN
            wdetail.instyp   =  trim(sicsyac.xmm600.acno_typ) 
            wdetail.tiname   =  trim(sicsyac.xmm600.ntitle)       
            wdetail.insnam   =  trim(sicsyac.xmm600.firstname)
            wdetail.lastname =  trim(sicsyac.xmm600.lastname) 
            wdetail.gender   =  trim(sicsyac.xmm600.sex)      
            wdetail.ICNO     =  trim(sicsyac.xmm600.icno)
            wdetail.insbr    =  TRIM(sicsyac.xmm600.br_insure) 
            wdetail.addr     =  trim(sicsyac.xmm600.addr1)          
            wdetail.tambon   =  trim(sicsyac.xmm600.addr2)          
            wdetail.amper    =  trim(sicsyac.xmm600.addr3)          
            wdetail.country  =  trim(sicsyac.xmm600.addr4)    
            wdetail.post     =  trim(sicsyac.xmm600.postcd)   
            wdetail.provcod  =  trim(sicsyac.xmm600.codeaddr1)
            wdetail.distcod  =  trim(sicsyac.xmm600.codeaddr2)
            wdetail.sdistcod =  trim(sicsyac.xmm600.codeaddr3)
            wdetail.jpae     =  trim(xmm600.coderef1) 
            wdetail.jpjtl    =  trim(xmm600.coderef2) 
            wdetail.jpts     =  trim(xmm600.coderef3) 
            wdetail.tele1    =  trim(sicsyac.xmm600.tel[1])   
            wdetail.tele2    =  trim(sicsyac.xmm600.tel[2])   
            wdetail.mail1    =  trim(sicsyac.xmm600.email[1]) 
            wdetail.mail2    =  trim(sicsyac.xmm600.email[2]) 
            wdetail.mail3    =  trim(sicsyac.xmm600.email[3]) 
            wdetail.mail4    =  trim(sicsyac.xmm600.email[4]) 
            wdetail.mail5    =  trim(sicsyac.xmm600.email[5]) 
            wdetail.mail6    =  trim(sicsyac.xmm600.email[6]) 
            wdetail.mail7    =  trim(sicsyac.xmm600.email[7]) 
            wdetail.mail8    =  trim(sicsyac.xmm600.email[8]) 
            wdetail.mail9    =  trim(sicsyac.xmm600.email[9]) 
            wdetail.mail10   =  trim(sicsyac.xmm600.email[10])
            wdetail.fax      =  trim(sicsyac.xmm600.fax)    
            wdetail.lineID   =  trim(sicsyac.xmm600.lineid)
            wdetail.inslang  =  TRIM(sicsyac.xmm600.langug) . 
        IF wdetail.n_branch = ""  THEN wdetail.n_branch = trim(sicsyac.xmm600.homebr) . 
    END.
    ELSE DO:
        ASSIGN wdetail.comment = wdetail.comment + "| NOT FOUND INSURED CODE : " + wdetail.nv_insref  + "(XMM600)"
               wdetail.pass    = "N"  .
    END.

END.

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_chkpolicy C-Win 
PROCEDURE proc_chkpolicy :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DEF BUFFER bfuwm100 FOR sicuw.uwm100.
DEF VAR n_count AS INT INIT 0.
DEF VAR nv_commpol      AS DECI INIT 0.00 . /* A64-0355*/
DEF VAR nv_commpol_t    AS DECI INIT 0.00 . /* A64-0355*/
DEF VAR nv_comm13_t     AS DECI INIT 0.00 . /* A64-0355*/
DEF VAR nv_premt        AS DECI INIT 0. 
DEF VAR nv_dgprm        AS DECI INIT 0.

FOR EACH wdetail .
   FIND last  wtxt   WHERE wtxt.policyno   = wdetail.policyno  NO-ERROR .
   FIND last  wmemo  WHERE wmemo.policyno  = wdetail.policyno  NO-ERROR .
   FIND last  wacces WHERE wacces.policyno = wdetail.policyno  NO-ERROR .
   FIND last  winst  WHERE winst.policyno  = wdetail.policyno  NO-ERROR .
   FIND last  wdrive  WHERE wdrive.policy  = wdetail.policyno  NO-ERROR .
   IF wdetail.prepol = "" THEN DO:
     IF wdetail.chasno  <> "" THEN DO:
         ASSIGN fi_process = "Check data Policy no " + wdetail.chasno + "....." .
         DISP fi_process WITH FRAM fr_main.
          FOR EACH sicuw.uwm301 Use-index uwm30121 WHERE sicuw.uwm301.cha_no = trim(wdetail.chasno) No-lock .
           FOR EACH sicuw.uwm100 USE-INDEX uwm10001  WHERE 
               sicuw.uwm100.policy    = sicuw.uwm301.policy       AND 
               sicuw.uwm100.rencnt    = sicuw.uwm301.rencnt       AND                          
               sicuw.uwm100.endcnt    = sicuw.uwm301.endcnt       NO-LOCK .
           /*IF AVAIL sicuw.uwm100 THEN  DO:*/
               IF sicuw.uwm100.comdat    <> DATE(wdetail.comdat)      AND 
                  sicuw.uwm100.expdat    <> DATE(wdetail.expdat)      THEN NEXT.
               ELSE IF sicuw.uwm100.firstname <> TRIM(wdetail.insnam)      AND 
                       sicuw.uwm100.lastname  <> TRIM(wdetail.lastname)    THEN NEXT. 
               ASSIGN 
                /* A64-0355*/ 
                 nv_commpol   = 0       nv_commpol_t = 0        nv_comm13_t  = 0       nv_premt     = 0
                 nv_dgprm     = 0 .
               /* end : A64-0355*/ 
               IF ra_poltyp = 1  THEN DO: 
                  IF uwm100.poltyp <> "V70" THEN NEXT.
                  IF wdetail.policyno = uwm100.policy THEN NEXT.
                  ASSIGN
                      /*wdetail.comment = IF  deci(wdetail.premt) <> deci(uwm100.prem_t) THEN "เบี้ยในไฟล์ " + string(wdetail.premt) + " ไม่เท่ากับพรีเมียม " + STRING(uwm100.prem_t)  
                                        ELSE ""*/ /* A64-0355 */
                      wdetail.comment = IF  deci(wdetail.premt) <> deci(uwm100.prem_t) AND deci(wdetail.dgprem) = 0 THEN wdetail.comment + "เบี้ยในไฟล์ " + string(wdetail.premt) + " ไม่เท่ากับพรีเมียม " + STRING(uwm100.prem_t)  
                                        ELSE wdetail.comment /* A64-0355 */
                      wdetail.policyno = uwm100.policy
                      wdetail.compolusory = ""
                      wdetail.premt    = IF wdetail.dgprem = 0 THEN uwm100.prem_t ELSE wdetail.premt  /*uwm100.prem_t  A64-355*/  
                      wdetail.rstp_t   = uwm100.rstp_t  
                      wdetail.rtax_t   = uwm100.rtax_t 
                      wtxt.policyno    = uwm100.policy
                      wmemo.policyno   = uwm100.policy
                      wacces.policyno  = uwm100.policy
                      winst.policyno   = uwm100.policy
                      wdrive.policy    = uwm100.policy . /*A67-0029*/
                IF sicuw.uwm301.modcod = "" THEN ASSIGN wdetail.redbook = "" /*A65-0079*/
                    wdetail.comment = IF wdetail.comment <> "" THEN wdetail.comment + "| Redbook เป็นค่าว่าง" ELSE "Redbook เป็นค่าว่าง " .
                ELSE ASSIGN wdetail.redbook = sicuw.uwm301.modcod . /*A65-0079*/
               END.
               ELSE IF ra_poltyp = 2 THEN DO:
                  IF uwm100.poltyp <> "V72" THEN NEXT.
                  IF wdetail.policyno = uwm100.policy THEN NEXT.
                  ASSIGN wdetail.comment = IF deci(wdetail.premt72) <> deci(uwm100.prem_t) THEN wdetail.comment + "เบี้ยในไฟล์ " + string(wdetail.premt72) + " ไม่เท่ากับพรีเมียม " + STRING(uwm100.prem_t)
                                           ELSE wdetail.comment 
                         wdetail.compolusory = uwm100.policy
                         wdetail.policyno    = uwm100.policy
                         wdetail.premt72     = uwm100.prem_t
                         wdetail.rstp_t72    = uwm100.rstp_t
                         wdetail.rtax_t72    = uwm100.rtax_t
                         wtxt.policyno       = uwm100.policy
                         wmemo.policyno      = uwm100.policy
                         wacces.policyno     = uwm100.policy
                         winst.policyno      = uwm100.policy
                         wdrive.policy    = uwm100.policy . /*A67-0029*/
                   IF sicuw.uwm301.modcod = "" THEN ASSIGN wdetail.redbook = "" /*A65-0079*/
                       wdetail.comment = IF wdetail.comment <> "" THEN wdetail.comment + "| Redbook เป็นค่าว่าง" ELSE "Redbook เป็นค่าว่าง " .
                   ELSE ASSIGN wdetail.redbook = sicuw.uwm301.modcod . /*A65-0079*/
               END.
               ELSE DO:
                  IF wdetail.policyno = uwm100.policy THEN NEXT.
                  IF uwm100.poltyp = "V70" THEN DO:
                    ASSIGN
                      /*wdetail.comment = IF  deci(wdetail.premt) <> deci(uwm100.prem_t) THEN "เบี้ยในไฟล์ " + string(wdetail.premt) + " ไม่เท่ากับพรีเมียม " + STRING(uwm100.prem_t)  
                                        ELSE ""*/ /* A64-0355 */
                      wdetail.comment = IF  deci(wdetail.premt) <> deci(uwm100.prem_t) AND wdetail.dgprem = 0 THEN wdetail.comment + "เบี้ยในไฟล์ " + string(wdetail.premt) + " ไม่เท่ากับพรีเมียม " + STRING(uwm100.prem_t)  
                                        ELSE wdetail.comment /* A64-0355 */
                      wdetail.policyno = uwm100.policy
                      wdetail.premt    = IF wdetail.dgprem = 0 THEN uwm100.prem_t ELSE wdetail.premt  /*uwm100.prem_t  A64-355*/
                      wdetail.rstp_t   = uwm100.rstp_t  
                      wdetail.rtax_t   = uwm100.rtax_t 
                      wtxt.policyno    = uwm100.policy
                      wmemo.policyno   = uwm100.policy
                      wacces.policyno  = uwm100.policy
                      winst.policyno   = uwm100.policy 
                      wdrive.policy    = uwm100.policy . /*A67-0029*/
                    IF sicuw.uwm301.modcod = "" THEN ASSIGN wdetail.redbook = "" /*A65-0079*/
                        wdetail.comment = IF wdetail.comment <> "" THEN wdetail.comment + "| Redbook เป็นค่าว่าง" ELSE "Redbook เป็นค่าว่าง " .
                    ELSE ASSIGN wdetail.redbook = sicuw.uwm301.modcod . /*A65-0079*/
                  END.
                  ELSE DO:
                      ASSIGN wdetail.compolusory = uwm100.policy
                         wdetail.premt72     = uwm100.prem_t
                         wdetail.rstp_t72    = uwm100.rstp_t
                         wdetail.rtax_t72    = uwm100.rtax_t.
                  END.
               END.
              FIND sicuw.uwm120 USE-INDEX uwm12001 WHERE 
                   sicuw.uwm120.policy    = sicuw.uwm100.policy   AND 
                   sicuw.uwm120.rencnt    = sicuw.uwm100.rencnt   AND                          
                   sicuw.uwm120.endcnt    = sicuw.uwm100.endcnt   NO-LOCK NO-ERROR.
              IF AVAIL sicuw.uwm120 THEN DO:
                  IF uwm100.poltyp = "V70" THEN DO:
                   ASSIGN  wdetail.comper70     = uwm120.com1p  
                           /*wdetail.comprem70    = uwm120.com1_r  */   /*A64-0355*/
                           wdetail.comco_per70  = uwm120.com3p          /*A64-0355*/
                           /*wdetail.comco_prem70 = uwm120.com3_r  */.  /*A64-0355*/
                   /* add : A64-0355 */
                   IF DECI(wdetail.comprem70) > 0 THEN DO: 
                       wdetail.comprem70 = DECI(wdetail.comprem70) * (-1) .
                       IF sicuw.uwm100.com1_t <> deci(wdetail.comprem70) THEN DO:
                            wdetail.comment = wdetail.comment + "|เบี้ยคอมมิชชั่นในไฟล์ " + string(wdetail.comprem70) + " ไม่เท่ากับพรีเมียม " + STRING(sicuw.uwm100.com1_t)  . 
                        END.
                   END.
                   IF DECI(wdetail.comco_prem70) > 0 THEN DO: 
                       wdetail.comco_prem70 = DECI(wdetail.comco_prem70) * (-1) .
                       IF sicuw.uwm100.com3_t <> deci(wdetail.comco_prem70) THEN DO:
                            wdetail.comment = wdetail.comment + "|เบี้ยคอมมิชชั่นในไฟล์ " + string(wdetail.comco_prem70) + " ไม่เท่ากับพรีเมียม " + STRING(sicuw.uwm100.com3_t)  . 
                        END.
                   END.
                   ASSIGN wdetail.comprem70    = sicuw.uwm100.com1_t
                          wdetail.comco_prem70 = sicuw.uwm100.com3_t .
                  END.
                  /* end : A64-0355 */
                  IF sicuw.uwm100.poltyp = "V72" THEN DO:
                   ASSIGN wdetail.comper72  =  uwm120.com1p    
                          wdetail.comprem72 =  uwm120.com1_r . 
                  END.
                 /* add : A64-0355*/
                IF wdetail.poltyp = "V70" THEN DO: 
                  nv_commpol   = (sic_bran.uwm120.com1p + sic_bran.uwm120.com3p) .
                  nv_commpol_t = - ROUND((sic_bran.uwm100.prem_t) * nv_commpol / 100 ,2).  /* commission total */
                  nv_comm13_t  =  ROUND(sic_bran.uwm100.com1_t + sic_bran.uwm100.com3_t ,2) .
                  IF nv_commpol_t <> nv_comm13_t THEN DO:
                      ASSIGN wdetail.comment = IF  wdetail.agco70 <> ""  THEN wdetail.comment + "|ยอดรวม comm. + comm.co-broker " + string(nv_comm13_t) + 
                                               " ไม่เท่ากับ comm.รวม กธ " + STRING(nv_commpol_t) 
                                              ELSE wdetail.comment + "|ยอดรวม comm.ในไฟล์ " + string(nv_comm13_t) + " ไม่เท่ากับ comm.รวมจากระบบ " + STRING(nv_commpol_t).
                  END.
                END.
                 /* end : A64-0355*/
              END.
              FIND sicuw.uwm130 USE-INDEX uwm13001 WHERE
               sicuw.uwm130.policy = sicuw.uwm301.policy AND
               sicuw.uwm130.rencnt = sicuw.uwm301.rencnt AND
               sicuw.uwm130.endcnt = sicuw.uwm301.endcnt AND
               sicuw.uwm130.riskgp = sicuw.uwm301.riskgp AND            /*0*/
               sicuw.uwm130.riskno = sicuw.uwm301.riskno AND            /*1*/
               sicuw.uwm130.itemno = sicuw.uwm301.itemno NO-LOCK NO-ERROR NO-WAIT.          
              IF AVAIL sicuw.uwm130  THEN
               IF sicuw.uwm100.poltyp <> "V72" THEN DO:
                 ASSIGN wdetail.comper       = sicuw.uwm130.uom1_v 
                        wdetail.comacc       = sicuw.uwm130.uom2_v 
                        wdetail.deductpd     = sicuw.uwm130.uom5_v .
                 IF INDEX(wdetail.covcod,".") = 0  THEN  wdetail.si   = sicuw.uwm130.uom6_v .
                 ELSE wdetail.siplus   = sicuw.uwm130.uom6_v .
               END.
              FOR EACH sicuw.uwd132 USE-INDEX uwd13290  WHERE
                      sicuw.uwd132.policy   = sicuw.uwm301.policy  AND
                      sicuw.uwd132.rencnt   = sicuw.uwm301.rencnt  AND
                      sicuw.uwd132.endcnt   = sicuw.uwm301.endcnt  AND
                      sicuw.uwd132.riskgp   = sicuw.uwm301.riskgp  AND
                      sicuw.uwd132.riskno   = sicuw.uwm301.riskno  AND
                      sicuw.uwd132.itemno   = sicuw.uwm301.itemno  NO-LOCK .
                   IF sicuw.uwm100.poltyp <> "V72" THEN DO:
                       nv_premt  = nv_premt + sicuw.uwd132.prem_c.
                       IF      sicuw.uwd132.bencod = "base" THEN ASSIGN wdetail.base   = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                       ELSE IF sicuw.uwd132.bencod = "411"  THEN ASSIGN wdetail.no_411 = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                       ELSE IF sicuw.uwd132.bencod = "412"  THEN ASSIGN wdetail.no_412 = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                       ELSE IF sicuw.uwd132.bencod = "42"   THEN ASSIGN wdetail.no_42  = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                       ELSE IF sicuw.uwd132.bencod = "43"   THEN ASSIGN wdetail.no_43  = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                       ELSE IF sicuw.uwd132.bencod = "dod"  THEN ASSIGN wdetail.dod    = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                       ELSE IF sicuw.uwd132.bencod = "dod2" THEN ASSIGN wdetail.dod    = DECI(DECI(wdetail.dod)  +  DECI(SUBSTRING(sicuw.uwd132.benvar,31,30))).
                       ELSE IF sicuw.uwd132.bencod = "dpd"  THEN ASSIGN wdetail.dpd    = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                       ELSE IF sicuw.uwd132.bencod = "flet" THEN 
                           ASSIGN wdetail.fleet     = trim(SUBSTRING(sicuw.uwd132.benvar,31,30))
                                  wdetail.fleetprem = DECI(sicuw.uwd132.prem_c) .
                       ELSE IF sicuw.uwd132.bencod = "ncb"     THEN 
                           ASSIGN wdetail.ncb      = trim(SUBSTRING(sicuw.uwd132.benvar,31,30))
                                  wdetail.ncbprem  = DECI(sicuw.uwd132.prem_c) .
                       ELSE IF sicuw.uwd132.bencod = "dspc"    THEN 
                           ASSIGN wdetail.dspc     = trim(SUBSTRING(sicuw.uwd132.benvar,31,30))
                                  wdetail.dspcprem = DECI(sicuw.uwd132.prem_c) .
                       ELSE IF sicuw.uwd132.bencod = "dstf"    THEN 
                           ASSIGN wdetail.dstf     = trim(SUBSTRING(sicuw.uwd132.benvar,31,30))
                                  wdetail.dstfprem  = DECI(sicuw.uwd132.prem_c) .
                       ELSE IF index(sicuw.uwd132.bencod,"cl") <> 0 THEN 
                           ASSIGN wdetail.claim    = trim(SUBSTRING(sicuw.uwd132.benvar,31,30))
                                  wdetail.clprem   = DECI(sicuw.uwd132.prem_c).
                       
                       IF wdetail.covcod = "2.1" AND sicuw.uwd132.bencod = "ba21" THEN 
                           ASSIGN wdetail.baseplus = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                       ELSE IF wdetail.covcod = "2.2" AND sicuw.uwd132.bencod = "ba22" THEN 
                           ASSIGN wdetail.baseplus = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                       ELSE IF wdetail.covcod = "2.3" AND sicuw.uwd132.bencod = "ba23" THEN 
                           ASSIGN wdetail.baseplus = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                       ELSE IF wdetail.covcod = "3.1" AND sicuw.uwd132.bencod = "ba31" THEN 
                           ASSIGN wdetail.baseplus = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                       ELSE IF wdetail.covcod = "3.2" AND sicuw.uwd132.bencod = "ba32" THEN 
                           ASSIGN wdetail.baseplus = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                       ELSE IF wdetail.covcod = "3.3" AND sicuw.uwd132.bencod = "ba33" THEN 
                           ASSIGN wdetail.baseplus = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                       /* A64-0355 : รยต. */
                       IF wdetail.dgprem <> 0 THEN DO:
                          IF sicuw.uwd132.bencod = "RSI"    THEN 
                              ASSIGN wdetail.dgsi     = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30))  
                                     nv_dgprm         = nv_dgprm + sicuw.uwd132.prem_c.
                          ELSE IF sicuw.uwd132.bencod = "RFET" THEN 
                              ASSIGN wdetail.dgfeet     = trim(SUBSTRING(sicuw.uwd132.benvar,31,30))
                                     wdetail.dgfeetprm  = DECI(sicuw.uwd132.prem_c)     
                                     nv_dgprm = nv_dgprm + sicuw.uwd132.prem_c.
                          ELSE IF sicuw.uwd132.bencod = "RNCB"     THEN                          
                              ASSIGN wdetail.dgncb      = trim(SUBSTRING(sicuw.uwd132.benvar,31,30))
                                     wdetail.dgncbprm  = DECI(sicuw.uwd132.prem_c)      
                                     nv_dgprm = nv_dgprm + sicuw.uwd132.prem_c.
                          ELSE IF sicuw.uwd132.bencod = "RDST"    THEN                           
                              ASSIGN wdetail.dgdisc      = trim(SUBSTRING(sicuw.uwd132.benvar,31,30))
                                     wdetail.dgdiscprm  = DECI(sicuw.uwd132.prem_c)     
                                     nv_dgprm = nv_dgprm + sicuw.uwd132.prem_c.
                          ELSE IF SUBSTR(sicuw.uwd132.bencod,1,2) = "DG" THEN                    
                              ASSIGN wdetail.dgatt     = DECI(sicuw.uwd132.prem_c)      
                                     nv_dgprm = nv_dgprm + sicuw.uwd132.prem_c.
                       END. /* end : A64-355 */
                   END.
                   ELSE DO:
                       IF sicuw.uwd132.bencod = "dstf72"  THEN  ASSIGN wdetail.dstf72   = trim(SUBSTRING(sicuw.uwd132.benvar,31,30))  wdetail.dstfprem72 = DECI(sicuw.uwd132.prem_c) .
                   END.
              END. /* uwd132 */
              /* add : A64-0355 เช็คเบี้ยในไฟล์กับระบบ */
              IF wdetail.dgprem <> 0 THEN DO:
                  nv_premt = (nv_premt - nv_dgprm) .
                IF nv_premt <> wdetail.premt  THEN ASSIGN wdetail.comment = wdetail.comment + "|เบี้ยสุทธิในไฟล์ " + string(wdetail.premt) + " ไม่เท่ากับพรีเมียม " + STRING(nv_premt) .
                IF nv_dgprm <> wdetail.dgprem THEN ASSIGN wdetail.comment = wdetail.comment + "|เบี้ย รยต. ในไฟล์ " + string(wdetail.dgprem) + " ไม่เท่ากับพรีเมียม " + STRING(nv_dgprm) .
                ASSIGN  wdetail.premt    = nv_premt
                        wdetail.dgprem   = nv_dgprm .
              end. /* end : A64-0355 */
           END. /* uwm100*/
          END.  /*uwm301 */
     END.
     ELSE DO:
         RUN proc_chkpolicy2. /*a65-0079*/
     END.
   END.
   ELSE IF wdetail.prepol <> ""  THEN DO:
       ASSIGN fi_process = "Check data Policy no " + wdetail.prepol + "....." .
       DISP fi_process WITH FRAM fr_main.
       FIND LAST bfuwm100 USE-INDEX uwm10020 WHERE bfuwm100.prvpol = TRIM(wdetail.prepol) NO-LOCK NO-ERROR.
       IF AVAIL bfuwm100 THEN DO:
          ASSIGN wdetail.policyno  = bfuwm100.policy  
                 wdetail.rencnt    = string(bfuwm100.rencnt) 
                 wdetail.comdat    = bfuwm100.comdat   
                 wdetail.expdat    = bfuwm100.expdat   
                 wdetail.insnam    = bfuwm100.firstname
                 wdetail.lastname  = bfuwm100.lastname .
          RUN proc_chkrenew.
       END.
   END.
   RELEASE sicuw.uwm120.
   RELEASE sicuw.uwm301.
   RELEASE sicuw.uwm130.
   RELEASE sicuw.uwm100.
   RELEASE sicuw.uwd132 .
END. /* wdetail. */
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_chkpolicy2 C-Win 
PROCEDURE proc_chkpolicy2 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes: add by : A65-0079 หาข้อมูลกรณีไม่มีเลขตัวถัง      
------------------------------------------------------------------------------*/
DEF BUFFER bfuwm100 FOR sicuw.uwm100.
DEF VAR n_count AS INT INIT 0.
DEF VAR nv_commpol      AS DECI INIT 0.00 . 
DEF VAR nv_commpol_t    AS DECI INIT 0.00 . 
DEF VAR nv_comm13_t     AS DECI INIT 0.00 . 
DEF VAR nv_premt        AS DECI INIT 0. 
DEF VAR nv_dgprm        AS DECI INIT 0.
DEF VAR nv_vehreg  AS CHAR INIT "" .
DEF VAR nv_policy  AS CHAR INIT "" .
DO:
    ASSIGN 
    nv_policy      = TRIM(wdetail.policy) 
    wdetail.policy = "" 
    nv_vehreg      = IF INDEX(wdetail.vehreg,"-") <> 0 THEN REPLACE(wdetail.vehreg,"-"," ") + " " + trim(wdetail.re_country)  
                     ELSE trim(wdetail.vehreg) + " " + trim(wdetail.re_country) /*A65-0079*/ .
    IF nv_policy  <> "" THEN DO:
         ASSIGN fi_process = "Check data Policy no " + nv_policy + "....." .
         DISP fi_process WITH FRAM fr_main.

         FIND LAST sicuw.uwm100 USE-INDEX uwm10001 WHERE sicuw.uwm100.policy = TRIM(nv_policy) NO-LOCK NO-ERROR.
            IF NOT AVAIL sicuw.uwm100 THEN DO:
                FIND LAST sicuw.uwm301 Use-index uwm30102 Where sicuw.uwm301.vehreg = trim(nv_vehreg) No-lock no-error no-wait.
                     If avail sicuw.uwm301 Then ASSIGN nv_policy = sicuw.uwm301.policy .
            END.
            ELSE ASSIGN nv_policy = sicuw.uwm100.policy .
           
          FOR EACH sicuw.uwm301 Use-index uwm30101 WHERE sicuw.uwm301.policy = trim(nv_policy) No-lock .
           FOR EACH sicuw.uwm100 USE-INDEX uwm10001  WHERE 
               sicuw.uwm100.policy    = sicuw.uwm301.policy       AND 
               sicuw.uwm100.rencnt    = sicuw.uwm301.rencnt       AND                          
               sicuw.uwm100.endcnt    = sicuw.uwm301.endcnt       NO-LOCK .
           
               IF sicuw.uwm100.comdat    <> DATE(wdetail.comdat)      AND 
                  sicuw.uwm100.expdat    <> DATE(wdetail.expdat)      THEN NEXT.
               ELSE IF sicuw.uwm100.firstname <> TRIM(wdetail.insnam)      AND 
                       sicuw.uwm100.lastname  <> TRIM(wdetail.lastname)    THEN NEXT. 
               ASSIGN 
                /* A64-0355*/ 
                 nv_commpol   = 0       nv_commpol_t = 0        nv_comm13_t  = 0       nv_premt     = 0
                 nv_dgprm     = 0 .
               /* end : A64-0355*/ 
               IF ra_poltyp = 1  THEN DO: 
                  IF uwm100.poltyp <> "V70" THEN NEXT.
                  IF wdetail.policyno = uwm100.policy THEN NEXT.
                  ASSIGN
                      wdetail.comment = IF  deci(wdetail.premt) <> deci(uwm100.prem_t) AND deci(wdetail.dgprem) = 0 THEN wdetail.comment + "เบี้ยในไฟล์ " + string(wdetail.premt) + " ไม่เท่ากับพรีเมียม " + STRING(uwm100.prem_t)  
                                        ELSE wdetail.comment /* A64-0355 */
                      wdetail.policyno = uwm100.policy
                      wdetail.compolusory = ""
                      wdetail.premt    = IF wdetail.dgprem = 0 THEN uwm100.prem_t ELSE wdetail.premt  /*uwm100.prem_t  A64-355*/  
                      wdetail.rstp_t   = uwm100.rstp_t  
                      wdetail.rtax_t   = uwm100.rtax_t 
                      wtxt.policyno    = uwm100.policy
                      wmemo.policyno   = uwm100.policy
                      wacces.policyno  = uwm100.policy
                      winst.policyno   = uwm100.policy
                      wdrive.policy    = uwm100.policy . /*A67-0029*/
                IF sicuw.uwm301.modcod = "" THEN ASSIGN  wdetail.redbook = "" /*A65-0079*/
                        wdetail.comment = IF wdetail.comment <> "" THEN wdetail.comment + "| Redbook เป็นค่าว่าง" ELSE "Redbook เป็นค่าว่าง " .
                ELSE ASSIGN wdetail.redbook = sicuw.uwm301.modcod . /*A65-0079*/
               END.
               ELSE IF ra_poltyp = 2 THEN DO:
                  IF uwm100.poltyp <> "V72" THEN NEXT.
                  IF wdetail.policyno = uwm100.policy THEN NEXT.
                  ASSIGN wdetail.comment = IF deci(wdetail.premt72) <> deci(uwm100.prem_t) THEN wdetail.comment + "เบี้ยในไฟล์ " + string(wdetail.premt72) + " ไม่เท่ากับพรีเมียม " + STRING(uwm100.prem_t)
                                           ELSE wdetail.comment 
                         wdetail.compolusory = uwm100.policy
                         wdetail.policyno    = uwm100.policy
                         wdetail.premt72     = uwm100.prem_t
                         wdetail.rstp_t72    = uwm100.rstp_t
                         wdetail.rtax_t72    = uwm100.rtax_t
                         wtxt.policyno       = uwm100.policy
                         wmemo.policyno      = uwm100.policy
                         wacces.policyno     = uwm100.policy
                         winst.policyno      = uwm100.policy
                         wdrive.policy    = uwm100.policy . /*A67-0029*/
                   IF sicuw.uwm301.modcod = "" THEN ASSIGN wdetail.redbook = "" /*A65-0079*/
                       wdetail.comment = IF wdetail.comment <> "" THEN wdetail.comment + "| Redbook เป็นค่าว่าง" ELSE "Redbook เป็นค่าว่าง " .
                   ELSE ASSIGN wdetail.redbook = sicuw.uwm301.modcod . /*A65-0079*/
               END.
               ELSE DO:
                  IF wdetail.policyno = uwm100.policy THEN NEXT.
                  IF uwm100.poltyp = "V70" THEN DO:
                    ASSIGN
                      wdetail.comment = IF  deci(wdetail.premt) <> deci(uwm100.prem_t) AND wdetail.dgprem = 0 THEN wdetail.comment + "เบี้ยในไฟล์ " + string(wdetail.premt) + " ไม่เท่ากับพรีเมียม " + STRING(uwm100.prem_t)  
                                        ELSE wdetail.comment /* A64-0355 */
                      wdetail.policyno = uwm100.policy
                      wdetail.premt    = IF wdetail.dgprem = 0 THEN uwm100.prem_t ELSE wdetail.premt  /*uwm100.prem_t  A64-355*/
                      wdetail.rstp_t   = uwm100.rstp_t  
                      wdetail.rtax_t   = uwm100.rtax_t 
                      wtxt.policyno    = uwm100.policy
                      wmemo.policyno   = uwm100.policy
                      wacces.policyno  = uwm100.policy
                      winst.policyno   = uwm100.policy 
                      wdrive.policy    = uwm100.policy . /*A67-0029*/
                    IF sicuw.uwm301.modcod = "" THEN ASSIGN wdetail.redbook = "" /*A65-0079*/
                        wdetail.comment = IF wdetail.comment <> "" THEN wdetail.comment + "| Redbook เป็นค่าว่าง" ELSE "Redbook เป็นค่าว่าง " .
                    ELSE ASSIGN wdetail.redbook = sicuw.uwm301.modcod . /*A65-0079*/
                  END.
                  ELSE DO:
                      ASSIGN wdetail.compolusory = uwm100.policy
                         wdetail.premt72     = uwm100.prem_t
                         wdetail.rstp_t72    = uwm100.rstp_t
                         wdetail.rtax_t72    = uwm100.rtax_t.
                  END.
               END.
              FIND sicuw.uwm120 USE-INDEX uwm12001 WHERE 
                   sicuw.uwm120.policy    = sicuw.uwm100.policy   AND 
                   sicuw.uwm120.rencnt    = sicuw.uwm100.rencnt   AND                          
                   sicuw.uwm120.endcnt    = sicuw.uwm100.endcnt   NO-LOCK NO-ERROR.
              IF AVAIL sicuw.uwm120 THEN DO:
                  IF uwm100.poltyp = "V70" THEN DO:
                   ASSIGN  wdetail.comper70     = uwm120.com1p  
                           /*wdetail.comprem70    = uwm120.com1_r  */   /*A64-0355*/
                           wdetail.comco_per70  = uwm120.com3p          /*A64-0355*/
                           /*wdetail.comco_prem70 = uwm120.com3_r  */.  /*A64-0355*/
                   /* add : A64-0355 */
                   IF DECI(wdetail.comprem70) > 0 THEN DO: 
                       wdetail.comprem70 = DECI(wdetail.comprem70) * (-1) .
                       IF sicuw.uwm100.com1_t <> deci(wdetail.comprem70) THEN DO:
                            wdetail.comment = wdetail.comment + "|เบี้ยคอมมิชชั่นในไฟล์ " + string(wdetail.comprem70) + " ไม่เท่ากับพรีเมียม " + STRING(sicuw.uwm100.com1_t)  . 
                        END.
                   END.
                   IF DECI(wdetail.comco_prem70) > 0 THEN DO: 
                       wdetail.comco_prem70 = DECI(wdetail.comco_prem70) * (-1) .
                       IF sicuw.uwm100.com3_t <> deci(wdetail.comco_prem70) THEN DO:
                            wdetail.comment = wdetail.comment + "|เบี้ยคอมมิชชั่นในไฟล์ " + string(wdetail.comco_prem70) + " ไม่เท่ากับพรีเมียม " + STRING(sicuw.uwm100.com3_t)  . 
                        END.
                   END.
                   ASSIGN wdetail.comprem70    = sicuw.uwm100.com1_t
                          wdetail.comco_prem70 = sicuw.uwm100.com3_t .
                  END.
                  /* end : A64-0355 */
                  IF sicuw.uwm100.poltyp = "V72" THEN DO:
                   ASSIGN wdetail.comper72  =  uwm120.com1p    
                          wdetail.comprem72 =  uwm120.com1_r . 
                  END.
                 /* add : A64-0355*/
                IF wdetail.poltyp = "V70" THEN DO: 
                  nv_commpol   = (sic_bran.uwm120.com1p + sic_bran.uwm120.com3p) .
                  nv_commpol_t = - ROUND((sic_bran.uwm100.prem_t) * nv_commpol / 100 ,2).  /* commission total */
                  nv_comm13_t  =  ROUND(sic_bran.uwm100.com1_t + sic_bran.uwm100.com3_t ,2) .
                  IF nv_commpol_t <> nv_comm13_t THEN DO:
                      ASSIGN wdetail.comment = IF  wdetail.agco70 <> ""  THEN wdetail.comment + "|ยอดรวม comm. + comm.co-broker " + string(nv_comm13_t) + 
                                               " ไม่เท่ากับ comm.รวม กธ " + STRING(nv_commpol_t) 
                                              ELSE wdetail.comment + "|ยอดรวม comm.ในไฟล์ " + string(nv_comm13_t) + " ไม่เท่ากับ comm.รวมจากระบบ " + STRING(nv_commpol_t).
                  END.
                END.
                 /* end : A64-0355*/
              END.
              FIND sicuw.uwm130 USE-INDEX uwm13001 WHERE
               sicuw.uwm130.policy = sicuw.uwm301.policy AND
               sicuw.uwm130.rencnt = sicuw.uwm301.rencnt AND
               sicuw.uwm130.endcnt = sicuw.uwm301.endcnt AND
               sicuw.uwm130.riskgp = sicuw.uwm301.riskgp AND            /*0*/
               sicuw.uwm130.riskno = sicuw.uwm301.riskno AND            /*1*/
               sicuw.uwm130.itemno = sicuw.uwm301.itemno NO-LOCK NO-ERROR NO-WAIT.          
              IF AVAIL sicuw.uwm130  THEN
               IF sicuw.uwm100.poltyp <> "V72" THEN DO:
                 ASSIGN wdetail.comper       = sicuw.uwm130.uom1_v 
                        wdetail.comacc       = sicuw.uwm130.uom2_v 
                        wdetail.deductpd     = sicuw.uwm130.uom5_v .
                 IF INDEX(wdetail.covcod,".") = 0  THEN  wdetail.si   = sicuw.uwm130.uom6_v .
                 ELSE wdetail.siplus   = sicuw.uwm130.uom6_v .
               END.
              FOR EACH sicuw.uwd132 USE-INDEX uwd13290  WHERE
                      sicuw.uwd132.policy   = sicuw.uwm301.policy  AND
                      sicuw.uwd132.rencnt   = sicuw.uwm301.rencnt  AND
                      sicuw.uwd132.endcnt   = sicuw.uwm301.endcnt  AND
                      sicuw.uwd132.riskgp   = sicuw.uwm301.riskgp  AND
                      sicuw.uwd132.riskno   = sicuw.uwm301.riskno  AND
                      sicuw.uwd132.itemno   = sicuw.uwm301.itemno  NO-LOCK .
                   IF sicuw.uwm100.poltyp <> "V72" THEN DO:
                       nv_premt  = nv_premt + sicuw.uwd132.prem_c.
                       IF      sicuw.uwd132.bencod = "base" THEN ASSIGN wdetail.base   = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                       ELSE IF sicuw.uwd132.bencod = "411"  THEN ASSIGN wdetail.no_411 = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                       ELSE IF sicuw.uwd132.bencod = "412"  THEN ASSIGN wdetail.no_412 = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                       ELSE IF sicuw.uwd132.bencod = "42"   THEN ASSIGN wdetail.no_42  = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                       ELSE IF sicuw.uwd132.bencod = "43"   THEN ASSIGN wdetail.no_43  = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                       ELSE IF sicuw.uwd132.bencod = "dod"  THEN ASSIGN wdetail.dod    = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                       ELSE IF sicuw.uwd132.bencod = "dod2" THEN ASSIGN wdetail.dod    = DECI(DECI(wdetail.dod)  +  DECI(SUBSTRING(sicuw.uwd132.benvar,31,30))).
                       ELSE IF sicuw.uwd132.bencod = "dpd"  THEN ASSIGN wdetail.dpd    = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                       ELSE IF sicuw.uwd132.bencod = "flet" THEN 
                           ASSIGN wdetail.fleet     = trim(SUBSTRING(sicuw.uwd132.benvar,31,30))
                                  wdetail.fleetprem = DECI(sicuw.uwd132.prem_c) .
                       ELSE IF sicuw.uwd132.bencod = "ncb"     THEN 
                           ASSIGN wdetail.ncb      = trim(SUBSTRING(sicuw.uwd132.benvar,31,30))
                                  wdetail.ncbprem  = DECI(sicuw.uwd132.prem_c) .
                       ELSE IF sicuw.uwd132.bencod = "dspc"    THEN 
                           ASSIGN wdetail.dspc     = trim(SUBSTRING(sicuw.uwd132.benvar,31,30))
                                  wdetail.dspcprem = DECI(sicuw.uwd132.prem_c) .
                       ELSE IF sicuw.uwd132.bencod = "dstf"    THEN 
                           ASSIGN wdetail.dstf     = trim(SUBSTRING(sicuw.uwd132.benvar,31,30))
                                  wdetail.dstfprem  = DECI(sicuw.uwd132.prem_c) .
                       ELSE IF index(sicuw.uwd132.bencod,"cl") <> 0 THEN 
                           ASSIGN wdetail.claim    = trim(SUBSTRING(sicuw.uwd132.benvar,31,30))
                                  wdetail.clprem   = DECI(sicuw.uwd132.prem_c).
                       
                       IF wdetail.covcod = "2.1" AND sicuw.uwd132.bencod = "ba21" THEN 
                           ASSIGN wdetail.baseplus = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                       ELSE IF wdetail.covcod = "2.2" AND sicuw.uwd132.bencod = "ba22" THEN 
                           ASSIGN wdetail.baseplus = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                       ELSE IF wdetail.covcod = "2.3" AND sicuw.uwd132.bencod = "ba23" THEN 
                           ASSIGN wdetail.baseplus = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                       ELSE IF wdetail.covcod = "3.1" AND sicuw.uwd132.bencod = "ba31" THEN 
                           ASSIGN wdetail.baseplus = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                       ELSE IF wdetail.covcod = "3.2" AND sicuw.uwd132.bencod = "ba32" THEN 
                           ASSIGN wdetail.baseplus = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                       ELSE IF wdetail.covcod = "3.3" AND sicuw.uwd132.bencod = "ba33" THEN 
                           ASSIGN wdetail.baseplus = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                       /* A64-0355 : รยต. */
                       IF wdetail.dgprem <> 0 THEN DO:
                          IF sicuw.uwd132.bencod = "RSI"    THEN 
                              ASSIGN wdetail.dgsi     = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30))  
                                     nv_dgprm         = nv_dgprm + sicuw.uwd132.prem_c.
                          ELSE IF sicuw.uwd132.bencod = "RFET" THEN 
                              ASSIGN wdetail.dgfeet     = trim(SUBSTRING(sicuw.uwd132.benvar,31,30))
                                     wdetail.dgfeetprm  = DECI(sicuw.uwd132.prem_c)     
                                     nv_dgprm = nv_dgprm + sicuw.uwd132.prem_c.
                          ELSE IF sicuw.uwd132.bencod = "RNCB"     THEN                          
                              ASSIGN wdetail.dgncb      = trim(SUBSTRING(sicuw.uwd132.benvar,31,30))
                                     wdetail.dgncbprm  = DECI(sicuw.uwd132.prem_c)      
                                     nv_dgprm = nv_dgprm + sicuw.uwd132.prem_c.
                          ELSE IF sicuw.uwd132.bencod = "RDST"    THEN                           
                              ASSIGN wdetail.dgdisc      = trim(SUBSTRING(sicuw.uwd132.benvar,31,30))
                                     wdetail.dgdiscprm  = DECI(sicuw.uwd132.prem_c)     
                                     nv_dgprm = nv_dgprm + sicuw.uwd132.prem_c.
                          ELSE IF SUBSTR(sicuw.uwd132.bencod,1,2) = "DG" THEN                    
                              ASSIGN wdetail.dgatt     = DECI(sicuw.uwd132.prem_c)      
                                     nv_dgprm = nv_dgprm + sicuw.uwd132.prem_c.
                       END. /* end : A64-355 */
                   END.
                   ELSE DO:
                       IF sicuw.uwd132.bencod = "dstf72"  THEN  ASSIGN wdetail.dstf72   = trim(SUBSTRING(sicuw.uwd132.benvar,31,30))  wdetail.dstfprem72 = DECI(sicuw.uwd132.prem_c) .
                   END.
              END. /* uwd132 */
              /* add : A64-0355 เช็คเบี้ยในไฟล์กับระบบ */
              IF wdetail.dgprem <> 0 THEN DO:
                  nv_premt = (nv_premt - nv_dgprm) .
                IF nv_premt <> wdetail.premt  THEN ASSIGN wdetail.comment = wdetail.comment + "|เบี้ยสุทธิในไฟล์ " + string(wdetail.premt) + " ไม่เท่ากับพรีเมียม " + STRING(nv_premt) .
                IF nv_dgprm <> wdetail.dgprem THEN ASSIGN wdetail.comment = wdetail.comment + "|เบี้ย รยต. ในไฟล์ " + string(wdetail.dgprem) + " ไม่เท่ากับพรีเมียม " + STRING(nv_dgprm) .
                ASSIGN  wdetail.premt    = nv_premt
                        wdetail.dgprem   = nv_dgprm .
              end. /* end : A64-0355 */
           END. /* uwm100*/
          END.  /*uwm301 */
     END.
END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_chkpolpremium C-Win 
PROCEDURE proc_chkpolpremium :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DEF BUFFER bfuwm301 FOR sicuw.uwm301.
DEF VAR stk   AS CHAR FORMAT "x(12)" INIT "" .
DEF VAR nv_chasno AS CHAR FORMAT "x(50)" .
DEF VAR nv_poltyp AS CHAR FORMAT "x(3)" .
DEF VAR nv_compol AS CHAR FORMAT "x(15)" .
DEF VAR nv_comdat AS DATE .
DEF VAR nv_expdat AS DATE .
DEF VAR nv_vehreg AS CHAR FORMAT "x(11)" INIT "" . /*A65-0079*/
/*DO: F67-0001 */
  ASSIGN fi_process = "check Policy on Premium " + wdetail.riskno + " " + wdetail.chasno + ".....".
  DISP fi_process WITH FRAM fr_main.
  /* add by : A64-0355 */
  IF trim(wdetail.vehuse) = "" THEN DO:
     ASSIGN wdetail.comment = wdetail.comment + "| ลักษณะการใช้รถ (Veh.usage) เป็นค่าว่างหรือระบุข้อมูลเป็นตัวเลขเท่านั้น"     
            WDETAIL.OK_GEN  = "N"
            wdetail.pass    = "N". 
  END.
  /* end : A64-0355 */
  /* add by : A65-0043 */
  IF wdetail.seat  = 0 AND wdetail.subclass <> "260" AND  wdetail.subclass <> "520" AND 
     wdetail.subclass <> "540"  AND wdetail.subclass <> "142B" AND wdetail.subclass <> "242B" AND
     wdetail.subclass <> "142A" AND wdetail.subclass <> "242A" AND wdetail.subclass <> "801" /* A65-0079*/  AND 
     wdetail.subclass <> "401" /*A66-0202*/ THEN DO:
      ASSIGN  wdetail.comment = wdetail.comment + "| seat เป็น 0 มีผลต่อการค้นหาข้อมูลใน Table Maktab_fil"
      wdetail.pass    = "N"    
      wdetail.OK_GEN  = "N".
  END.
   /* end  : A65-0043 */
  /* add by : A65-0079  */
  IF wdetail.model = " " AND (wdetail.covcod <> "3" AND wdetail.subclass <> "801" AND wdetail.subclass <> "401" /*A66-0202*/) THEN 
   ASSIGN  wdetail.comment = wdetail.comment + "| model เป็นค่าว่าง มีผลต่อการค้นหาข้อมูลใน Table Maktab_fil"
   wdetail.pass    = "N"   
   wdetail.OK_GEN  = "N".

  IF trim(wdetail.chasno) = "" AND wdetail.subclass <> "801" AND wdetail.subclass <> "401" /*A66-0202*/ THEN DO: 
       ASSIGN  wdetail.comment = wdetail.comment + "| เลขตัวถัง เป็นค่าว่าง "
               wdetail.pass    = "N"    
               wdetail.OK_GEN  = "N".
  END.
   /* end : ranu A65-0079 */
  ASSIGN nv_chasno  = ""
         nv_poltyp  = ""
         nv_compol  = ""
         nv_expdat  = ?
         nv_vehreg  = "" /*A65-0079*/
         nv_chasno  = trim(wdetail.chasno)
         nv_poltyp  = TRIM(wdetail.poltyp)
         nv_compol  = TRIM(wdetail.compolusory) 
         nv_comdat  = DATE(wdetail.comdat)
         nv_expdat  = DATE(wdetail.expdat)
         nv_vehreg  = IF INDEX(wdetail.vehreg,"-") <> 0 THEN REPLACE(wdetail.vehreg,"-"," ") + " " + trim(wdetail.re_country)  
                      ELSE trim(wdetail.vehreg) + " " + trim(wdetail.re_country) /*A65-0079*/ .
                        
  IF nv_chasno <> ""   THEN DO:
     FIND FIRST sicuw.uwm301 Use-index uwm30121 Where sicuw.uwm301.cha_no = trim(nv_chasno) No-lock no-error no-wait.
     If avail sicuw.uwm301 Then DO:

       FOR EACH  sicuw.uwm301 Use-index uwm30121 Where sicuw.uwm301.cha_no = trim(nv_chasno) NO-LOCK:

           Find LAST sicuw.uwm100 Use-index uwm10001       Where
               sicuw.uwm100.policy = sicuw.uwm301.policy   and
               sicuw.uwm100.rencnt = sicuw.uwm301.rencnt   and                         
               /*sicuw.uwm100.endcnt = sicuw.uwm301.endcnt   AND */ /*A64-0044*/
               sicuw.uwm100.poltyp = nv_poltyp  No-lock no-error no-wait.
           If avail sicuw.uwm100 Then DO:

               IF DATE(sicuw.uwm100.expdat) > date(nv_comdat) AND 
                  YEAR(sicuw.uwm100.expdat) = YEAR(nv_expdat) AND  
                  sicuw.uwm100.polsta    = "IF" THEN DO:
                  ASSIGN wdetail.comment = wdetail.comment + "| เลขตัวถังนี้มีกรมธรรม์ในระบบแล้ว" + uwm100.policy      
                         WDETAIL.OK_GEN  = "N"
                         wdetail.pass    = "N". 
               END.
               /* add by : A64-0355 */
               ELSE IF DATE(sicuw.uwm100.expdat) > date(nv_comdat)  AND 
                       YEAR(sicuw.uwm100.expdat) <> YEAR(nv_expdat) AND 
                       MONTH(sicuw.uwm100.expdat) - MONTH(TODAY) > 3 AND
                       sicuw.uwm100.polsta    = "IF" THEN DO:
                   ASSIGN wdetail.comment = wdetail.comment + "| เลขตัวถังนี้มีกรมธรรม์ในระบบแล้ว" + uwm100.policy      
                         WDETAIL.OK_GEN  = "N"
                         wdetail.pass    = "N". 
               END.
               /* end : A64-0355 */
           END.
       END. /*FOR EACH  sicuw.uwm301 */

     END.        /*avil 301*/
     RELEASE sicuw.uwm301.
     RELEASE sicuw.uwm100.
  END.
  /* Add by : a65-0079 */
  IF (wdetail.subclass = "801") OR (wdetail.subclass = "401") /*A66-0202*/ THEN DO:
      FIND FIRST sicuw.uwm301 Use-index uwm30102 Where sicuw.uwm301.vehreg = trim(nv_vehreg) No-lock no-error no-wait.
        If avail sicuw.uwm301 Then DO:
           FOR EACH  sicuw.uwm301 Use-index uwm30102 Where sicuw.uwm301.vehreg = trim(nv_vehreg) NO-LOCK:
           
               Find LAST sicuw.uwm100 Use-index uwm10001       Where
                   sicuw.uwm100.policy = sicuw.uwm301.policy   and
                   sicuw.uwm100.rencnt = sicuw.uwm301.rencnt   and                         
                   sicuw.uwm100.poltyp = nv_poltyp  No-lock no-error no-wait.
               If avail sicuw.uwm100 Then DO:
           
                   IF DATE(sicuw.uwm100.expdat) > date(nv_comdat) AND 
                      YEAR(sicuw.uwm100.expdat) = YEAR(nv_expdat) AND  
                      sicuw.uwm100.polsta    = "IF" THEN DO:
                      ASSIGN wdetail.comment = wdetail.comment + "| เลขทะเบียนนี้มีกรมธรรม์ในระบบแล้ว" + uwm100.policy      
                             WDETAIL.OK_GEN  = "N"
                             wdetail.pass    = "N". 
                   END.
                   /* add by : A64-0355 */
                   ELSE IF DATE(sicuw.uwm100.expdat) > date(nv_comdat)  AND 
                           YEAR(sicuw.uwm100.expdat) <> YEAR(nv_expdat) AND 
                           MONTH(sicuw.uwm100.expdat) - MONTH(TODAY) > 3 AND
                           sicuw.uwm100.polsta    = "IF" THEN DO:
                       ASSIGN wdetail.comment = wdetail.comment + "| เลขทะเบียนนี้มีกรมธรรม์ในระบบแล้ว" + uwm100.policy      
                             WDETAIL.OK_GEN  = "N"
                             wdetail.pass    = "N". 
                   END.
                   /* end : A64-0355 */
               END.
           END. /*FOR EACH  sicuw.uwm301 */
        END.        /*avil 301*/
     RELEASE sicuw.uwm301.
     RELEASE sicuw.uwm100.
  END.
  /* end : a65-0079 */
  IF nv_poltyp = "V72" AND nv_compol <> ""  THEN DO:
      IF LENGTH(nv_compol) <> 12 THEN DO:
          ASSIGN  wdetail.comment = wdetail.comment + "| เลขกรมธรรม์พรบ. " + nv_compol + " ไม่เท่ากับ 12 หลัก "  
                  wdetail.pass    = "N".
      END.
      /* add by : a64-0355 */
      ELSE IF SUBSTR(nv_compol,3,2) <> "72" THEN DO:
          ASSIGN  wdetail.comment = wdetail.comment + "| เลขกรมธรรม์พรบ. " + nv_compol + " หลักที่ 3-4 ไม่เท่ากับ 72 "  
                  wdetail.pass    = "N".
      END.
      /* end : a64-0355 */
      ELSE DO:
        stk = "" .
        FIND LAST sicuw.uwm100 USE-INDEX uwm10001 WHERE 
                  sicuw.uwm100.policy = nv_compol NO-LOCK NO-ERROR .
        IF AVAIL sicuw.uwm100 THEN DO:
           IF sicuw.uwm100.firstname <> ""  AND
              sicuw.uwm100.comdat    <> ?   AND 
              sicuw.uwm100.expdat    <> ?   THEN  
            ASSIGN  wdetail.comment = wdetail.comment + "| เลข พรบ. " + sicuw.uwm100.policy  + "มีข้อมูลลูกค้าในระบบแล้ว"      
                    WDETAIL.OK_GEN  = "N"
                    wdetail.pass    = "N". 
        END.
        ELSE DO:
             FIND LAST bfuwm301 USE-INDEX uwm30101 WHERE 
                  bfuwm301.policy = nv_compol NO-LOCK NO-ERROR.
             IF AVAIL bfuwm301 THEN DO:
                 stk = IF INDEX(bfuwm301.drinam[9],"STKNO:") <> 0 THEN SUBSTR(bfuwm301.drinam[9],7,LENGTH(bfuwm301.drinam[9]))  ELSE "" .
                 IF wdetail.stk <> "" AND wdetail.stk <> stk THEN DO:
                    ASSIGN wdetail.comment = wdetail.comment + "| เลขสติ๊กเกอร์ในไฟล์ " + wdetail.stk + " ไม่ตรงกับพรีเมียม . "     
                           WDETAIL.OK_GEN  = "N"
                           wdetail.pass    = "N". 
                 END.
                 IF wdetail.stk = ""  THEN wdetail.stk = stk .
             END.
        END.
      END.
  END.
  ELSE DO: /*A67-0212 */
        /* A67-0029 */
      IF tg_flag = NO THEN DO: /* A68-0044 */
        /*IF (wdetail.subclass = "E11" ) THEN DO:  */ /*A68-0044 */
        IF (wdetail.subclass = "E11" ) OR (wdetail.subclass = "E21" ) OR (wdetail.subclass = "E61" ) THEN DO:   /*A68-0044 */
            IF  TRIM(wdetail.prepol) = "" THEN DO: /*A67-0212 New */
                IF trim(wdetail.drivnam) = "0" OR TRIM(wdetail.drivnam) = ""   THEN DO:
                  ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถไฟฟ้า " + wdetail.subclass + " กรุณาระบุผู้ขับขี่ " 
                         WDETAIL.OK_GEN  = "N"     
                         wdetail.pass    = "N".
                END.
                ELSE DO:
                    FIND LAST wdrive WHERE wdrive.policy = wdetail.policy NO-LOCK NO-ERROR.
                    IF AVAIL wdrive THEN DO:
                        IF wdrive.name1 = "" AND wdrive.name2 = "" AND wdrive.name3 = "" AND wdrive.name4 = "" AND wdrive.name5 = "" THEN DO:
                              ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถไฟฟ้า " + wdetail.subclass + " กรุณาระบุชื่อผู้ขับขี่" 
                                WDETAIL.OK_GEN  = "N"     
                                wdetail.pass    = "N".
                        END.
                        IF wdrive.name1 <> "" AND (wdrive.ddriveno1 = ""  OR  wdrive.dicno1 = "" ) THEN DO:
                          ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถไฟฟ้า " + wdetail.subclass + " เลขที่บัตรประชาชน หรือเลขที่ใบอนุญาตขับขี่ผู้ขับขี่ 1 ต้องระบุข้อมูล" 
                                WDETAIL.OK_GEN  = "N"     
                                wdetail.pass    = "N".
                        END.
                        IF wdrive.name2 <> "" AND (wdrive.ddriveno2 = ""  OR  wdrive.dicno2 = "" ) THEN DO:
                          ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถไฟฟ้า " + wdetail.subclass + " เลขที่บัตรประชาชน หรือเลขที่ใบอนุญาตขับขี่ผู้ขับขี่ 2 ต้องระบุข้อมูล" 
                                WDETAIL.OK_GEN  = "N"     
                                wdetail.pass    = "N".
                        END.
                        IF wdrive.name3 <> "" AND (wdrive.ddriveno3 = ""  OR  wdrive.dicno3 = "" ) THEN DO:
                          ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถไฟฟ้า " + wdetail.subclass + " เลขที่บัตรประชาชน หรือเลขที่ใบอนุญาตขับขี่ผู้ขับขี่ 3 ต้องระบุข้อมูล" 
                                WDETAIL.OK_GEN  = "N"     
                                wdetail.pass    = "N".
                        END.
                        IF wdrive.name4 <> "" AND (wdrive.ddriveno4 = ""  OR  wdrive.dicno4 = "" ) THEN DO:
                          ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถไฟฟ้า " + wdetail.subclass + " เลขที่บัตรประชาชน หรือเลขที่ใบอนุญาตขับขี่ผู้ขับขี่ 4 ต้องระบุข้อมูล" 
                                WDETAIL.OK_GEN  = "N"     
                                wdetail.pass    = "N".
                        END.
                        IF wdrive.name5 <> "" AND (wdrive.ddriveno5 = ""  OR  wdrive.dicno5 = "" ) THEN DO:
                          ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถไฟฟ้า " + wdetail.subclass + " เลขที่บัตรประชาชน หรือเลขที่ใบอนุญาตขับขี่ผู้ขับขี่ 5 ต้องระบุข้อมูล" 
                                WDETAIL.OK_GEN  = "N"     
                                wdetail.pass    = "N".
                        END.
                    END.
                    ELSE DO:
                        ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถไฟฟ้า " + wdetail.subclass + " ไม่พบข้อมูลผู้ขับขี่ " 
                         WDETAIL.OK_GEN  = "N"     
                         wdetail.pass    = "N".
                    END.
                END.
            END.
            /* add by : A67-0212 Renew*/
            ELSE DO: 
                IF trim(wdetail.drivnam) = "" OR trim(wdetail.drivnam) = "0" THEN DO:
                  ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถไฟฟ้า " + wdetail.subclass + " กรุณาระบุผู้ขับขี่ " 
                         WDETAIL.OK_GEN  = "N"     
                         wdetail.pass    = "N".
                END.
                ELSE IF TRIM(wdetail.drivnam) <> "0" AND wdetail.driver = "" THEN DO: /*ระบุในไฟล์ */
                    FIND LAST wdrive WHERE wdrive.policy = wdetail.policy NO-LOCK NO-ERROR.
                    IF AVAIL wdrive THEN DO:
                        IF wdrive.name1 = "" AND wdrive.name2 = "" AND wdrive.name3 = "" AND wdrive.name4 = "" AND wdrive.name5 = "" THEN DO:
                              ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถไฟฟ้า " + wdetail.subclass + " กรุณาระบุชื่อผู้ขับขี่" 
                                WDETAIL.OK_GEN  = "N"     
                                wdetail.pass    = "N".
                        END.
                        IF wdrive.name1 <> "" AND (wdrive.ddriveno1 = ""  OR  wdrive.dicno1 = "" ) THEN DO:
                          ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถไฟฟ้า " + wdetail.subclass + " เลขที่บัตรประชาชน หรือเลขที่ใบอนุญาตขับขี่ผู้ขับขี่ 1 ต้องระบุข้อมูล" 
                                WDETAIL.OK_GEN  = "N"     
                                wdetail.pass    = "N".
                        END.
                        IF wdrive.name2 <> "" AND (wdrive.ddriveno2 = ""  OR  wdrive.dicno2 = "" ) THEN DO:
                          ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถไฟฟ้า " + wdetail.subclass + " เลขที่บัตรประชาชน หรือเลขที่ใบอนุญาตขับขี่ผู้ขับขี่ 2 ต้องระบุข้อมูล" 
                                WDETAIL.OK_GEN  = "N"     
                                wdetail.pass    = "N".
                        END.
                        IF wdrive.name3 <> "" AND (wdrive.ddriveno3 = ""  OR  wdrive.dicno3 = "" ) THEN DO:
                          ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถไฟฟ้า " + wdetail.subclass + " เลขที่บัตรประชาชน หรือเลขที่ใบอนุญาตขับขี่ผู้ขับขี่ 3 ต้องระบุข้อมูล" 
                                WDETAIL.OK_GEN  = "N"     
                                wdetail.pass    = "N".
                        END.
                        IF wdrive.name4 <> "" AND (wdrive.ddriveno4 = ""  OR  wdrive.dicno4 = "" ) THEN DO:
                          ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถไฟฟ้า " + wdetail.subclass + " เลขที่บัตรประชาชน หรือเลขที่ใบอนุญาตขับขี่ผู้ขับขี่ 4 ต้องระบุข้อมูล" 
                                WDETAIL.OK_GEN  = "N"     
                                wdetail.pass    = "N".
                        END.
                        IF wdrive.name5 <> "" AND (wdrive.ddriveno5 = ""  OR  wdrive.dicno5 = "" ) THEN DO:
                          ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถไฟฟ้า " + wdetail.subclass + " เลขที่บัตรประชาชน หรือเลขที่ใบอนุญาตขับขี่ผู้ขับขี่ 5 ต้องระบุข้อมูล" 
                                WDETAIL.OK_GEN  = "N"     
                                wdetail.pass    = "N".
                        END.
                    END.
                    ELSE DO:
                        ASSIGN wdetail.comment = wdetail.comment + "| " + "รหัสรถไฟฟ้า " + wdetail.subclass + " ไม่พบข้อมูลผู้ขับขี่ " 
                         WDETAIL.OK_GEN  = "N"     
                         wdetail.pass    = "N".
                    END.
                END.
            END.
            /* end A67-0212 */
        END.
      END.
      ELSE RUN proc_chkdrivnam. /* A68-0044 : New tariff cal */

      /* IF trim(wdetail.battyr) <> "" AND INTE(wdetail.battyr) <> 0 THEN DO: A67-0212 */
      IF trim(wdetail.battyr) <> "" AND TRIM(wdetail.battyr) <> "0" THEN DO:  /*A67-0212 */
          RUN wgw/wgwbattper(INPUT INTE(wdetail.battyr),
                             INPUT DATE(wdetail.comdat),
                             INPUT-OUTPUT wdetail.battper ,
                             INPUT-OUTPUT nv_chkerror) . 
         IF nv_chkerror <> ""  THEN DO:
             ASSIGN wdetail.comment = wdetail.comment + "|" + TRIM(nv_chkerror)
                    wdetail.pass    = "N" 
                    wdetail.OK_GEN  = "N".
         END.
      END.
      IF wdetail.battno <> "" AND wdetail.battno <> "-" THEN DO:
          IF deci(wdetail.battsi) = 0 THEN DO:
            ASSIGN wdetail.comment = wdetail.comment + "| " + " กรุณาระบุ ทุนประกันแบตเตอรี่ !" 
                   WDETAIL.OK_GEN  = "N"     
                   wdetail.pass    = "N".        
          END.
          IF DECI(wdetail.battprm) = 0 THEN DO:  
              ASSIGN wdetail.comment = wdetail.comment + "| " + " กรุณาระบุ เบี้ยแบตเตอรี่ ! " 
                   WDETAIL.OK_GEN  = "N"     
                   wdetail.pass    = "N". 
          END.
      END.
      IF wdetail.chargno <> "" AND wdetail.chargno <> "-"  THEN DO:
          IF deci(wdetail.chargsi) = 0 THEN DO:
            ASSIGN wdetail.comment = wdetail.comment + "| " + " กรุณาระบุราคาเครื่องชาร์ท !" 
                   WDETAIL.OK_GEN  = "N"     
                   wdetail.pass    = "N".        
          END.
          IF DECI(wdetail.chargprm ) = 0 THEN DO:  
              ASSIGN wdetail.comment = wdetail.comment + "| " + " กรุณาระบุ เบี้ยเครื่องชาร์ท ! " 
                   WDETAIL.OK_GEN  = "N"     
                   wdetail.pass    = "N". 
          END.
      END.
      /* add by : A68-0044  
      IF TRIM(wdetail.garage) = "G" AND (DECI(wdetail.prmt31) = 0 OR deci(wdetail.rate31) = 0 ) THEN DO:
          ASSIGN wdetail.comment = wdetail.comment + "| " + "Garage = G ระบุเบี้ย หรือ Rate 31 " 
                   WDETAIL.OK_GEN  = "N"     
                   wdetail.pass    = "N". 
      END.
      end : A68-0044 */
  END. /* A67-0212 */
/* end : A67-0029 */
/*END. F67-0001*/
RELEASE sicuw.uwm301.
RELEASE sicuw.uwm100.

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_chkredbook C-Win 
PROCEDURE proc_chkredbook :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:  add by :A68-0044     
------------------------------------------------------------------------------*/
DO:
    FIND FIRST stat.maktab_fil USE-INDEX maktab01   WHERE 
               stat.maktab_fil.sclass = wdetail.subclass AND 
               stat.maktab_fil.modcod = wdetail.redbook  No-lock no-error no-wait.
     If  avail  stat.maktab_fil  Then DO:
         ASSIGN sic_bran.uwm301.modcod = wdetail.redbook .
         IF sic_bran.uwm301.maksi = 0 AND trim(wdetail.covcod) <> "3" THEN sic_bran.uwm301.maksi = stat.maktab_fil.maksi. 
     END.

END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_chkrenew C-Win 
PROCEDURE proc_chkrenew :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DO:
    FIND LAST sicuw.uwm100 USE-INDEX uwm10001      WHERE 
             sicuw.uwm100.policy    = wdetail.policyno     AND 
             sicuw.uwm100.rencnt    = int(wdetail.rencnt)  AND                          
             sicuw.uwm100.endcnt    = 0                    AND
             sicuw.uwm100.poltyp    = "V70"   NO-LOCK NO-ERROR .
        IF AVAIL sicuw.uwm100 THEN DO:
             IF sicuw.uwm100.comdat    = DATE(wdetail.comdat)   AND 
                sicuw.uwm100.expdat    = DATE(wdetail.expdat)   AND
                sicuw.uwm100.firstname = TRIM(wdetail.insnam)   AND 
                sicuw.uwm100.lastname  = TRIM(wdetail.lastname) THEN DO:
                 ASSIGN
                  wdetail.comment = IF deci(wdetail.premt) <> deci(uwm100.prem_t) THEN wdetail.comment + "เบี้ยในไฟล์ " + string(wdetail.premt) + " ไม่เท่ากับพรีเมียม "  
                                    ELSE wdetail.comment 
                  wdetail.policyno = uwm100.policy
                  wdetail.compolusory = IF wdetail.compul = "Y" THEN  uwm100.cr_2 ELSE "" 
                  wdetail.premt    = uwm100.prem_t  
                  wdetail.rstp_t   = uwm100.rstp_t  
                  wdetail.rtax_t   = uwm100.rtax_t 
                  wtxt.policyno    = uwm100.policy
                  wmemo.policyno   = uwm100.policy
                  wacces.policyno  = uwm100.policy
                  winst.policyno   = uwm100.policy 
                  wdrive.policy    = uwm100.policy . /*A67-0029*/
                FIND LAST sicuw.uwm301 USE-INDEX uwm30101 WHERE sicuw.uwm301.policy = sicuw.uwm100.policy AND
                                                                sicuw.uwm301.rencnt = sicuw.uwm100.rencnt and
                                                                sicuw.uwm301.endcnt = sicuw.uwm100.endcnt and
                                                                sicuw.uwm301.riskno = 1 AND
                                                                sicuw.uwm301.itemno = 1 NO-LOCK NO-ERROR .
                IF AVAIL sicuw.uwm301 THEN DO:
                    IF sicuw.uwm301.modcod = "" THEN ASSIGN wdetail.comment = IF wdetail.comment <> "" THEN wdetail.comment + "| Redbook เป็นค่าว่าง" ELSE "Redbook เป็นค่าว่าง " .
                END.
                
                FIND sicuw.uwm120 USE-INDEX uwm12001 WHERE 
                     sicuw.uwm120.policy    = sicuw.uwm100.policy   AND 
                     sicuw.uwm120.rencnt    = sicuw.uwm100.rencnt   AND                          
                     sicuw.uwm120.endcnt    = sicuw.uwm100.endcnt   NO-LOCK NO-ERROR.
                IF AVAIL sicuw.uwm120 THEN DO:
                    IF uwm100.poltyp = "V70" THEN DO:
                     ASSIGN  wdetail.comper70  =  uwm120.com1p 
                             wdetail.comprem70 =  uwm120.com1_r .
                    END.
                END.
                FIND sicuw.uwm130 USE-INDEX uwm13001 WHERE
                 sicuw.uwm130.policy = sicuw.uwm120.policy AND
                 sicuw.uwm130.rencnt = sicuw.uwm120.rencnt AND
                 sicuw.uwm130.endcnt = sicuw.uwm120.endcnt AND
                 sicuw.uwm130.riskgp = sicuw.uwm120.riskgp AND            /*0*/
                 sicuw.uwm130.riskno = sicuw.uwm120.riskno AND            /*1*/
                 sicuw.uwm130.itemno = 1  NO-LOCK NO-ERROR NO-WAIT.          
                IF AVAIL sicuw.uwm130  THEN
                   ASSIGN wdetail.comper       = sicuw.uwm130.uom1_v 
                          wdetail.comacc       = sicuw.uwm130.uom2_v 
                          wdetail.deductpd     = sicuw.uwm130.uom5_v .
                   IF INDEX(wdetail.covcod,".") = 0  THEN  wdetail.si   = sicuw.uwm130.uom6_v .
                   ELSE wdetail.siplus   = sicuw.uwm130.uom6_v .
                
                FOR EACH sicuw.uwd132 USE-INDEX uwd13290  WHERE
                        sicuw.uwd132.policy   = sicuw.uwm120.policy  AND
                        sicuw.uwd132.rencnt   = sicuw.uwm120.rencnt  AND
                        sicuw.uwd132.endcnt   = sicuw.uwm120.endcnt  AND
                        sicuw.uwd132.riskno   = sicuw.uwm120.riskno  AND
                        sicuw.uwd132.itemno   = 1  NO-LOCK .
                
                     IF      sicuw.uwd132.bencod = "base"    THEN ASSIGN wdetail.base     = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                     ELSE IF sicuw.uwd132.bencod = "411"     THEN ASSIGN wdetail.no_411   = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                     ELSE IF sicuw.uwd132.bencod = "412"     THEN ASSIGN wdetail.no_412   = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                     ELSE IF sicuw.uwd132.bencod = "42"      THEN ASSIGN wdetail.no_42    = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                     ELSE IF sicuw.uwd132.bencod = "43"      THEN ASSIGN wdetail.no_43    = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                     ELSE IF sicuw.uwd132.bencod = "dod"     THEN ASSIGN wdetail.dod      = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                     /*ELSE IF sicuw.uwd132.bencod = "dod2"  THEN ASSIGN wdetail.addod    = DECI(DECI(np_dedod)  +  DECI(SUBSTRING(sicuw.uwd132.benvar,31,30))).*/
                     ELSE IF sicuw.uwd132.bencod = "dpd"     THEN ASSIGN wdetail.dpd      = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                     ELSE IF sicuw.uwd132.bencod = "flet"    THEN 
                       ASSIGN wdetail.fleet     = trim(SUBSTRING(sicuw.uwd132.benvar,31,30))
                              wdetail.fleetprem = DECI(sicuw.uwd132.prem_c) .
                     ELSE IF sicuw.uwd132.bencod = "ncb"     THEN 
                       ASSIGN wdetail.ncb      = trim(SUBSTRING(sicuw.uwd132.benvar,31,30))
                              wdetail.ncbprem  = DECI(sicuw.uwd132.prem_c) .
                     ELSE IF sicuw.uwd132.bencod = "dspc"    THEN 
                       ASSIGN wdetail.dspc     = trim(SUBSTRING(sicuw.uwd132.benvar,31,30))
                              wdetail.dspcprem = DECI(sicuw.uwd132.prem_c) .
                     ELSE IF sicuw.uwd132.bencod = "dstf"    THEN 
                       ASSIGN wdetail.dstf     = trim(SUBSTRING(sicuw.uwd132.benvar,31,30))
                              wdetail.dstfprem  = DECI(sicuw.uwd132.prem_c)  .
                     ELSE IF index(sicuw.uwd132.bencod,"cl") <> 0 THEN 
                       ASSIGN wdetail.claim    = trim(SUBSTRING(sicuw.uwd132.benvar,31,30))
                              wdetail.clprem   = DECI(sicuw.uwd132.prem_c) .
                   
                     IF      wdetail.covcod = "2.1" AND sicuw.uwd132.bencod = "ba21" THEN ASSIGN wdetail.baseplus     = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                     ELSE IF wdetail.covcod = "2.2" AND sicuw.uwd132.bencod = "ba22" THEN ASSIGN wdetail.baseplus     = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                     ELSE IF wdetail.covcod = "2.3" AND sicuw.uwd132.bencod = "ba23" THEN ASSIGN wdetail.baseplus     = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                     ELSE IF wdetail.covcod = "3.1" AND sicuw.uwd132.bencod = "ba31" THEN ASSIGN wdetail.baseplus     = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                     ELSE IF wdetail.covcod = "3.2" AND sicuw.uwd132.bencod = "ba32" THEN ASSIGN wdetail.baseplus     = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                     ELSE IF wdetail.covcod = "3.3" AND sicuw.uwd132.bencod = "ba33" THEN ASSIGN wdetail.baseplus     = DECI(SUBSTRING(sicuw.uwd132.benvar,31,30)).
                     
                 
                END. /* uwd132 */
            END.
         END. /* uwm100*/
         IF wdetail.compolusory <> "" THEN DO:
             FIND LAST sicuw.uwm100 USE-INDEX uwm10001 WHERE sicuw.uwm100.policy = TRIM(wdetail.compolusory) NO-LOCK NO-ERROR.
             IF AVAIL sicuw.uwm100  THEN DO:
                 ASSIGN wdetail.comment = IF deci(wdetail.premt72) <> deci(uwm100.prem_t) THEN "เบี้ยในไฟล์ " + string(wdetail.premt72) + " ไม่เท่ากับพรีเมียม "  ELSE "" 
                        wdetail.compolusory = uwm100.policy
                        wdetail.premt72     = uwm100.prem_t
                        wdetail.rstp_t72    = uwm100.rstp_t
                        wdetail.rtax_t72    = uwm100.rtax_t.

                 FIND sicuw.uwm120 USE-INDEX uwm12001 WHERE 
                      sicuw.uwm120.policy    = sicuw.uwm100.policy   AND 
                      sicuw.uwm120.rencnt    = sicuw.uwm100.rencnt   AND                          
                      sicuw.uwm120.endcnt    = sicuw.uwm100.endcnt   NO-LOCK NO-ERROR.
                    IF AVAIL sicuw.uwm120 THEN 
                    ASSIGN wdetail.comper72  =  uwm120.com1p    
                           wdetail.comprem72 =  uwm120.com1_r . 
             END.
         END.
         RUN proc_assignrenew .

END. 
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_chkRY C-Win 
PROCEDURE proc_chkRY :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes: Create by Ranu I. A64-0309       
------------------------------------------------------------------------------*/
DEF VAR nv_prm4t AS DECI FORMAT ">>>>>>>>>9.99-" .
DEF VAR nv_mv4t  AS DECI FORMAT ">>>>>>>>>9.99-" .
DEF VAR nv_polday AS INT INIT 0.
DO:

    ASSIGN nv_mv411  = 0
           nv_mv412  = 0
           nv_mv42   = 0
           nv_mv43   = 0
           nv_prm4t  = 0
           nv_mv4t   = 0 
           nv_polday = 0
           nv_polday = (sic_bran.uwm100.expdat - sic_bran.uwm100.comdat) + 1.

    RUN wus/wusppadd (INPUT wdetail.subclass ,
                      INPUT wdetail.NO_411 ,
                      INPUT wdetail.NO_412 ,
                      INPUT wdetail.NO_42  ,
                      INPUT wdetail.NO_43  ,
                      INPUT wdetail.seat41 ,
                      INPUT-OUTPUT  nv_mv411,
                      INPUT-OUTPUT  nv_mv412,
                      INPUT-OUTPUT  nv_mv42 ,
                      INPUT-OUTPUT  nv_mv43 ) .
   IF nv_polday < 365 THEN DO:
        ASSIGN nv_mv411  = IF nv_mv411 > 0 then (nv_mv411 / 365) * nv_polday  else nv_mv411
               nv_mv412  = IF nv_mv412 > 0 then (nv_mv412 / 365) * nv_polday  else nv_mv412
               nv_mv42   = IF nv_mv42  > 0 then (nv_mv42 / 365)  * nv_polday  else nv_mv42 
               nv_mv43   = IF nv_mv43  > 0 then (nv_mv43 / 365)  * nv_polday  else nv_mv43 .
    END.

    IF wdetail.NO_411 <> 0 THEN DO: 
        /*IF nv_411t < 0 OR nv_411t > nv_mv411 THEN */ /*A64-0355*/
        IF nv_411t < 0 THEN  /*A64-0355*/
            ASSIGN
                wdetail.comment  = wdetail.comment + "| Package code/Polmaster : " + wdetail.packcod + "/" + wdetail.polmaster + " เบี้ย รย.411 = " + STRING(nv_411t,"->>>,>>9.99") + " ไม่ถูกต้อง "
                wdetail.WARNING  = wdetail.WARNING + "|เบี้ย รย.411 = " + STRING(nv_411t,"->>>,>>9.99") + " ไม่ถูกต้อง " 
                wdetail.pass     = "N"     
                wdetail.OK_GEN   = "N".
    END.
    IF wdetail.NO_412 <> 0 THEN DO: 
        /*IF nv_412t < 0 OR nv_412t > nv_mv412 THEN  */ /*A64-0355*/
        IF nv_412t < 0 THEN   /*A64-0355*/
            ASSIGN
                wdetail.comment  = wdetail.comment + "| Package code/Polmaster : " + wdetail.packcod + "/" + wdetail.polmaster + " เบี้ย รย.412 = " + STRING(nv_412t,"->>>,>>9.99") + " ไม่ถูกต้อง "
                wdetail.WARNING  = "เบี้ย รย.412 = " + STRING(nv_412t,"->>>,>>9.99") + " ไม่ถูกต้อง " 
                wdetail.pass     = "N"     
                wdetail.OK_GEN   = "N".
    END.
    IF wdetail.NO_42  <> 0 THEN DO: 
        /*IF nv_42t < 0 OR nv_42t > nv_mv42 THEN  */ /*A64-0355*/
        IF nv_42t < 0  THEN   /*A64-0355*/
            ASSIGN
                wdetail.comment  = wdetail.comment + "| Package code/Polmaster : " + wdetail.packcod + "/" + wdetail.polmaster + " เบี้ย รย.42 = " + STRING(nv_42t,"->>>,>>9.99") + " ไม่ถูกต้อง "
                wdetail.WARNING  = "เบี้ย รย.42 = " + STRING(nv_42t,"->>>,>>9.99") + " ไม่ถูกต้อง " 
                wdetail.pass     = "N"     
                wdetail.OK_GEN   = "N".
    END.
    IF wdetail.NO_43  <> 0 THEN DO: 
        /*IF nv_43t < 0 OR nv_43t > nv_mv43 THEN  */ /*A64-0355*/
        IF nv_43t < 0 THEN   /*A64-0355*/
            ASSIGN
                wdetail.comment  = wdetail.comment + "| Package code/Polmaster : " + wdetail.packcod + "/" + wdetail.polmaster + " เบี้ย รย.43 = " + STRING(nv_43t,"->>>,>>9.99") + " ไม่ถูกต้อง "
                wdetail.WARNING  = "เบี้ย รย.43  = " + STRING(nv_43t,"->>>,>>9.99") + " ไม่ถูกต้อง " 
                wdetail.pass     = "N"     
                wdetail.OK_GEN   = "N".
    END.
    IF (wdetail.NO_411 <> 0 OR wdetail.NO_412 <> 0 OR wdetail.NO_42  <> 0 OR wdetail.NO_43  <> 0 ) THEN DO: /*A64-0355*/
        ASSIGN nv_prm4t = nv_411t + nv_412t + nv_42t + nv_43t .
        IF nv_prm4t <= 0 THEN DO:
            ASSIGN
                    wdetail.comment  = wdetail.comment + "| Package code/Polmaster : " + wdetail.packcod + "/" + wdetail.polmaster + " เบี้ยรวม รย. = " + STRING(nv_prm4t,"->>>,>>9.99") + " ไม่ถูกต้อง "
                    wdetail.WARNING  = "เบี้ยรวม รย. = " + STRING(nv_prm4t,"->>>,>>9.99") + " ไม่ถูกต้อง " 
                    wdetail.pass     = "N"     
                    wdetail.OK_GEN   = "N".
        END.
    END.
    /* Add by : A68-0044*/
    IF tg_flag = YES AND wdetail.garage = "G" AND /*INDEX("110,120,210,220,230,320,327,340,347",wdetail.subclass) <> 0 AND*/ nv_ry31 = 0 THEN DO:
        ASSIGN 
               wdetail.comment  = wdetail.comment + "| Class " + wdetail.subclass + " New Tariff Garage = G ต้องมีเบี้ย รย.31 " 
               wdetail.WARNING  = wdetail.subclass + " New Tariff Garage = G ต้องมีเบี้ย รย.31 "  .
    END.
    /* end : A68-0044*/

END.

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_chktest0 C-Win 
PROCEDURE proc_chktest0 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DEF VAR nv_seq         AS INTEGER  INIT  1.
DEF VAR nv_sum         AS INTEGER  INIT  0.
DEF VAR nv_checkdigit  AS INTEGER . 
DEFINE VAR chk_sticker AS CHAR FORMAT "x(15)".
DEF VAR nv_class AS CHAR INIT "" .
ASSIGN fi_process = "check data Text file " + wdetail.riskno  + " " + wdetail.policyno .
DISP fi_process WITH FRAM fr_main.

IF ra_type = 2  AND wdetail.vehreg = " " AND wdetail.prepol  = " " THEN DO: 
   ASSIGN wdetail.comment = wdetail.comment + "| Vehicle Register is mandatory field. "
       wdetail.pass    = "N"   
       WDETAIL.OK_GEN  = "N".
END.
/* เช็ค Agent , Producer */
 IF  wdetail.agent = "" THEN DO:
     ASSIGN wdetail.comment = wdetail.comment + "| Agent Code is Null "
            wdetail.pass    = "N" 
            wdetail.OK_GEN  = "N".
 END.
 ELSE IF wdetail.producer = "" THEN DO:
     ASSIGN wdetail.comment = wdetail.comment + "| Producer Code is Null "
            wdetail.pass    = "N" 
            wdetail.OK_GEN  = "N".
 END.
 ELSE DO:
     ASSIGN nv_agent    = TRIM(wdetail.agent)
            nv_producer = TRIM(wdetail.producer) 
            nv_chkerror = "" .
     RUN wgw/wgwchkagpd(INPUT nv_agent,INPUT nv_producer,INPUT-OUTPUT nv_chkerror) . 
     IF nv_chkerror <> ""  THEN DO:
         ASSIGN wdetail.comment = wdetail.comment + "|" + TRIM(nv_chkerror)
                wdetail.pass    = "N" 
                wdetail.OK_GEN  = "N".
     END.
 END.
 /* A64-0355 */
 IF TRIM(wdetail.jpae) <> ""  THEN DO:
     FIND LAST sicsyac.xmm604 WHERE sicsyac.xmm604.stfcod = TRIM(wdetail.jpae) NO-LOCK NO-ERROR .
     IF NOT AVAIL xmm604 THEN
         ASSIGN wdetail.comment = wdetail.comment + "| Not found Code AE " + wdetail.jpae + "(xmm604)" 
            wdetail.pass    = "N" 
            wdetail.OK_GEN  = "N".
 END.
 IF TRIM(wdetail.jpjtl) <> "" THEN DO: 
     FIND LAST sicsyac.xmm604 WHERE sicsyac.xmm604.stfcod = TRIM(wdetail.jpjtl) NO-LOCK NO-ERROR .
     IF NOT AVAIL xmm604 THEN
         ASSIGN wdetail.comment = wdetail.comment + "| Not found Code Japanese Team Leader " + (wdetail.jpjtl) + "(xmm604)" 
            wdetail.pass    = "N" 
            wdetail.OK_GEN  = "N".
 END.
 IF TRIM(wdetail.jpts) <> "" THEN DO: 
    FIND LAST sicsyac.xmm604 WHERE sicsyac.xmm604.stfcod = TRIM(wdetail.jpts) NO-LOCK NO-ERROR .
     IF NOT AVAIL xmm604 THEN
         ASSIGN wdetail.comment = wdetail.comment + "| Not found Code TS " + (wdetail.jpts) + "(xmm604)"
                wdetail.pass    = "N" 
                wdetail.OK_GEN  = "N".
 END.
 /* end: A64-0355 */
 IF wdetail.n_delercode <> "" THEN DO:
     FIND LAST sicsyac.xmm600 USE-INDEX xmm60001 WHERE xmm600.acno = TRIM(wdetail.n_delercode) NO-LOCK NO-ERROR.
     IF NOT AVAIL xmm600 THEN 
         ASSIGN wdetail.comment = wdetail.comment + "| Not found Code Dealer " + wdetail.n_delercode + "(xmm600)" 
            wdetail.pass    = "N" 
            wdetail.OK_GEN  = "N".
     ELSE DO:
         IF xmm600.closed <> ? AND xmm600.closed < TODAY THEN
         ASSIGN wdetail.comment = wdetail.comment + "| Code Dealer " + wdetail.n_delercode + " Closed Date: " + STRING(xmm600.closed,"99/99/9999") 
                wdetail.pass    = "N" 
                wdetail.OK_GEN  = "N".
     END.
 END.
 IF wdetail.fincode <> "" THEN DO:
     FIND LAST sicsyac.xmm600 USE-INDEX xmm60001 WHERE xmm600.acno = TRIM(wdetail.fincode) NO-LOCK NO-ERROR.
     IF NOT AVAIL xmm600 THEN 
         ASSIGN wdetail.comment = wdetail.comment + "| Not found Code Finance " + wdetail.fincode + "(xmm600)" 
            wdetail.pass    = "N" 
            wdetail.OK_GEN  = "N".
     ELSE DO:
      IF xmm600.closed <> ? AND xmm600.closed < TODAY THEN
       ASSIGN wdetail.comment = wdetail.comment + "| Code Finance " + wdetail.fincode + " Closed Date: " + STRING(xmm600.closed,"99/99/9999") 
              wdetail.pass    = "N" 
              wdetail.OK_GEN  = "N".
     END.
 END.
 IF wdetail.payercod <> "" THEN DO:
     FIND LAST sicsyac.xmm600 USE-INDEX xmm60001 WHERE xmm600.acno = TRIM(wdetail.payercod) NO-LOCK NO-ERROR.
     IF NOT AVAIL xmm600 THEN 
         ASSIGN wdetail.comment = wdetail.comment + "| Not found Code Payer " + wdetail.payercod + "(xmm600)" 
            wdetail.pass    = "N" 
            wdetail.OK_GEN  = "N".
 END.
 IF wdetail.vatcode <> "" THEN DO:
     FIND LAST sicsyac.xmm600 USE-INDEX xmm60001 WHERE xmm600.acno = TRIM(wdetail.vatcode) NO-LOCK NO-ERROR.
     IF NOT AVAIL xmm600 THEN 
         ASSIGN wdetail.comment = wdetail.comment + "| Not found Code Vat " + wdetail.vatcode + "(xmm600)" 
            wdetail.pass    = "N" 
            wdetail.OK_GEN  = "N".
     ELSE DO:
         IF xmm600.closed <> ? AND xmm600.closed < TODAY THEN
         ASSIGN wdetail.comment = wdetail.comment + "| Code VAT " + wdetail.vatcode + " Closed Date: " + STRING(xmm600.closed,"99/99/9999") 
             wdetail.pass    = "N" 
             wdetail.OK_GEN  = "N".
    END.
 END.
 RELEASE sicsyac.xmm600.
 /* เช็คความคุ้มครอง */
 IF wdetail.covcod = "" THEN 
     ASSIGN wdetail.comment = wdetail.comment + "| ประเภทความคุ้มครองเป็นค่าว่าง "
            wdetail.pass    = "N" 
            wdetail.OK_GEN  = "N".
 RUN proc_chkdate . /*A65-0043*/

 IF wdetail.camp_no <> ""  THEN DO:
     FIND LAST stat.campaign_master USE-INDEX campmaster02 WHERE 
        date(campaign_master.effdat) <= date(wdetail.comdat) AND
        date(campaign_master.enddat) >= date(wdetail.comdat) AND
         campaign_master.campcode = wdetail.camp_no NO-LOCK NO-ERROR.
     IF NOT AVAIL campaign_master THEN DO:
         ASSIGN wdetail.comment = wdetail.comment + "| ไม่พบ Campaign Code " + wdetail.camp_no + " ในระบบ (Campaign_master) "
            wdetail.pass    = "N" 
            wdetail.OK_GEN  = "N".
     END.
     ELSE DO:
        RUN proc_chkcampaign.
     END.
 END.
 RELEASE stat.campaign_master .

 IF wdetail.poltyp = "V70" THEN DO:
     /* เช็ค แพ็คเกจ ในพารามิเตอร์ */
     IF wdetail.packcod <> ""  THEN DO:
        FIND LAST stat.caccount USE-INDEX caccount05 WHERE caccount.camcod = TRIM(wdetail.packcod) NO-LOCK NO-ERROR.
        IF AVAIL stat.caccount THEN DO:
            FIND LAST stat.campaign_fil USE-INDEX campfil14  WHERE campaign_fil.camcod = caccount.camcod NO-LOCK NO-ERROR.
            IF NOT AVAIL stat.campaign_fil THEN DO:
                ASSIGN wdetail.comment = wdetail.comment + "|รหัสแพ็คเกจ " + wdetail.packcod + " ยังไม่โหลดวิธีคีย์เข้าระบบ" 
                       wdetail.pass    = "N" 
                       wdetail.OK_GEN  = "N".
            END.
            ELSE IF ra_type = 1 THEN RUN proc_policyname4 . /*A64-0044*/
        END.
        ELSE ASSIGN wdetail.comment = wdetail.comment + "|ไม่พบรหัสแพ็คเกจ" + wdetail.packcod + " ในระบบ"
                    wdetail.pass    = "N"    wdetail.OK_GEN  = "N".
     END.
     /* เช็คน้ำหนักตัน , CC */
     IF wdetail.subclass = " " THEN DO: 
         ASSIGN  wdetail.comment = wdetail.comment + "| sub class เป็นค่าว่าง มีผลต่อการค้นหาข้อมูลใน Table Maktab_fil"
                 wdetail.pass    = "N"      wdetail.OK_GEN  = "N".
     END.
     ELSE DO:
        nv_class = trim(SUBSTR(wdetail.subclass,1,1)) . 
        IF (nv_class = "3" OR nv_class = "4" OR nv_class = "5" OR TRIM(wdetail.subclass) = "803"  OR  
        TRIM(wdetail.subclass)  = "804"  OR TRIM(wdetail.subclass) = "805") AND int(wdetail.weight) = 0 THEN 
           ASSIGN wdetail.comment = wdetail.comment + "|รหัสรถ " + wdetail.subclass + " ต้องระบุน้ำหนักในช่อง น้ำหนัก(ตัน) " 
                  wdetail.pass    = "N" 
                  wdetail.OK_GEN  = "N".
        /* A64-0044 */
        ELSE IF SUBSTR(wdetail.subclass,LENGTH(wdetail.subclass),1) = "E" AND DECI(wdetail.watt) = 0 /* A66-0202 */
            /*INT(wdetail.watt) = 0 */ /* A66-0202 */ THEN
            ASSIGN wdetail.comment = wdetail.comment +  "| " + wdetail.subclass + " เป็น Class รถไฟฟ้า ต้องระบุข้อมูล Kilowatt " 
                       wdetail.pass    = "N" 
                       wdetail.OK_GEN  = "N".
        /* end : A64-0044 */
        ELSE IF int(wdetail.engcc) = 0 AND int(wdetail.weight) = 0 AND DECI(wdetail.watt) = 0 /* A66-0202 */ /*INT(wdetail.watt) = 0*/ /*A66-0202*/ AND
                wdetail.subclass <> "801" /*A65-0079*/  AND wdetail.subclass <> "401" /*A66-0202*/ THEN DO:
                ASSIGN wdetail.comment = wdetail.comment +  "| " + wdetail.subclass + " น้ำหนักรถเป็นค่าว่าง ต้องระบุ CC หรือ Ton หรือ Kilowatt " 
                       wdetail.pass    = "N" 
                       wdetail.OK_GEN  = "N".
        END.
     END.
     IF wdetail.compul = "Y" AND  int(wdetail.premt72) = 0  THEN 
        ASSIGN wdetail.comment = wdetail.comment + "| กรมธรรม์ซื้อควบ = Y เบี้ยพรบ.เป็น 0  "
            wdetail.pass    = "N" 
            wdetail.OK_GEN  = "N".
    IF wdetail.compul = "N" AND (INT(wdetail.premt72) <> 0 ) THEN 
        ASSIGN wdetail.comment = wdetail.comment + "|กรมธรรม์ซื้อควบ = N แต่เบี้ยพรบ.เป็น " + STRING(wdetail.premt72)
            wdetail.pass    = "N" 
            wdetail.OK_GEN  = "N".
    IF (DECI(wdetail.comprem70) <> (-1)) AND DECI(wdetail.comper70) = (-1)  THEN 
        ASSIGN wdetail.comment = wdetail.comment + "|กรมธรรม์ระบุ 70 Commission Amount " + string(wdetail.comprem70) + " แต่ไม่ระบุ Commission% "
            wdetail.pass    = "N" 
            wdetail.OK_GEN  = "N".
    RUN proc_chkco-broker. /* A64-0355*/
 END.
 IF wdetail.poltyp = "V70" AND  int(wdetail.premt) = 0  THEN 
     ASSIGN wdetail.comment = wdetail.comment + "| เบี้ยสุทธิเป็น 0 "
     wdetail.pass    = "N" 
     wdetail.OK_GEN  = "N".
     
 IF wdetail.poltyp = "V72" AND (INT(wdetail.premt72) = 0 ) THEN DO:
    ASSIGN wdetail.comment = wdetail.comment + "| พรบ. เบี้ยเป็น 0 "
    wdetail.pass    = "N" 
    wdetail.OK_GEN  = "N".
 END.
 ELSE DO:
     RUN proc_chkcomp.
 END.

 IF wdetail.poltyp = "V72" AND (INT(wdetail.comprem72) <> (-1) ) AND DECI(wdetail.comper72) = (-1)  THEN 
     ASSIGN wdetail.comment = wdetail.comment + "|กรมธรรม์ 72 ระบุ Commission Amount " + string(wdetail.comprem72) + "  แต่ไม่ระบุ Commission % "
            wdetail.pass    = "N" 
            wdetail.OK_GEN  = "N".

IF wdetail.n_branch = ""  THEN DO: 
    ASSIGN  wdetail.pass = "N"  
    wdetail.comment = wdetail.comment + "| พบสาขาเป็นค่าว่าง" 
    wdetail.OK_GEN  = "N".
END.
ELSE DO:
    FIND LAST sicsyac.xmm023 USE-INDEX xmm02301 WHERE sicsyac.xmm023.branch = TRIM(wdetail.n_bran) NO-LOCK NO-ERROR.
    IF NOT AVAIL sicsyac.xmm023 THEN DO:
        ASSIGN  wdetail.pass = "N"  
        wdetail.comment = wdetail.comment + "| ไม่พบสาขาในระบบ (XMM023)" 
        wdetail.OK_GEN  = "N".
    END.
END.
RELEASE sicsyac.xmm023 .
IF wdetail.cancel = "ca"  THEN  
    ASSIGN  wdetail.pass = "N"  
    wdetail.comment = wdetail.comment + "| cancel"
    wdetail.OK_GEN  = "N".
IF wdetail.insnam = " " THEN 
    ASSIGN  wdetail.comment = wdetail.comment + "| ชื่อผู้เอาประกันเป็นค่าว่างกรุณาใส่ชื่อผู้เอาประกัน"
    wdetail.pass    = "N"     
    wdetail.OK_GEN  = "N".
IF wdetail.drivnam  = "y" /*AND wdetail.drivername1 =  " " */ /*A67-0029*/  THEN DO:
    /* add by : A67-0029 */ 
    FIND LAST wdrive WHERE wdrive.policy = wdetail.policy NO-LOCK NO-ERROR .
    IF AVAIL wdrive  THEN DO:
        IF wdrive.name1 = "" THEN DO:
    /* end : A67-0029 */ 
            ASSIGN  wdetail.comment = wdetail.comment + "| มีการระบุว่ามีคนขับแต่ไม่มีชื่อคนขับ"
            wdetail.pass    = "N" 
            wdetail.OK_GEN  = "N".
        END.
    END.
END.
IF wdetail.prempa = " " AND wdetail.poltyp = "V70" THEN 
    ASSIGN  wdetail.comment = wdetail.comment + "| prem pack เป็นค่าว่าง มีผลต่อการค้นหาข้อมูลใน Table Maktab_fil"
    wdetail.pass    = "N"     
    wdetail.OK_GEN  = "N".
IF wdetail.brand = " " THEN 
    ASSIGN  wdetail.comment = wdetail.comment + "| Brand เป็นค่าว่าง มีผลต่อการค้นหาข้อมูลใน Table Maktab_fil"
    wdetail.pass    = "N"        
    wdetail.OK_GEN  = "N".
/* A65-0079 
IF wdetail.model = " " THEN 
    ASSIGN  wdetail.comment = wdetail.comment + "| model เป็นค่าว่าง มีผลต่อการค้นหาข้อมูลใน Table Maktab_fil"
    wdetail.pass    = "N"   
    wdetail.OK_GEN  = "N".*/
/* comment by : A65-0043...
IF wdetail.seat  = 0 THEN 
    ASSIGN  wdetail.comment = wdetail.comment + "| seat เป็น 0 มีผลต่อการค้นหาข้อมูลใน Table Maktab_fil"
    wdetail.pass    = "N"    
    wdetail.OK_GEN  = "N".*/
/*IF wdetail.yrmanu = " " THEN */ /* A65-0043*/
IF wdetail.poltyp = "V70" AND wdetail.yrmanu = " " THEN  /* A65-0043*/
    ASSIGN  wdetail.comment = wdetail.comment + "| year manufacture เป็นค่าว่าง มีผลต่อการค้นหาข้อมูลใน Table Maktab_fil"
    wdetail.pass    = "N"  
    wdetail.OK_GEN  = "N".
/* A65-0079
IF trim(wdetail.chasno) = ""  THEN
    ASSIGN  wdetail.comment = wdetail.comment + "| เลขตัวถัง เป็นค่าว่าง "
    wdetail.pass    = "N"  
    wdetail.OK_GEN  = "N".*/
ASSIGN
    nv_maxsi  = 0       nv_maxdes = ""  
    nv_minsi  = 0       nv_mindes = ""  
    nv_si     = 0       chkred    = NO. 
    /*end note add &  modi*/
ASSIGN                  
    NO_CLASS  = wdetail.prempa + wdetail.subclass 
    nv_poltyp = wdetail.poltyp.

IF nv_poltyp = "v72" THEN NO_CLASS  =  wdetail.subclass.
If no_class  <>  " " Then do:
    FIND FIRST  sicsyac.xmd031 USE-INDEX xmd03101   WHERE
        sicsyac.xmd031.poltyp =   nv_poltyp AND
        sicsyac.xmd031.class  =   no_class  NO-LOCK NO-ERROR NO-WAIT.
    IF NOT AVAILABLE sicsyac.xmd031 THEN 
       ASSIGN
            wdetail.comment = wdetail.comment + "| Not On Business Class xmd031" 
            wdetail.pass    = "N"   
            wdetail.OK_GEN  = "N".
    
    FIND sicsyac.xmm016 USE-INDEX xmm01601 WHERE 
        sicsyac.xmm016.class =    no_class  NO-LOCK NO-ERROR.
    IF NOT AVAILABLE sicsyac.xmm016 THEN 
        ASSIGN
            wdetail.comment = wdetail.comment + "| Not on Business class on xmm016"
            wdetail.pass    = "N"    
            wdetail.OK_GEN  = "N".
    ELSE 
        ASSIGN    
            wdetail.tariff =   sicsyac.xmm016.tardef
            no_class       =   sicsyac.xmm016.class
            nv_sclass      =   Substr(no_class,2,3).
END.
release sicsyac.xmd031.
release sicsyac.xmm016.

FIND sicsyac.sym100 USE-INDEX sym10001 WHERE
    sicsyac.sym100.tabcod = "U014"    AND
    sicsyac.sym100.itmcod = trim(wdetail.vehuse) NO-LOCK NO-ERROR.
IF NOT AVAIL sicsyac.sym100 THEN DO:
    ASSIGN     
        wdetail.pass    = "N"  
        wdetail.comment = wdetail.comment + "| ไม่พบ Veh.Usage ในระบบ "
        wdetail.OK_GEN  = "N".
END.
 Find  sicsyac.sym100 Use-index sym10001  Where
     sicsyac.sym100.tabcod = "u013"         And
     sicsyac.sym100.itmcod = wdetail.covcod
     No-lock no-error no-wait.
 IF not avail sicsyac.sym100 Then DO:
     ASSIGN wdetail.comment = wdetail.comment + "| Not on Motor Cover Type Codes table sym100 u013"
         wdetail.pass    = "N"    
         wdetail.OK_GEN  = "N".
 END.
 RELEASE sicsyac.sym100 .
 /*---------- fleet -------------------*/
 IF inte(wdetail.fleet) <> 0 AND INTE(wdetail.fleet) <> 10 Then 
     ASSIGN wdetail.comment = wdetail.comment + "| Fleet Percent must be 0 or 10. "
         wdetail.pass    = "N"    
         wdetail.OK_GEN  = "N".
 /*----------  ncb -------------------*/
 IF (DECI(wdetail.ncb) = 0 )  OR (DECI(wdetail.ncb) = 20 ) OR
    (DECI(wdetail.ncb) = 30 ) OR (DECI(wdetail.ncb) = 40 ) OR
    (DECI(wdetail.ncb) = 50 )    THEN DO:
 END.
 ELSE ASSIGN wdetail.comment = wdetail.comment + "| not on NCB Rates file xmm104."
         wdetail.pass    = "N"   
         wdetail.OK_GEN  = "N".
 ASSIGN NV_NCBPER = 0
        NV_NCBPER = INTE(WDETAIL.NCB).
 If nv_ncbper  <> 0 Then do:
     Find first sicsyac.xmm104 Use-index xmm10401 Where
         sicsyac.xmm104.tariff = wdetail.tariff                      AND
         sicsyac.xmm104.class  = wdetail.prempa + wdetail.subclass   AND
         sicsyac.xmm104.covcod = wdetail.covcod           AND
         sicsyac.xmm104.ncbper = INTE(wdetail.ncb)
         No-lock no-error no-wait.
     IF not avail  sicsyac.xmm104  Then 
         ASSIGN wdetail.comment = wdetail.comment + "| This NCB Step not on NCB Rates file xmm104. "
             wdetail.pass    = "N"     
             wdetail.OK_GEN  = "N".
 END. /*ncb <> 0*/
 RELEASE sicsyac.xmm104 .
     /******* drivernam **********/
nv_sclass = wdetail.subclass. 
If  wdetail.drivnam = "y" AND substr(nv_sclass,2,1) = "2"   Then 
   ASSIGN wdetail.comment = wdetail.comment + "| CODE  nv_sclass Driver 's Name must be no. "
       wdetail.pass    = "N"    
       wdetail.OK_GEN  = "N".

IF wdetail.stk <> "" AND wdetail.poltyp = "V72"  THEN DO: 
    IF SUBSTR(wdetail.stk,1,1) = "2" THEN chr_sticker = "0" + wdetail.stk.
    ELSE chr_sticker = wdetail.stk.
    
    IF LENGTH(chr_sticker) < 9 OR LENGTH(chr_sticker) > 13 THEN DO:
        ASSIGN wdetail.comment = wdetail.comment + "| เลข Sticker ต้องเป็น 11 หรือ 13 หลักเท่านั้น"   
        wdetail.pass    = ""
        wdetail.OK_GEN  = "N".
    END.
    ELSE DO:
        chk_sticker  = chr_sticker .
        RUN wuz\wuzchmod.
        IF chk_sticker  <> chr_sticker  Then 
          ASSIGN  wdetail.pass    = "N"
                  wdetail.comment = wdetail.comment + "| Sticker Number ใช้ Generate ไม่ได้ เนื่องจาก Module Error".
        
        nv_newsck = " ".
        IF SUBSTR(wdetail.stk,1,1) = "2" THEN wdetail.stk = "0" + wdetail.stk.
        ELSE wdetail.stk = wdetail.stk.
        
        FIND FIRST stat.detaitem USE-INDEX detaitem11 WHERE
                   stat.detaitem.serailno = trim(wdetail.stk) NO-LOCK NO-ERROR.
        IF AVAIL stat.detaitem THEN DO:
            FIND LAST sicuw.uwm100 USE-INDEX uwm10001 WHERE 
                  sicuw.uwm100.policy = TRIM(stat.detaitem.policy) /*AND /* A65-0079 : ranu 08/03/2022*/
                  sicuw.uwm100.rencnt = stat.detaitem.rencnt  AND
                  sicuw.uwm100.endcnt = stat.detaitem.endcnt */ NO-LOCK NO-ERROR .
            IF AVAIL sicuw.uwm100 THEN DO:
                /*IF sicuw.uwm100.firstname <> ""  AND sicuw.uwm100.comdat <> ?   AND sicuw.uwm100.expdat  <> ?   THEN DO:*/ /* A65-0079 : ranu 08/03/2022*/
                IF ( sicuw.uwm100.firstname <> "" OR sicuw.uwm100.name1 <> "" ) AND sicuw.uwm100.comdat <> ? AND 
                    sicuw.uwm100.expdat  <> ?   THEN DO:  /* A65-0079 : ranu 08/03/2022*/
                  ASSIGN  wdetail.pass    = "N"
                       wdetail.comment = wdetail.comment + "| หมายเลข Sticker เบอร์นี้ได้ถูกใช้ไปกับ Policy " + stat.detaitem.policy .
                END.
            END.
            /* A65-0079 : ranu 08/03/2022*/
            ELSE DO:
                ASSIGN  wdetail.pass    = "N"
                       wdetail.comment = wdetail.comment + "| หมายเลข Sticker เบอร์นี้ได้ถูกใช้ไปกับ Policy " + stat.detaitem.policy .
            END.
            /* A65-0079 : ranu 08/03/2022*/
        END.
        RELEASE stat.detaitem .
    END.
END.  
RUN proc_chkpolpremium .
IF wdetail.dgprem <> 0 OR TRIM(wdetail.dgpackge) <> "" THEN RUN proc_chkDG.  /*A64-0355*/
   
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_chktest1 C-Win 
PROCEDURE proc_chktest1 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
-----------------------------------------------------------------------------*/
RUN proc_var.
LOOP_WDETAIL:
FOR EACH wdetail  WHERE wdetail.policyno <> ""  .

    OUTPUT TO Log_LoadMitsu.txt APPEND.
    PUT " " TODAY FORMAT "99/99/9999" ";" STRING(TIME,"HH:MM:SS") "." SUBSTR(STRING(MTIME,">>>>99999999"),10,3) 
          " start create data " + wdetail.policyno   FORMAT "X(150)" SKIP.
    OUTPUT CLOSE.
        /*------------------  renew ---------------------*/
        ASSIGN fi_process = "Process data Load Text...." + wdetail.policyno .
        DISP fi_process WITH FRAM fr_main.

        RUN proc_cr_2.
        ASSIGN 
            nv_dss_per   = 0   
            n_rencnt     = 0
            n_endcnt     = 0
            nv_dscom     = 0
            nv_drivno    = 0
            nv_dlevel    = 0  /*A67-0029*/
            nv_dlevper   = 0  /*A67-0029*/
            /*nv_polmaster = "" */ /*A64-0044*/
            n_rencnt     = IF ra_type = 1 THEN 0 ELSE INT(wdetail.rencnt).
        
        IF wdetail.poltyp = "V70" THEN wdetail.compul = "N"  .
        IF wdetail.poltyp = "V72" THEN wdetail.compul = "Y" .
        
        IF wdetail.prepol <> " " AND wdetail.poltyp = "V72" THEN wdetail.prepol = "" .

        IF wdetail.poltyp = "V72"  THEN DO:
            /*RUN proc_72.*/
            RUN proc_policy. 
            RUN proc_722.
            RUN proc_723 (INPUT  s_recid1,       
                          INPUT  s_recid2,
                          INPUT  s_recid3,
                          INPUT  s_recid4,
                          INPUT-OUTPUT nv_message).

           /* OUTPUT TO Log_LoadMitsu.txt APPEND.
            PUT " " TODAY FORMAT "99/99/9999" ";" STRING(TIME,"HH:MM:SS") "." SUBSTR(STRING(MTIME,">>>>99999999"),10,3) 
                   " End create data " + wdetail.policyno   FORMAT "X(150)" SKIP.
            OUTPUT CLOSE.*/

            NEXT.
        END.
        RUN proc_policy . 
        RUN proc_chktest2.      
        RUN proc_chktest3.
        RUN proc_chktest4. 

   /* OUTPUT TO Log_LoadMitsu.txt APPEND.
    PUT " " TODAY FORMAT "99/99/9999" ";" STRING(TIME,"HH:MM:SS") "." SUBSTR(STRING(MTIME,">>>>99999999"),10,3) 
           " End create data " + wdetail.policyno   FORMAT "X(150)" SKIP.
    OUTPUT CLOSE.*/
/*
RELEASE sic_bran.uwm100 .
RELEASE sic_bran.uwm120 .
RELEASE sic_bran.uwm130 .
RELEASE sic_bran.uwm301 .*/
END.     /*for each*/
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_chktest2 C-Win 
PROCEDURE proc_chktest2 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
ASSIGN fi_process = "Create Data " + wdetail.policyno + " on uwm130,uwm301...."  .
DISP fi_process WITH FRAM fr_main.
FIND sic_bran.uwm130 USE-INDEX uwm13001 WHERE
           sic_bran.uwm130.policy  = sic_bran.uwm100.policy AND
           sic_bran.uwm130.rencnt  = sic_bran.uwm100.rencnt AND
           sic_bran.uwm130.endcnt  = sic_bran.uwm100.endcnt AND
           sic_bran.uwm130.riskgp  = s_riskgp               AND            /*0*/
           sic_bran.uwm130.riskno  = s_riskno               AND            /*1*/
           sic_bran.uwm130.itemno  = s_itemno               AND            /*1*/
           sic_bran.uwm130.bchyr   = nv_batchyr             AND 
           sic_bran.uwm130.bchno   = nv_batchno             AND 
           sic_bran.uwm130.bchcnt  = nv_batcnt             NO-WAIT NO-ERROR.
IF NOT AVAILABLE uwm130 THEN DO:
    DO TRANSACTION:
    CREATE sic_bran.uwm130.
    ASSIGN
        sic_bran.uwm130.policy = sic_bran.uwm120.policy
        sic_bran.uwm130.rencnt = sic_bran.uwm120.rencnt   sic_bran.uwm130.endcnt = sic_bran.uwm120.endcnt
        sic_bran.uwm130.riskgp = sic_bran.uwm120.riskgp   sic_bran.uwm130.riskno = sic_bran.uwm120.riskno
        sic_bran.uwm130.itemno = s_itemno
        sic_bran.uwm130.bchyr  = nv_batchyr          /* batch Year */
        sic_bran.uwm130.bchno  = nv_batchno          /* bchno      */
        sic_bran.uwm130.bchcnt = nv_batcnt        /* bchcnt     */
        nv_sclass     = wdetail.subclass
        nv_uom6_u     = "" 
        nv_othcod     = ""
        nv_othvar1    = ""
        nv_othvar2    = ""
        nv_othvar     = "". 

    IF wdetail.special  =  "A"  THEN DO:
       nv_uom6_u  =  "A".
    END.     
    IF CAPS(nv_uom6_u) = "A"  Then
        Assign  nv_uom6_u                  = "A"
        nv_othcod                  = "OTH"
        nv_othvar1                 = "     Accessory  = "
        nv_othvar2                 =  STRING(nv_uom6_u)
        SUBSTRING(nv_othvar,1,30)  = nv_othvar1
        SUBSTRING(nv_othvar,31,30) = nv_othvar2.
    ELSE ASSIGN  nv_uom6_u              = ""
            nv_othcod                  = ""
            nv_othvar1                 = ""
            nv_othvar2                 = ""
            SUBSTRING(nv_othvar,1,30)  = nv_othvar1
            SUBSTRING(nv_othvar,31,30) = nv_othvar2.
    
    IF (wdetail.covcod = "1")   OR (wdetail.covcod = "5")    OR (wdetail.covcod = "2.1") OR (wdetail.covcod = "3.1") OR
       (wdetail.covcod = "2.2") OR (wdetail.covcod = "3.2")  THEN DO: /*a62-0215*/
        ASSIGN
            sic_bran.uwm130.uom6_v   = IF      wdetail.covcod = "2.1" THEN inte(wdetail.siplus)
                                       ELSE IF wdetail.covcod = "2.2" THEN inte(wdetail.siplus) 
                                       ELSE IF wdetail.covcod = "3.1" THEN INTE(wdetail.siplus) 
                                       ELSE IF wdetail.covcod = "3.2" THEN INTE(wdetail.siplus) 
                                       ELSE inte(wdetail.si)
            sic_bran.uwm130.uom7_v   = IF      wdetail.covcod = "2.1" THEN inte(wdetail.siplus)
                                       ELSE IF wdetail.covcod = "2.2" THEN inte(wdetail.siplus) 
                                       ELSE IF wdetail.covcod = "3.1" THEN 0 
                                       ELSE IF wdetail.covcod = "3.2" THEN 0  
                                       ELSE inte(wdetail.si)
            sic_bran.uwm130.fptr01   = 0     sic_bran.uwm130.bptr01 = 0  /*Item Upper text*/
            sic_bran.uwm130.fptr02   = 0     sic_bran.uwm130.bptr02 = 0  /*Item Lower Text*/
            sic_bran.uwm130.fptr03   = 0     sic_bran.uwm130.bptr03 = 0  /*Cover & Premium*/
            sic_bran.uwm130.fptr04   = 0     sic_bran.uwm130.bptr04 = 0  /*Item Endt. Text*/
            sic_bran.uwm130.fptr05   = 0     sic_bran.uwm130.bptr05 = 0. /*Item Endt. Clause*/
    END.
    IF wdetail.covcod = "2"  THEN DO:
        ASSIGN
            sic_bran.uwm130.uom6_v   = 0
            sic_bran.uwm130.uom7_v   = inte(wdetail.si)
            sic_bran.uwm130.fptr01   = 0     sic_bran.uwm130.bptr01 = 0  /*Item Upper text*/
            sic_bran.uwm130.fptr02   = 0     sic_bran.uwm130.bptr02 = 0  /*Item Lower Text*/
            sic_bran.uwm130.fptr03   = 0     sic_bran.uwm130.bptr03 = 0  /*Cover & Premium*/
            sic_bran.uwm130.fptr04   = 0     sic_bran.uwm130.bptr04 = 0  /*Item Endt. Text*/
            sic_bran.uwm130.fptr05   = 0     sic_bran.uwm130.bptr05 = 0. /*Item Endt. Clause*/
    END.
    IF wdetail.covcod = "3"  THEN DO:
        ASSIGN
            sic_bran.uwm130.uom6_v   = 0
            sic_bran.uwm130.uom7_v   = 0
            sic_bran.uwm130.fptr01   = 0     sic_bran.uwm130.bptr01 = 0  /*Item Upper text*/
            sic_bran.uwm130.fptr02   = 0     sic_bran.uwm130.bptr02 = 0  /*Item Lower Text*/
            sic_bran.uwm130.fptr03   = 0     sic_bran.uwm130.bptr03 = 0  /*Cover & Premium*/
            sic_bran.uwm130.fptr04   = 0     sic_bran.uwm130.bptr04 = 0  /*Item Endt. Text*/
            sic_bran.uwm130.fptr05   = 0     sic_bran.uwm130.bptr05 = 0. /*Item Endt. Clause*/
    END.
    IF wdetail.poltyp = "v72" THEN  n_sclass72 = wdetail.subclass.
    ELSE n_sclass72 = wdetail.prempa + wdetail.subclass .

    FIND FIRST stat.clastab_fil Use-index clastab01 Where
        stat.clastab_fil.class   = n_sclass72       And
        stat.clastab_fil.covcod  = wdetail.covcod No-lock  No-error No-wait.
    IF avail stat.clastab_fil Then do: 
        Assign 
            sic_bran.uwm130.uom1_v     = if int(wdetail.comper)   <> 0 then int(wdetail.comper)   else stat.clastab_fil.uom1_si
            sic_bran.uwm130.uom2_v     = if int(wdetail.comacc)   <> 0 then int(wdetail.comacc)   else stat.clastab_fil.uom2_si
            sic_bran.uwm130.uom5_v     = if int(wdetail.deductpd) <> 0 then int(wdetail.deductpd) else stat.clastab_fil.uom5_si
            sic_bran.uwm130.uom1_u     = if sic_bran.uwm130.uom1_v = 999999999 then "U" else "" /*A64-0355 unlimit */
            sic_bran.uwm130.uom2_u     = if sic_bran.uwm130.uom2_v = 999999999 then "U" else "" /*A64-0355 unlimit */
            sic_bran.uwm130.uom5_u     = if sic_bran.uwm130.uom5_v = 999999999 then "U" else "" /*A64-0355 unlimit */
            sic_bran.uwm130.uom8_v     =  stat.clastab_fil.uom8_si                
            sic_bran.uwm130.uom9_v     =  stat.clastab_fil.uom9_si          
            sic_bran.uwm130.uom3_v     =  0
            sic_bran.uwm130.uom4_v     =  0
            sic_bran.uwm130.uom6_u     =  nv_uom6_u    /* อุปกรณ์เสริมพิเศษ */
            wdetail.comper             =  stat.clastab_fil.uom8_si                
            wdetail.comacc             =  stat.clastab_fil.uom9_si
            nv_uom1_v                  =  sic_bran.uwm130.uom1_v   
            nv_uom2_v                  =  sic_bran.uwm130.uom2_v
            nv_uom5_v                  =  sic_bran.uwm130.uom5_v        
            sic_bran.uwm130.uom1_c  = "D1"
            sic_bran.uwm130.uom2_c  = "D2"
            sic_bran.uwm130.uom5_c  = "D5"
            sic_bran.uwm130.uom6_c  = "D6"
            sic_bran.uwm130.uom7_c  = "D7".
        If  wdetail.garage  =  "G"  THEN DO:
            /* add by :A65-0079 */
            Assign 
            WDETAIL.no_411  =  if int(wdetail.NO_411) <> -1 then wdetail.NO_411 else stat.clastab_fil.si_41pai
            WDETAIL.no_412  =  if int(wdetail.NO_412) <> -1 then wdetail.NO_412 else stat.clastab_fil.si_41pai
            WDETAIL.no_42   =  if int(wdetail.NO_42)  <> -1 then wdetail.NO_42  else stat.clastab_fil.si_42                         
            WDETAIL.no_43   =  if int(wdetail.NO_43)  <> -1 then wdetail.NO_43  else stat.clastab_fil.impsi_43 
             /* end A75-0079 */
            /*WDETAIL.seat41  =  stat.clastab_fil.dri_41 + stat.clastab_fil.pass_41. */   /*A64-0044*/   
            wdetail.seat41   =  IF wdetail.seat41 <> 0 THEN wdetail.seat41 ELSE stat.clastab_fil.dri_41 + stat.clastab_fil.pass_41.  /*A64-0044*/ 
        END.
        Else DO:
             /* add by :A65-0079 */
            Assign 
                WDETAIL.no_411  =  if int(wdetail.NO_411) <> -1 then wdetail.NO_411 else stat.clastab_fil.si_41unp
                WDETAIL.no_412  =  if int(wdetail.NO_412) <> -1 then wdetail.NO_412 else stat.clastab_fil.si_41unp
                WDETAIL.no_42   =  if int(wdetail.NO_42)  <> -1 then wdetail.NO_42  else stat.clastab_fil.si_42
                WDETAIL.no_43   =  if int(wdetail.NO_43)  <> -1 then wdetail.NO_43  else stat.clastab_fil.si_43
             /* end A75-0079 */
                wdetail.seat41  = IF wdetail.seat41 <> 0 THEN wdetail.seat41 ELSE stat.clastab_fil.dri_41 + stat.clastab_fil.pass_41.  /*A64-0044*/ 
        END.
    END. 
    /* add by : A64-0355*/
    ELSE DO:
        ASSIGN wdetail.pass    = "N"
               wdetail.comment = wdetail.comment + "| Class " + n_sclass72 + " Cover: " + wdetail.covcod + " Not on Paramter (clastab_fil) ". 
    END. /* end : A64-0355*/
    ASSIGN  nv_riskno = 1   nv_itemno = 1.
    IF wdetail.covcod = "1" Then 
        RUN wgs/wgschsum(INPUT  wdetail.policy, 
                         nv_riskno,
                         nv_itemno).
    END.  /* end Do transaction*/
    s_recid3  = RECID(sic_bran.uwm130).
    nv_covcod = wdetail.covcod.
    nv_makdes = wdetail.brand.
    nv_moddes = wdetail.model.
    nv_newsck = " ".
    RUN proc_chassic.
    IF SUBSTRING(wdetail.stk,1,1) = "2" THEN nv_newsck = "0" + wdetail.stk.
    ELSE nv_newsck =  wdetail.stk.
    FIND sic_bran.uwm301 USE-INDEX uwm30101      WHERE
         sic_bran.uwm301.policy = sic_bran.uwm100.policy    AND
         sic_bran.uwm301.rencnt = sic_bran.uwm100.rencnt    AND
         sic_bran.uwm301.endcnt = sic_bran.uwm100.endcnt    AND
         sic_bran.uwm301.riskgp = s_riskgp                  AND
         sic_bran.uwm301.riskno = s_riskno                  AND
         sic_bran.uwm301.itemno = s_itemno                  AND
         sic_bran.uwm301.bchyr  = nv_batchyr                AND 
         sic_bran.uwm301.bchno  = nv_batchno                AND 
         sic_bran.uwm301.bchcnt = nv_batcnt                     
         NO-WAIT NO-ERROR.
     IF NOT AVAILABLE sic_bran.uwm301 THEN DO:                  
         DO TRANSACTION:
             CREATE sic_bran.uwm301.
         END. 
     END. 
     ASSIGN
         sic_bran.uwm301.policy   = sic_bran.uwm120.policy                 
         sic_bran.uwm301.rencnt   = sic_bran.uwm120.rencnt
         sic_bran.uwm301.endcnt   = sic_bran.uwm120.endcnt
         sic_bran.uwm301.riskgp   = sic_bran.uwm120.riskgp
         sic_bran.uwm301.riskno   = sic_bran.uwm120.riskno
         sic_bran.uwm301.itemno   = s_itemno
         sic_bran.uwm301.tariff   = wdetail.tariff    
         sic_bran.uwm301.covcod   = nv_covcod
         /*sic_bran.uwm301.cha_no   = wdetail.chasno */ /*A65-0079*/
         sic_bran.uwm301.cha_no   = IF wdetail.chasno = "" THEN "-" ELSE TRIM(wdetail.chasno) /*A65-0079*/
         /*sic_bran.uwm301.trareg   = wdetail.chasno*/ /*A64-0044*/
         sic_bran.uwm301.trareg   = IF nv_uwm301trareg = "" THEN "-" ELSE nv_uwm301trareg /*A65-0079*/ 
         sic_bran.uwm301.eng_no   = wdetail.eng
         sic_bran.uwm301.Tons     = IF int(wdetail.weight) <> 0 AND DECI(wdetail.weight) < 100 THEN wdetail.weight * 1000 ELSE wdetail.weight  
         sic_bran.uwm301.engine   = INTEGER(wdetail.engcc)
         /*sic_bran.uwm301.watts    = INTEGER(wdetail.watt)*/ /*A66-0202*/
         sic_bran.uwm301.watts    = DECI(wdetail.watt)   /*A66-0202*/
         sic_bran.uwm301.yrmanu   = INTEGER(wdetail.yrmanu)
         sic_bran.uwm301.garage   = wdetail.garage
         sic_bran.uwm301.body     = wdetail.body
         sic_bran.uwm301.seats    = INTEGER(wdetail.seat)
         sic_bran.uwm301.mv_ben83 = IF wdetail.poltyp = "V72" THEN "" ELSE IF trim(wdetail.benname) = "-" OR trim(wdetail.benname) = "Null" THEN ""  /*Null A64-0309*/
                                    ELSE trim(wdetail.benname)
         sic_bran.uwm301.vehreg   = wdetail.vehreg + " " + wdetail.re_country
         sic_bran.uwm301.vehuse   = wdetail.vehuse
         sic_bran.uwm301.modcod   = wdetail.redbook
         sic_bran.uwm301.moddes   = trim(wdetail.brand) + " " + trim(wdetail.model) + " " + trim(wdetail.submodel)    
         sic_bran.uwm301.sckno    = 0
         sic_bran.uwm301.itmdel   = NO
         sic_bran.uwm301.logbok   = IF TRIM(wdetail.inspec) = "N" OR TRIM(wdetail.inspec) = "No" THEN "N" 
                                    ELSE IF TRIM(wdetail.inspec) = "Y" OR TRIM(wdetail.inspec) = "Yes" THEN "Y" ELSE "" 
         sic_bran.uwm301.car_year = INT(wdetail.re_year)                                                                
         sic_bran.uwm301.province_reg  = trim(wdetail.re_country)                                                   
         sic_bran.uwm301.vehgrp    = trim(wdetail.cargrp)                                                   
         sic_bran.uwm301.car_color = trim(wdetail.colorcar)                                                  
         sic_bran.uwm301.fuel      = trim(wdetail.fule)
         sic_bran.uwm301.watts     = deci(wdetail.watt)      /* A64-0044-*/                                                   
         wdetail.tariff            = sic_bran.uwm301.tariff
         sic_bran.uwm130.i_text    = IF INT(wdetail.cctv)  <> 0 THEN "0001" ELSE ""   /*CCTV */
         /* A67-0029 */
         sic_bran.uwm301.maksi     = INTE(wdetail.maksi)      
         sic_bran.uwm301.eng_no2   = wdetail.eng_no2  
         sic_bran.uwm301.battper   = INTE(wdetail.battper)
         /*sic_bran.uwm301.battrate  = INTE(wdetail.battrate)*/
         sic_bran.uwm301.battyr    = INTE(wdetail.battyr)  
         sic_bran.uwm301.battsi    = INTE(wdetail.battsi)
         sic_bran.uwm301.battprice = deci(wdetail.battprice)
         sic_bran.uwm301.battno    = wdetail.battno 
         sic_bran.uwm301.chargno   = wdetail.chargno 
         sic_bran.uwm301.chargsi   = deci(wdetail.chargsi)  
         sic_bran.uwm301.battflg   = IF DECI(wdetail.battprm) <> 0 THEN "Y" ELSE "N"  
         sic_bran.uwm301.chargflg  = IF DECI(wdetail.chargprm) <> 0 THEN "Y" ELSE "N". 
   RUN proc_prmtxt.
   IF wdetail.compul = "y" THEN DO:
     sic_bran.uwm301.cert = "".
     IF LENGTH(wdetail.stk) = 11  THEN sic_bran.uwm301.drinam[9] = "STKNO:" + STRING(wdetail.stk,"99999999999"). 
     IF LENGTH(wdetail.stk) = 13  THEN sic_bran.uwm301.drinam[9] = "STKNO:" + STRING(wdetail.stk,"9999999999999").
     IF wdetail.stk = ""  THEN sic_bran.uwm301.drinam[9] = "".
     FIND FIRST brStat.Detaitem USE-INDEX detaitem11 WHERE
         brStat.Detaitem.serailno = wdetail.stk  NO-LOCK NO-ERROR .
     IF NOT AVAIL brstat.Detaitem THEN DO:     
         CREATE brstat.Detaitem.
         ASSIGN brStat.Detaitem.Policy   = sic_bran.uwm301.Policy
                brStat.Detaitem.RenCnt   = sic_bran.uwm301.RenCnt
                brStat.Detaitem.EndCnt   = sic_bran.uwm301.Endcnt
                brStat.Detaitem.RiskNo   = sic_bran.uwm301.RiskNo
                brStat.Detaitem.ItemNo   = sic_bran.uwm301.ItemNo
                brStat.Detaitem.serailno = wdetail.stk.  
     END.
   END.
   ASSIGN  sic_bran.uwm301.bchyr = nv_batchyr       /* batch Year */
           sic_bran.uwm301.bchno = nv_batchno       /* bchno      */
           sic_bran.uwm301.bchcnt= nv_batcnt.      /* bchcnt     */
          
   IF wdetail.prepol = "" THEN DO:
     IF INT(wdetail.drivnam) > 0 THEN DO:
         ASSIGN wdetail.drivnam = "Y" .
         /*RUN proc_mailtxt.  /*A55-0151*/*/ /* A67-0029*/
     END.
     ELSE ASSIGN wdetail.drivnam = "N".
     RUN proc_chkdrive. /*A67-0029*/
   END.
   ELSE DO:
     /* add by : A67-0212 */
     IF trim(wdetail.driver) = "" THEN DO:
        IF INT(wdetail.drivnam) > 0  THEN ASSIGN wdetail.drivnam = "Y" .
        ELSE ASSIGN wdetail.drivnam = "N".
        RUN proc_chkdrive. 
     END.
     ELSE DO:
     /*end : A67-0212 */
       FOR EACH ws0m009 WHERE ws0m009.policy = wdetail.driver NO-LOCK .
          CREATE brstat.mailtxt_fil.
          ASSIGN
              brstat.mailtxt_fil.policy  = TRIM(sic_bran.uwm301.policy) +
                           STRING(sic_bran.uwm301.rencnt,"99" ) +
                           STRING(sic_bran.uwm301.endcnt,"999")  +
                           STRING(sic_bran.uwm301.riskno,"999") +
                           STRING(sic_bran.uwm301.itemno,"999")    
              brstat.mailtxt_fil.lnumber = INTEGER(ws0m009.lnumber)
              brstat.mailtxt_fil.ltext   = ws0m009.ltext  
              brstat.mailtxt_fil.ltext2  = ws0m009.ltext2   
              brstat.mailtxt_fil.bchyr   = nv_batchyr 
              brstat.mailtxt_fil.bchno   = nv_batchno 
              brstat.mailtxt_fil.bchcnt  = nv_batcnt 
              /* Add by : A67-0029 */
              brstat.mailtxt_fil.drivbirth = ws0m009.drivbirth 
              brstat.mailtxt_fil.drivage   = ws0m009.drivage    
              brstat.mailtxt_fil.occupcod  = ws0m009.occupcod   
              brstat.mailtxt_fil.occupdes  = ws0m009.occupdes   
              brstat.mailtxt_fil.cardflg   = ws0m009.cardflg    
              brstat.mailtxt_fil.drividno  = ws0m009.drividno   
              brstat.mailtxt_fil.licenno   = ws0m009.licenno   
              brstat.mailtxt_fil.drivnam   = ws0m009.drivnam   
              brstat.mailtxt_fil.gender    = ws0m009.gender    
              brstat.mailtxt_fil.drivlevel = ws0m009.drivlevel 
              brstat.mailtxt_fil.levelper  = ws0m009.levelper  
              brstat.mailtxt_fil.titlenam  = ws0m009.titlenam  
              brstat.mailtxt_fil.licenexp  = ws0m009.licenexp  
              brstat.mailtxt_fil.firstnam  = ws0m009.firstnam  
              brstat.mailtxt_fil.lastnam   = ws0m009.lastnam  
              brstat.mailtxt_fil.dconsen   = ws0m009.dconsen .
              /* end : A67-0029 */
          ASSIGN nv_drivno = INTEGER(ws0m009.lnumber).
       END.
       IF nv_drivno <> 0 THEN DO:
           ASSIGN wdetail.drivnam = "Y"     sic_bran.uwm301.actprm   = wdetail.nname .
       END.
     END.
   END. /*  A67-0212 */
   ASSIGN s_recid4    = RECID(sic_bran.uwm301).
   IF wdetail.redbook <> "" THEN DO:
       FIND FIRST stat.maktab_fil USE-INDEX maktab01   WHERE 
           stat.maktab_fil.sclass = wdetail.subclass  AND
           stat.maktab_fil.modcod = wdetail.redbook   No-lock no-error no-wait.
       If  avail  stat.maktab_fil  Then DO:
           ASSIGN sic_bran.uwm301.modcod  =  stat.maktab_fil.modcod 
           sic_bran.uwm301.vehgrp  =  stat.maktab_fil.prmpac
           wdetail.cargrp          =  stat.maktab_fil.prmpac 
           wdetail.seat41          =  IF wdetail.seat41 = 0 THEN stat.maktab_fil.seats ELSE wdetail.seat41  /*A64-0044*/
           sic_bran.uwm301.body    =  IF wdetail.body = "" THEN stat.maktab_fil.body ELSE wdetail.body.    /*A65-0079*/
           /*IF sic_bran.uwm301.maksi = 0 AND SUBSTR(wdetail.subclass,1,1) = "E" THEN sic_bran.uwm301.maksi = stat.maktab_fil.maksi ./*A67-0029*/*//*A68-0044*/
           IF sic_bran.uwm301.maksi = 0 AND wdetail.covcod <> "3" THEN sic_bran.uwm301.maksi = stat.maktab_fil.maksi . /*A68-0044*/
       END.
  END.
  ELSE RUN proc_maktab.
END.
RELEASE brStat.Detaitem.
RELEASE brstat.mailtxt_fil .
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_chktest3 C-Win 
PROCEDURE proc_chktest3 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
FIND sic_bran.uwm100 WHERE RECID(sic_bran.uwm100) = s_recid1 NO-WAIT NO-ERROR.
FIND sic_bran.uwm120 WHERE RECID(sic_bran.uwm120) = s_recid2 NO-WAIT NO-ERROR.
FIND sic_bran.uwm130 WHERE RECID(sic_bran.uwm130) = s_recid3 NO-WAIT NO-ERROR.
FIND sic_bran.uwm301 WHERE RECID(sic_bran.uwm301) = s_recid4 NO-WAIT NO-ERROR.
ASSIGN fi_process = "Create data " + wdetail.policyno  + " on uwm130 uwm120 ..."  .
DISP fi_process WITH FRAM fr_main.
ASSIGN 
    nv_tariff = sic_bran.uwm301.tariff
    nv_class  = IF wdetail.poltyp = "v72" THEN wdetail.subclass ELSE wdetail.prempa +  wdetail.subclass
    nv_comdat = sic_bran.uwm100.comdat
    nv_engine = DECI(wdetail.engcc)
    nv_covcod = wdetail.covcod
    nv_vehuse = wdetail.vehuse
    nv_COMPER = deci(wdetail.comper) 
    nv_comacc = deci(wdetail.comacc) 
    nv_seats  = INTE(wdetail.seat)
    nv_tons   = DECI(wdetail.weight)
    /*nv_dss_per = 0   */  
    nv_dsspcvar1 = ""           nv_cl_cod  = "" 
    nv_dsspcvar2 =  ""          nv_cl_per  = 0 
    nv_dsspcvar  = ""           nv_lodclm  = 0 
    nv_42cod     = ""           nv_lodclm1 = 0 
    nv_43cod     = ""           nv_clmvar1 = "" 
    nv_41cod1    = ""           nv_clmvar2 = "" 
    nv_41cod2    = ""           nv_clmvar  = "" 
    nv_basecod   = ""           nv_stf_cod = "" 
    nv_usecod    = ""           nv_stf_per = 0 
    nv_engcod    = ""           nv_stf_amt = 0 
    nv_drivcod   = ""           nv_stfvar1 = "" 
    nv_yrcod     = ""           nv_stfvar2 = "" 
    nv_sicod     = ""           nv_stfvar  = "" 
    nv_grpcod    = ""           nv_41cod3  = ""  /*A64-0355*/
    nv_bipcod    = ""           nv_41cod4  = ""  /*A64-0355*/
    nv_biacod    = "" 
    nv_pdacod    = "" 
    nv_ncbyrs    =   0    
    nv_ncbper    =   0    
    nv_ncb       =   0
    nv_totsi     =   0.
IF wdetail.compul = "y" THEN DO:
    ASSIGN
        nv_comper     = deci(sicsyac.xmm016.si_d_t[8]) 
        nv_comacc     = deci(sicsyac.xmm016.si_d_t[9])                                           
        sic_bran.uwm130.uom8_v   = nv_comper   
        sic_bran.uwm130.uom9_v   = nv_comacc  
        nv_vehuse = "0" . 
    RUN wgs\wgscomp. 
    If  nv_comper  =  0  Then   nv_comacc =  0 . 
    Else do:
        IF   nv_comacc  <> 0  Then do:
            ASSIGN
                nv_compcod      = "COMP"
                nv_compvar1     = "     Compulsory  =   "
                nv_compvar2     = STRING(nv_comacc)
                Substr(nv_compvar,1,30)   = nv_compvar1
                Substr(nv_compvar,31,30)  = nv_compvar2.
            IF n_curbil = "bht" THEN
                nv_comacc = Truncate(nv_comacc, 0).
            ELSE 
                nv_comacc = nv_comacc. 
            ASSIGN
                sic_bran.uwm130.uom8_c  = "D8"
                sic_bran.uwm130.uom9_c  = "D9". 
        END.
        Else assign          
            nv_compprm     = 0
            nv_compcod     = " "
            nv_compvar1    = " "
            nv_compvar2    = " "
            nv_compvar     = " ".
        If  nv_compprm  =  0  THEN DO:
            ASSIGN nv_vehuse = "0".     /*A52-0172 ให้ค่า0 เนื่องจากต้องการส่งค่าให้ key.b = 0 */
            RUN wgs\wgscomp.       
        END.
        nv_comacc  = nv_comacc .                  
    END.   /* else do */
    If  nv_comper  =  0 and nv_comacc  =  0 Then  nv_compprm  =  0. 
END.       /*compul y*/
ELSE 
    ASSIGN
        nv_compprm     = 0
        nv_compcod     = " "
        nv_compvar1    = " "
        nv_compvar2    = " "
        nv_compvar     = " "
        nv_COMPER      = 0
        nv_comacc      = 0
        sic_bran.uwm130.uom8_v  =  0               
        sic_bran.uwm130.uom9_v  =  0.
IF (wdetail.covcod = "2.1" ) OR (wdetail.covcod = "3.1" ) OR (wdetail.covcod = "2.2" ) OR (wdetail.covcod = "3.2" ) THEN RUN proc_base2plus.  /*A62-0215*/
ELSE RUN proc_base2.
IF wdetail.poltyp = "v72" THEN DO:
    ASSIGN  
        nv_baseprm = 0   
        nv_usecod  = "" 
        nv_engcod  = "" 
        nv_drivcod = ""
        nv_yrcod   = "" 
        nv_sicod   = "" 
        nv_grpcod  = "" 
        nv_bipcod  = "" 
        nv_biacod  = "" 
        nv_pdacod  = "" 
        nv_class   = SUBSTRING(nv_class,2,3).
    RUN WGS\WGSORPRM.P (INPUT S_RECID3,
                        INPUT S_RECID4,
                        nv_tariff, /*pass*/
                        nv_class,
                        nv_covcod,
                        nv_key_b,
                        nv_comdat,
                        nv_totsi,
                        nv_uom1_v ,       
                        nv_uom2_v ,       
                        nv_uom5_v ).
END.
/* add by : A64-0355 */
IF wdetail.polmaster <> "" THEN DO:  
    IF (wdetail.covcod = "2.2") OR (wdetail.covcod = "3.2") THEN RUN proc_adduwd132Plus.
    ELSE RUN proc_adduwd132.

    FIND LAST sic_bran.uwm100 WHERE RECID(sic_bran.uwm100) = s_RECID1 NO-ERROR.
      IF AVAIL  sic_bran.uwm100 THEN DO:
         ASSIGN 
            sic_bran.uwm100.prem_t = nv_pdprm     
            sic_bran.uwm100.sigr_p = inte(wdetail.si)
            sic_bran.uwm100.gap_p  = nv_gapprm.
         IF wdetail.pass <> "Y" THEN 
             ASSIGN
                 sic_bran.uwm100.impflg = NO
                 sic_bran.uwm100.imperr = wdetail.comment.       
      END.

   FIND LAST sic_bran.uwm120 WHERE RECID(sic_bran.uwm120) = s_RECID2  NO-ERROR.
       IF AVAIL  sic_bran.uwm120 THEN 
        ASSIGN
            sic_bran.uwm120.gap_r  = nv_gapprm
            sic_bran.uwm120.prem_r = nv_pdprm
            sic_bran.uwm120.sigr   = inte(wdetail.si).
END.
ELSE DO:
     IF ra_type = 2 AND wdetail.prepol <> "" THEN DO: /*NEW or Renew System Process */
          RUN proc_uwd132_Renew. /* used data Expiry */
     END.
     ELSE DO:
        /* IF substr(wdetail.subclass,1,1) = "E" THEN RUN proc_calpremt_EV. /*A67-0029*/
         ELSE RUN proc_calpremt.*/ 
         RUN proc_calpremt_EV. /*A67-0029*/
         RUN proc_adduwd132prem.
     END.
    
     FIND LAST sic_bran.uwm100 WHERE RECID(sic_bran.uwm100) = s_RECID1 NO-ERROR.
     IF AVAIL  sic_bran.uwm100 THEN DO:
         ASSIGN 
         sic_bran.uwm100.prem_t = nv_pdprm     
         sic_bran.uwm100.sigr_p = inte(wdetail.si)
         sic_bran.uwm100.gap_p  = nv_gapprm.
         IF wdetail.pass <> "Y" THEN 
             ASSIGN
                 sic_bran.uwm100.impflg = NO
                 sic_bran.uwm100.imperr = wdetail.comment.       
         END.

     FIND LAST sic_bran.uwm120 WHERE RECID(sic_bran.uwm120) = s_RECID2  NO-ERROR.
     IF AVAIL  sic_bran.uwm120 THEN 
          ASSIGN
          sic_bran.uwm120.gap_r  = nv_gapprm
          sic_bran.uwm120.prem_r = nv_pdprm
          sic_bran.uwm120.sigr   = inte(wdetail.si).
END.

FIND LAST sic_bran.uwm301 WHERE RECID(sic_bran.uwm301) = s_RECID4  NO-ERROR.
    IF AVAIL  sic_bran.uwm301 THEN 
        ASSIGN   
            sic_bran.uwm301.mv41seat = wdetail.seat41
            sic_bran.uwm301.tons     = IF sic_bran.uwm301.tons = 0 THEN 0 
                                       ELSE IF sic_bran.uwm301.tons < 100 THEN (sic_bran.uwm301.tons * 1000) 
                                       ELSE sic_bran.uwm301.tons.

    IF (SUBSTR(wdetail.subclass,1,1) = "3" OR SUBSTR(wdetail.subclass,1,1) = "4" OR
       SUBSTR(wdetail.subclass,1,1)  = "5" OR TRIM(wdetail.subclass) = "803"     OR
       TRIM(wdetail.subclass)  = "804"     OR TRIM(wdetail.subclass) = "805" )   AND 
        sic_bran.uwm301.tons < 100  THEN DO:

       MESSAGE  wdetail.subclass + " ระบุน้ำหนักรถไม่ถูกต้อง Tons:" + string(sic_bran.uwm301.tons)  VIEW-AS ALERT-BOX.
       ASSIGN 
           wdetail.comment = wdetail.comment + "|Class " + wdetail.subclass + " น้ำหนักรถไม่ถูกต้อง " 
           wdetail.pass    = "N".
    END.

/* end : A64-0355 */

/* comment by : A64-0355....
FIND LAST sic_bran.uwm100 WHERE RECID(sic_bran.uwm100) = s_RECID1 NO-ERROR.
IF AVAIL  sic_bran.uwm100 THEN DO:
    ASSIGN 
        /*sic_bran.uwm100.prem_t = nv_gapprm*/ /*A64-0309*/
        sic_bran.uwm100.prem_t = nv_pdprm     /*A64-0309*/
        sic_bran.uwm100.sigr_p = inte(wdetail.si)
        sic_bran.uwm100.gap_p  = nv_gapprm.
    IF wdetail.pass <> "Y" THEN 
        ASSIGN
        sic_bran.uwm100.impflg = NO
        sic_bran.uwm100.imperr = wdetail.comment.    
END.

FIND LAST sic_bran.uwm120 WHERE RECID(sic_bran.uwm120) = s_RECID2  NO-ERROR.
IF AVAIL  sic_bran.uwm120 THEN 
     ASSIGN
     sic_bran.uwm120.gap_r  = nv_gapprm
     sic_bran.uwm120.prem_r = nv_pdprm
     sic_bran.uwm120.sigr   = inte(wdetail.si).

FIND LAST sic_bran.uwm301 WHERE RECID(sic_bran.uwm301) = s_RECID4  NO-ERROR.
IF AVAIL  sic_bran.uwm301 THEN 
    ASSIGN   
        sic_bran.uwm301.ncbper   = nv_ncbper
        sic_bran.uwm301.ncbyrs   = nv_ncbyrs
        sic_bran.uwm301.mv41seat = wdetail.seat41.
/* Package Code */
/*IF nv_polmaster <> "" THEN DO:*/ /*A64-0044*/
IF wdetail.polmaster <> "" THEN DO:  /*A64-0044*/
    IF (wdetail.covcod = "2.2") OR (wdetail.covcod = "3.2") THEN RUN proc_adduwd132Plus.
    ELSE RUN proc_adduwd132.

    FIND LAST sic_bran.uwm100 WHERE RECID(sic_bran.uwm100) = s_RECID1 NO-ERROR.
    IF AVAIL  sic_bran.uwm100 THEN DO:
        ASSIGN 
            /*sic_bran.uwm100.prem_t = nv_gapprm*/ /*A64-0309*/
            sic_bran.uwm100.prem_t = nv_pdprm     /*A64-0309*/
            sic_bran.uwm100.gap_p  = nv_gapprm.
    END.

    FIND LAST sic_bran.uwm120 WHERE RECID(sic_bran.uwm120) = s_RECID2  NO-ERROR.
    IF AVAIL  sic_bran.uwm120 THEN DO:
         ASSIGN
         sic_bran.uwm120.gap_r  = nv_gapprm
         sic_bran.uwm120.prem_r = nv_pdprm.
    END.
END.
/* end A63-0443 */
ELSE DO:
    IF wdetail.prepol = "" THEN DO: /*NEW or Renew System Process */
        IF (wdetail.covcod = "2.1" ) OR (wdetail.covcod = "3.1" ) OR (wdetail.covcod = "2.2" ) OR (wdetail.covcod = "3.2" ) THEN    /*A62-0215*/
            RUN WGS\WGSTP132(INPUT S_RECID3,   /*A57-0126 add WGSTP132*/
                             INPUT S_RECID4).  /*A57-0126 add WGSTP132*/ 
        ELSE    
            RUN WGS\WGSTN132(INPUT S_RECID3, 
                             INPUT S_RECID4).

        nv_pdprm0 = 0.
        IF nv_drivno <> 0  THEN DO:
             RUN wgw\wgwORPR0 (INPUT  nv_tariff,
                                 nv_class,
                                 nv_covcod,
                                 nv_key_b,
                                 nv_comdat,
                                 nv_totsi,
                                 nv_uom1_v,
                                 nv_uom2_v,
                                 nv_uom5_v,
                          OUTPUT nv_pdprm0).
             ASSIGN sic_bran.uwm301.actprm = nv_pdprm0. 
        END.

        IF wdetail.dgpackge <> ""  THEN DO:
            RUN wgw\wgwchkatt(INPUT s_recid3 ,
                                    s_recid4 ,
                                    nv_tariff, /*pass*/
                                    wdetail.dgpackge,
                                    wdetail.danger1,
                                    wdetail.danger2,
                                    wdetail.dgsi   ,
                                    wdetail.dgrate ,
                                    wdetail.dgfeet ,       
                                    wdetail.dgncb  ,       
                                    wdetail.dgdisc , 
                                    sic_bran.uwm100.comdat,  
                                    sic_bran.uwm100.expdat ). 
        END.
    END.
    ELSE DO:  /* Renew Expiry */
        RUN proc_uwd132_Renew.
        FIND LAST sic_bran.uwm100 WHERE RECID(sic_bran.uwm100) = s_RECID1 NO-ERROR.
            IF AVAIL  sic_bran.uwm100 THEN DO:
                ASSIGN 
                    /*sic_bran.uwm100.prem_t = nv_gapprm*/ /*A64-0309*/
                    sic_bran.uwm100.prem_t = nv_pdprm     /*A64-0309*/
                    sic_bran.uwm100.gap_p  = nv_gapprm.
            END.
        
        FIND LAST sic_bran.uwm120 WHERE RECID(sic_bran.uwm120) = s_RECID2  NO-ERROR.
            IF AVAIL  sic_bran.uwm120 THEN DO:
                 ASSIGN
                 sic_bran.uwm120.gap_r  = nv_gapprm
                 sic_bran.uwm120.prem_r = nv_pdprm.
            END.
    END.
END.
...end A64-0355...*/
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_chktest4 C-Win 
PROCEDURE proc_chktest4 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DEF VAR   n_sigr_r     like sic_bran.uwm130.uom6_v.
DEF VAR   n_gap_r      Like sic_bran.uwd132.gap_c . 
DEF VAR   n_prem_r     Like sic_bran.uwd132.prem_c.
DEF VAR   nt_compprm   like sic_bran.uwd132.prem_c.  
DEF VAR   n_gap_t      Like sic_bran.uwm100.gap_p.
DEF VAR   n_prem_t     Like sic_bran.uwm100.prem_t.
DEF VAR   n_sigr_t     Like sic_bran.uwm100.sigr_p.
DEF VAR   nv_policy    like sic_bran.uwm100.policy.
DEF VAR   nv_rencnt    like sic_bran.uwm100.rencnt.
DEF VAR   nv_endcnt    like sic_bran.uwm100.endcnt.
DEF VAR   nv_com1_per  like sicsyac.xmm031.comm1.
DEF VAR   nv_stamp_per like sicsyac.xmm020.rvstam.
DEF VAR nv_com3p        AS DECI INIT 0.00 . /* A64-0355*/
DEF VAR nv_com2p        AS DECI INIT 0.00 .
DEF VAR nv_com1p        AS DECI INIT 0.00 .
DEF VAR nv_fi_netprm    AS DECI INIT 0.00.
DEF VAR NV_fi_dup_trip  AS CHAR FORMAT  "X" INIT "".
DEF VAR nv_fi_tax_per   AS DECI INIT 0.00.
DEF VAR nv_fi_stamp_per AS DECI INIT 0.00.
DEF VAR nv_fi_rstp_t    AS INTE INIT 0.
DEF VAR nv_fi_rtax_t    AS DECI INIT 0.00 .
DEF VAR nv_fi_com1_t    AS DECI INIT 0.00.
DEF VAR nv_fi_com2_t    AS DECI INIT 0.00.
DEF VAR nv_fi_com3_t    AS DECI INIT 0.00. /* A64-0355*/
DEF VAR nv_commpol      AS DECI INIT 0.00 . /* A64-0355*/
DEF VAR nv_commpol_t    AS DECI INIT 0.00 . /* A64-0355*/
DEF VAR nv_comm13_t     AS DECI INIT 0.00 . /* A64-0355*/

DEF BUFFER bfwinst FOR winst.
ASSIGN fi_process = "Create data Stamp, Vat , Commisson to uwm120 ..." + wdetail.policyno .
DISP fi_process WITH FRAM fr_main.

FIND sic_bran.uwm100   Where Recid(sic_bran.uwm100)  = s_recid1
  no-error no-wait.
  If  not avail sic_bran.uwm100  Then do:
      /*Message "not found (uwm100./wuwrep02.p)" View-as alert-box.*/
      Return.
  End.
  Else  do:
      Assign 
            nv_policy  =  CAPS(sic_bran.uwm100.policy)
            nv_rencnt  =  sic_bran.uwm100.rencnt
            nv_endcnt  =  sic_bran.uwm100.endcnt.
            FOR EACH sic_bran.uwm120 USE-INDEX uwm12001 WHERE
                     sic_bran.uwm120.policy  = sic_bran.uwm100.policy  AND
                     sic_bran.uwm120.rencnt  = sic_bran.uwm100.rencnt  AND
                     sic_bran.uwm120.endcnt  = sic_bran.uwm100.endcnt  AND
                     sic_bran.uwm120.bchyr   = nv_batchyr               AND 
                     sic_bran.uwm120.bchno   = nv_batchno               AND 
                     sic_bran.uwm120.bchcnt  = nv_batcnt         .
                     FOR EACH sic_bran.uwm130   USE-INDEX uwm13001 WHERE
                              sic_bran.uwm130.policy  = sic_bran.uwm120.policy  AND
                              sic_bran.uwm130.rencnt  = sic_bran.uwm120.rencnt  AND
                              sic_bran.uwm130.endcnt  = sic_bran.uwm120.endcnt  AND
                              sic_bran.uwm130.riskno  = sic_bran.uwm120.riskno  AND
                              sic_bran.uwm130.bchyr   = nv_batchyr              AND 
                              sic_bran.uwm130.bchno   = nv_batchno              AND 
                              sic_bran.uwm130.bchcnt  = nv_batcnt               NO-LOCK.
                         n_sigr_r                = n_sigr_r + uwm130.uom6_v.
                              FOR EACH sic_bran.uwd132  USE-INDEX uwd13201 WHERE 
                                       sic_bran.uwd132.policy  = sic_bran.uwm130.policy  AND
                                       sic_bran.uwd132.rencnt  = sic_bran.uwm130.rencnt  AND
                                       sic_bran.uwd132.endcnt  = sic_bran.uwm130.endcnt  AND
                                       sic_bran.uwd132.riskno  = sic_bran.uwm130.riskno  AND
                                       sic_bran.uwd132.itemno  = sic_bran.uwm130.itemno  AND
                                       sic_bran.uwd132.bchyr   = nv_batchyr              AND 
                                       sic_bran.uwd132.bchno   = nv_batchno              AND 
                                       sic_bran.uwd132.bchcnt  = nv_batcnt               NO-LOCK.
                                        IF  sic_bran.uwd132.bencod  = "COMP"   THEN DO:
                                             nt_compprm     = nt_compprm + sic_bran.uwd132.prem_c.
                                        END.
                                         n_gap_r  = sic_bran.uwd132.gap_c  + n_gap_r.
                                         n_prem_r = sic_bran.uwd132.prem_c + n_prem_r.
                                 END.  /* uwd132 */
                          END.  /*uwm130 */
                          ASSIGN
                          n_gap_t      = n_gap_t   + n_gap_r
                          n_prem_t     = n_prem_t  + n_prem_r
                          n_sigr_t     = n_sigr_t  + n_sigr_r
                          n_gap_r      = 0 
                          n_prem_r     = 0  
                          n_sigr_r     = 0.
           END.    /* end uwm120 */
  End.  /*  avail  100   */
  /*-------------------- calprem ---------------------*/
  Find LAST  sic_bran.uwm120  Use-index uwm12001  WHERE          
             sic_bran.uwm120.policy  = sic_bran.uwm100.policy   And
             sic_bran.uwm120.rencnt  = sic_bran.uwm100.rencnt   And
             sic_bran.uwm120.endcnt  = sic_bran.uwm100.endcnt   AND 
             sic_bran.uwm120.bchyr = nv_batchyr               AND 
             sic_bran.uwm120.bchno = nv_batchno               AND 
             sic_bran.uwm120.bchcnt  = nv_batcnt                No-error.
  FIND LAST  sicsyac.xmm018 USE-INDEX xmm01801 WHERE
             sicsyac.xmm018.agent              = sic_bran.uwm100.acno1          AND               /*แยกงานตาม Code Producer*/  
             substr(sicsyac.xmm018.poltyp,1,5) = "CR" + sic_bran.uwm100.poltyp  AND               /*Shukiat T. modi on 25/04/2007*/
             SUBSTR(xmm018.poltyp,7,1)         = sic_bran.uwm100.branch         AND               /*Shukiat T. add on 05/06/2007 A50-0144*/
             sicsyac.xmm018.datest            <= sic_bran.uwm100.comdat         NO-LOCK NO-ERROR. /*Shukiat T. add on 25/04/2007*/
    IF AVAIL   sicsyac.xmm018 THEN DO:
              Assign     nv_com1p = sicsyac.xmm018.commsp  
                         nv_com2p = 0
                         nv_commpol = sicsyac.xmm018.commsp. /* A64-0355 */
    END.
    ELSE DO:
            Find sicsyac.xmm031  Use-index xmm03101  Where  
                 sicsyac.xmm031.poltyp  = sic_bran.uwm100.poltyp
            No-lock no-error no-wait.
            IF not  avail sicsyac.xmm031 Then 
              Assign     nv_com1p = 0
                         nv_com2p = 0
                         nv_commpol = 0. /* A64-0355 */
            Else  
            Assign   nv_com1p = sicsyac.xmm031.comm1
                     nv_com2p = 0 
                     nv_commpol = sicsyac.xmm031.comm1. /* A64-0355 */
    END. /* Not Avail Xmm018 */
  /***--- Commmission Rate Line 72 ---***/
  IF wdetail.compul = "y" THEN DO:
      FIND LAST  sicsyac.xmm018 USE-INDEX xmm01801 WHERE
                 sicsyac.xmm018.agent              = sic_bran.uwm100.acno1  AND               
                 substr(sicsyac.xmm018.poltyp,1,5) = "CRV72"                AND               
                 SUBSTR(xmm018.poltyp,7,1)         = sic_bran.uwm100.branch AND               
                 sicsyac.xmm018.datest            <= sic_bran.uwm100.comdat NO-LOCK NO-ERROR. 
      IF AVAIL   sicsyac.xmm018 THEN 
                 nv_com2p = sicsyac.xmm018.commsp.
      
      ELSE DO:
           Find  sicsyac.xmm031  Use-index xmm03101  Where  
                 sicsyac.xmm031.poltyp    = "v72"
           No-lock no-error no-wait.
                   nv_com2p = sicsyac.xmm031.comm1.  
      END.
  END. /* Wdetail.Compul = "Y"*/

  /*--------- tax -----------*/
  Find sicsyac.xmm020 Use-index xmm02001        Where
       sicsyac.xmm020.branch = sic_bran.uwm100.branch   And
       sicsyac.xmm020.dir_ri = sic_bran.uwm100.dir_ri   No-lock no-error.
  IF avail sicsyac.xmm020 Then do:
           nv_fi_stamp_per      = sicsyac.xmm020.rvstam.
       If    sic_bran.uwm100.gstrat  <>  0  Then  nv_fi_tax_per  =  sic_bran.uwm100.gstrat.
       Else  nv_fi_tax_per  =  sicsyac.xmm020.rvtax.
  End.
  
  /*----------- stamp ------------*/
  IF sic_bran.uwm120.stmpae  = Yes Then do:                        /* STAMP */
     nv_fi_rstp_t  = Truncate(sic_bran.uwm100.prem_t * nv_fi_stamp_per / 100,0) +
                     (IF     (sic_bran.uwm100.prem_t * nv_fi_stamp_per / 100)   -
                     Truncate(sic_bran.uwm100.prem_t * nv_fi_stamp_per / 100,0) > 0
                     Then 1 Else 0).
  End.
  /*sic_bran.uwm100.rstp_t = nv_fi_rstp_t.*/ /* F67-0001*/
  ASSIGN sic_bran.uwm100.rstp_t = IF deci(wdetail.rstp_t) <> 0 THEN DECI(wdetail.rstp_t) ELSE nv_fi_rstp_t.  /* F67-0001*/
    
  IF  sic_bran.uwm120.taxae   = Yes   Then do:                       /* TAX */
      nv_fi_rtax_t  = (sic_bran.uwm100.prem_t + nv_fi_rstp_t + sic_bran.uwm100.pstp)
                       * nv_fi_tax_per  / 100.
       /* fi_taxae       = Yes.*/
  End.
  /*sic_bran.uwm100.rtax_t = nv_fi_rtax_t.*/    /*F67-0001 */
  ASSIGN  sic_bran.uwm100.rtax_t = IF DECI(wdetail.rtax_t) <> 0 THEN DECI(wdetail.rtax_t) ELSE nv_fi_rtax_t .  /*F67-0001 */
  
  if sic_bran.uwm100.poltyp = "V70" THEN DO: 
      /* add by : A64-0355 co-broker */
      IF wdetail.agco70 <> "" THEN DO:
          sic_bran.uwm120.com1ae = YES.
          sic_bran.uwm120.com3ae = YES. 
        IF wdetail.comper70  <> (-1) AND wdetail.comco_per70  = (-1) THEN DO:  /* ระบุ comm policy แต่ไม่ระบุ comm co-broker */
            ASSIGN  nv_com3p  = nv_com1p - wdetail.comper70
                    nv_com1p  = wdetail.comper70 .
        END.
        ELSE IF wdetail.comper70  = (-1) AND wdetail.comco_per70  <> (-1) THEN DO: /* ไม่ระบุ comm policy แต่ระบุ comm co-broker */
            ASSIGN  nv_com1p  = nv_com1p - wdetail.comco_per70
                    nv_com3p  = wdetail.comco_per70 .
        END.
        ELSE IF wdetail.comper70  <> (-1) AND wdetail.comco_per70  <> (-1) THEN DO: /* ระบุ comm policy และ ระบุ comm co-broker */
            ASSIGN  nv_com1p  = wdetail.comper70
                    nv_com3p  = wdetail.comco_per70 .
        END.
        
        IF wdetail.comprem70 <> (-1)  THEN  /* ใส่เบี้ย comm policy มาในไฟล์ */
            ASSIGN nv_fi_com1_t = (wdetail.comprem70) /* ระบุติดลบมาในไฟล์ */
                   sic_bran.uwm120.com1ae = NO.

        IF wdetail.comco_prem70 <> (-1)  THEN /* ใส่เบี้ย comm co-broker มาในไฟล์ */
            ASSIGN nv_fi_com3_t = (wdetail.comco_prem70) /* ระบุติดลบมาในไฟล์ */
                   sic_bran.uwm120.com3ae = NO.
      END.
      /* end : A64-0355 */
      ELSE DO:
        sic_bran.uwm120.com1ae = YES. 
        IF wdetail.comper70  <> (-1)  THEN ASSIGN nv_com1p  = wdetail.comper70 .
        IF wdetail.comprem70 <> (-1)  THEN 
            ASSIGN nv_fi_com1_t = (wdetail.comprem70) /* ระบุติดลบมาในไฟล์ */
                   sic_bran.uwm120.com1ae = NO.
      END.
  END.
  if sic_bran.uwm100.poltyp = "V72" THEN DO: 
      sic_bran.uwm120.com1ae = YES.
      sic_bran.uwm120.com2ae = YES.  
      IF wdetail.comper72  <> (-1)  THEN ASSIGN nv_com2p     = wdetail.comper72 .
      IF wdetail.comprem72 <> (-1)  THEN 
          ASSIGN nv_fi_com2_t = (wdetail.comprem72)  /* ระบุติดลบมาในไฟล์ */
                 sic_bran.uwm120.com2ae = NO 
                 sic_bran.uwm120.com1ae = NO.
  END.
  /*--------- motor commission -----------------*/
  IF sic_bran.uwm120.com1ae   = Yes Then do:         /* MOTOR COMMISION */
     If sic_bran.uwm120.com1p <> 0  Then nv_com1p  = sic_bran.uwm120.com1p.
     nv_fi_com1_t   =  - ROUND((sic_bran.uwm100.prem_t - nt_compprm) * nv_com1p / 100,2) .            
         /*fi_com1ae        =  YES.*/
  End.
   /* add by : A64-0355 co-broker */  
  IF wdetail.agco70 <> ""  THEN DO:
    IF sic_bran.uwm120.com3ae   = Yes  Then do:                   /* Comp.COMMISION */
      If sic_bran.uwm120.com3p <> 0  Then nv_com3p  = sic_bran.uwm120.com3p.
      nv_fi_com3_t   = - ROUND((sic_bran.uwm100.prem_t - nt_compprm) * nv_com3p / 100 ,2).    
    End.
  END.
  IF nv_fi_com1_t > 0 THEN nv_fi_com1_t = nv_fi_com1_t * (-1) .
  IF nv_fi_com3_t > 0 THEN nv_fi_com3_t = nv_fi_com3_t * (-1) .
  /* end : A64-0355 co-broker */
  /*----------- comp comission ------------*/
  IF sic_bran.uwm120.com2ae   = Yes  Then do:                   /* Comp.COMMISION */
      If sic_bran.uwm120.com2p <> 0  Then nv_com2p  = sic_bran.uwm120.com2p.
      nv_fi_com2_t   =  - ROUND(nt_compprm  *  nv_com2p / 100 ,2).              
         /*nv_fi_com2ae        =  YES.*/
  End.
  
  IF sic_bran.uwm100.pstp <> 0 Then do:
     IF sic_bran.uwm100.no_sch  = 1 Then NV_fi_dup_trip = "D".
     Else If sic_bran.uwm100.no_sch  = 2 Then  NV_fi_dup_trip = "T".
  End.
  Else  NV_fi_dup_trip  =  "".

  nv_fi_netprm = sic_bran.uwm100.prem_t + sic_bran.uwm100.rtax_t
               + sic_bran.uwm100.rstp_t + sic_bran.uwm100.pstp.

  /* add by : A64-0355 co-broker */
   nv_commpol   = (nv_com1p + nv_com3p) .
   nv_commpol_t = - ROUND((sic_bran.uwm100.prem_t - nt_compprm) * nv_commpol / 100 ,2).  /* commission total */
   nv_comm13_t  =  ROUND(nv_fi_com1_t + nv_fi_com3_t ,2) .
  IF wdetail.agco70 <> ""  THEN DO: /*21/12/2021*/
    IF nv_commpol_t <> nv_comm13_t AND sic_bran.uwm120.com3ae = YES THEN DO:
        nv_fi_com3_t = (nv_commpol_t) - (nv_fi_com1_t) .
    END.
  END. /*21/12/2021*/
  /* END: A64-0355 co-broker */

  Find     sic_bran.uwm100 Where  Recid(sic_bran.uwm100)  =  s_recid1.
  If avail sic_bran.uwm100 Then DO:
      Assign 
           sic_bran.uwm100.gap_p   = n_gap_t
           sic_bran.uwm100.prem_t  = n_prem_t
           sic_bran.uwm100.sigr_p  = n_sigr_t
           sic_bran.uwm100.instot  = uwm100.instot
           sic_bran.uwm100.com1_t  = nv_fi_com1_t
           sic_bran.uwm100.com2_t  = nv_fi_com2_t
           sic_bran.uwm100.com3_t  = nv_fi_com3_t  /*A64-0355*/
           sic_bran.uwm100.pstp    = 0               /*note modified on 25/10/2006*/
           /*sic_bran.uwm100.rstp_t  = nv_fi_rstp_t */ /*F67-0001*/
           /*sic_bran.uwm100.rtax_t  = nv_fi_rtax_t */ /*F67-0001*/
           sic_bran.uwm100.rstp_t  = IF DECI(wdetail.rstp_t) = 0 THEN nv_fi_rstp_t ELSE DECI(wdetail.rstp_t)  /*F67-0001*/
           sic_bran.uwm100.rtax_t  = IF DECI(wdetail.rtax_t) = 0 THEN nv_fi_rtax_t ELSE DECI(wdetail.rtax_t)  /*F67-0001*/
           sic_bran.uwm100.gstrat  = nv_fi_tax_per.
  END.
  
  IF wdetail.poltyp = "v72" THEN DO:
            ASSIGN  
           sic_bran.uwm100.com2_t  = 0 
           sic_bran.uwm100.com1_t  = nv_fi_com2_t.
  END.

  Find     sic_bran.uwm120 Where  Recid(sic_bran.uwm120)   =  s_recid2   .
  IF avail sic_bran.uwm120 Then do:
       Assign
           sic_bran.uwm120.gap_r    = n_gap_t   /*n_gap_r */
           sic_bran.uwm120.prem_r   = n_prem_t  /*n_prem_r */
           sic_bran.uwm120.sigr     = n_sigr_T  /* A490166 note modi from n_sigr_r to n_sigr_t 11/10/2006 */
           /*sic_bran.uwm120.rtax     = nv_fi_rtax_t */ /*F67-0001*/
           sic_bran.uwm120.rtax     = IF DECI(wdetail.rtax_t) = 0  THEN nv_fi_rtax_t ELSE DECI(wdetail.rtax_t)  /*F67-0001*/
           sic_bran.uwm120.taxae    = YES
           sic_bran.uwm120.stmpae   = YES
           /*sic_bran.uwm120.rstp_r   = nv_fi_rstp_t */ /*F67-0001*/   
           sic_bran.uwm120.rstp_r   = IF DECI(wdetail.rstp_t) = 0 THEN nv_fi_rstp_t ELSE DECI(wdetail.rstp_t)  /*F67-0001*/  
           /*sic_bran.uwm120.com1ae   = YES*/
           sic_bran.uwm120.com1p    = nv_com1p
           sic_bran.uwm120.com1_r   = nv_fi_com1_t
           sic_bran.uwm120.com2ae   = YES
           sic_bran.uwm120.com2p    = nv_com2p
           sic_bran.uwm120.com2_r   = nv_fi_com2_t
           sic_bran.uwm120.com3p    = nv_com3p         /*A64-0355*/
           sic_bran.uwm120.com3_r   = nv_fi_com3_t .   /*A64-0355*/

        IF wdetail.poltyp = "v72" THEN DO:
           ASSIGN  
           sic_bran.uwm120.com2_r    = 0 
           sic_bran.uwm120.com1_r    = nv_fi_com2_t
           sic_bran.uwm120.com1p     = nv_com2p
           sic_bran.uwm120.com2p     = 0
          /* sic_bran.uwm120.rstp_r   = nv_fi_rstp_t*/ /*F67-0001*/ 
          /* sic_bran.uwm120.rtax     = nv_fi_rtax_t*/ /*F67-0001*/
           sic_bran.uwm120.rtax     = IF DECI(wdetail.rtax_t72) = 0 THEN nv_fi_rtax_t ELSE DECI(wdetail.rtax_t72)  /*F67-0001*/    
           sic_bran.uwm120.rstp_r   = IF DECI(wdetail.rstp_t72) = 0 THEN nv_fi_rstp_t ELSE DECI(wdetail.rstp_t72)  /*F67-0001*/     .
        END.
  End.
  /* add by : A64-0355 co-broker */
 /* IF wdetail.agco70 <> ""  THEN DO:*/
  IF wdetail.poltyp = "V70" THEN DO: 
    nv_commpol   = (sic_bran.uwm120.com1p + sic_bran.uwm120.com3p) .
    nv_commpol_t = - ROUND((sic_bran.uwm100.prem_t - nt_compprm) * nv_commpol / 100 ,2).  /* commission total */
    nv_comm13_t  =  ROUND(sic_bran.uwm100.com1_t + sic_bran.uwm100.com3_t ,2) .
    IF nv_commpol_t <> nv_comm13_t THEN DO:
        ASSIGN wdetail.comment = IF  wdetail.agco70 <> ""  THEN wdetail.comment + "|ยอดรวม comm. + comm.co-broker " + string(nv_comm13_t) + 
                                 " ไม่เท่ากับ comm.รวม กธ " + STRING(nv_commpol_t) 
                                ELSE wdetail.comment + "|ยอดรวม comm.ในไฟล์ " + string(nv_comm13_t) + " ไม่เท่ากับ comm.รวมจากระบบ " + STRING(nv_commpol_t).
    END.
  END.
  /* end : A64-0355 co-broker */
  IF wdetail.instot > 1 THEN DO:
      ASSIGN 
          nv_com1p_ins        = nv_com1p
          nv_fi_tax_per_ins   = nv_fi_tax_per  
          nv_fi_stamp_per_ins = nv_fi_stamp_per . 
      /* add by : A64-0355 co-broker */
      IF wdetail.agco70 <> "" THEN ASSIGN nv_com3p_ins = nv_com3p .
      ELSE ASSIGN nv_com3p_ins = 0 .
      /* end : A64-0355 co-broker */
      RUN proc_insnam_inst .
      FIND FIRST bfwinst WHERE bfwinst.policyno = wdetail.policyno NO-LOCK NO-ERROR.
        IF AVAIL bfwinst THEN DO:
            IF bfwinst.instcomm02 <> 0 AND bfwinst.instrstp2 <> 0 THEN RUN proc_instot1. /*มีเบี้ย installment ในไฟล์ */
            ELSE RUN proc_instot2. /* ไม่มีเบี้ย */
        END.
  END.
  RELEASE sic_bran.uwd132 .
  
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_clearmailtxt C-Win 
PROCEDURE proc_clearmailtxt :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
ASSIGN nv_ntitle    = ""
       nv_name      = ""
       nv_lname     = ""
       nv_drinam    = ""
       nv_dicno     = ""
       nv_dgender   = ""
       nv_dribirth  = "" 
       nv_dbirth    = ""
       nv_dage      = 0
       nv_doccup    = ""
       nv_ddriveno  = ""
       nv_drivexp   = ""
       nv_dlevel    = 0 
       nv_dconsent   = "" 
       nv_dlevper   = 0 .


END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_create100 C-Win 
PROCEDURE proc_create100 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
Create  sic_bran.uwm100.   /*Create ฝั่ง gateway*/    
ASSIGN                                              
       sic_bran.uwm100.policy =  wdetail.policy
       sic_bran.uwm100.rencnt =  n_rencnt              
       sic_bran.uwm100.renno  =  ""
       sic_bran.uwm100.endcnt =  n_endcnt
       sic_bran.uwm100.bchyr  =  nv_batchyr 
       sic_bran.uwm100.bchno  =  nv_batchno 
       sic_bran.uwm100.bchcnt =  nv_batcnt     .


END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_cr_2 C-Win 
PROCEDURE proc_cr_2 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DEF VAR len AS INTE.
DEF BUFFER bfwdetail FOR wdetail.
IF wdetail.cr_2 <> ""  THEN DO:
/*FIND LAST bfwdetail WHERE trim(bfwdetail.chasno) =  TRIM(wdetail.chasno) AND 
                          trim(bfwdetail.poltyp) <> trim(wdetail.poltyp)  NO-LOCK NO-ERROR.
IF AVAIL bfwdetail THEN DO: 
    ASSIGN wdetail.cr_2 = bfwdetail.policyno .
    IF wdetail.poltyp = "V72" THEN wdetail.redbook =  bfwdetail.redbook .
END.*/
/* comment by :A64-0355...
   FIND LAST bfwdetail WHERE trim(bfwdetail.policy) =  TRIM(wdetail.cr_2)  NO-LOCK NO-ERROR.
    IF AVAIL bfwdetail THEN DO: 
        IF bfwdetail.poltyp = "V72" AND wdetail.redbook <> "" THEN bfwdetail.redbook =  wdetail.redbook .
    END.
*/
    /* add by : a64-0355*/
    FIND LAST bfwdetail WHERE trim(bfwdetail.chasno) =  TRIM(wdetail.chasno) AND 
                              trim(bfwdetail.poltyp) <> trim(wdetail.poltyp)  NO-LOCK NO-ERROR.
    IF AVAIL bfwdetail THEN DO: 
        ASSIGN wdetail.cr_2 = bfwdetail.policyno .
        IF bfwdetail.poltyp = "V72" AND wdetail.redbook <> "" THEN bfwdetail.redbook =  wdetail.redbook .
    END.
    /* end A64-0355 */
END.
    
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_cutchar C-Win 
PROCEDURE proc_cutchar :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DEF VAR nv_i AS INT.
DEF VAR nv_c AS CHAR.
DEF VAR nv_l AS INT.
DEF VAR nv_p AS CHAR.
DEF VAR ind AS INT.

ASSIGN nv_c = ""  .
IF wdetail.prepol <> ""  THEN DO:
    nv_c = wdetail.prepol.
    
    nv_i = 0.
    nv_l = LENGTH(nv_c).
    
    
    DO WHILE nv_i <= nv_l:
    
        ind = 0.
        ind = INDEX(nv_c,"/").
        IF ind <> 0 THEN DO:
            nv_c = TRIM (SUBSTRING(nv_c,1,ind - 1) + SUBSTRING(nv_c,ind + 1, nv_l)).
        END.
        ind = INDEX(nv_c,"\").
        IF ind <> 0 THEN DO:
            nv_c = TRIM (SUBSTRING(nv_c,1,ind - 1) + SUBSTRING(nv_c,ind + 1, nv_l)).
        END.
        ind = INDEX(nv_c,"-").
        IF ind <> 0 THEN DO:
            nv_c = TRIM (SUBSTRING(nv_c,1,ind - 1) + SUBSTRING(nv_c,ind + 1, nv_l)).
        END.
    
        ind = INDEX(nv_c," ").
        IF ind <> 0 THEN DO:
            nv_c = TRIM (SUBSTRING(nv_c,1,ind - 1) + SUBSTRING(nv_c,ind + 1, nv_l)).
        END.
    
        nv_i = nv_i + 1.
    END.
    ASSIGN
        wdetail.prepol = nv_c .
END.

ASSIGN nv_c = ""  .
IF wdetail.vehreg <> ""  THEN DO:
    nv_c = TRIM(wdetail.vehreg).
    
    nv_i = 0.
    nv_l = LENGTH(nv_c).
    
    DO WHILE nv_i <= nv_l:
    
        ind = 0.
    
        ind = INDEX(nv_c,"/").
        IF ind <> 0 THEN DO:
            IF SUBSTR(nv_c,1,1) = "/"  THEN nv_c = TRIM(nv_c) . /*A64-0355*/
            ELSE nv_c = TRIM(REPLACE(nv_c,"/"," ")).
        END.
        ind = INDEX(nv_c,"\").
        IF ind <> 0 THEN DO:
            nv_c = TRIM(REPLACE(nv_c,"\"," ")).
        END.
        ind = INDEX(nv_c,"-").
        IF ind <> 0 THEN DO:
            nv_c = TRIM(REPLACE(nv_c,"-"," ")).
        END.
        nv_i = nv_i + 1.
    END.
    ASSIGN
        wdetail.vehreg = nv_c .
END.

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_dstf72 C-Win 
PROCEDURE proc_dstf72 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes: add DSPC72    
------------------------------------------------------------------------------*/
DEF VAR nv_check AS LOGICAL INIT NO.
DEF VAR nv_recid AS RECID .
DEF BUFFER wf_uwd132 FOR sic_bran.uwd132.

DO:
    FIND sic_bran.uwm100 WHERE RECID(sic_bran.uwm100) = s_recid1 NO-ERROR NO-WAIT.
    FIND sic_bran.uwm130 WHERE RECID(sic_bran.uwm130) = s_recid3 NO-ERROR NO-WAIT.

    ASSIGN nv_bptr = 0.
    
    IF nv_stf_per  <> 0  THEN DO:
       nv_check = NO.
       FIND FIRST wf_uwd132 USE-INDEX uwd13201 WHERE 
                  wf_uwd132.policy = sic_bran.uwm100.policy AND
                  wf_uwd132.rencnt = sic_bran.uwm100.rencnt AND
                  wf_uwd132.endcnt = sic_bran.uwm100.endcnt AND 
                  wf_uwd132.riskno = sic_bran.uwm130.riskno AND
                  wf_uwd132.itemno = sic_bran.uwm130.itemno AND
                  wf_uwd132.bchyr  = nv_batchyr             AND
                  wf_uwd132.bchno  = nv_batchno             AND
                  wf_uwd132.bchcnt = nv_batcnt              AND
                  wf_uwd132.bptr   = 0             NO-LOCK NO-ERROR.


 FIND sic_bran.uwd132  USE-INDEX uwd13201 WHERE
         sic_bran.uwd132.policy = sic_bran.uwm100.policy AND
         sic_bran.uwd132.rencnt = sic_bran.uwm100.rencnt AND
         sic_bran.uwd132.endcnt = sic_bran.uwm100.endcnt AND
         sic_bran.uwd132.riskgp = s_riskgp               AND
         sic_bran.uwd132.riskno = s_riskno               AND
         sic_bran.uwd132.itemno = s_itemno               AND
         sic_bran.uwd132.bchyr  = nv_batchyr             AND
         sic_bran.uwd132.bchno  = nv_batchno             AND
         sic_bran.uwd132.bchcnt = nv_batcnt              NO-ERROR NO-WAIT.
       IF AVAIL wf_uwd132 THEN DO:
           nv_bptr  = RECID(wf_uwd132).
       END.
    
       FIND FIRST sic_bran.uwd132 USE-INDEX uwd13201 WHERE 
                  sic_bran.uwd132.policy = sic_bran.uwm100.policy AND
                  sic_bran.uwd132.rencnt = sic_bran.uwm100.rencnt AND
                  sic_bran.uwd132.endcnt = sic_bran.uwm100.endcnt AND 
                  sic_bran.uwd132.riskno = sic_bran.uwm130.riskno AND
                  sic_bran.uwd132.itemno = sic_bran.uwm130.itemno AND
                  sic_bran.uwd132.bchyr  = nv_batchyr             AND
                  sic_bran.uwd132.bchno  = nv_batchno             AND
                  sic_bran.uwd132.bchcnt = nv_batcnt              AND
                  /*sic_bran.uwd132.bencod = "DSTF" */ /* A66-0202*/
                  sic_bran.uwd132.bencod = "DSPC"   NO-ERROR. /* A66-0202*/  
       IF NOT AVAIL sic_bran.uwd132 THEN DO:
           CREATE sic_bran.uwd132.
           ASSIGN
               sic_bran.uwd132.gap_ae = NO
               sic_bran.uwd132.pd_aep = "E"
               /*sic_bran.uwd132.bencod = "DSTF"      */  /* A66-0202*/ 
               sic_bran.uwd132.bencod = "DSPC"          /* A66-0202*/ 
               sic_bran.uwd132.policy = sic_bran.uwm130.policy
               sic_bran.uwd132.rencnt = sic_bran.uwm130.rencnt   sic_bran.uwd132.endcnt = sic_bran.uwm130.endcnt
               sic_bran.uwd132.riskgp = sic_bran.uwm130.riskgp   sic_bran.uwd132.riskno = sic_bran.uwm130.riskno
               sic_bran.uwd132.itemno = sic_bran.uwm130.itemno   sic_bran.uwd132.bchyr  = nv_batchyr  
               sic_bran.uwd132.bchno  = nv_batchno               sic_bran.uwd132.bchcnt = nv_batcnt   
               nv_check = YES.
    
       END.
    
       ASSIGN
           sic_bran.uwd132.gap_c  = nv_stf_per
           sic_bran.uwd132.prem_c = nv_stf_per
           sic_bran.uwd132.benvar = nv_stfvar
           nv_recid = RECID(sic_bran.uwd132).
    
       IF nv_check = YES THEN DO:
           FIND sic_bran.uwd132 WHERE RECID(sic_bran.uwd132) = nv_recid NO-ERROR.
           IF AVAIL sic_bran.uwd132 THEN DO: /*new*/
               FIND FIRST wf_uwd132 WHERE RECID(wf_uwd132) = nv_bptr  NO-ERROR.
               IF AVAIL wf_uwd132 THEN DO:
                   ASSIGN
                       wf_uwd132.bptr  = RECID(uwd132)
                       sic_bran.uwd132.fptr   = RECID(wf_uwd132)  /*new record*/
                       sic_bran.uwd132.bptr   = 0               /*new record*/
                       sic_bran.uwm130.fptr03 = RECID(sic_bran.uwd132).
    
                   FIND FIRST wf_uwd132 WHERE wf_uwd132.policy = sic_bran.uwm100.policy AND
                          wf_uwd132.rencnt = sic_bran.uwm100.rencnt AND
                          wf_uwd132.endcnt = sic_bran.uwm100.endcnt AND 
                          wf_uwd132.fptr   = 0             NO-LOCK NO-ERROR.
                   IF AVAIL wf_uwd132 THEN DO:
                        sic_bran.uwm130.bptr03 = RECID(wf_uwd132).
                   END.
               END.
           END.
    
       END.
    END.
    RELEASE sic_bran.uwd132.
END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_initcal C-Win 
PROCEDURE proc_initcal :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
 ASSIGN 
     nv_polday  = 0                nv_flag    =  NO   /*A68-0044*/
     nv_covcod  = ""               nv_garage  =  ""   /*A68-0044*/
     nv_class   = ""               nv_31prmt  =  0    /*A68-0044*/
     nv_vehuse  = ""               nv_31rate  =  0    /*A68-0044*/
     nv_cstflg  = ""  /*C=CC ; S=Seat ; T=Tons ; W=Watts*/    
     nv_engcst  = 0   /* ต้องใส่ค่าตาม nv_cstflg  */         
     /*nv_drivno  = 0*/
     nv_driage1 = 0
     nv_driage2 = 0
     nv_pdprm0  = 0  /*เบี้ยส่วนลดผู้ขับขี่*/
     nv_yrmanu  = 0
     nv_totsi   = 0
     nv_totfi   = 0
     nv_vehgrp  = ""
     nv_access  = ""
     nv_supe    = NO
     nv_tpbi1si = 0
     nv_tpbi2si = 0
     nv_tppdsi  = 0   
     nv_411si   = 0
     nv_412si   = 0
     nv_413si   = 0
     nv_414si   = 0  
     nv_42si    = 0
     nv_43si    = 0
     nv_41prmt  = 0
     nv_412prmt = 0  /*A65-0079*/
     nv_413prmt = 0  /*A65-0079*/
     nv_414prmt = 0  /*A65-0079*/
     nv_42prmt  = 0
     nv_43prmt  = 0
     nv_seat41  = 0          
     nv_dedod   = 0
     nv_addod   = 0
     nv_dedpd   = 0        
     nv_ncbp    = 0
     nv_fletp   = 0
     nv_dspcp   = 0
     nv_dstfp   = 0
     nv_clmp    = 0
     /* A65-0079*/
     nv_mainprm = 0 
     nv_ncbamt  = 0 
     nv_fletamt = 0 
     nv_dspcamt = 0 
     nv_dstfamt = 0 
     nv_clmamt  = 0 
     /* end : A65-0079 */
     nv_baseprm  = 0
     nv_baseprm3 = 0
     nv_pdprem   = 0
     nv_netprem  = 0    /*เบี้ยสุทธิ */
     nv_gapprm   = 0    /*เบี้ยรวม */
     nv_flagprm  = "N"  /* N = เบี้ยสุทธิ, G = เบี้ยรวม */
     nv_effdat   = ?    
     nv_ratatt   = 0    
     nv_siatt    = 0    
     nv_netatt   = 0    
     nv_fltatt   = 0    
     nv_ncbatt   = 0    
     nv_dscatt   = 0    
     nv_atfltgap = 0   /*A65-0079*/
     nv_atncbgap = 0   /*A65-0079*/
     nv_atdscgap = 0   /*A65-0079*/
     nv_packatt  = ""  /*A65-0079*/
     nv_flgsht   = ""  /*A65-0079*/
     nv_status   = "" 
     nv_fcctv    = NO
     nv_uom1_c   = "" 
     nv_uom2_c   = "" 
     nv_uom5_c   = "" 
     nv_uom6_c   = "" 
     nv_uom7_c   = ""
     nv_message  = "" 
     /* A67-0029*/
     nv_level    = 0 
     nv_levper   = 0
     nv_tariff   = ""
     nv_adjpaprm   = NO
     nv_flgpol     = ""
     nv_flgclm     = ""
     /*nv_ncbyrs     = 0*/
     nv_chgflg     = NO    
     nv_chgrate    = 0    
     nv_chgsi      = 0    
     nv_chgpdprm   = 0    
     nv_chggapprm  = 0    
     nv_battflg    = NO    
     nv_battrate   = 0    
     nv_battsi     = 0    
     nv_battprice  = 0    
     nv_battpdprm  = 0    
     nv_battgapprm = 0    
     nv_battyr     = 0    
     nv_battper    = 0
     nv_evflg      = NO .
 /* end A67-0029*/
 /* add by : A68-0061 */
 IF index(wdetail.subclass,"E") <> 0 THEN ASSIGN cv_lncbper = 40.
 ELSE IF wdetail.prepol <> ""  THEN ASSIGN cv_lncbper = 50.
 ELSE ASSIGN cv_lncbper = 40.
 /* end : A68-0061 */

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_initdataex C-Win 
PROCEDURE proc_initdataex :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
ASSIGN 
    wf_riskno         = ""  /* A64-0355*/
    wf_num            = ""          
    wf_policyno       = ""  
    wf_n_branch       = ""  
    wf_agent          = ""  
    wf_producer       = ""  
    wf_n_delercode    = ""  
    wf_fincode        = ""  
    wf_appenno        = ""  
    wf_salename       = ""  
    wf_srate          = ""  
    wf_comdat         = ""  
    wf_expdat         = ""  
    wf_agreedat       = ""  
    wf_firstdat       = ""  
    wf_packcod        = ""  
    wf_camp_no        = ""  
    wf_campen         = ""  
    wf_specon         = ""  
    wf_product        = ""  
    wf_promo          = ""  
    wf_rencnt         = ""  
    wf_prepol         = ""  
    wf_txt1           = ""  
    wf_txt2           = ""  
    wf_txt3           = ""  
    wf_txt4           = ""  
    wf_txt5           = ""  
    wf_txt6           = ""  
    wf_txt7           = ""  
    wf_txt8           = ""  
    wf_txt9           = ""  
    wf_txt10          = ""  
    wf_memo1          = ""  
    wf_memo2          = ""  
    wf_memo3          = ""  
    wf_memo4          = ""  
    wf_memo5          = ""  
    wf_memo6          = ""  
    wf_memo7          = ""  
    wf_memo8          = ""  
    wf_memo9          = ""  
    wf_memo10         = ""  
    wf_accdata1       = ""  
    wf_accdata2       = ""  
    wf_accdata3       = ""  
    wf_accdata4       = ""  
    wf_accdata5       = ""  
    wf_accdata6       = ""  
    wf_accdata7       = ""  
    wf_accdata8       = ""  
    wf_accdata9       = ""  
    wf_accdata10      = ""  
    wf_compul         = "" 
    wf_insref         = ""  /* A64-0355*/
    wf_instyp         = ""  
    wf_inslang        = ""  
    wf_tiname         = ""  
    wf_insnam         = ""  
    wf_lastname       = ""  
    wf_icno           = ""  
    wf_insbr          = ""  
    wf_occup          = ""  
    wf_addr           = ""  
    wf_tambon         = ""  
    wf_amper          = ""  
    wf_country        = ""  
    wf_post           = ""  
    wf_provcod        = ""  
    wf_distcod        = ""  
    wf_sdistcod       = "" 
    wf_ae             = "" /* ae  new Xmm600 งาน Japanes */  /*A64-0355*/  
    wf_jtl            = "" /* jtl new Xmm600 งาน Japanes */  /*A64-0355*/  
    wf_ts             = ""  /* ts  new Xmm600 งาน Japanes */  /*A64-0355*/  
    wf_gender         = ""  
    wf_tele1          = ""  
    wf_tele2          = ""  
    wf_mail1          = ""  
    wf_mail2          = ""  
    wf_mail3          = ""  
    wf_mail4          = ""  
    wf_mail5          = ""  
    wf_mail6          = ""  
    wf_mail7          = ""  
    wf_mail8          = ""  
    wf_mail9          = ""  
    wf_mail10         = ""  
    wf_fax            = ""  
    wf_lineID         = ""  
    wf_name2          = ""  
    wf_name3          = ""  
    wf_benname        = ""  
    wf_payercod       = ""  
    wf_vatcode        = ""  
    wf_instcod1       = ""  
    wf_insttyp1       = ""  
    wf_insttitle1     = ""  
    wf_instname1      = ""  
    wf_instlname1     = ""  
    wf_instic1        = ""  
    wf_instbr1        = ""  
    wf_instaddr11     = ""  
    wf_instaddr21     = ""  
    wf_instaddr31     = ""  
    wf_instaddr41     = ""  
    wf_instpost1      = ""  
    wf_instprovcod1   = ""  
    wf_instdistcod1   = ""  
    wf_instsdistcod1  = ""  
    wf_instprm1       = ""  
    wf_instrstp1      = ""  
    wf_instrtax1      = ""  
    wf_instcomm01     = ""  
    wf_instcomm12     = ""  
    wf_instcod2       = ""  
    wf_insttyp2       = ""  
    wf_insttitle2     = ""  
    wf_instname2      = ""  
    wf_instlname2     = ""  
    wf_instic2        = ""  
    wf_instbr2        = ""  
    wf_instaddr12     = ""  
    wf_instaddr22     = ""  
    wf_instaddr32     = ""  
    wf_instaddr42     = ""  
    wf_instpost2      = ""  
    wf_instprovcod2   = ""  
    wf_instdistcod2   = ""  
    wf_instsdistcod2  = ""  
    wf_instprm2       = ""  
    wf_instrstp2      = ""  
    wf_instrtax2      = ""  
    wf_instcomm02     = ""  
    wf_instcomm22     = ""  
    wf_instcod3       = ""  
    wf_insttyp3       = ""  
    wf_insttitle3     = ""  
    wf_instname3      = ""  
    wf_instlname3     = ""  
    wf_instic3        = ""  
    wf_instbr3        = ""  
    wf_instaddr13     = ""  
    wf_instaddr23     = ""  
    wf_instaddr33     = ""  
    wf_instaddr43     = ""  
    wf_instpost3      = ""  
    wf_instprovcod3   = ""  
    wf_instdistcod3   = ""  
    wf_instsdistcod3  = ""  
    wf_instprm3       = ""  
    wf_instrstp3      = ""  
    wf_instrtax3      = ""  
    wf_instcomm03     = ""  
    wf_instcomm23     = ""  
    wf_covcod         = ""  
    wf_garage         = ""  
    wf_special        = ""  
    wf_inspec         = ""  
    wf_class70        = "" 
    wf_vehuse         = ""  /*A64-0355 : vehuse 15/12/2021 */
    wf_brand          = ""  
    wf_model          = ""  
    wf_submodel       = ""  
    wf_caryear        = ""  
    wf_chasno         = ""  
    wf_eng            = ""  
    wf_seat           = ""  
    wf_engcc          = ""  
    wf_weight         = ""  
    wf_watt           = ""  
    wf_body           = ""  
    wf_type           = ""  
    wf_re_year        = ""  
    wf_vehreg         = ""  
    wf_re_country     = ""  
    wf_cargrp         = ""  
    wf_colorcar       = ""  
    wf_fule           = ""  
    wf_drivnam        = ""  
    wf_ntitle1        = ""  
    wf_drivername1    = ""  
    wf_dname2         = ""  
    wf_dicno          = ""  
    wf_dgender1       = ""  
    wf_dbirth         = ""  
    wf_doccup         = ""  
    wf_ddriveno       = ""  
    wf_ntitle2        = ""  
    wf_drivername2    = ""  
    wf_ddname1        = ""  
    wf_ddicno         = ""  
    wf_dgender2       = ""  
    wf_ddbirth        = ""  
    wf_ddoccup        = ""  
    wf_dddriveno      = ""  
    wf_baseplus       = ""  
    wf_siplus         = ""  
    wf_rs10           = ""  
    wf_comper         = ""  
    wf_comacc         = ""  
    wf_deductpd       = ""  
    wf_DOD            = ""  
    wf_DPD            = ""  
    wf_tpfire         = ""  
    wf_NO_41          = ""  
    wf_ac2            = ""  
    wf_ac4            = ""  
    wf_ac5            = ""  
    wf_ac6            = ""  
    wf_ac7            = ""  
    wf_NO_42          = ""  
    wf_NO_43          = ""  
    wf_base           = ""  
    wf_unname         = ""  
    wf_nname          = ""  
    wf_tpbi           = ""  
    wf_tppd           = ""  
    wf_ry01           = ""  
    wf_ry02           = ""  
    wf_ry03           = ""  
    wf_fleet          = ""  
    wf_ncb            = ""  
    wf_claim          = ""  
    wf_dspc           = ""  
    wf_cctv           = ""  
    wf_dstf           = ""  
    wf_fleetprem      = ""  
    wf_ncbprem        = ""  
    wf_clprem         = ""  
    wf_dspcprem       = ""  
    wf_cctvprem       = ""  
    wf_dstfprem       = ""  
    wf_premt          = ""  
    wf_rstp_t         = ""  
    wf_rtax_t         = ""  
    wf_comper70       = ""  
    wf_comprem70      = ""  
    wf_agco70         = ""  
    wf_comco_per70    = ""  
    wf_comco_prem70   = ""  
    wf_dgpackge       = ""  
    wf_danger1        = ""  
    wf_danger2        = ""  
    wf_dgsi           = ""  
    wf_dgrate         = ""  
    wf_dgfeet         = ""  
    wf_dgncb          = ""  
    wf_dgdisc         = ""  
    wf_dgatt          = ""  
    wf_dgfeetprm      = ""  
    wf_dgncbprm       = ""  
    wf_dgdiscprm      = ""  
    wf_dgprem         = ""  
    wf_cltxt          = ""  
    wf_clamount       = ""  
    wf_faultno        = ""  
    wf_faultprm       = ""  
    wf_goodno         = ""  
    wf_goodprm        = ""  
    wf_loss           = ""  
    wf_compolusory    = ""  
    wf_barcode        = ""  
    wf_class72        = ""  
    wf_dstf72         = ""  
    wf_dstfprem72     = ""  
    wf_premt72        = ""  
    wf_rstp_t72       = ""  
    wf_rtax_t72       = ""  
    wf_comper72       = ""  
    wf_comprem72      = ""  
    wf_instot         = 0  
    /* add by : A67-0029 */
    wf_DOD1      = "" 
    wf_bi2       = "" 
    wf_dodamt    = "" 
    wf_dod1amt   = "" 
    wf_dpdamt    = "" 
    wf_ry412     = "" 
    wf_ry413     = "" 
    wf_ry414     = "" 
    wf_maksi     = "" 
    wf_eng_no2   = ""   /*หมายเลขเครื่อง 2 */ 
    wf_drivexp1  = ""   /*วันที่ใบอนุญาต หมดอายุ */  
    wf_dlevel1   = ""   /*ระดับพฤติกรรมการขับขี่ */  
    wf_drivexp2  = ""   /*วันที่ใบอนุญาต หมดอายุ */  
    wf_dlevel2   = ""   /*ระดับพฤติกรรมการขับขี่ */
    wf_ntitle3   = ""   /*คำนำหน้า              */ 
    wf_dname3    = ""   /*ชื่อ                  */ 
    wf_dlname3   = ""   /*นามสกุล               */ 
    wf_dicno3    = ""   /*เลขที่บัตรประชาชน     */ 
    wf_dgender3  = ""   /*เพศ                   */ 
    wf_dbirth3   = ""   /*วันเกิด               */ 
    wf_doccup3   = ""   /*ชื่ออาชีพ             */ 
    wf_ddriveno3 = ""   /*เลขที่ใบอนุญาตขับขี่  */ 
    wf_drivexp3  = ""   /*วันที่ใบอนุญาต หมดอายุ*/ 
    wf_dlevel3   = ""   /*ระดับพฤติกรรมการขับขี่*/ 
    wf_ntitle4   = ""   /*คำนำหน้า              */ 
    wf_dname4    = ""   /*ชื่อ                  */ 
    wf_dlname4   = ""   /*นามสกุล               */ 
    wf_dicno4    = ""   /*เลขที่บัตรประชาชน     */ 
    wf_dgender4  = ""   /*เพศ                   */ 
    wf_dbirth4   = ""   /*วันเกิด               */ 
    wf_doccup4   = ""   /*ชื่ออาชีพ             */ 
    wf_ddriveno4 = ""   /*เลขที่ใบอนุญาตขับขี่  */ 
    wf_drivexp4  = ""   /*วันที่ใบอนุญาต หมดอายุ*/ 
    wf_dlevel4   = ""   /*ระดับพฤติกรรมการขับขี่*/
    wf_ntitle5   = ""   /*คำนำหน้า              */ 
    wf_dname5    = ""   /*ชื่อ                  */ 
    wf_dlname5   = ""   /*นามสกุล               */ 
    wf_dicno5    = ""   /*เลขที่บัตรประชาชน     */ 
    wf_dgender5  = ""   /*เพศ                   */ 
    wf_dbirth5   = ""   /*วันเกิด               */ 
    wf_doccup5   = ""   /*ชื่ออาชีพ             */ 
    wf_ddriveno5 = ""   /*เลขที่ใบอนุญาตขับขี่  */ 
    wf_drivexp5  = ""   /*วันที่ใบอนุญาต หมดอายุ*/ 
    wf_dlevel5   = ""   /*ระดับพฤติกรรมการขับขี่*/ 
    wf_maksi     = ""   /* ทุนประกันรถ EV */ 
    wf_battno    = ""    /*เลขที่แบตเตอรี่   */  
    wf_battyr    = ""    /*ปีแบตฯ            */
    wf_battsi    = ""    /*ทุนแบตฯ          */
    wf_battprice = ""    /*ราคาแบตฯ          */
    wf_battrate  = ""    /*Rate              */ 
    wf_battper   = ""    /*% batt             */  
    wf_battprm   = ""    /*Premium           */  
    wf_chargno   = ""    /*เลขที่เครื่องชาร์จ*/  
    wf_chargsi   = ""    /*ราคาเครื่องชาร์จ  */  
    wf_chargrate  = ""    /*Rate              */  
    wf_chargprm  = ""    /*Premium           */  
    /* end : A67-0029*/
    wf_comdat72  = ""  /* วันที่คุ้มครอง 72 */  /*F67-0001*/      
    wf_expdat72  = ""  /* วันที่หมดอายุ 72 */   /*F67-0001*/
    wf_31prmt    = ""     /*A68-0044*/
    wf_31rate    = "" .   /*A68-0044*/
        
ASSIGN nv_instcod       = ""     nv_instaddr1     = ""         
       nv_insttyp       = ""     nv_instaddr2     = "" 
       nv_insttitle     = ""     nv_instaddr3     = "" 
       nv_instname      = ""     nv_instaddr4     = "" 
       nv_instlname     = ""     nv_instpost      = "" 
       nv_instic        = ""     nv_instprovcod   = "" 
       nv_instbr        = ""     nv_instdistcod   = "" 
       n_insref      = ""        nv_instsdistcod  = "" 
       nv_messagein  = ""        n_check       = "" 
       nv_usrid      = ""        nv_insref     = "" 
       nv_transfer   = NO        putchr        = "" 
       nv_typ        = ""        putchr1       = "" 
       nv_usrid      = SUBSTRING(USERID(LDBNAME(1)),3,4) 
       nv_transfer   = YES.

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_initrenew C-Win 
PROCEDURE proc_initrenew :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/

ASSIGN  
    re_comdat         = ""          re_battyr     = ""   /*A67-0212*/                                              
    re_expdat         = ""          re_battsi     = ""   /*A67-0212*/
    re_tiname         = ""          re_battprice  = ""   /*A67-0212*/
    re_insnam         = ""          re_battno     = ""   /*A67-0212*/
    re_lastname       = ""          re_chargno    = ""   /*A67-0212*/
    re_name2          = ""          re_chargsi    = ""   /*A67-0212*/
    re_name3          = ""          re_battprm    = ""   /*A67-0212*/
    re_n_addr1        = ""          re_chargprm   = ""   /*A67-0212*/
    re_n_addr2        = ""
    re_n_addr3        = ""
    re_n_addr4        = ""
    re_post           = ""
    re_provcod        = ""
    re_distcod        = ""
    re_sdistcod       = ""
    re_firstdat       = ""
    re_class          = ""                           
    re_moddes         = ""                           
    re_yrmanu         = ""                           
    re_seats          = ""                           
    re_vehuse         = ""                           
    re_covcod         = ""                         
    re_garage         = ""                         
    re_vehreg         = ""                            
    re_cha_no         = ""                            
    re_eng_no         = ""                                      
    re_uom1_v         = ""                                         
    re_uom2_v         = ""                                                    
    re_uom5_v         = ""                                                    
    re_si             = ""                                                    
    re_baseprm        = 0                                                     
    re_41             = 0                                         
    re_42             = 0                           
    re_43             = 0                           
    re_seat41         = 0                                         
    re_dedod          = 0                             
    re_addod          = 0                             
    re_dedpd          = 0                             
    re_flet_per       = ""                            
    re_ncbper         = ""                            
    re_dss_per        = ""                            
    re_stf_per        = 0                             
    re_cl_per         = 0                             
    re_bennam1        = ""  
    re_branch         = ""
    re_insref         = ""
    re_agent          = ""
    re_producer       = ""
    re_delercode      = ""
    re_fincode        = ""
    re_payercod       = ""
    re_vatcode        = ""
    re_cargrp         = ""
    re_premt          = 0
    re_adj            = "" 
    re_rencnt         = 0
    re_comment        = "" 
    re_driver         = ""
    re_acctxt         = ""
    re_prmtdriv       = 0
    re_chkmemo        = ""
    re_chktxt         = ""
    re_chkdriv        = "" 
    re_comm           = 0    /*A64-0257*/
    re_base3          = 0    /*A64-0257*/  
    re_agco           = ""   /*A64-0355*/
    re_commco         = 0    /*A64-0355*/
    re_watt           = 0    /*A66-0202*/
    re_acctyp         = ""   /*A66-0202*/
    re_maksi          = 0    /*A67-0029*/
    re_eng_no2        = "" . /*A67-0029*/


                                                      

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_insnam C-Win 
PROCEDURE proc_insnam :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
/***********************/
ASSIGN  
    n_insref      = ""  
    nv_messagein  = ""
    nv_usrid      = ""
    nv_transfer   = NO
    n_check       = ""
    nv_insref     = ""
    putchr        = "" 
    putchr1       = ""
    nv_typ        = ""
    nv_usrid      = SUBSTRING(USERID(LDBNAME(1)),3,4) 
    nv_transfer   = YES.

 FIND LAST sicsyac.xmm600 USE-INDEX  xmm60033 WHERE
    /* (sicsyac.xmm600.NAME      = TRIM(wdetail.insnam) + " " + trim(wdetail.lastname)) OR */ /*A64-0257*/
     (sicsyac.xmm600.firstname = TRIM(wdetail.insnam)    AND
     sicsyac.xmm600.lastname   = TRIM(wdetail.lastname)) AND 
     sicsyac.xmm600.homebr     = TRIM(wdetail.n_branch)  AND 
     sicsyac.xmm600.clicod     = "IN"  EXCLUSIVE-LOCK NO-ERROR NO-WAIT.    /* A56-0047 add check  sicsyac.xmm600.clicod   = "IN"*/
 IF NOT AVAILABLE sicsyac.xmm600 THEN DO: 
    IF n_insref = "" THEN DO:
         ASSIGN  n_check   = ""      nv_insref = "".
         nv_typ = IF wdetail.instyp = "C" THEN "Cs" ELSE "0s"  .
         RUN proc_insno. 
         IF n_check <> "" THEN DO: 
             ASSIGN nv_transfer = NO
                 nv_insref   = "".
             RETURN.
         END.
         IF nv_insref <> "" THEN DO:
             loop_runningins:                /*Check Insured  */
             REPEAT:
                 FIND sicsyac.xmm600 USE-INDEX xmm60001 WHERE
                     sicsyac.xmm600.acno = CAPS(nv_insref)  NO-LOCK NO-ERROR NO-WAIT.
                 IF AVAIL sicsyac.xmm600 THEN DO:
                     RUN proc_insno .
                     IF n_check <> "" THEN DO: 
                         ASSIGN nv_transfer = NO
                             nv_insref   = "".
                         RETURN.
                     END.
                 END.
                 ELSE LEAVE loop_runningins.
             END.
         END.
         IF nv_insref <> "" THEN CREATE sicsyac.xmm600.
         ELSE DO:
             ASSIGN wdetail.pass = "N"  
                 wdetail.comment = wdetail.comment + "| รหัสลูกค้าเป็นค่าว่างไม่สามารถนำเข้าระบบได้ค่ะ" 
                 WDETAIL.OK_GEN  = "N"
                 nv_transfer = NO.
         END.    /**/
     END.
     n_insref = nv_insref.
 END.
 ELSE DO:
    IF sicsyac.xmm600.acno <> "" THEN DO:   /* กรณีพบ */
        ASSIGN
            nv_insref                = trim(sicsyac.xmm600.acno) 
            n_insref                 = caps(trim(nv_insref)) 
            nv_transfer              = NO 
            sicsyac.xmm600.acno_typ  = IF wdetail.instyp = "C" THEN "CO" ELSE "PR"  
            sicsyac.xmm600.ntitle    = TRIM(wdetail.tiname)      /*Title for Name Mr/Mrs/etc*/
            sicsyac.xmm600.fname     = ""                        /*First Name*/
            sicsyac.xmm600.firstname = TRIM(wdetail.insnam)
            sicsyac.xmm600.lastname  = TRIM(wdetail.lastname)
            sicsyac.xmm600.name      = TRIM(wdetail.insnam) + " " + trim(wdetail.lastname)      /*Name Line 1*/
            sicsyac.xmm600.abname    = TRIM(wdetail.insnam) + " " + trim(wdetail.lastname)      /*Abbreviated Name*/
            sicsyac.xmm600.sex       = TRIM(wdetail.gender)
            sicsyac.xmm600.icno      = TRIM(wdetail.ICNO)              /*IC No.*/           
            sicsyac.xmm600.br_insure = TRIM(wdetail.insbr)      /* A64-0355*/
            sicsyac.xmm600.addr1     = TRIM(wdetail.addr)              /*Address line 1*/
            sicsyac.xmm600.addr2     = TRIM(wdetail.tambon)                                /*Address line 2*/
            sicsyac.xmm600.addr3     = TRIM(wdetail.amper)                                 /*Address line 3*/
            sicsyac.xmm600.addr4     = TRIM(wdetail.country)
            sicsyac.xmm600.postcd    = TRIM(wdetail.post)
            sicsyac.xmm600.codeaddr1 = trim(wdetail.provcod)
            sicsyac.xmm600.codeaddr2 = trim(wdetail.distcod)
            sicsyac.xmm600.codeaddr3 = trim(wdetail.sdistcod)
            sicsyac.xmm600.tel[1]    = trim(wdetail.tele1)   
            sicsyac.xmm600.tel[2]    = trim(wdetail.tele2)   
            sicsyac.xmm600.email[1]  = trim(wdetail.mail1)   
            sicsyac.xmm600.email[2]  = trim(wdetail.mail2)   
            sicsyac.xmm600.email[3]  = trim(wdetail.mail3)   
            sicsyac.xmm600.email[4]  = trim(wdetail.mail4)   
            sicsyac.xmm600.email[5]  = trim(wdetail.mail5)   
            sicsyac.xmm600.email[6]  = trim(wdetail.mail6)   
            sicsyac.xmm600.email[7]  = trim(wdetail.mail7)   
            sicsyac.xmm600.email[8]  = trim(wdetail.mail8)   
            sicsyac.xmm600.email[9]  = trim(wdetail.mail9)   
            sicsyac.xmm600.email[10] = trim(wdetail.mail10)  
            sicsyac.xmm600.fax       = trim(wdetail.fax)     
            sicsyac.xmm600.lineid    = trim(wdetail.lineID)  
            sicsyac.xmm600.homebr    = TRIM(wdetail.n_branch)    /*Home branch*/
            sicsyac.xmm600.langug    = TRIM(wdetail.inslang)     /*A64-0355*/
            sicsyac.xmm600.anlyc5    = IF nv_typ = "Cs" THEN TRIM(wdetail.insbr) ELSE ""  
            sicsyac.xmm600.opened    = TODAY
            sicsyac.xmm600.chgpol    = YES                       /*Allow N & A change on pol.Y/N*/
            sicsyac.xmm600.entdat    = TODAY                     /*Entry date*/
            sicsyac.xmm600.enttim    = STRING(TIME,"HH:MM:SS")   /*Entry time*/
            sicsyac.xmm600.usrid     = nv_usrid 
            sicsyac.xmm600.dtyp20    = "" 
            sicsyac.xmm600.dval20    = ""
            /*add by : A65-0216 */
            sicsyac.xmm600.coderef1  = trim(wdetail.jpae)     
            sicsyac.xmm600.coderef2  = trim(wdetail.jpjtl)      
            sicsyac.xmm600.coderef3  = trim(wdetail.jpts) .
            /*end : A65-0216 */    
       IF n_chkvat = YES THEN RUN proc_insnamvat .  /*A65-0043*/
    END.
 END.
  IF nv_transfer = YES AND nv_insref <>  ""  THEN DO:     
    ASSIGN  
        sicsyac.xmm600.acno_typ  = IF wdetail.instyp = "C" THEN "CO" ELSE "PR" 
        sicsyac.xmm600.acno      = nv_insref                 /*Account no*/
        sicsyac.xmm600.gpstcs    = nv_insref                 /*Group A/C for statistics*/
        sicsyac.xmm600.gpage     = ""                        /*Group A/C for ageing*/
        sicsyac.xmm600.gpstmt    = ""                        /*Group A/C for Statement*/
        sicsyac.xmm600.or1ref    = ""                        /*OR Agent 1 Ref. No.*/
        sicsyac.xmm600.or2ref    = ""                        /*OR Agent 2 Ref. No.*/
        sicsyac.xmm600.or1com    = 0                         /*OR Agent 1 Comm. %*/
        sicsyac.xmm600.or2com    = 0                         /*OR Agent 2 Comm. %*/
        sicsyac.xmm600.or1gn     = "G"                       /*OR Agent 1 Gross/Net*/
        sicsyac.xmm600.or2gn     = "G"                       /*OR Agent 2 Gross/Net*/
        sicsyac.xmm600.ntitle    = TRIM(wdetail.tiname)      /*Title for Name Mr/Mrs/etc*/
        sicsyac.xmm600.fname     = ""                        /*First Name*/
        sicsyac.xmm600.name      = TRIM(wdetail.insnam) + " " + trim(wdetail.lastname)     /*Name Line 1*/
        sicsyac.xmm600.abname    = TRIM(wdetail.insnam) + " " + trim(wdetail.lastname)      /*Abbreviated Name*/
        sicsyac.xmm600.firstname = TRIM(wdetail.insnam)
        sicsyac.xmm600.lastname  = TRIM(wdetail.lastname)
        sicsyac.xmm600.icno      = TRIM(wdetail.ICNO)        /*IC No.*/ 
        sicsyac.xmm600.br_insure = TRIM(wdetail.insbr)      /* A64-0355*/
        sicsyac.xmm600.sex       = TRIM(wdetail.gender)
        sicsyac.xmm600.addr1     = TRIM(wdetail.addr )  /*Address line 1*/
        sicsyac.xmm600.addr2     = TRIM(wdetail.tambon)                     /*Address line 2*/
        sicsyac.xmm600.addr3     = TRIM(wdetail.amper)                      /*Address line 3*/
        sicsyac.xmm600.addr4     = TRIM(wdetail.country)                    /*Address line 4*/
        sicsyac.xmm600.postcd    = TRIM(wdetail.post)                        /*Postal Code*/
        sicsyac.xmm600.codeaddr1 = trim(wdetail.provcod)
        sicsyac.xmm600.codeaddr2 = trim(wdetail.distcod)
        sicsyac.xmm600.codeaddr3 = trim(wdetail.sdistcod)
        sicsyac.xmm600.tel[1]    = trim(wdetail.tele1)   
        sicsyac.xmm600.tel[2]    = trim(wdetail.tele2)   
        sicsyac.xmm600.email[1]  = trim(wdetail.mail1)   
        sicsyac.xmm600.email[2]  = trim(wdetail.mail2)   
        sicsyac.xmm600.email[3]  = trim(wdetail.mail3)   
        sicsyac.xmm600.email[4]  = trim(wdetail.mail4)   
        sicsyac.xmm600.email[5]  = trim(wdetail.mail5)   
        sicsyac.xmm600.email[6]  = trim(wdetail.mail6)   
        sicsyac.xmm600.email[7]  = trim(wdetail.mail7)   
        sicsyac.xmm600.email[8]  = trim(wdetail.mail8)   
        sicsyac.xmm600.email[9]  = trim(wdetail.mail9)   
        sicsyac.xmm600.email[10] = trim(wdetail.mail10)  
        sicsyac.xmm600.fax       = trim(wdetail.fax)     
        sicsyac.xmm600.lineid    = trim(wdetail.lineID)  
        sicsyac.xmm600.clicod   = "IN"                      /*Client Type Code*/
        sicsyac.xmm600.acccod   = "IN"                      /*Account type code*/
        sicsyac.xmm600.relate   = ""                        /*Related A/C for RI Claims*/
        sicsyac.xmm600.notes1   = ""                        /*Notes line 1*/
        sicsyac.xmm600.notes2   = ""                        /*Notes line 2*/
        sicsyac.xmm600.homebr   = TRIM(wdetail.n_branch)      /*Home branch*/
        sicsyac.xmm600.opened   = TODAY                     /*Date A/C opened*/
        sicsyac.xmm600.prindr   = 1                         /*No. to print Dr/Cr N., default*/
        sicsyac.xmm600.langug   = TRIM(wdetail.inslang)     /*Language Code*/
        sicsyac.xmm600.cshdat   = ?                         /*Cash terms wef date*/
        sicsyac.xmm600.legal    = ""                        /*Legal action pending/closed*/
        sicsyac.xmm600.stattp   = "I"                       /*Statement type I/B/N*/
        sicsyac.xmm600.autoap   = NO                        /*Automatic cash matching*/
        sicsyac.xmm600.ltcurr   = "BHT"                     /*Credit limit currency*/
        sicsyac.xmm600.ltamt    = 0                         /*Credit limit amount*/
        sicsyac.xmm600.exec     = ""                        /*Executive responsible*/
        sicsyac.xmm600.cntry    = "TH"                      /*Country code*/
        sicsyac.xmm600.phone    = ""                        /*Phone no.*/
        sicsyac.xmm600.closed   = ?                         /*Date A/C closed*/
        sicsyac.xmm600.crper    = 0                         /*Credit period*/
        sicsyac.xmm600.pvfeq    = 0                         /*PV frequency/Type code*/
        sicsyac.xmm600.comtab   = 1                         /*Commission table no*/
        sicsyac.xmm600.chgpol   = YES                       /*Allow N & A change on pol.Y/N*/
        sicsyac.xmm600.entdat   = TODAY                     /*Entry date*/
        sicsyac.xmm600.enttim   = STRING(TIME,"HH:MM:SS")   /*Entry time*/
        sicsyac.xmm600.usrid    = nv_usrid                 /*Userid*/
        sicsyac.xmm600.regagt   = ""                       /*Registered agent code*/
        sicsyac.xmm600.agtreg   = ""                       /*Agents Registration/Licence No*/
        sicsyac.xmm600.debtyn   = YES                      /*Permit debtor trans Y/N*/
        sicsyac.xmm600.crcon    = NO                       /*Credit Control Report*/
        sicsyac.xmm600.muldeb   = NO                       /*Multiple Debtors Acc.*/
        sicsyac.xmm600.styp20   = ""                       /*Statistic Type Codes (4 x 20)*/
        sicsyac.xmm600.sval20   = ""                       /*Statistic Value Codes (4 x 20)*/
        sicsyac.xmm600.dtyp20   = ""                       /*Type of Date Codes (2 X 20)*/
        sicsyac.xmm600.dval20   = ""                       /*Date Values (8 X 20)*/
        sicsyac.xmm600.iblack   = ""                       /*Insured Black List Code*/
        sicsyac.xmm600.oldic    = ""                       /*Old IC No.*/
        sicsyac.xmm600.cardno   = ""                       /*Credit Card Account No.*/
        sicsyac.xmm600.cshcrd   = ""                       /*Cash(C)/Credit(R) Agent*/
        sicsyac.xmm600.naddr1   = ""                       /*New address line 1*/
        sicsyac.xmm600.gstreg   = ""                       /*GST Registration No.*/
        sicsyac.xmm600.naddr2   = ""                       /*New address line 2*/
        sicsyac.xmm600.fax      = ""                       /*Fax No.*/
        sicsyac.xmm600.naddr3   = ""                       /*New address line 3*/
        sicsyac.xmm600.telex    = ""                       /*Telex No.*/
        sicsyac.xmm600.naddr4   = ""                       /*New address line 4*/
        sicsyac.xmm600.name2    = ""                       /*Name Line 2*/
        sicsyac.xmm600.npostcd  = ""                       /*New postal code*/
        sicsyac.xmm600.name3    = ""                       /*Name Line 3*/
        sicsyac.xmm600.nphone   = ""                       /*New phone no.*/    
        sicsyac.xmm600.nachg    = YES                      /*Change N&A on Renewal/Endt*/
        sicsyac.xmm600.regdate  = ?                        /*Agents registration Date*/
        sicsyac.xmm600.alevel   = 0                        /*Agency Level*/
        sicsyac.xmm600.taxno    = ""                       /*Agent tax no.*/
        sicsyac.xmm600.anlyc1   = ""                       /*Analysis Code 1*/
        sicsyac.xmm600.taxdate  = ?                        /*Agent tax date*/
        sicsyac.xmm600.anlyc5   = IF nv_typ = "Cs" THEN TRIM(wdetail.insbr) ELSE ""
        sicsyac.xmm600.dtyp20   = ""
        sicsyac.xmm600.dval20   = ""     /*string(wdetail.brithday).*/
        /*add by : A65-0216 */
        sicsyac.xmm600.coderef1  = trim(wdetail.jpae)     
        sicsyac.xmm600.coderef2  = trim(wdetail.jpjtl)      
        sicsyac.xmm600.coderef3  = trim(wdetail.jpts) 
        /*end : A65-0216 */
        /* vat ชมพู : A64-0043 */
        sicsyac.xmm600.nbr_insure = ""
        sicsyac.xmm600.nntitle    = ""
        sicsyac.xmm600.nfirstName = ""
        sicsyac.xmm600.nlastname  = ""
        sicsyac.xmm600.nicno      = "".
       /* end vat ชมพู : A64-0043 */
       IF n_chkvat = YES THEN DO:
          RUN proc_insnamvat. /*A65-0043*/
       END.
  END.
  IF sicsyac.xmm600.acno <> "" THEN DO:              /*A55-0268 add chk nv_insref = "" */
      ASSIGN nv_insref = trim(sicsyac.xmm600.acno)
          nv_transfer  = YES.
      FIND sicsyac.xtm600 USE-INDEX xtm60001 WHERE sicsyac.xtm600.acno  = nv_insref  NO-ERROR NO-WAIT.
      IF NOT AVAILABLE sicsyac.xtm600 THEN DO:
          IF LOCKED sicsyac.xtm600 THEN DO:
              nv_transfer = NO.
              RETURN.
          END.
          ELSE DO:
              CREATE sicsyac.xtm600.
              nv_transfer  = YES.
          END.
      END.
      IF nv_transfer = YES THEN DO:
          ASSIGN
              sicsyac.xtm600.acno      = nv_insref                                          /*Account no.*/
              sicsyac.xtm600.ntitle    = TRIM(wdetail.tiname)                               /*Title*/
              sicsyac.xtm600.firstname = trim(wdetail.insnam)
              sicsyac.xtm600.lastname  = trim(wdetail.lastname)
              /*sicsyac.xtm600.name      = TRIM(wdetail.insnam) + " " + trim(wdetail.name3) */  /*Name of Insured Line 1*/  /*A64-0355*/
              /*sicsyac.xtm600.abname    = TRIM(wdetail.insnam) + " " + trim(wdetail.name3) */  /*Abbreviated Name*/        /*A64-0355*/
              sicsyac.xtm600.name      = TRIM(wdetail.insnam) + " " + trim(wdetail.lastname)   /*Name of Insured Line 1*/   /*A64-0355*/
              sicsyac.xtm600.abname    = TRIM(wdetail.insnam) + " " + trim(wdetail.lastname)   /*Abbreviated Name*/         /*A64-0355*/
              sicsyac.xtm600.addr1     = TRIM(wdetail.addr)            /*address line 1*/
              sicsyac.xtm600.addr2     = TRIM(wdetail.tambon)                               /*address line 2*/
              sicsyac.xtm600.addr3     = TRIM(wdetail.amper)                                /*address line 3*/
              sicsyac.xtm600.addr4     = TRIM(wdetail.country)                              /*address line 4*/
              sicsyac.xtm600.post      = TRIM(wdetail.post)
              sicsyac.xtm600.name2     = ""                                                 /*Name of Insured Line 2*/ 
              sicsyac.xtm600.name3     = ""                                                 /*Name of Insured Line 3*/
              sicsyac.xtm600.fname     = "" .                                               /*First Name*/
      END.
  END.
  ASSIGN  wdetail.nv_insref = nv_insref .

RELEASE sicsyac.xtm600.
RELEASE sicsyac.xmm600.
RELEASE sicsyac.xzm056.
/*
RETURN.
HIDE MESSAGE NO-PAUSE.*/

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_insnamvat C-Win 
PROCEDURE proc_insnamvat :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes: Add by A65-0043        
------------------------------------------------------------------------------*/
DO:
    FIND LAST winst WHERE winst.policyno  = wdetail.policyno AND 
                          winst.instot    = wdetail.instot   AND 
                          winst.instname1 <> ""              AND 
                          winst.instname1 <> "Null" NO-LOCK NO-ERROR .
    IF AVAIL winst THEN DO:
    ASSIGN 
           sicsyac.xmm600.nbr_insure =  ""
           sicsyac.xmm600.nntitle    =  ""
           sicsyac.xmm600.nfirstName =  ""
           sicsyac.xmm600.nlastname  =  ""
           sicsyac.xmm600.nphone     =  ""
           sicsyac.xmm600.nicno      =  ""
           sicsyac.xmm600.naddr1     =  ""
           sicsyac.xmm600.naddr2     =  ""
           sicsyac.xmm600.naddr3     =  ""
           sicsyac.xmm600.naddr4     =  ""
           sicsyac.xmm600.npostcd    =  ""
           sicsyac.xmm600.anlyc1     =  ""  

           sicsyac.xmm600.nbr_insure =   winst.instbr1
           sicsyac.xmm600.nntitle    =   winst.insttitle1
           sicsyac.xmm600.nfirstName =   winst.instname1   
           sicsyac.xmm600.nlastname  =   winst.instlname1     
           sicsyac.xmm600.nphone     =   TRIM(winst.instname1) + " " +  TRIM(winst.instlname1) 
           sicsyac.xmm600.nicno      =   winst.instic1   
           sicsyac.xmm600.naddr1     =   winst.instaddr11        
           sicsyac.xmm600.naddr2     =   winst.instaddr21        
           sicsyac.xmm600.naddr3     =   winst.instaddr31    
           sicsyac.xmm600.naddr4     =   winst.instaddr41    
           sicsyac.xmm600.npostcd    =   winst.instpost1 
           SUBSTRING(sicsyac.xmm600.anlyc1,1,14) =  trim(winst.instic1)    /*A65-0043*/
           SUBSTRING(sicsyac.xmm600.anlyc1,20,5) =  TRIM(winst.instbr1).   /*A65-0043*/
    END.
    /* clear vat ชมพู: A65-0043 */
    FIND LAST winst WHERE winst.policyno  = wdetail.policyno AND 
                          winst.instot    = wdetail.instot   AND
                          winst.instname1 = "Null" NO-LOCK NO-ERROR .
    IF AVAIL winst THEN DO:
        ASSIGN 
            sicsyac.xmm600.nbr_insure =  ""
            sicsyac.xmm600.nntitle    =  ""
            sicsyac.xmm600.nfirstName =  ""
            sicsyac.xmm600.nlastname  =  ""
            sicsyac.xmm600.nphone     =  ""
            sicsyac.xmm600.nicno      =  ""
            sicsyac.xmm600.naddr1     =  ""
            sicsyac.xmm600.naddr2     =  ""
            sicsyac.xmm600.naddr3     =  ""
            sicsyac.xmm600.naddr4     =  ""
            sicsyac.xmm600.npostcd    =  ""
            sicsyac.xmm600.anlyc1     =  ""    .
    END.
    /* end : A65-0043 */ 

END.

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_insnam_inst C-Win 
PROCEDURE proc_insnam_inst :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DO:
    ASSIGN fi_process = "Check & Create data instament to XMM600..." + wdetail.policyno .
    DISP fi_process WITH FRAM fr_main.
    ASSIGN nv_instot = 0
           nv_instot = 1
           nv_insref = "" .
    DO WHILE nv_instot <= wdetail.instot :
        FIND LAST winst WHERE winst.policyno = wdetail.policyno AND winst.instot = wdetail.instot NO-ERROR NO-WAIT  .
        IF AVAIL winst THEN DO:
           RUN proc_initdataex.
           RUN proc_insnam_inst2.
           IF nv_instcod <> "" THEN DO:
              FIND sicsyac.xmm600 USE-INDEX xmm60001 WHERE sicsyac.xmm600.acno = trim(nv_instcod) /*AND nv_instname = "" */ /*A65-0043*/ NO-LOCK NO-ERROR .
              IF AVAIL xmm600 THEN DO: 
                  ASSIGN n_insref  = nv_instcod  
                         nv_insref = TRIM(nv_instcod)
                         nv_transfer = NO .
              END.
              ELSE nv_insref = "" .
           END.
           IF nv_insref = ""  THEN DO:
                FIND LAST sicsyac.xmm600 USE-INDEX  xmm60033 WHERE
                    /*(sicsyac.xmm600.NAME      = TRIM(nv_instname) + " " + trim(nv_instlname)) OR */ /*A65-0043 */
                    (sicsyac.xmm600.firstname = TRIM(nv_instname)    AND
                     sicsyac.xmm600.lastname  = TRIM(nv_instlname))  AND 
                     sicsyac.xmm600.homebr    = TRIM(wdetail.n_branch)  AND 
                     sicsyac.xmm600.clicod    = "IN"  EXCLUSIVE-LOCK NO-ERROR NO-WAIT.    /* A56-0047 add check  sicsyac.xmm600.clicod   = "IN"*/
                 IF NOT AVAILABLE sicsyac.xmm600 THEN DO: 
                     IF n_insref = "" THEN DO:
                         ASSIGN  n_check   = ""      nv_insref = "".
                         nv_typ = IF nv_insttyp = "C" THEN "Cs" ELSE "0s"  .
                         RUN proc_insno. 
                         IF n_check <> "" THEN DO: 
                             ASSIGN nv_transfer = NO
                                 nv_insref   = "".
                             RETURN.
                         END.
                         IF nv_insref <> "" THEN DO:
                             loop_runningins:                /*Check Insured  */
                             REPEAT:
                                 FIND sicsyac.xmm600 USE-INDEX xmm60001 WHERE
                                     sicsyac.xmm600.acno = CAPS(nv_insref)  NO-LOCK NO-ERROR NO-WAIT.
                                 IF AVAIL sicsyac.xmm600 THEN DO:
                                     RUN proc_insno .
                                     IF n_check <> "" THEN DO: 
                                         ASSIGN nv_transfer = NO
                                             nv_insref   = "".
                                         RETURN.
                                     END.
                                 END.
                                 ELSE LEAVE loop_runningins.
                             END.
                         END.
                         IF nv_insref <> "" THEN CREATE sicsyac.xmm600.
                         ELSE DO:
                             ASSIGN wdetail.pass = "N"  
                                 wdetail.comment = wdetail.comment + "| รหัสลูกค้าเป็นค่าว่างไม่สามารถนำเข้าระบบได้" 
                                 WDETAIL.OK_GEN  = "N"
                                 nv_transfer = NO.
                         END.    /**/
                     END.
                     n_insref = nv_insref.
                 END.
                 ELSE DO:
                     IF sicsyac.xmm600.acno <> "" THEN DO:   /* กรณีพบ */
                        IF nv_instot = 1 THEN ASSIGN winst.instcod1  = sicsyac.xmm600.acno .
                        IF nv_instot = 2 THEN ASSIGN winst.instcod2  = sicsyac.xmm600.acno .
                        IF nv_instot = 3 THEN ASSIGN winst.instcod3  = sicsyac.xmm600.acno .
                        nv_transfer = NO .
                     END.
                 END.
                 IF nv_transfer = YES AND nv_insref <>  "" THEN DO:     
                     ASSIGN  
                         sicsyac.xmm600.acno_typ  = IF nv_insttyp = "C" THEN "CO" ELSE "PR" 
                         sicsyac.xmm600.acno      = nv_insref                 /*Account no*/
                         sicsyac.xmm600.gpstcs    = nv_insref                 /*Group A/C for statistics*/
                         sicsyac.xmm600.gpage     = ""                        /*Group A/C for ageing*/
                         sicsyac.xmm600.gpstmt    = ""                        /*Group A/C for Statement*/
                         sicsyac.xmm600.or1ref    = ""                        /*OR Agent 1 Ref. No.*/
                         sicsyac.xmm600.or2ref    = ""                        /*OR Agent 2 Ref. No.*/
                         sicsyac.xmm600.or1com    = 0                         /*OR Agent 1 Comm. %*/
                         sicsyac.xmm600.or2com    = 0                         /*OR Agent 2 Comm. %*/
                         sicsyac.xmm600.or1gn     = "G"                       /*OR Agent 1 Gross/Net*/
                         sicsyac.xmm600.or2gn     = "G"                       /*OR Agent 2 Gross/Net*/
                         sicsyac.xmm600.ntitle    = TRIM(nv_insttitle)      /*Title for Name Mr/Mrs/etc*/
                         sicsyac.xmm600.fname     = ""                        /*First Name*/
                         sicsyac.xmm600.name      = TRIM(nv_instname) + " " + trim(nv_instlname)     /*Name Line 1*/
                         sicsyac.xmm600.abname    = TRIM(nv_instname) + " " + trim(nv_instlname)     /*Abbreviated Name*/ /*A65-0043*/
                         sicsyac.xmm600.firstname = TRIM(nv_instname)    
                         sicsyac.xmm600.lastname  = trim(nv_instlname)  
                         sicsyac.xmm600.icno      = TRIM(nv_instic)       /*IC No.*/ 
                         sicsyac.xmm600.br_insure = TRIM(nv_instbr)    /*A64-0355*/
                         sicsyac.xmm600.sex       = ""
                         sicsyac.xmm600.addr1     = TRIM(nv_instaddr1)   /*Address line 1*/
                         sicsyac.xmm600.addr2     = TRIM(nv_instaddr2)   /*Address line 2*/
                         sicsyac.xmm600.addr3     = TRIM(nv_instaddr3)   /*Address line 3*/
                         sicsyac.xmm600.addr4     = TRIM(nv_instaddr4)   /*Address line 4*/
                         sicsyac.xmm600.postcd    = TRIM(nv_instpost)    /*Postal Code*/
                         sicsyac.xmm600.codeaddr1 = trim(nv_instprovcod) 
                         sicsyac.xmm600.codeaddr2 = trim(nv_instdistcod) 
                         sicsyac.xmm600.codeaddr3 = trim(nv_instsdistcod)
                         sicsyac.xmm600.tel       = ""  
                         sicsyac.xmm600.email     = ""  
                         sicsyac.xmm600.fax       = ""  
                         sicsyac.xmm600.lineid    = ""  
                         sicsyac.xmm600.clicod   = "IN"                      /*Client Type Code*/
                         sicsyac.xmm600.acccod   = "IN"                      /*Account type code*/
                         sicsyac.xmm600.relate   = ""                        /*Related A/C for RI Claims*/
                         sicsyac.xmm600.notes1   = ""                        /*Notes line 1*/
                         sicsyac.xmm600.notes2   = ""                        /*Notes line 2*/
                         sicsyac.xmm600.homebr   = TRIM(wdetail.n_branch)    /*Home branch*/
                         sicsyac.xmm600.opened   = TODAY                     /*Date A/C opened*/
                         sicsyac.xmm600.prindr   = 1                         /*No. to print Dr/Cr N., default*/
                         sicsyac.xmm600.langug   =TRIM(wdetail.inslang)     /*Language Code*/
                         sicsyac.xmm600.cshdat   = ?                         /*Cash terms wef date*/
                         sicsyac.xmm600.legal    = ""                        /*Legal action pending/closed*/
                         sicsyac.xmm600.stattp   = "I"                       /*Statement type I/B/N*/
                         sicsyac.xmm600.autoap   = NO                        /*Automatic cash matching*/
                         sicsyac.xmm600.ltcurr   = "BHT"                     /*Credit limit currency*/
                         sicsyac.xmm600.ltamt    = 0                         /*Credit limit amount*/
                         sicsyac.xmm600.exec     = ""                        /*Executive responsible*/
                         sicsyac.xmm600.cntry    = "TH"                      /*Country code*/
                         sicsyac.xmm600.phone    = ""                        /*Phone no.*/
                         sicsyac.xmm600.closed   = ?                         /*Date A/C closed*/
                         sicsyac.xmm600.crper    = 0                         /*Credit period*/
                         sicsyac.xmm600.pvfeq    = 0                         /*PV frequency/Type code*/
                         sicsyac.xmm600.comtab   = 1                         /*Commission table no*/
                         sicsyac.xmm600.chgpol   = YES                       /*Allow N & A change on pol.Y/N*/
                         sicsyac.xmm600.entdat   = TODAY                     /*Entry date*/
                         sicsyac.xmm600.enttim   = STRING(TIME,"HH:MM:SS")   /*Entry time*/
                         sicsyac.xmm600.usrid    = nv_usrid                 /*Userid*/
                         sicsyac.xmm600.regagt   = ""                       /*Registered agent code*/
                         sicsyac.xmm600.agtreg   = ""                       /*Agents Registration/Licence No*/
                         sicsyac.xmm600.debtyn   = YES                      /*Permit debtor trans Y/N*/
                         sicsyac.xmm600.crcon    = NO                       /*Credit Control Report*/
                         sicsyac.xmm600.muldeb   = NO                       /*Multiple Debtors Acc.*/
                         sicsyac.xmm600.styp20   = ""                       /*Statistic Type Codes (4 x 20)*/
                         sicsyac.xmm600.sval20   = ""                       /*Statistic Value Codes (4 x 20)*/
                         sicsyac.xmm600.dtyp20   = ""                       /*Type of Date Codes (2 X 20)*/
                         sicsyac.xmm600.dval20   = ""                       /*Date Values (8 X 20)*/
                         sicsyac.xmm600.iblack   = ""                       /*Insured Black List Code*/
                         sicsyac.xmm600.oldic    = ""                       /*Old IC No.*/
                         sicsyac.xmm600.cardno   = ""                       /*Credit Card Account No.*/
                         sicsyac.xmm600.cshcrd   = ""                       /*Cash(C)/Credit(R) Agent*/
                         sicsyac.xmm600.naddr1   = ""                       /*New address line 1*/
                         sicsyac.xmm600.gstreg   = ""                       /*GST Registration No.*/
                         sicsyac.xmm600.naddr2   = ""                       /*New address line 2*/
                         sicsyac.xmm600.fax      = ""                       /*Fax No.*/
                         sicsyac.xmm600.naddr3   = ""                       /*New address line 3*/
                         sicsyac.xmm600.telex    = ""                       /*Telex No.*/
                         sicsyac.xmm600.naddr4   = ""                       /*New address line 4*/
                         sicsyac.xmm600.name2    = ""                       /*Name Line 2*/
                         sicsyac.xmm600.npostcd  = ""                       /*New postal code*/
                         sicsyac.xmm600.name3    = ""                       /*Name Line 3*/
                         sicsyac.xmm600.nphone   = ""                       /*New phone no.*/    
                         sicsyac.xmm600.nachg    = YES                      /*Change N&A on Renewal/Endt*/
                         sicsyac.xmm600.regdate  = ?                        /*Agents registration Date*/
                         sicsyac.xmm600.alevel   = 0                        /*Agency Level*/
                         sicsyac.xmm600.taxno    = ""                       /*Agent tax no.*/
                         sicsyac.xmm600.anlyc1   = ""                       /*Analysis Code 1*/
                         sicsyac.xmm600.taxdate  = ?                        /*Agent tax date*/
                         sicsyac.xmm600.anlyc5   = IF nv_typ = "Cs" THEN TRIM(nv_instbr) ELSE "" .
                 END.
                 IF sicsyac.xmm600.acno <> "" THEN DO:              /*A55-0268 add chk nv_insref = "" */
                     ASSIGN nv_insref    = trim(sicsyac.xmm600.acno)
                            nv_transfer  = YES.
                     FIND sicsyac.xtm600 USE-INDEX xtm60001 WHERE sicsyac.xtm600.acno  = nv_insref  NO-ERROR NO-WAIT.
                     IF NOT AVAILABLE sicsyac.xtm600 THEN DO:
                         IF LOCKED sicsyac.xtm600 THEN DO:
                             nv_transfer = NO.
                             RETURN.
                         END.
                         ELSE DO:
                             CREATE sicsyac.xtm600.
                             nv_transfer  = YES.
                         END.
                     END.
                     IF nv_transfer = YES THEN DO:
                         ASSIGN
                             sicsyac.xtm600.acno      = nv_insref                                     /*Account no.*/
                             sicsyac.xtm600.ntitle    = TRIM(nv_insttitle)                            /*Title*/
                             sicsyac.xtm600.firstname = TRIM(nv_instname)                             
                             sicsyac.xtm600.lastname  = trim(nv_instlname)                            
                             sicsyac.xtm600.name      = TRIM(nv_instname) + " " + trim(nv_instlname)  /*Name of Insured Line 1*/
                             sicsyac.xtm600.abname    = TRIM(nv_instname) + " " + trim(nv_instlname)  /*Abbreviated Name*/ /*A65-0043*/
                             sicsyac.xtm600.addr1     = TRIM(nv_instaddr1)                            /*address line 1*/
                             sicsyac.xtm600.addr2     = TRIM(nv_instaddr2)                            /*address line 2*/
                             sicsyac.xtm600.addr3     = TRIM(nv_instaddr3)                            /*address line 3*/
                             sicsyac.xtm600.addr4     = TRIM(nv_instaddr4)                            /*address line 4*/
                             sicsyac.xtm600.post      = TRIM(nv_instpost)                             
                             sicsyac.xtm600.name2     = ""                                            /*Name of Insured Line 2*/ 
                             sicsyac.xtm600.name3     = ""                                            /*Name of Insured Line 3*/
                             sicsyac.xtm600.fname     = "" .                                          /*First Name*/
                     END.
                 END.
            IF nv_instot = 1 THEN ASSIGN winst.instcod1  = sicsyac.xmm600.acno.
            IF nv_instot = 2 THEN ASSIGN winst.instcod2  = sicsyac.xmm600.acno.
            IF nv_instot = 3 THEN ASSIGN winst.instcod3  = sicsyac.xmm600.acno.
           END. /* nv_insref = "" */
           /* add by : A65-0043 */
           ELSE DO:
               FIND sicsyac.xmm600 USE-INDEX xmm60001 WHERE sicsyac.xmm600.acno  = nv_insref  NO-ERROR NO-WAIT.
                IF AVAILABLE sicsyac.xmm600 THEN DO:
                 IF nv_instot = 1 AND nv_instaddr1 = "" AND nv_instaddr2 = "" THEN DO:
                   ASSIGN 
                     winst.instcod1      = sicsyac.xmm600.acno
                     winst.insttitle1    = sicsyac.xmm600.ntitle  
                     winst.instname1     = sicsyac.xmm600.firstname    
                     winst.instlname1    = sicsyac.xmm600.lastname     
                     winst.instaddr11    = sicsyac.xmm600.addr1    
                     winst.instaddr21    = sicsyac.xmm600.addr2    
                     winst.instaddr31    = sicsyac.xmm600.addr3    
                     winst.instaddr41    = sicsyac.xmm600.addr4
                     winst.instpost1     = sicsyac.xmm600.postcd   
                     winst.instprovcod1  = sicsyac.xmm600.codeaddr1 /*A65-0079*/
                     winst.instdistcod1  = sicsyac.xmm600.codeaddr2 /*A65-0079*/
                     winst.instsdistcod1 = sicsyac.xmm600.codeaddr3 /*A65-0079*/
                     winst.instic1       = sicsyac.xmm600.icno       
                     winst.instbr1       = IF sicsyac.xmm600.br_insure <> "" THEN sicsyac.xmm600.br_insure ELSE xmm600.anlyc5.
                 END.
                 IF nv_instot = 2 AND nv_instaddr1 = "" AND nv_instaddr2 = "" THEN DO:
                   ASSIGN 
                     winst.instcod2      = sicsyac.xmm600.acno
                     winst.insttitle2    = sicsyac.xmm600.ntitle  
                     winst.instname2     = sicsyac.xmm600.firstname    
                     winst.instlname2    = sicsyac.xmm600.lastname     
                     winst.instaddr12    = sicsyac.xmm600.addr1    
                     winst.instaddr22    = sicsyac.xmm600.addr2    
                     winst.instaddr32    = sicsyac.xmm600.addr3    
                     winst.instaddr42    = sicsyac.xmm600.addr4
                     winst.instpost2     = sicsyac.xmm600.postcd   
                     winst.instprovcod2  = sicsyac.xmm600.codeaddr1 /*A65-0079*/
                     winst.instdistcod2  = sicsyac.xmm600.codeaddr2 /*A65-0079*/
                     winst.instsdistcod2 = sicsyac.xmm600.codeaddr3 /*A65-0079*/
                     winst.instic2       = sicsyac.xmm600.icno       
                     winst.instbr2       = IF sicsyac.xmm600.br_insure <> "" THEN sicsyac.xmm600.br_insure ELSE xmm600.anlyc5.
                 END.
                 IF nv_instot = 3 AND nv_instaddr1 = "" AND nv_instaddr2 = "" THEN DO:
                   ASSIGN 
                     winst.instcod3     = sicsyac.xmm600.acno
                     winst.insttitle3   = sicsyac.xmm600.ntitle  
                     winst.instname3    = sicsyac.xmm600.firstname    
                     winst.instlname3   = sicsyac.xmm600.lastname     
                     winst.instaddr13   = sicsyac.xmm600.addr1    
                     winst.instaddr23   = sicsyac.xmm600.addr2    
                     winst.instaddr33   = sicsyac.xmm600.addr3    
                     winst.instaddr43   = sicsyac.xmm600.addr4    
                     winst.instpost3    = sicsyac.xmm600.postcd
                     winst.instprovcod3  = sicsyac.xmm600.codeaddr1 /*A65-0079*/
                     winst.instdistcod3  = sicsyac.xmm600.codeaddr2 /*A65-0079*/
                     winst.instsdistcod3 = sicsyac.xmm600.codeaddr3 /*A65-0079*/
                     winst.instic3      = sicsyac.xmm600.icno       
                     winst.instbr3      = IF sicsyac.xmm600.br_insure <> "" THEN sicsyac.xmm600.br_insure ELSE xmm600.anlyc5.
                 END.
               END.
           END.
           /* end : A65-0043 */
        END. /* if avail */
        nv_instot = nv_instot + 1.
    END.
END.
RELEASE sicsyac.xmm600.
RELEASE sicsyac.xmm600.
RELEASE sicsyac.xzm056.
/*
RETURN.
HIDE MESSAGE NO-PAUSE.*/

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_insnam_inst2 C-Win 
PROCEDURE proc_insnam_inst2 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DO:
    IF nv_instot = 1  THEN DO:
       ASSIGN n_addr = ""    nv_chkerror = "" .
       IF trim(winst.instprovcod1) = "" OR trim(winst.instdistcod1) = ""  OR trim(winst.instsdistcod1) = "" THEN DO:
           n_addr = trim(winst.instaddr11 + " " + winst.instaddr21 + " " + winst.instaddr31 + " " + winst.instaddr41) .
           IF n_addr <> "" THEN DO:
               RUN wgw/wgwchkaddr(INPUT n_addr ,
                                  OUTPUT winst.instprovcod1 ,
                                  OUTPUT winst.instdistcod1 ,
                                  OUTPUT winst.instsdistcod1,
                                  OUTPUT nv_chkerror).
                IF nv_chkerror <> ""  THEN wdetail.comment = wdetail.comment + "| installment1 " + nv_chkerror .
           END.
       END.
       ASSIGN   nv_instcod       = winst.instcod1      nv_instaddr1     = winst.instaddr11          
                nv_insttyp       = winst.insttyp1      nv_instaddr2     = winst.instaddr21   
                nv_insttitle     = winst.insttitle1    nv_instaddr3     = winst.instaddr31   
                nv_instname      = winst.instname1     nv_instaddr4     = winst.instaddr41   
                nv_instlname     = winst.instlname1    nv_instpost      = winst.instpost1    
                nv_instic        = winst.instic1       nv_instprovcod   = winst.instprovcod1 
                nv_instbr        = winst.instbr1       nv_instdistcod   = winst.instdistcod1 
                nv_instsdistcod  = winst.instsdistcod1  .
    END.
    IF nv_instot = 2   THEN DO:
       ASSIGN n_addr = ""    nv_chkerror = "" .
       IF trim(winst.instprovcod2) = "" OR trim(winst.instdistcod2) = ""  OR trim(winst.instsdistcod2) = "" THEN DO:
           n_addr = trim(winst.instaddr12 + " " + winst.instaddr22 + " " + winst.instaddr32 + " " + winst.instaddr42) .
           IF n_addr <> "" THEN DO: 
               RUN wgw/wgwchkaddr(INPUT n_addr ,
                                  OUTPUT winst.instprovcod2 ,
                                  OUTPUT winst.instdistcod2 ,
                                  OUTPUT winst.instsdistcod2,
                                  OUTPUT nv_chkerror) .
               IF nv_chkerror <> ""  THEN wdetail.comment = wdetail.comment + "| installment2 " + nv_chkerror .
           END.
       END.
       ASSIGN   nv_instcod       = winst.instcod2      nv_instaddr1     = winst.instaddr12          
                nv_insttyp       = winst.insttyp2      nv_instaddr2     = winst.instaddr22   
                nv_insttitle     = winst.insttitle2    nv_instaddr3     = winst.instaddr32   
                nv_instname      = winst.instname2     nv_instaddr4     = winst.instaddr42   
                nv_instlname     = winst.instlname2    nv_instpost      = winst.instpost2    
                nv_instic        = winst.instic2       nv_instprovcod   = winst.instprovcod2 
                nv_instbr        = winst.instbr2       nv_instdistcod   = winst.instdistcod2 
                nv_instsdistcod  = winst.instsdistcod2  .
    END.
    IF nv_instot = 3  THEN DO:
        ASSIGN n_addr = ""    nv_chkerror = "" .
       IF trim(winst.instprovcod3) = "" OR trim(winst.instdistcod3) = ""  OR trim(winst.instsdistcod3) = "" THEN DO:
           n_addr = trim(winst.instaddr13 + " " + winst.instaddr23 + " " + winst.instaddr33 + " " + winst.instaddr43) .
           IF n_addr <> "" THEN DO: 
               RUN wgw/wgwchkaddr(INPUT n_addr ,
                                  OUTPUT winst.instprovcod3 ,
                                  OUTPUT winst.instdistcod3 ,
                                  OUTPUT winst.instsdistcod3,
                                  OUTPUT nv_chkerror) .
               IF nv_chkerror <> ""  THEN wdetail.comment = wdetail.comment + "| installment3 " + nv_chkerror .
           END.
       END.
       ASSIGN   nv_instcod       = winst.instcod3      nv_instaddr1     = winst.instaddr13          
                nv_insttyp       = winst.insttyp3      nv_instaddr2     = winst.instaddr23   
                nv_insttitle     = winst.insttitle3    nv_instaddr3     = winst.instaddr33   
                nv_instname      = winst.instname3     nv_instaddr4     = winst.instaddr43   
                nv_instlname     = winst.instlname3    nv_instpost      = winst.instpost3    
                nv_instic        = winst.instic3       nv_instprovcod   = winst.instprovcod3 
                nv_instbr        = winst.instbr3       nv_instdistcod   = winst.instdistcod3 
                nv_instsdistcod  = winst.instsdistcod3  .
    END.
END.

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_insno C-Win 
PROCEDURE proc_insno :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DEF VAR n_search   AS LOGICAL INIT YES .
DEF VAR nv_lastno  AS INT INIT 0. 
DEF VAR nv_seqno   AS INT INIT 0.  
ASSIGN  nv_insref = "" .

FIND LAST sicsyac.xzm056 USE-INDEX xzm05601 WHERE 
    sicsyac.xzm056.seqtyp   =  nv_typ        AND
    sicsyac.xzm056.branch   =  TRIM(wdetail.n_branch)    NO-LOCK NO-ERROR .
IF NOT AVAIL xzm056 THEN DO :
    IF n_search = YES THEN DO:
        CREATE xzm056.
        ASSIGN sicsyac.xzm056.seqtyp =  nv_typ
            sicsyac.xzm056.branch    =  TRIM(wdetail.n_branch)
            sicsyac.xzm056.des       =  "Personal/Start"
            sicsyac.xzm056.lastno    =  1.                   
    END.
    ELSE DO:
        ASSIGN
            nv_insref = TRIM(wdetail.n_branch)  + String(1,"999999")
            nv_lastno = 1.
        RETURN.
    END.
END.
ASSIGN 
    nv_lastno = sicsyac.xzm056.lastno
    nv_seqno  = sicsyac.xzm056.seqno. 
IF n_check = "YES" THEN DO:   
    IF nv_typ = "0s" THEN DO: 
        IF LENGTH(TRIM(wdetail.n_branch)) = 2 THEN
            nv_insref = TRIM(wdetail.n_branch) + String(sicsyac.xzm056.lastno + 1 ,"99999999").
        ELSE DO:
            /*A56-0318....
            IF sicsyac.xzm056.lastno > 99999 THEN
                   nv_insref = "0" + TRIM(wdetail.n_branch) + STRING(sicsyac.xzm056.lastno + 1 ,"99999999").
            ELSE   nv_insref =       TRIM(wdetail.n_branch) + STRING(sicsyac.xzm056.lastno + 1 ,"999999").   A56-0318*/
            /*Add ... A56-0318*/
            IF sicsyac.xzm056.lastno > 99999 THEN DO:
                IF (TRIM(wdetail.n_branch) = "A") OR (TRIM(wdetail.n_branch) = "B") THEN DO:
                    nv_insref = "7" + TRIM(wdetail.n_branch) + STRING(sicsyac.xzm056.lastno,"99999999").
                END.
                ELSE nv_insref = "0" + TRIM(wdetail.n_branch) + STRING(sicsyac.xzm056.lastno,"99999999").
            END.
            ELSE DO:
                IF (TRIM(wdetail.n_branch) = "A") OR (TRIM(wdetail.n_branch) = "B") THEN DO:
                    nv_insref = "7" + TRIM(wdetail.n_branch) + STRING(sicsyac.xzm056.lastno,"99999999").
                END.
                ELSE nv_insref =       TRIM(wdetail.n_branch) + STRING(sicsyac.xzm056.lastno,"999999").
            END.    /*add ...A56-0318*/
        END.
        CREATE sicsyac.xzm056.
        ASSIGN
            sicsyac.xzm056.seqtyp    =  nv_typ
            sicsyac.xzm056.branch    =  TRIM(wdetail.n_branch)
            sicsyac.xzm056.des       =  "Personal/Start"
            sicsyac.xzm056.lastno    =  nv_lastno + 1
            sicsyac.xzm056.seqno     =  nv_seqno.   
    END.
    ELSE IF nv_typ = "Cs" THEN DO:
        IF LENGTH(TRIM(wdetail.n_branch)) = 2 THEN
            nv_insref = TRIM(wdetail.n_branch) + "C" + String(sicsyac.xzm056.lastno + 1 ,"9999999").
        ELSE DO:  
            IF sicsyac.xzm056.lastno > 99999 THEN
                nv_insref = "0" + TRIM(wdetail.n_branch) + "C" + String(sicsyac.xzm056.lastno + 1 ,"9999999").
            ELSE   nv_insref =       TRIM(wdetail.n_branch) + "C" + String(sicsyac.xzm056.lastno + 1 ,"99999").
        END.   
        CREATE sicsyac.xzm056.
        ASSIGN
            sicsyac.xzm056.seqtyp    =  nv_typ
            sicsyac.xzm056.branch    =  TRIM(wdetail.n_branch)
            sicsyac.xzm056.des       =  "Company/Start"
            sicsyac.xzm056.lastno    =  nv_lastno + 1
            sicsyac.xzm056.seqno     =  nv_seqno. 
    END.
    n_check = "".
END.
ELSE DO:
    IF nv_typ = "0s" THEN DO:
        IF LENGTH(TRIM(wdetail.n_branch)) = 2 THEN
            nv_insref = TRIM(wdetail.n_branch) + STRING(sicsyac.xzm056.lastno,"99999999").
        ELSE DO: 
            /*IF sicsyac.xzm056.lastno > 99999 THEN
                nv_insref = "0" + TRIM(wdetail.n_branch) + STRING(sicsyac.xzm056.lastno,"99999999").
            ELSE nv_insref =       TRIM(wdetail.n_branch) + STRING(sicsyac.xzm056.lastno,"999999").*/
            /*Add ... A56-0318*/
            IF sicsyac.xzm056.lastno > 99999 THEN DO:
                IF (TRIM(wdetail.n_branch) = "A") OR (TRIM(wdetail.n_branch) = "B") THEN DO:
                    nv_insref = "7" + TRIM(wdetail.n_branch) + STRING(sicsyac.xzm056.lastno,"99999999").
                END.
                ELSE nv_insref = "0" + TRIM(wdetail.n_branch) + STRING(sicsyac.xzm056.lastno,"99999999").
            END.
            ELSE DO:
                IF (TRIM(wdetail.n_branch) = "A") OR (TRIM(wdetail.n_branch) = "B") THEN DO:
                    nv_insref = "7" + TRIM(wdetail.n_branch) + STRING(sicsyac.xzm056.lastno,"99999999").
                END.
                ELSE nv_insref =       TRIM(wdetail.n_branch) + STRING(sicsyac.xzm056.lastno,"999999").
            END.    /*add ...A56-0318*/
        END.
    END.
    ELSE DO:
        IF LENGTH(TRIM(wdetail.n_branch)) = 2 THEN
            nv_insref = TRIM(wdetail.n_branch) + "C" + String(sicsyac.xzm056.lastno,"9999999").
        ELSE DO:  
            IF sicsyac.xzm056.lastno > 99999 THEN
                nv_insref = "0" + TRIM(wdetail.n_branch) + "C" + String(sicsyac.xzm056.lastno,"9999999").
            ELSE
                nv_insref =       TRIM(wdetail.n_branch) + "C" + String(sicsyac.xzm056.lastno,"99999").
        END.
    END.   
END.
IF sicsyac.xzm056.lastno >  sicsyac.xzm056.seqno Then Do :
  /* MESSAGE  "Running Code = Last No. / Please, Update Insured Running Code." SKIP
        "รหัสลูกค้า ถึงหมายเลขสุดท้ายแล้ว / ยกเลิกการทำงานชั่วคราว"      SKIP
        "แล้วติดต่อผู้ตั้ง Code"  VIEW-AS ALERT-BOX. */
    n_check = "ERROR".
    RETURN. 
END.         /*lastno > seqno*/                       
ELSE DO :    /*lastno <= seqno */
    IF nv_typ = "0s" THEN DO:
        IF n_search = YES THEN DO:
            CREATE sicsyac.xzm056.
            ASSIGN
                sicsyac.xzm056.seqtyp    =  nv_typ
                sicsyac.xzm056.branch    =  TRIM(wdetail.n_branch)
                sicsyac.xzm056.des       =  "Personal/Start"
                sicsyac.xzm056.lastno    =  nv_lastno + 1
                sicsyac.xzm056.seqno     =  nv_seqno.   
        END.
    END.
    ELSE IF nv_typ = "Cs" THEN DO:
        IF n_search = YES THEN DO:
            CREATE sicsyac.xzm056.
            ASSIGN
                sicsyac.xzm056.seqtyp    =  nv_typ
                sicsyac.xzm056.branch    =  TRIM(wdetail.n_branch)
                sicsyac.xzm056.des       =  "Company/Start"
                sicsyac.xzm056.lastno    =  nv_lastno + 1
                sicsyac.xzm056.seqno     =  nv_seqno. 
        END.
    END.
END.        /*lastno <= seqno */  
RELEASE sicsyac.xzm056 .

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_instot1 C-Win 
PROCEDURE proc_instot1 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes: ระบุเบี้ยมาในไฟล์      
------------------------------------------------------------------------------*/
/**  uwo10085.p - NEW POLICY ENTRY - INSTALMENTS  **/
DEFINE        VAR n_recid   AS RECID.                                       
DEFINE        VAR n_ttprem  LIKE sic_bran.uwm100.prem_t.                   
DEFINE        VAR n_ttcom1  LIKE sic_bran.uwm100.com1_t.                    
DEFINE        VAR n_ttcom2  LIKE sic_bran.uwm100.com2_t.
DEFINE        VAR n_ttrstp  LIKE sic_bran.uwm100.rstp_t.                    
DEFINE        VAR n_ttrfee  LIKE sic_bran.uwm100.rfee_t.                    
DEFINE        VAR n_ttrtax  LIKE sic_bran.uwm100.rtax_t.                    
DEFINE        VAR n_ttpstp  LIKE sic_bran.uwm100.rstp_t.                    
DEFINE        VAR n_ttpfee  LIKE sic_bran.uwm100.rfee_t.                    
DEFINE        VAR n_ttptax  LIKE sic_bran.uwm100.rtax_t.                    
DEFINE        VAR n_index   AS INTEGER.                                    
DEFINE        VAR nv_d0     AS INT.                                         
DEFINE        VAR nv_tmp_date AS DATE.                                      
DEF VAR nv_fi_rstp_t1       AS DECI INIT 0.
DEF VAR nv_fi_rstp_t2       AS DECI INIT 0.
DEF VAR nv_fi_rstp_t3       AS DECI INIT 0.
DEF VAR nv_com1p_ins1       AS DECI INIT 0.
DEF VAR nv_com1p_ins2       AS DECI INIT 0.
DEF VAR nv_com1p_ins3       AS DECI INIT 0.
DEF VAR nv_prem01           AS DECI INIT 0.
DEF VAR nv_prem02           AS DECI INIT 0.
DEF VAR nv_prem03           AS DECI INIT 0.

/* add by : A64-0355 */
DEF VAR n_ttcom3            LIKE sic_bran.uwm100.com3_t. 
DEF VAR nv_com3p_ins1       AS DECI INIT 0.
DEF VAR nv_com3p_ins2       AS DECI INIT 0.
DEF VAR nv_com3p_ins3       AS DECI INIT 0.
/* end A64-0355 */
ASSIGN fi_process = "Create data instament to uwm101 ..." + wdetail.policyno .
DISP fi_process WITH FRAM fr_main.

/*
DEF VAR nv_fi_tax_per_ins   AS DECI .
DEF VAR nv_fi_stamp_per_ins AS DECI .*/
/*
nv_com1p_ins       
nv_fi_tax_per_ins  
nv_fi_stamp_per_ins*/
/*FIND uwm100 WHERE            RECID(uwm100)           = s_recid1 exclusive-lock NO-ERROR.*/
FIND sic_bran.uwm100   Where Recid(sic_bran.uwm100)  = s_recid1 no-error no-wait.
IF AVAILABLE sic_bran.uwm100  THEN DO:
    ASSIGN 
        s_recid1 = RECID(sic_bran.uwm100)
        sic_bran.uwm100.instot = wdetail.instot  
        nv_fi_rstp_t1 = 0
        nv_fi_rstp_t2 = 0
        nv_fi_rstp_t3 = 0
        nv_com1p_ins1 = 0
        nv_com1p_ins2 = 0
        nv_com1p_ins3 = 0
        nv_prem01     = 0  
        nv_prem02     = 0  
        nv_prem03     = 0
        nv_com3p_ins1 = 0  /*A64-0355*/
        nv_com3p_ins2 = 0  /*A64-0355*/
        nv_com3p_ins3 = 0. /*A64-0355*/
    
    
    FIND LAST winst WHERE winst.policyno = sic_bran.uwm100.policy AND winst.instot = wdetail.instot NO-LOCK NO-ERROR .
    
        IF winst.instot = 2 THEN DO:
            ASSIGN 
                nv_prem02 = winst.instprm2      
                nv_prem01 = winst.instprm1.                               
        END.
        ELSE DO:
            ASSIGN 
                nv_prem03 = winst.instprm3
                nv_prem02 = winst.instprm2
                nv_prem01 = winst.instprm1 .
        END.
        
        IF nv_prem01 > 0 THEN 
            ASSIGN 
            nv_com1p_ins1 = winst.instcomm01
            nv_com3p_ins1 = IF sic_bran.uwm100.acno2 <> "" THEN winst.instcomm12 ELSE 0 /*A64-0355*/
            nv_fi_rstp_t1 = winst.instrstp1.
        IF nv_prem02 > 0 THEN 
            ASSIGN 
            nv_com1p_ins2 = winst.instcomm02
            nv_com3p_ins2 = IF sic_bran.uwm100.acno2 <> "" THEN winst.instcomm22 ELSE 0 /*A64-0355*/
            nv_fi_rstp_t2 = winst.instrstp2 .
        IF nv_prem03 > 0 THEN   
            ASSIGN 
            nv_com1p_ins3 = winst.instcomm03
            nv_com3p_ins3 = IF sic_bran.uwm100.acno2 <> "" THEN winst.instcomm23 ELSE 0 /*A64-0355*/
            nv_fi_rstp_t3 = winst.instrstp3.

       
        FIND FIRST sic_bran.uwm101  USE-INDEX uwm10101 WHERE
            sic_bran.uwm101.policy = sic_bran.uwm100.policy  AND
            sic_bran.uwm101.rencnt = sic_bran.uwm100.rencnt  AND
            sic_bran.uwm101.endcnt = sic_bran.uwm100.endcnt  AND
            sic_bran.uwm101.bchyr  = nv_batchyr     AND
            sic_bran.uwm101.bchno  = nv_batchno     AND
            sic_bran.uwm101.bchcnt = nv_batcnt      NO-LOCK NO-ERROR NO-WAIT.
        IF AVAILABLE sic_bran.uwm101  THEN DO:
            FOR EACH sic_bran.uwm101  USE-INDEX uwm10101   WHERE
                sic_bran.uwm101.policy = sic_bran.uwm100.policy  AND
                sic_bran.uwm101.rencnt = sic_bran.uwm100.rencnt  AND
                sic_bran.uwm101.endcnt = sic_bran.uwm100.endcnt  AND
                sic_bran.uwm101.bchyr  = nv_batchyr     AND
                sic_bran.uwm101.bchno  = nv_batchno     AND
                sic_bran.uwm101.bchcnt = nv_batcnt:
                DELETE sic_bran.uwm101.
            END.  /* each uwm101 */
            RELEASE sic_bran.uwm101.
        END.       /* avail uwm101 */
        IF sic_bran.uwm100.instot > 1 THEN DO: 
            ASSIGN 
                n_ttprem = 0
                n_ttcom1 = 0
                n_ttcom2 = 0
                n_ttcom3 = 0 /*A64-0355*/
                n_ttpstp = 0
                n_ttpfee = 0
                n_ttptax = 0
                n_ttrstp = 0
                n_ttrfee = 0
                n_ttrtax = 0.
            DO transaction:
                FIND sic_bran.uwm100 WHERE RECID(sic_bran.uwm100) = s_recid1 exclusive-lock NO-ERROR.
            END.
            FIND sicsyac.xmm031 USE-INDEX xmm03101 WHERE xmm031.poltyp = sic_bran.uwm100.poltyp NO-LOCK NO-ERROR.
            Do transaction:
                FIND sic_bran.uwm101 USE-INDEX uwm10101 WHERE 
                    sic_bran.uwm101.policy = sic_bran.uwm100.policy AND
                    sic_bran.uwm101.rencnt = sic_bran.uwm100.rencnt AND 
                    sic_bran.uwm101.endcnt = sic_bran.uwm100.endcnt AND
                    sic_bran.uwm101.bchyr  = nv_batchyr             AND
                    sic_bran.uwm101.bchno  = nv_batchno             AND
                    sic_bran.uwm101.bchcnt = nv_batcnt              AND
                    sic_bran.uwm101.instno = 1 exclusive-lock NO-ERROR.
            END.
            IF NOT AVAILABLE sic_bran.uwm101 THEN DO transaction:
                REPEAT n_index = 1 TO sic_bran.uwm100.instot:

                    CREATE sic_bran.uwm101.
                    ASSIGN 
                        sic_bran.uwm101.policy = sic_bran.uwm100.policy 
                        sic_bran.uwm101.rencnt = sic_bran.uwm100.rencnt 
                        sic_bran.uwm101.endcnt = sic_bran.uwm100.endcnt
                        sic_bran.uwm101.bchyr  = nv_batchyr        
                        sic_bran.uwm101.bchno  = nv_batchno            
                        sic_bran.uwm101.bchcnt = nv_batcnt  
                        sic_bran.uwm101.instno = n_index
                        sic_bran.uwm101.prem_i = IF      n_index = 1 THEN nv_prem01
                                                 ELSE IF n_index = 2 THEN nv_prem02
                                                                     ELSE nv_prem03
                        sic_bran.uwm101.com1_i = IF      n_index = 1 THEN nv_com1p_ins1 * ( -1 )
                                                 ELSE IF n_index = 2 THEN nv_com1p_ins2 * ( -1 )
                                                                     ELSE nv_com1p_ins3 * ( -1 )
                        /*sic_bran.uwm101.com2_i = IF      n_index = 1 THEN winst.instcomm12 * ( -1 )
                                                 ELSE IF n_index = 2 THEN winst.instcomm22 * ( -1 )
                                                                     ELSE winst.instcomm23 * ( -1 )*/ /*A64-0355*/
                        sic_bran.uwm101.com2_i = 0   /*A64-0355*/
                        sic_bran.uwm101.com3_i = IF      n_index = 1 THEN nv_com3p_ins1 * ( -1 )
                                                 ELSE IF n_index = 2 THEN nv_com3p_ins2 * ( -1 )
                                                                     ELSE nv_com3p_ins3 * ( -1 ) /*A64-0355 comm co-broker 70 */

                        sic_bran.uwm101.rstp_i = IF      n_index = 1 THEN nv_fi_rstp_t1
                                                 ELSE IF n_index = 2 THEN nv_fi_rstp_t2
                                                 ELSE                     nv_fi_rstp_t3   
                        sic_bran.uwm101.rfee_i = 0.00
                        sic_bran.uwm101.rtax_i = IF      n_index = 1 THEN instrtax1
                                                 ELSE IF n_index = 2 THEN instrtax2
                                                                     ELSE instrtax3

                        n_ttprem               = n_ttprem + sic_bran.uwm101.prem_i 
                        n_ttcom1               = n_ttcom1 + sic_bran.uwm101.com1_i
                        n_ttcom2               = n_ttcom2 + sic_bran.uwm101.com2_i   
                        n_ttcom3               = n_ttcom3 + sic_bran.uwm101.com3_i  /*A64-0355 comm co-broker 70*/
                        n_ttrstp               = n_ttrstp + sic_bran.uwm101.rstp_i  
                        n_ttrfee               = n_ttrfee + sic_bran.uwm101.rfee_i
                        n_ttrtax               = n_ttrtax + sic_bran.uwm101.rtax_i
                        sic_bran.uwm101.desc_i = IF      n_index = 1 THEN winst.instcod1 + " " + 
                                                                          winst.insttitle1 + " " + winst.instname1 + " " + winst.instlname1
                                                 ELSE IF n_index = 2 THEN winst.instcod2 + " " + 
                                                                          winst.insttitle2 + " " + winst.instname2 + " " + winst.instlname2
                                                                     ELSE winst.instcod3 + " " + 
                                                                          winst.insttitle3 + " " + winst.instname3 + " " + winst.instlname3
                       sic_bran.uwm101.flgprn  = "Y" . /*A66-0202*/

                    IF n_index = 1 THEN DO:
                        ASSIGN 
                        n_recid                = RECID(sic_bran.uwm101) 
                        sic_bran.uwm101.pstp_i = sic_bran.uwm100.pstp 
                        sic_bran.uwm101.pfee_i = sic_bran.uwm100.pfee
                        sic_bran.uwm101.ptax_i = sic_bran.uwm100.ptax.
                    END.
                    ELSE DO:
                        ASSIGN 
                            sic_bran.uwm101.pstp_i  = 0 
                            sic_bran.uwm101.pfee_i  = 0
                            sic_bran.uwm101.ptax_i  = 0.
                    END.
                    IF xmm031.insdef = "C" OR xmm031.insdef = "T" THEN DO:
                        
                        IF xmm031.insdef = "C" THEN sic_bran.uwm101.duedat = sic_bran.uwm100.comdat.
                                ELSE uwm101.duedat = uwm100.trndat.
                                nv_tmp_date = uwm101.duedat.
                                nv_d0       = DAY(nv_tmp_date).
                    END.
                END.
                FIND FIRST sic_bran.uwm101 WHERE RECID(sic_bran.uwm101) = n_recid.
                IF AVAILABLE sic_bran.uwm101 THEN DO:
                    sic_bran.uwm101.prem_i = sic_bran.uwm101.prem_i + (sic_bran.uwm100.prem_t - n_ttprem).
                    sic_bran.uwm101.com1_i = sic_bran.uwm101.com1_i + (sic_bran.uwm100.com1_t - n_ttcom1).
                    sic_bran.uwm101.com2_i = sic_bran.uwm101.com2_i + (sic_bran.uwm100.com2_t - n_ttcom2).
                    sic_bran.uwm101.com3_i = sic_bran.uwm101.com3_i + (sic_bran.uwm100.com3_t - n_ttcom3). /*A64-0355*/
                    sic_bran.uwm101.rstp_i = sic_bran.uwm101.rstp_i + (sic_bran.uwm100.rstp_t - n_ttrstp).
                    sic_bran.uwm101.rfee_i = sic_bran.uwm101.rfee_i + (sic_bran.uwm100.rfee_t - n_ttrfee).
                    sic_bran.uwm101.rtax_i = sic_bran.uwm101.rtax_i + (sic_bran.uwm100.rtax_t - n_ttrtax).
                END.
            END.  /*else do: */
            DO transaction:
                FIND sic_bran.uwm101 USE-INDEX uwm10101 WHERE 
                    sic_bran.uwm101.policy = sic_bran.uwm100.policy AND
                    sic_bran.uwm101.rencnt = sic_bran.uwm100.rencnt AND 
                    sic_bran.uwm101.endcnt = sic_bran.uwm100.endcnt AND
                    sic_bran.uwm101.instno = 1  exclusive-lock NO-ERROR.
            END.  /* Transaction */
            
            ASSIGN 
                n_index  = 1 
                n_ttprem = 0 
                n_ttcom1 = 0
                n_ttcom2 = 0
                n_ttcom3 = 0  /*A64-0355*/
                n_ttrstp = 0 
                n_ttrfee = 0
                n_ttrtax = 0
                n_ttpstp = 0
                n_ttpfee = 0
                n_ttptax = 0 
                nv_fi_rstp_t1 = 0
                nv_fi_rstp_t2 = 0
                nv_fi_rstp_t3 = 0
                nv_com1p_ins1 = 0
                nv_com1p_ins2 = 0
                nv_com1p_ins3 = 0
                nv_com3p_ins1 = 0   /*A64-0355*/
                nv_com3p_ins2 = 0   /*A64-0355*/
                nv_com3p_ins3 = 0.  /*A64-0355*/
        END.  /* if */
END. /*End 100 */
RELEASE sic_bran.uwm101.
RELEASE sic_bran.uwm100.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_instot1-01 C-Win 
PROCEDURE proc_instot1-01 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
/**  uwo10085.p - NEW POLICY ENTRY - INSTALMENTS  **/
/*
DEFINE        VAR n_recid   AS RECID.                                       
DEFINE        VAR n_ttprem  LIKE sic_bran.uwm100.prem_t.                   
DEFINE        VAR n_ttcom1  LIKE sic_bran.uwm100.com1_t.                    
DEFINE        VAR n_ttcom2  LIKE sic_bran.uwm100.com2_t.                    
DEFINE        VAR n_ttrstp  LIKE sic_bran.uwm100.rstp_t.                    
DEFINE        VAR n_ttrfee  LIKE sic_bran.uwm100.rfee_t.                    
DEFINE        VAR n_ttrtax  LIKE sic_bran.uwm100.rtax_t.                    
DEFINE        VAR n_ttpstp  LIKE sic_bran.uwm100.rstp_t.                    
DEFINE        VAR n_ttpfee  LIKE sic_bran.uwm100.rfee_t.                    
DEFINE        VAR n_ttptax  LIKE sic_bran.uwm100.rtax_t.                    
DEFINE        VAR n_index   AS INTEGER.                                    
DEFINE        VAR nv_d0     AS INT.                                         
DEFINE        VAR nv_tmp_date AS DATE.                                      
/*DEFINE  VAR s_recid1      AS RECID NO-UNDO.        /** uwm100 recid **/
DEFINE  VAR  nv_batchyr   AS INT FORMAT "9999"            INIT 2015.
DEFINE  VAR  nv_batcnt    AS INT FORMAT "99"              INIT 1.
DEFINE  VAR  nv_batchno   AS CHARACTER FORMAT "X(18)"     INIT "B3M00170M0044"  NO-UNDO.*/
DEF VAR nv_fi_rstp_t1       AS DECI INIT 0.
DEF VAR nv_fi_rstp_t2       AS DECI INIT 0.
DEF VAR nv_fi_rstp_t3       AS DECI INIT 0.
DEF VAR nv_com1p_ins1       AS DECI INIT 0.
DEF VAR nv_com1p_ins2       AS DECI INIT 0.
DEF VAR nv_com1p_ins3       AS DECI INIT 0.
DEF VAR nv_prem01           AS DECI INIT 0.
DEF VAR nv_prem02           AS DECI INIT 0.
DEF VAR nv_prem03           AS DECI INIT 0.

/*
DEF VAR nv_fi_tax_per_ins   AS DECI .
DEF VAR nv_fi_stamp_per_ins AS DECI .*/
/*
nv_com1p_ins       
nv_fi_tax_per_ins  
nv_fi_stamp_per_ins*/
/*FIND uwm100 WHERE            RECID(uwm100)           = s_recid1 exclusive-lock NO-ERROR.*/
FIND sic_bran.uwm100   Where Recid(sic_bran.uwm100)  = s_recid1 no-error no-wait.
/*FIND LAST  sic_bran.uwm100   Where 
    sic_bran.uwm100.policy = wdetail.policyno AND 
    sic_bran.uwm100.bchyr  = nv_batchyr       AND 
    sic_bran.uwm100.bchno  = nv_batchno       AND 
    sic_bran.uwm100.bchcnt = nv_batcnt        no-error no-wait.*/
IF AVAILABLE sic_bran.uwm100  THEN DO:
    ASSIGN 
        s_recid1 = RECID(sic_bran.uwm100)
        sic_bran.uwm100.instot = wdetail.instot  
        nv_fi_rstp_t1 = 0
        nv_fi_rstp_t2 = 0
        nv_fi_rstp_t3 = 0
        nv_com1p_ins1 = 0
        nv_com1p_ins2 = 0
        nv_com1p_ins3 = 0
        nv_prem01     = 0  
        nv_prem02     = 0  
        nv_prem03     = 0  .

    FIND LAST winst WHERE winst.policyno = sic_bran.uwm100.policy NO-LOCK NO-ERROR .
    
    IF wdetail3.instot = 2 THEN DO:
        ASSIGN 
            nv_prem02 = (TRUNCATE(((deci(wdetail3.premt_re2)  * 100 ) / 107.43),0))       
            nv_prem01 = sic_bran.uwm100.prem_t - nv_prem02.                               
    END.
    ELSE DO:
        ASSIGN 
            nv_prem03 = (TRUNCATE(((deci(wdetail3.premt_re3)  * 100 ) / 107.43),0))
            nv_prem02 = (TRUNCATE(((deci(wdetail3.premt_re2)  * 100 ) / 107.43),0))
            nv_prem01 = sic_bran.uwm100.prem_t - nv_prem02 - nv_prem03.
    END.

    IF nv_prem01 > 0 THEN 
        ASSIGN 
        nv_com1p_ins1 = (nv_prem01 * nv_com1p_ins ) / 100
        nv_fi_rstp_t1 = Truncate(nv_prem01 * nv_fi_stamp_per_ins  / 100,0)  + 
                        IF      (nv_prem01 * nv_fi_stamp_per_ins  / 100) -
                        Truncate(nv_prem01 * nv_fi_stamp_per_ins  / 100,0) > 0 Then 1 Else 0.
    IF nv_prem02 > 0 THEN 
        ASSIGN 
        nv_com1p_ins2 = (nv_prem02 * nv_com1p_ins ) / 100
        nv_fi_rstp_t2 = Truncate(nv_prem02 * nv_fi_stamp_per_ins / 100,0) + 
                            (IF (nv_prem02 * nv_fi_stamp_per_ins / 100) - 
                        Truncate(nv_prem02 * nv_fi_stamp_per_ins / 100,0) > 0 Then 1 Else 0 ).
    IF nv_prem03 > 0 THEN   
        ASSIGN 
        nv_com1p_ins3 = (nv_prem03 * nv_com1p_ins ) / 100
        nv_fi_rstp_t3 = Truncate(nv_prem03 * nv_fi_stamp_per_ins / 100,0) + 
                            (IF (nv_prem03 * nv_fi_stamp_per_ins / 100) - 
                        Truncate(nv_prem03 * nv_fi_stamp_per_ins / 100,0) > 0 Then 1 Else 0 ).

    FIND FIRST sic_bran.uwm101  USE-INDEX uwm10101 WHERE
        sic_bran.uwm101.policy = sic_bran.uwm100.policy  AND
        sic_bran.uwm101.rencnt = sic_bran.uwm100.rencnt  AND
        sic_bran.uwm101.endcnt = sic_bran.uwm100.endcnt  AND
        sic_bran.uwm101.bchyr  = nv_batchyr     AND
        sic_bran.uwm101.bchno  = nv_batchno     AND
        sic_bran.uwm101.bchcnt = nv_batcnt      NO-LOCK NO-ERROR NO-WAIT.
    IF AVAILABLE sic_bran.uwm101  THEN DO:
        FOR EACH sic_bran.uwm101  USE-INDEX uwm10101   WHERE
            sic_bran.uwm101.policy = sic_bran.uwm100.policy  AND
            sic_bran.uwm101.rencnt = sic_bran.uwm100.rencnt  AND
            sic_bran.uwm101.endcnt = sic_bran.uwm100.endcnt  AND
            sic_bran.uwm101.bchyr  = nv_batchyr     AND
            sic_bran.uwm101.bchno  = nv_batchno     AND
            sic_bran.uwm101.bchcnt = nv_batcnt:
            DELETE sic_bran.uwm101.
        END.  /* each uwm101 */
        RELEASE sic_bran.uwm101.
    END.       /* avail uwm101 */
    IF sic_bran.uwm100.instot > 1 THEN DO: 
        ASSIGN 
            n_ttprem = 0
            n_ttcom1 = 0
            n_ttcom2 = 0
            n_ttpstp = 0
            n_ttpfee = 0
            n_ttptax = 0
            n_ttrstp = 0
            n_ttrfee = 0
            n_ttrtax = 0.
        DO transaction:
            FIND sic_bran.uwm100 WHERE RECID(sic_bran.uwm100) = s_recid1 exclusive-lock NO-ERROR.
        END.
        FIND sicsyac.xmm031 USE-INDEX xmm03101 WHERE xmm031.poltyp = sic_bran.uwm100.poltyp NO-LOCK NO-ERROR.
        Do transaction:
            FIND sic_bran.uwm101 USE-INDEX uwm10101 WHERE 
                sic_bran.uwm101.policy = sic_bran.uwm100.policy AND
                sic_bran.uwm101.rencnt = sic_bran.uwm100.rencnt AND 
                sic_bran.uwm101.endcnt = sic_bran.uwm100.endcnt AND
                sic_bran.uwm101.bchyr  = nv_batchyr             AND
                sic_bran.uwm101.bchno  = nv_batchno             AND
                sic_bran.uwm101.bchcnt = nv_batcnt              AND
                sic_bran.uwm101.instno = 1 exclusive-lock NO-ERROR.
        END.
        IF NOT AVAILABLE sic_bran.uwm101 THEN DO transaction:
            REPEAT n_index = 1 TO sic_bran.uwm100.instot:
                CREATE sic_bran.uwm101.
                ASSIGN 
                    sic_bran.uwm101.policy = sic_bran.uwm100.policy 
                    sic_bran.uwm101.rencnt = sic_bran.uwm100.rencnt 
                    sic_bran.uwm101.endcnt = sic_bran.uwm100.endcnt
                    sic_bran.uwm101.bchyr  = nv_batchyr        
                    sic_bran.uwm101.bchno  = nv_batchno            
                    sic_bran.uwm101.bchcnt = nv_batcnt  
                    sic_bran.uwm101.instno = n_index
                    sic_bran.uwm101.prem_i = IF      n_index = 1 THEN nv_prem01
                                             ELSE IF n_index = 2 THEN nv_prem02
                                                                 ELSE nv_prem03
                    sic_bran.uwm101.com1_i = IF      n_index = 1 THEN nv_com1p_ins1 * ( -1 )
                                             ELSE IF n_index = 2 THEN nv_com1p_ins2 * ( -1 )
                                                                 ELSE nv_com1p_ins3 * ( -1 )
                    sic_bran.uwm101.com2_i = 0.00
                    sic_bran.uwm101.rstp_i = IF      n_index = 1 THEN nv_fi_rstp_t1
                                             ELSE IF n_index = 2 THEN nv_fi_rstp_t2
                                             ELSE                     nv_fi_rstp_t3   
                    sic_bran.uwm101.rfee_i = 0.00
                    sic_bran.uwm101.rtax_i = IF      n_index = 1 THEN (nv_prem01 + nv_fi_rstp_t1) * nv_fi_tax_per_ins / 100
                                             ELSE IF n_index = 2 THEN (nv_prem02 + nv_fi_rstp_t2) * nv_fi_tax_per_ins / 100
                                                                 ELSE (nv_prem03 + nv_fi_rstp_t3) * nv_fi_tax_per_ins / 100
                    n_ttprem               = n_ttprem + sic_bran.uwm101.prem_i 
                    n_ttcom1               = n_ttcom1 + sic_bran.uwm101.com1_i
                    n_ttcom2               = n_ttcom2 + sic_bran.uwm101.com2_i
                    n_ttrstp               = n_ttrstp + sic_bran.uwm101.rstp_i
                    n_ttrfee               = n_ttrfee + sic_bran.uwm101.rfee_i
                    n_ttrtax               = n_ttrtax + sic_bran.uwm101.rtax_i
                    sic_bran.uwm101.desc_i = IF      n_index = 1 THEN wdetail3.companyre1
                                             ELSE IF n_index = 2 THEN wdetail3.companyre2
                                                                 ELSE wdetail3.companyre3
                    sic_bran.uwm101.trty1i = ""
                    sic_bran.uwm101.docnoi = "".
                IF n_index = 1 THEN DO:
                    ASSIGN 
                    n_recid                = RECID(sic_bran.uwm101) 
                    sic_bran.uwm101.pstp_i = sic_bran.uwm100.pstp 
                    sic_bran.uwm101.pfee_i = sic_bran.uwm100.pfee
                    sic_bran.uwm101.ptax_i = sic_bran.uwm100.ptax.
                END.
                ELSE DO:
                    ASSIGN 
                        sic_bran.uwm101.pstp_i  = 0 
                        sic_bran.uwm101.pfee_i  = 0
                        sic_bran.uwm101.ptax_i  = 0.
                END.
                IF xmm031.insdef = "C" OR xmm031.insdef = "T" THEN DO:
                    
                    IF xmm031.insdef = "C" THEN sic_bran.uwm101.duedat = sic_bran.uwm100.comdat.
                            ELSE uwm101.duedat = uwm100.trndat.
                            nv_tmp_date = uwm101.duedat.
                            nv_d0       = DAY(nv_tmp_date).
                END.
            END.
            FIND FIRST sic_bran.uwm101 WHERE RECID(sic_bran.uwm101) = n_recid.
            IF AVAILABLE sic_bran.uwm101 THEN DO:
                sic_bran.uwm101.prem_i = sic_bran.uwm101.prem_i + (sic_bran.uwm100.prem_t - n_ttprem).
                /*sic_bran.uwm101.com1_i = sic_bran.uwm101.com1_i + (sic_bran.uwm100.com1_t - n_ttcom1).*/
                sic_bran.uwm101.com2_i = sic_bran.uwm101.com2_i + (sic_bran.uwm100.com2_t - n_ttcom2).
                sic_bran.uwm101.rstp_i = sic_bran.uwm101.rstp_i + (sic_bran.uwm100.rstp_t - n_ttrstp).
                sic_bran.uwm101.rfee_i = sic_bran.uwm101.rfee_i + (sic_bran.uwm100.rfee_t - n_ttrfee).
                sic_bran.uwm101.rtax_i = sic_bran.uwm101.rtax_i + (sic_bran.uwm100.rtax_t - n_ttrtax).
            END.
        END.  /*else do: */
        DO transaction:
            FIND sic_bran.uwm101 USE-INDEX uwm10101 WHERE 
                sic_bran.uwm101.policy = sic_bran.uwm100.policy AND
                sic_bran.uwm101.rencnt = sic_bran.uwm100.rencnt AND 
                sic_bran.uwm101.endcnt = sic_bran.uwm100.endcnt AND
                sic_bran.uwm101.instno = 1  exclusive-lock NO-ERROR.
        END.  /* Transaction */
        ASSIGN 
            n_index  = 1 
            n_ttprem = 0 
            n_ttcom1 = 0
            n_ttcom2 = 0
            n_ttrstp = 0 
            n_ttrfee = 0
            n_ttrtax = 0
            n_ttpstp = 0
            n_ttpfee = 0
            n_ttptax = 0 
            nv_fi_rstp_t1 = 0
            nv_fi_rstp_t2 = 0
            nv_fi_rstp_t3 = 0
            nv_com1p_ins1 = 0
            nv_com1p_ins2 = 0
            nv_com1p_ins3 = 0.
    END.  /* if */
END. /*End 100 */
RELEASE sic_bran.uwm101.
RELEASE sic_bran.uwm100.*/
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_instot2 C-Win 
PROCEDURE proc_instot2 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes: คำนวณเบี้ยเอง      
------------------------------------------------------------------------------*/
/**  uwo10085.p - NEW POLICY ENTRY - INSTALMENTS  **/

DEFINE        VAR n_recid   AS RECID.                                       
DEFINE        VAR n_ttprem  LIKE sic_bran.uwm100.prem_t.                   
DEFINE        VAR n_ttcom1  LIKE sic_bran.uwm100.com1_t.                    
DEFINE        VAR n_ttcom2  LIKE sic_bran.uwm100.com2_t.                    
DEFINE        VAR n_ttrstp  LIKE sic_bran.uwm100.rstp_t.                    
DEFINE        VAR n_ttrfee  LIKE sic_bran.uwm100.rfee_t.                    
DEFINE        VAR n_ttrtax  LIKE sic_bran.uwm100.rtax_t.                    
DEFINE        VAR n_ttpstp  LIKE sic_bran.uwm100.rstp_t.                    
DEFINE        VAR n_ttpfee  LIKE sic_bran.uwm100.rfee_t.                    
DEFINE        VAR n_ttptax  LIKE sic_bran.uwm100.rtax_t.                    
DEFINE        VAR n_index   AS INTEGER.                                    
DEFINE        VAR nv_d0     AS INT.                                         
DEFINE        VAR nv_tmp_date AS DATE.                                      
DEF VAR nv_fi_rstp_t1       AS DECI INIT 0.
DEF VAR nv_fi_rstp_t2       AS DECI INIT 0.
DEF VAR nv_fi_rstp_t3       AS DECI INIT 0.
DEF VAR nv_com1p_ins1       AS DECI INIT 0.
DEF VAR nv_com1p_ins2       AS DECI INIT 0.
DEF VAR nv_com1p_ins3       AS DECI INIT 0.
DEF VAR nv_prem01           AS DECI INIT 0.
DEF VAR nv_prem02           AS DECI INIT 0.
DEF VAR nv_prem03           AS DECI INIT 0.

/* add by : A64-0355 */
DEF VAR n_ttcom3            LIKE sic_bran.uwm100.com3_t. 
DEF VAR nv_com3p_ins1       AS DECI INIT 0.
DEF VAR nv_com3p_ins2       AS DECI INIT 0.
DEF VAR nv_com3p_ins3       AS DECI INIT 0.
/* end A64-0355 */

FIND sic_bran.uwm100   Where Recid(sic_bran.uwm100)  = s_recid1 no-error no-wait.
IF AVAILABLE sic_bran.uwm100  THEN DO:
    ASSIGN 
        s_recid1 = RECID(sic_bran.uwm100)
        sic_bran.uwm100.instot = wdetail.instot  
        nv_fi_rstp_t1 = 0
        nv_fi_rstp_t2 = 0
        nv_fi_rstp_t3 = 0
        nv_com1p_ins1 = 0
        nv_com1p_ins2 = 0
        nv_com1p_ins3 = 0
        nv_prem01     = 0  
        nv_prem02     = 0  
        nv_prem03     = 0  
        nv_com3p_ins1 = 0   /*A64-0355*/
        nv_com3p_ins2 = 0   /*A64-0355*/
        nv_com3p_ins3 = 0 . /*A64-0355*/

    FIND LAST winst WHERE winst.policyno = sic_bran.uwm100.policy AND winst.instot = wdetail.instot NO-LOCK NO-ERROR .

    IF winst.instot = 2 THEN DO:
        ASSIGN 
            nv_prem02 = winst.instprm2       
            nv_prem01 = winst.instprm1.
    END.
    ELSE DO:
        ASSIGN 
            nv_prem03 = winst.instprm3
            nv_prem02 = winst.instprm2
            nv_prem01 = winst.instprm1.
    END.

    IF nv_prem01 > 0 THEN 
        ASSIGN 
        nv_com1p_ins1 = (nv_prem01 * nv_com1p_ins) / 100
        nv_com3p_ins1 = (nv_prem01 * nv_com3p_ins) / 100    /*A64-0355*/ 
        nv_fi_rstp_t1 = Truncate(nv_prem01 * nv_fi_stamp_per_ins  / 100,0)  + 
                        IF      (nv_prem01 * nv_fi_stamp_per_ins  / 100) -
                        Truncate(nv_prem01 * nv_fi_stamp_per_ins  / 100,0) > 0 Then 1 Else 0.
    IF nv_prem02 > 0 THEN 
        ASSIGN 
        nv_com1p_ins2 = (nv_prem02 * nv_com1p_ins) / 100
        nv_com3p_ins2 = (nv_prem02 * nv_com3p_ins) / 100    /*A64-0355*/ 
        nv_fi_rstp_t2 = Truncate(nv_prem02 * nv_fi_stamp_per_ins / 100,0) + 
                            (IF (nv_prem02 * nv_fi_stamp_per_ins / 100) - 
                        Truncate(nv_prem02 * nv_fi_stamp_per_ins / 100,0) > 0 Then 1 Else 0 ).
    IF nv_prem03 > 0 THEN   
        ASSIGN 
        nv_com1p_ins3 = (nv_prem03 * nv_com1p_ins ) / 100
        nv_com3p_ins3 = (nv_prem03 * nv_com3p_ins ) / 100   /*A64-0355*/ 
        nv_fi_rstp_t3 = Truncate(nv_prem03 * nv_fi_stamp_per_ins / 100,0) + 
                            (IF (nv_prem03 * nv_fi_stamp_per_ins / 100) - 
                        Truncate(nv_prem03 * nv_fi_stamp_per_ins / 100,0) > 0 Then 1 Else 0 ).

    FIND FIRST sic_bran.uwm101  USE-INDEX uwm10101 WHERE
        sic_bran.uwm101.policy = sic_bran.uwm100.policy  AND
        sic_bran.uwm101.rencnt = sic_bran.uwm100.rencnt  AND
        sic_bran.uwm101.endcnt = sic_bran.uwm100.endcnt  AND
        sic_bran.uwm101.bchyr  = nv_batchyr     AND
        sic_bran.uwm101.bchno  = nv_batchno     AND
        sic_bran.uwm101.bchcnt = nv_batcnt      NO-LOCK NO-ERROR NO-WAIT.
    IF AVAILABLE sic_bran.uwm101  THEN DO:
        FOR EACH sic_bran.uwm101  USE-INDEX uwm10101   WHERE
            sic_bran.uwm101.policy = sic_bran.uwm100.policy  AND
            sic_bran.uwm101.rencnt = sic_bran.uwm100.rencnt  AND
            sic_bran.uwm101.endcnt = sic_bran.uwm100.endcnt  AND
            sic_bran.uwm101.bchyr  = nv_batchyr     AND
            sic_bran.uwm101.bchno  = nv_batchno     AND
            sic_bran.uwm101.bchcnt = nv_batcnt:
            DELETE sic_bran.uwm101.
        END.  /* each uwm101 */
        RELEASE sic_bran.uwm101.
    END.       /* avail uwm101 */
    IF sic_bran.uwm100.instot > 1 THEN DO: 
        ASSIGN 
            n_ttprem = 0
            n_ttcom1 = 0
            n_ttcom2 = 0
            n_ttcom3 = 0 /* A64-0355*/
            n_ttpstp = 0
            n_ttpfee = 0
            n_ttptax = 0
            n_ttrstp = 0
            n_ttrfee = 0
            n_ttrtax = 0.
        DO transaction:
            FIND sic_bran.uwm100 WHERE RECID(sic_bran.uwm100) = s_recid1 exclusive-lock NO-ERROR.
        END.
        FIND sicsyac.xmm031 USE-INDEX xmm03101 WHERE xmm031.poltyp = sic_bran.uwm100.poltyp NO-LOCK NO-ERROR.
        Do transaction:
            FIND sic_bran.uwm101 USE-INDEX uwm10101 WHERE 
                sic_bran.uwm101.policy = sic_bran.uwm100.policy AND
                sic_bran.uwm101.rencnt = sic_bran.uwm100.rencnt AND 
                sic_bran.uwm101.endcnt = sic_bran.uwm100.endcnt AND
                sic_bran.uwm101.bchyr  = nv_batchyr             AND
                sic_bran.uwm101.bchno  = nv_batchno             AND
                sic_bran.uwm101.bchcnt = nv_batcnt              AND
                sic_bran.uwm101.instno = 1 exclusive-lock NO-ERROR.
        END.
        IF NOT AVAILABLE sic_bran.uwm101 THEN DO transaction:
            REPEAT n_index = 1 TO sic_bran.uwm100.instot:
                CREATE sic_bran.uwm101.
                ASSIGN 
                    sic_bran.uwm101.policy = sic_bran.uwm100.policy 
                    sic_bran.uwm101.rencnt = sic_bran.uwm100.rencnt 
                    sic_bran.uwm101.endcnt = sic_bran.uwm100.endcnt
                    sic_bran.uwm101.bchyr  = nv_batchyr        
                    sic_bran.uwm101.bchno  = nv_batchno            
                    sic_bran.uwm101.bchcnt = nv_batcnt  
                    sic_bran.uwm101.instno = n_index
                    sic_bran.uwm101.prem_i = IF      n_index = 1 THEN nv_prem01
                                             ELSE IF n_index = 2 THEN nv_prem02
                                                                 ELSE nv_prem03
                    sic_bran.uwm101.com1_i = IF      n_index = 1 THEN nv_com1p_ins1 * ( -1 )
                                             ELSE IF n_index = 2 THEN nv_com1p_ins2 * ( -1 )
                                                                 ELSE nv_com1p_ins3 * ( -1 )
                    sic_bran.uwm101.com2_i = 0.00
                    /* Add by : A64-0355 */
                    sic_bran.uwm101.com3_i = IF      n_index = 1 THEN nv_com3p_ins1 * ( -1 )
                                             ELSE IF n_index = 2 THEN nv_com3p_ins2 * ( -1 )
                                                                 ELSE nv_com3p_ins3 * ( -1 )
                    /* end A64-0355 */
                    sic_bran.uwm101.rstp_i = IF      n_index = 1 THEN nv_fi_rstp_t1
                                             ELSE IF n_index = 2 THEN nv_fi_rstp_t2
                                             ELSE                     nv_fi_rstp_t3   
                    sic_bran.uwm101.rfee_i = 0.00
                    sic_bran.uwm101.rtax_i = IF      n_index = 1 THEN (nv_prem01 + nv_fi_rstp_t1) * nv_fi_tax_per_ins / 100
                                             ELSE IF n_index = 2 THEN (nv_prem02 + nv_fi_rstp_t2) * nv_fi_tax_per_ins / 100
                                                                 ELSE (nv_prem03 + nv_fi_rstp_t3) * nv_fi_tax_per_ins / 100
                    n_ttprem               = n_ttprem + sic_bran.uwm101.prem_i 
                    n_ttcom1               = n_ttcom1 + sic_bran.uwm101.com1_i
                    n_ttcom2               = n_ttcom2 + sic_bran.uwm101.com2_i
                    n_ttcom3               = n_ttcom3 + sic_bran.uwm101.com3_i  /*A64-0355*/
                    n_ttrstp               = n_ttrstp + sic_bran.uwm101.rstp_i
                    n_ttrfee               = n_ttrfee + sic_bran.uwm101.rfee_i
                    n_ttrtax               = n_ttrtax + sic_bran.uwm101.rtax_i
                    sic_bran.uwm101.desc_i = IF      n_index = 1 THEN winst.instcod1 + " " + 
                                                                      winst.insttitle1 + " " + winst.instname1 + " " + winst.instlname1
                                             ELSE IF n_index = 2 THEN winst.instcod2 + " " + 
                                                                      winst.insttitle2 + " " + winst.instname2 + " " + winst.instlname2
                                             ELSE                     winst.instcod3 + " " + 
                                                                      winst.insttitle3 + " " + winst.instname3 + " " + winst.instlname3
                    sic_bran.uwm101.trty1i = ""
                    sic_bran.uwm101.docnoi = ""
                    sic_bran.uwm101.flgprn  = "Y" . /*A66-0202*/

                IF n_index = 1 THEN DO:
                    ASSIGN 
                    n_recid                = RECID(sic_bran.uwm101) 
                    sic_bran.uwm101.pstp_i = sic_bran.uwm100.pstp 
                    sic_bran.uwm101.pfee_i = sic_bran.uwm100.pfee
                    sic_bran.uwm101.ptax_i = sic_bran.uwm100.ptax.
                END.
                ELSE DO:
                    ASSIGN 
                        sic_bran.uwm101.pstp_i  = 0 
                        sic_bran.uwm101.pfee_i  = 0
                        sic_bran.uwm101.ptax_i  = 0.
                END.
                IF xmm031.insdef = "C" OR xmm031.insdef = "T" THEN DO:
                    
                    IF xmm031.insdef = "C" THEN sic_bran.uwm101.duedat = sic_bran.uwm100.comdat.
                            ELSE uwm101.duedat = uwm100.trndat.
                            nv_tmp_date = uwm101.duedat.
                            nv_d0       = DAY(nv_tmp_date).
                END.
            END.
            FIND FIRST sic_bran.uwm101 WHERE RECID(sic_bran.uwm101) = n_recid.
            IF AVAILABLE sic_bran.uwm101 THEN DO:
                sic_bran.uwm101.prem_i = sic_bran.uwm101.prem_i + (sic_bran.uwm100.prem_t - n_ttprem).
                sic_bran.uwm101.com1_i = sic_bran.uwm101.com1_i + (sic_bran.uwm100.com1_t - n_ttcom1).
                sic_bran.uwm101.com2_i = sic_bran.uwm101.com2_i + (sic_bran.uwm100.com2_t - n_ttcom2).
                sic_bran.uwm101.com3_i = sic_bran.uwm101.com3_i + (sic_bran.uwm100.com3_t - n_ttcom3).
                sic_bran.uwm101.rstp_i = sic_bran.uwm101.rstp_i + (sic_bran.uwm100.rstp_t - n_ttrstp).
                sic_bran.uwm101.rfee_i = sic_bran.uwm101.rfee_i + (sic_bran.uwm100.rfee_t - n_ttrfee).
                sic_bran.uwm101.rtax_i = sic_bran.uwm101.rtax_i + (sic_bran.uwm100.rtax_t - n_ttrtax).
            END.
        END.  /*else do: */
        DO transaction:
            FIND sic_bran.uwm101 USE-INDEX uwm10101 WHERE 
                sic_bran.uwm101.policy = sic_bran.uwm100.policy AND
                sic_bran.uwm101.rencnt = sic_bran.uwm100.rencnt AND 
                sic_bran.uwm101.endcnt = sic_bran.uwm100.endcnt AND
                sic_bran.uwm101.instno = 1  exclusive-lock NO-ERROR.
        END.  /* Transaction */
        /* add by : Ranu I. A64-0355 */
        /*IF n_ttprem <> sic_bran.uwm100.prem_t THEN DO:
            ASSIGN wdetail.comment = wdetail.comment + "|เบี้ยรวม Instament : " + string(n_ttprem)  + 
                   " ไม่เท่ากับเบี้ยสุทธิของ กธ. : " + STRING(sic_bran.uwm100.prem_t) .
        END.
        
        IF n_ttcom1 <> sic_bran.uwm100.com1_t THEN DO:
            ASSIGN wdetail.comment = wdetail.comment + "|เบี้ย Comm. Instament : " + string(n_ttcom1)  + 
                   " ไม่เท่ากับเบี้ย Comm. ของ กธ. : " + STRING(sic_bran.uwm100.com1_t) .
        END.
        IF n_ttrstp <>  uwm100.rstp_t then do:
            ASSIGN wdetail.comment = wdetail.comment + "|เบี้ยอากรรวม Instament : " + string(n_ttrstp)  + 
                   " ไม่เท่ากับเบี้ยอากรของ กธ. : " + STRING(uwm100.rstp_t) .
        END.
        
        if n_ttrtax <>  uwm100.rtax_t then do: 
            ASSIGN wdetail.comment = wdetail.comment + "|เบี้ย Tax รวม Instament : " + string(n_ttrtax)  + 
                   " ไม่เท่ากับเบี้ย Tax ของ กธ. : " + STRING(uwm100.rtax_t) .
        END.*/
        /* end : Ranu I. A64-0355 */
        ASSIGN 
            n_index  = 1 
            n_ttprem = 0 
            n_ttcom1 = 0
            n_ttcom2 = 0
            n_ttrstp = 0 
            n_ttrfee = 0
            n_ttrtax = 0
            n_ttpstp = 0
            n_ttpfee = 0
            n_ttptax = 0 
            nv_fi_rstp_t1 = 0
            nv_fi_rstp_t2 = 0
            nv_fi_rstp_t3 = 0
            nv_com1p_ins1 = 0
            nv_com1p_ins2 = 0
            nv_com1p_ins3 = 0
            n_ttcom3 = 0        /* A64-0355*/
            nv_com3p_ins1 = 0   /* A64-0355*/
            nv_com3p_ins2 = 0   /* A64-0355*/
            nv_com3p_ins3 = 0 . /* A64-0355*/
    END.  /* if */
END. /*End 100 */
RELEASE sic_bran.uwm101.
RELEASE sic_bran.uwm100.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_mailtxt C-Win 
PROCEDURE proc_mailtxt :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
FIND  LAST brstat.mailtxt_fil  USE-INDEX  mailtxt01  WHERE
           brstat.mailtxt_fil.policy  = no_policy + no_rencnt + no_endcnt +  no_riskno + no_itemno  AND
           brstat.mailtxt_fil.bchyr   = nv_batchyr   AND                                               
           brstat.mailtxt_fil.bchno   = nv_batchno   AND
           brstat.mailtxt_fil.bchcnt  = nv_batcnt    AND 
           brstat.mailtxt_fil.lnumber = n_count      NO-ERROR  NO-WAIT.
    IF NOT AVAIL brstat.mailtxt_fil THEN DO:  
          nv_lnumber =  n_count.  
          CREATE brstat.mailtxt_fil.
          ASSIGN                                           
                 brstat.mailtxt_fil.policy  = no_policy + no_rencnt + no_endcnt +  no_riskno + no_itemno
                 brstat.mailtxt_fil.bchyr   = nv_batchyr   
                 brstat.mailtxt_fil.bchno   = nv_batchno   
                 brstat.mailtxt_fil.bchcnt  = nv_batcnt 

                 brstat.mailtxt_fil.lnumber   = nv_lnumber
                 brstat.mailtxt_fil.ltext     = nv_drinam + FILL(" ",50 - LENGTH(nv_drinam)) + nv_dgender  
                 brstat.mailtxt_fil.ltext2    = nv_dbirth + "  " + string(nv_dage)  /* พ.ศ. */
                 SUBSTRING(brstat.mailtxt_fil.ltext2,16,40)   =  IF nv_doccup  = "" THEN "-" ELSE nv_doccup 
                 SUBSTRING(brstat.mailtxt_fil.ltext2,101,50)  =  nv_dicno
                 SUBSTRING(brstat.mailtxt_fil.ltext2,151,50)  =  nv_ddriveno 
                 SUBSTRING(brstat.mailtxt_fil.ltext2,201,4)   =  "" 
                 brstat.mailtxt_fil.titlenam   = nv_ntitle
                 brstat.mailtxt_fil.firstnam   = nv_name  
                 brstat.mailtxt_fil.lastnam    = nv_lname 
                 brstat.mailtxt_fil.drivbirth  = IF trim(nv_dribirth) <> "" THEN date(nv_dribirth) ELSE ? /* ค.ศ */
                 brstat.mailtxt_fil.drivage    = nv_dage
                 brstat.mailtxt_fil.occupcod   = "-" 
                 brstat.mailtxt_fil.drividno   = nv_dicno
                 brstat.mailtxt_fil.licenno    = nv_ddriveno
                 brstat.mailtxt_fil.gender     = nv_dgender
                 brstat.mailtxt_fil.drivlevel  = nv_dlevel
                 brstat.mailtxt_fil.levelper   = deci(nv_dlevper)
                 brstat.mailtxt_fil.licenexp   = IF trim(nv_drivexp) <> "" THEN DATE(nv_drivexp) ELSE ?
                 brstat.mailtxt_fil.dconsen    = IF nv_dconsent = "N" THEN NO ELSE YES 
                 brstat.mailtxt_fil.occupdes   = IF nv_doccup  = "" THEN "-" ELSE nv_doccup
                 brstat.mailtxt_fil.cardflg    = "" .
    END. /*End Avail Brstat*/
    ELSE DO:
        nv_lnumber =  n_count. 
        ASSIGN                                           
             brstat.mailtxt_fil.policy  = no_policy + no_rencnt + no_endcnt +  no_riskno + no_itemno
             brstat.mailtxt_fil.bchyr   = nv_batchyr   
             brstat.mailtxt_fil.bchno   = nv_batchno   
             brstat.mailtxt_fil.bchcnt  = nv_batcnt 
        
             brstat.mailtxt_fil.lnumber   = nv_lnumber
             brstat.mailtxt_fil.ltext     = nv_drinam + FILL(" ",50 - LENGTH(nv_drinam)) + nv_dgender  
             brstat.mailtxt_fil.ltext2    = nv_dbirth + "  " + string(nv_dage)  /* พ.ศ. */
             SUBSTRING(brstat.mailtxt_fil.ltext2,16,40)   =  IF nv_doccup  = "" THEN "-" ELSE nv_doccup 
             SUBSTRING(brstat.mailtxt_fil.ltext2,101,50)  =  nv_dicno
             SUBSTRING(brstat.mailtxt_fil.ltext2,151,50)  =  nv_ddriveno 
             SUBSTRING(brstat.mailtxt_fil.ltext2,201,4)   =  "" 
             brstat.mailtxt_fil.titlenam   = nv_ntitle
             brstat.mailtxt_fil.firstnam   = nv_name  
             brstat.mailtxt_fil.lastnam    = nv_lname 
             brstat.mailtxt_fil.drivbirth  = IF trim(nv_dribirth) <> "" THEN date(nv_dribirth) ELSE ? /* ค.ศ. */
             brstat.mailtxt_fil.drivage    = nv_dage
             brstat.mailtxt_fil.occupcod   = "-"  
             brstat.mailtxt_fil.drividno   = nv_dicno
             brstat.mailtxt_fil.licenno    = nv_ddriveno
             brstat.mailtxt_fil.gender     = nv_dgender
             brstat.mailtxt_fil.drivlevel  = nv_dlevel
             brstat.mailtxt_fil.levelper   = deci(nv_dlevper)
             brstat.mailtxt_fil.licenexp   = IF trim(nv_drivexp) <> "" THEN DATE(nv_drivexp) ELSE ?
             brstat.mailtxt_fil.dconsen    = IF nv_dconsent = "N" THEN NO ELSE YES 
             brstat.mailtxt_fil.occupdes   = IF nv_doccup  = "" THEN "-" ELSE nv_doccup
             brstat.mailtxt_fil.cardflg    = "" .
    END.
    RELEASE brstat.mailtxt_fil .
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_maktab C-Win 
PROCEDURE proc_maktab :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
FIND FIRST stat.makdes31 USE-INDEX makdes31 WHERE 
    makdes31.moddes =  wdetail.prempa + wdetail.subclass NO-LOCK NO-ERROR NO-WAIT.
IF AVAIL makdes31  THEN
    ASSIGN n_ratmin = makdes31.si_theft_p   
    n_ratmax = makdes31.load_p   .    
ELSE ASSIGN n_ratmin = 0
    n_ratmax = 0.

IF (wdetail.si = 0 ) THEN DO:
    Find First stat.maktab_fil USE-INDEX maktab04    Where
        stat.maktab_fil.makdes   =     wdetail.brand            And                  
        index(stat.maktab_fil.moddes,wdetail.model) <> 0        And
        stat.maktab_fil.makyea   =     Integer(wdetail.yrmanu) AND 
        stat.maktab_fil.sclass   =     wdetail.subclass        AND
        stat.maktab_fil.seats    =     INTEGER(wdetail.seat)    No-lock no-error no-wait.
    If  avail stat.maktab_fil  Then DO:
        ASSIGN  wdetail.redbook  =  stat.maktab_fil.modcod
        sic_bran.uwm301.modcod   =  stat.maktab_fil.modcod                                    
        wdetail.cargrp           =  stat.maktab_fil.prmpac
        sic_bran.uwm301.vehgrp   =  stat.maktab_fil.prmpac
        /*sic_bran.uwm301.body   =  stat.maktab_fil.body*/
        /*sic_bran.uwm301.engine =  stat.maktab_fil.eng*/
        nv_engine                =  stat.maktab_fil.engine
        wdetail.seat41           =  IF wdetail.seat41 = 0 THEN stat.maktab_fil.seats ELSE wdetail.seat41.  /*A64-0044*/
        IF sic_bran.uwm301.maksi = 0 AND SUBSTR(wdetail.subclass,1,1) = "E" THEN sic_bran.uwm301.maksi = stat.maktab_fil.maksi . /*A67-0029*/
    END.
END.
ELSE DO:
    Find First stat.maktab_fil USE-INDEX maktab04    Where
        stat.maktab_fil.makdes   =     wdetail.brand            And                  
        index(stat.maktab_fil.moddes,wdetail.model) <> 0        And
        stat.maktab_fil.makyea   =     Integer(wdetail.yrmanu) AND 
        stat.maktab_fil.engine   =     Integer(wdetail.engcc)   AND
        stat.maktab_fil.sclass   =     wdetail.subclass        AND
        (stat.maktab_fil.si - (stat.maktab_fil.si * n_ratmin / 100 ) LE  deci(wdetail.si)    AND
         stat.maktab_fil.si + (stat.maktab_fil.si * n_ratmax / 100 ) GE  deci(wdetail.si) )  AND  
        stat.maktab_fil.seats    =     INTEGER(wdetail.seat)     No-lock no-error no-wait.
    If  avail stat.maktab_fil  Then DO:
        ASSIGN  wdetail.redbook =  stat.maktab_fil.modcod
        sic_bran.uwm301.modcod  =  stat.maktab_fil.modcod                                    
        wdetail.cargrp          =  stat.maktab_fil.prmpac
        sic_bran.uwm301.vehgrp  =  stat.maktab_fil.prmpac
        /*sic_bran.uwm301.engine  =  stat.maktab_fil.eng*/
        nv_engine               =  stat.maktab_fil.engine
        wdetail.seat41          =  IF wdetail.seat41 = 0 THEN stat.maktab_fil.seats ELSE wdetail.seat41.  /*A64-0044*/
        IF sic_bran.uwm301.maksi = 0 AND SUBSTR(wdetail.subclass,1,1) = "E" THEN sic_bran.uwm301.maksi = stat.maktab_fil.maksi . /*A67-0029*/
    END.
END.
IF wdetail.redbook = "" THEN DO:
    Find First stat.maktab_fil USE-INDEX maktab04    Where
        stat.maktab_fil.makdes   =     wdetail.brand            And                  
        index(stat.maktab_fil.moddes,wdetail.model) <> 0        And
        stat.maktab_fil.makyea   =     Integer(wdetail.yrmanu) AND 
        stat.maktab_fil.sclass   =     wdetail.subclass        AND
        stat.maktab_fil.seats    =     INTEGER(wdetail.seat)    No-lock no-error no-wait.
    If  avail stat.maktab_fil  Then DO:
        ASSIGN  wdetail.redbook   =  stat.maktab_fil.modcod
        sic_bran.uwm301.modcod    =  stat.maktab_fil.modcod                                    
        wdetail.cargrp            =  stat.maktab_fil.prmpac
        sic_bran.uwm301.vehgrp    =  stat.maktab_fil.prmpac
        /*sic_bran.uwm301.engine  =  stat.maktab_fil.engine*/
        nv_engine                 =  stat.maktab_fil.engine
        wdetail.seat41            =  IF wdetail.seat41 = 0 THEN stat.maktab_fil.seats ELSE wdetail.seat41.  /*A64-0044*/
        IF sic_bran.uwm301.maksi = 0 AND SUBSTR(wdetail.subclass,1,1) = "E" THEN sic_bran.uwm301.maksi = stat.maktab_fil.maksi . /*A67-0029*/
    END.
END.
RELEASE stat.maktab_fil .

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_open C-Win 
PROCEDURE proc_open :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
/*OPEN QUERY br_wdetail FOR EACH wdetail WHERE wdetail.pass = "y".   */
OPEN QUERY br_wdetail FOR EACH wdetail WHERE wdetail.pass <> "N" .

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_policy C-Win 
PROCEDURE proc_policy :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DEF VAR chk_sticker AS CHAR FORMAT "x(15)".

ASSIGN fi_process = "Create data Text File to uwm100...." + wdetail.policyno .   
DISP fi_process WITH FRAM fr_main.

IF wdetail.poltyp = "v72" THEN n_rencnt = 0.  

/* เช็ค Vat ชมพู */
ASSIGN n_chkvat = NO.
IF wdetail.instot = 1 THEN DO:
   FIND LAST winst WHERE winst.policyno = wdetail.policy AND winst.instot = wdetail.instot AND winst.instname1 <> "" NO-LOCK NO-ERROR.
   IF AVAIL winst THEN n_chkvat = YES.
   ELSE n_chkvat = NO.
END.
ELSE ASSIGN n_chkvat = YES.

IF n_chkvat = YES THEN RUN proc_insnam_inst.

nv_insref = "" .
/*IF wdetail.nv_insref <> "" THEN nv_insref = trim(wdetail.nv_insref).*/ /*A64-0043*/
/* Add by : A64-0043 */
IF wdetail.nv_insref <> "" THEN DO: 
    nv_insref = trim(wdetail.nv_insref).
   IF wdetail.instot = 1 AND n_chkvat = YES THEN DO:
       FIND sicsyac.xmm600 USE-INDEX xmm60001 WHERE sicsyac.xmm600.acno = nv_insref NO-ERROR NO-WAIT .
         IF AVAIL xmm600 THEN RUN proc_insnamvat .
       RELEASE sicsyac.xmm600. 
   END.
END.
/* end : A65-0043*/
ELSE RUN proc_insnam. 

IF nv_insref = ""  THEN DO:
    ASSIGN wdetail.comment = wdetail.comment + "|รหัสลูกค้าเป็นค่าว่าง เช็ครันนิ่ง insured code (XZM056) สาขา " + wdetail.n_branch 
           wdetail.pass    = "N" 
           wdetail.OK_gen  = "N" .
    RETURN.
END.
ELSE DO:

    RUN proc_create100.
    s_recid1  =  Recid(sic_bran.uwm100).
    FIND sicsyac.xmm031 USE-INDEX xmm03101 WHERE sicsyac.xmm031.poltyp = wdetail.poltyp  NO-LOCK NO-ERROR NO-WAIT.
    IF AVAIL  sicsyac.xmm031 THEN DO:
        nv_dept = sicsyac.xmm031.dept.
    END.
    /* comment by : Ranu I. A64-0044...
    nv_polmaster = "" .
    IF ra_type = 1 AND wdetail.packcod <> "" THEN RUN proc_policyname4. 
    ... end A64-0044 ..*/
    /* A65-0043 */
    IF (wdetail.icno <> "-" AND wdetail.icno <> "" ) THEN DO:
        IF LENGTH(wdetail.icno) < 13  THEN 
            ASSIGN wdetail.comment = wdetail.comment + "|เลขบัตรประชาชนไม่ครบ 13 หลัก "
                   wdetail.WARNING = wdetail.WARNING + "|เลขบัตรประชาชนไม่ครบ 13 หลัก ".
    END.
    /* end : A65-0043 */
    DO TRANSACTION:
       ASSIGN
          sic_bran.uwm100.renno      = ""
          sic_bran.uwm100.endno      = ""
          sic_bran.uwm100.poltyp     = wdetail.poltyp
          sic_bran.uwm100.acno_typ   = IF wdetail.instyp = "C" THEN "CO" ELSE "PR"
          sic_bran.uwm100.br_insured = wdetail.insbr
          sic_bran.uwm100.insref     = CAPS(trim(nv_insref))                         
          sic_bran.uwm100.opnpol     = CAPS(TRIM(wdetail.promo))
          sic_bran.uwm100.icno       = TRIM(wdetail.icno)
          sic_bran.uwm100.ntitle     = trim(wdetail.tiname)              
          sic_bran.uwm100.name1      = trim(wdetail.insnam) + " " + wdetail.lastname
          sic_bran.uwm100.firstname  = trim(wdetail.insnam)
          sic_bran.uwm100.lastname   = trim(wdetail.lastname)
          sic_bran.uwm100.sex        = trim(wdetail.gender)
         /* sic_bran.uwm100.name2      = trim(wdetail.name2)*/ /* A64-0309 */                  
         /* sic_bran.uwm100.name3      = trim(wdetail.name3)*/ /* A64-0309 */    
          sic_bran.uwm100.name2      = if trim(wdetail.name2) <> "null" then trim(wdetail.name2) else ""  /* A64-0309 */     
          sic_bran.uwm100.name3      = if trim(wdetail.name3) <> "null" then trim(wdetail.name3) else ""  /* A64-0309 */     
          sic_bran.uwm100.addr1      = trim(wdetail.addr)               
          sic_bran.uwm100.addr2      = trim(wdetail.tambon)               
          sic_bran.uwm100.addr3      = trim(wdetail.amper)               
          sic_bran.uwm100.addr4      = trim(wdetail.country)
          sic_bran.uwm100.postcd     = trim(wdetail.post)  
          sic_bran.uwm100.codeaddr1  = trim(wdetail.provcod)
          sic_bran.uwm100.codeaddr2  = trim(wdetail.distcod)
          sic_bran.uwm100.codeaddr3  = trim(wdetail.sdistcod)
          sic_bran.uwm100.undyr      = String(Year(today),"9999")      
          sic_bran.uwm100.branch     = wdetail.n_branch                  
          sic_bran.uwm100.dept       = nv_dept
          sic_bran.uwm100.usrid      = USERID(LDBNAME(1))
          sic_bran.uwm100.fstdat     = date(wdetail.firstdat)          
          sic_bran.uwm100.comdat     = DATE(wdetail.comdat)
          sic_bran.uwm100.expdat     = date(wdetail.expdat)
          /*sic_bran.uwm100.accdat     = DATE(wdetail.agreedat) */ /*A67-0029*/
          sic_bran.uwm100.accdat     = IF DATE(wdetail.agreedat) <> ? THEN DATE(wdetail.agreedat) ELSE DATE(wdetail.comdat) /*A67-0029*/
          sic_bran.uwm100.tranty     = "N"                     /*Transaction Type (N/R/E/C/T)*/
          sic_bran.uwm100.langug     = wdetail.inslang
          sic_bran.uwm100.acctim     = "00:00"
          sic_bran.uwm100.trty11     = "M"   
          sic_bran.uwm100.docno1     = STRING(nv_docno,"9999999")     
          sic_bran.uwm100.enttim     = STRING(TIME,"HH:MM:SS")
          sic_bran.uwm100.entdat     = TODAY
          sic_bran.uwm100.curbil     = "BHT"
          sic_bran.uwm100.curate     = 1                            
          sic_bran.uwm100.instot     = wdetail.instot               
          sic_bran.uwm100.prog       = "wgwloadem"
          sic_bran.uwm100.cntry      = "TH"                  /*Country where risk is situated*/
          sic_bran.uwm100.insddr     = YES                   /*Print Insd. Name on DrN       */
          sic_bran.uwm100.no_sch     = 0                     /*No. to print, Schedule        */
          sic_bran.uwm100.no_dr      = 1                     /*No. to print, Dr/Cr Note      */
          sic_bran.uwm100.no_ri      = 0                     /*No. to print, RI Appln        */
          sic_bran.uwm100.no_cer     = 0                     /*No. to print, Certificate     */
          sic_bran.uwm100.li_sch     = YES                   /*Print Later/Imm., Schedule    */
          sic_bran.uwm100.li_dr      = YES                   /*Print Later/Imm., Dr/Cr Note  */
          sic_bran.uwm100.li_ri      = YES                   /*Print Later/Imm., RI Appln,   */
          sic_bran.uwm100.li_cer     = YES                   /*Print Later/Imm., Certificate */
          sic_bran.uwm100.apptax     = YES                   /*Apply risk level tax (Y/N)    */
          sic_bran.uwm100.recip      = "N"                   /*Reciprocal (Y/N/C)            */
          sic_bran.uwm100.short      = IF trim(wdetail.srate) = "Y" THEN YES ELSE NO                    
          sic_bran.uwm100.acno1      = caps(trim(wdetail.producer))               /*Kridtiya i. A55-0151*/
          sic_bran.uwm100.agent      = caps(trim(wdetail.agent))     /*nv_agent   */
          sic_bran.uwm100.insddr     = NO
          sic_bran.uwm100.coins      = NO
          sic_bran.uwm100.billco     = ""
          sic_bran.uwm100.fptr01     = 0        sic_bran.uwm100.bptr01 = 0
          sic_bran.uwm100.fptr02     = 0        sic_bran.uwm100.bptr02 = 0
          sic_bran.uwm100.fptr03     = 0        sic_bran.uwm100.bptr03 = 0
          sic_bran.uwm100.fptr04     = 0        sic_bran.uwm100.bptr04 = 0
          sic_bran.uwm100.fptr05     = 0        sic_bran.uwm100.bptr05 = 0
          sic_bran.uwm100.fptr06     = 0        sic_bran.uwm100.bptr06 = 0  
          sic_bran.uwm100.styp20     = "NORM"
          sic_bran.uwm100.dir_ri     =  YES
          sic_bran.uwm100.drn_p      =  NO
          sic_bran.uwm100.sch_p      =  NO
          /*sic_bran.uwm100.cr_1       = CAPS(trim(wdetail.pack))  /* Product */*/ /*A66-0202*/
          sic_bran.uwm100.cr_1       = IF CAPS(trim(wdetail.pack)) = "" THEN CAPS(TRIM(wdetail.product))  ELSE CAPS(trim(wdetail.packcod))   /* Product */ /*A66-0202*/
          sic_bran.uwm100.cr_2       = trim(wdetail.cr_2)
          sic_bran.uwm100.bchyr      = nv_batchyr          /*Batch Year */  
          sic_bran.uwm100.bchno      = nv_batchno          /*Batch No.  */  
          sic_bran.uwm100.bchcnt     = nv_batcnt           /*Batch Count*/  
          sic_bran.uwm100.prvpol     = wdetail.prepol      /*A52-0172   */
          sic_bran.uwm100.cedpol     = wdetail.appenno
          sic_bran.uwm100.finint     = caps(trim(wdetail.n_delercode)) 
          sic_bran.uwm100.bs_cd      = caps(trim(wdetail.vatcode))  
          sic_bran.uwm100.codeocc    = trim(wdetail.occup)     /* code อาชีพ*/
          /*sic_bran.uwm100.occupn     = trim(wdetail.occup) */    /*  อาชีพ*/
          /*sic_bran.uwm100.endern     = TODAY    */          /* เพิ่มวันที่รับเงิน*/
          sic_bran.uwm100.dealer      = CAPS(TRIM(wdetail.fincode))
          sic_bran.uwm100.sname       = CAPS(TRIM(wdetail.salename))
          sic_bran.uwm100.s_lastname  = CAPS(TRIM(wdetail.product))
          sic_bran.uwm100.payer       = caps(trim(wdetail.payercod))
          sic_bran.uwm100.campaign    = caps(trim(wdetail.camp_no))   
          sic_bran.uwm100.refer1      = caps(trim(wdetail.campen))   
          sic_bran.uwm100.chr1        = caps(trim(wdetail.specon))  
          /*sic_bran.uwm100.cedco       = wdetail.agco70 */ /*A64-0355*/
          sic_bran.uwm100.acno2       = CAPS(trim(wdetail.agco70))     /*A64-0355 co-broker */
          sic_bran.uwm100.s_tel[1]    = trim(wdetail.tele1)   
          sic_bran.uwm100.s_tel[2]    = trim(wdetail.tele2)
          sic_bran.uwm100.s_email[1]  = trim(wdetail.mail1) 
          sic_bran.uwm100.s_email[2]  = trim(wdetail.mail2) 
          sic_bran.uwm100.s_email[3]  = trim(wdetail.mail3) 
          sic_bran.uwm100.s_email[4]  = trim(wdetail.mail4) 
          sic_bran.uwm100.s_email[5]  = trim(wdetail.mail5) 
          sic_bran.uwm100.fgtariff    = IF index(wdetail.subclass,"E") <> 0 THEN NO ELSE tg_flag /*A68-0044*/

          sic_bran.uwm100.accdat      = IF sic_bran.uwm100.accdat > sic_bran.uwm100.comdat THEN sic_bran.uwm100.comdat ELSE sic_bran.uwm100.accdat 
          sic_bran.uwm100.trndat      = IF fi_loaddat <> ? THEN  fi_loaddat ELSE TODAY
          sic_bran.uwm100.issdat      = sic_bran.uwm100.trndat .

          IF wdetail.prepol <> " " THEN DO:
              IF wdetail.poltyp = "v72"  THEN ASSIGN sic_bran.uwm100.prvpol  = ""  sic_bran.uwm100.tranty  = "R".  
              ELSE 
                  ASSIGN sic_bran.uwm100.prvpol = wdetail.prepol     /*ถ้าเป็นงาน Renew  ต้องไม่เป็นค่าว่าง*/
                    sic_bran.uwm100.tranty      = "R".               /*Transaction Type (N/R/E/C/T)*/
          END.
          IF  wdetail.pass = "Y" THEN sic_bran.uwm100.impflg  = YES.
          ELSE sic_bran.uwm100.impflg  = NO.

          IF wdetail.cancel = "ca" THEN sic_bran.uwm100.polsta = "CA" .
          ELSE sic_bran.uwm100.polsta = "IF".

          nv_polday  =  IF  (sic_bran.uwm100.expdat - sic_bran.uwm100.comdat = 365)  OR
                            (sic_bran.uwm100.expdat - sic_bran.uwm100.comdat = 366)  OR
                            (sic_bran.uwm100.expdat - sic_bran.uwm100.comdat = 367)  THEN  365 
                        ELSE sic_bran.uwm100.expdat - sic_bran.uwm100.comdat.  
          
    END. /*transaction*/
    RUN proc_uwd100.
    RUN proc_uwd102.
     /* --------------------U W M 1 2 0 -------------- */
      FIND sic_bran.uwm120 USE-INDEX uwm12001      WHERE
           sic_bran.uwm120.policy  = sic_bran.uwm100.policy AND 
           sic_bran.uwm120.rencnt  = sic_bran.uwm100.rencnt AND 
           sic_bran.uwm120.endcnt  = sic_bran.uwm100.endcnt AND 
           sic_bran.uwm120.riskgp  = s_riskgp               AND 
           sic_bran.uwm120.riskno  = s_riskno               AND       
           sic_bran.uwm120.bchyr   = nv_batchyr             AND 
           sic_bran.uwm120.bchno   = nv_batchno             AND 
           sic_bran.uwm120.bchcnt  = nv_batcnt              NO-WAIT NO-ERROR.
        IF NOT AVAILABLE sic_bran.uwm120 THEN DO:
           RUN wgw/wgwad120 (INPUT sic_bran.uwm100.policy,   /***--- A490166 Note Modi ---***/
                                   sic_bran.uwm100.rencnt,
                                   sic_bran.uwm100.endcnt,
                                   s_riskgp,
                                   s_riskno,
                                   OUTPUT  s_recid2).
          FIND sic_bran.uwm120 WHERE RECID(sic_bran.uwm120) = s_recid2 NO-WAIT NO-ERROR.
        END.   /* end not avail  uwm120 */
        IF AVAILABLE sic_bran.uwm120 THEN DO:  
            ASSIGN sic_bran.uwm120.sicurr = "BHT"
            sic_bran.uwm120.siexch = 1  /*not sure*/
            sic_bran.uwm120.fptr01 = 0               
            sic_bran.uwm120.fptr02 = 0               
            sic_bran.uwm120.fptr03 = 0               
            sic_bran.uwm120.fptr04 = 0               
            sic_bran.uwm120.fptr08 = 0               
            sic_bran.uwm120.fptr09 = 0          
            sic_bran.uwm120.com1ae = YES
            sic_bran.uwm120.stmpae = YES
            sic_bran.uwm120.feeae  = YES
            sic_bran.uwm120.taxae  = YES
            sic_bran.uwm120.bptr01 = 0 
            sic_bran.uwm120.bptr02 = 0 
            sic_bran.uwm120.bptr03 = 0 
            sic_bran.uwm120.bptr04 = 0 
            sic_bran.uwm120.bptr08 = 0 
            sic_bran.uwm120.bptr09 = 0 
            sic_bran.uwm120.bchyr  = nv_batchyr         /* batch Year */
            sic_bran.uwm120.bchno  = nv_batchno         /* bchno    */
            sic_bran.uwm120.bchcnt = nv_batcnt       /* bchcnt     */
            sic_bran.uwm120.class  = IF wdetail.poltyp = "v72" THEN wdetail.subclass ELSE wdetail.prempa + wdetail.subclass 
            s_recid2     = RECID(sic_bran.uwm120).
        END. 
END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_policyname4 C-Win 
PROCEDURE proc_policyname4 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:     
------------------------------------------------------------------------------*/
/* Add by : A66-0202 */
DEF VAR nv_si AS INT INIT 0. 
DEF VAR nv_ModelYear   AS DECI INIT 0.
DEF VAR nv_campaignMS  AS CHAR INIT "".  /*A63-0206*/ 
DEF VAR n_packcod  AS CHAR FORMAT "x(10)" INIT "" .
def var n_subclass as char format "x(4)" init "" .
def var n_covcod   as char format "x(3)" init "" .
def var n_cargrp   as char format "x(1)" init "" .
def var n_vehuse   as char format "x(1)" init "" .
def var n_garage   as char format "x(1)" init "" .
def var n_si       as DECI init 0 .
def var n_brand    as char format "x(25)" init "" .
def var n_model    as char format "x(30)" init "" .
def var n_premt    as DECI init 0 .

DO:
     ASSIGN fi_process = "Check Campaign (campaign_fil)..." + wdetail.policyno .
     DISP fi_process WITH FRAM fr_main.
     
     IF wdetail.packcod <> "" AND wdetail.poltyp = "V70"  THEN DO:
         ASSIGN n_yr = 0
                n_yr = (YEAR(TODAY) - DECI(wdetail.yrmanu)).

       IF ra_type = 1 THEN DO: 
           IF n_yr = 0 OR n_yr = 1 THEN n_yr = 1 . 
           ELSE n_yr = n_yr + 1.
       END.
       IF wdetail.covcod = "1"  THEN DO:
           IF wdetail.subclass <> "110" THEN DO:  /* 110E 210 320 */ /*A64-0044 */
             IF wdetail.cargrp <> "" AND wdetail.vehuse <> ""  THEN DO:
               FIND LAST stat.campaign_fil USE-INDEX campfil04  WHERE 
                   stat.campaign_fil.camcod = wdetail.packcod   AND /* campaign no */
                   stat.campaign_fil.sclass = wdetail.subclass  AND /* class 110 210 320 */
                   stat.campaign_fil.covcod = wdetail.covcod    AND /* cover 1 2 3 2.1 2.2 3.1 3.2 */
                   stat.campaign_fil.vehgrp = wdetail.cargrp    AND /* group car */
                   stat.campaign_fil.vehuse = wdetail.vehuse    AND /* ประเภทการใช้รถ */
                   stat.campaign_fil.garage = wdetail.garage          AND /* การซ่อม */
                   stat.campaign_fil.maxyea = n_yr                    AND /* อายุรถ */
                   stat.campaign_fil.simax  = deci(wdetail.si)        AND  /* ทุน */
                   stat.campaign_fil.makdes = wdetail.brand     AND 
                   (index(wdetail.model,stat.campaign_fil.moddes) <> 0  OR   /* Model */
                   index(stat.campaign_fil.moddes,wdetail.model) <> 0 ) AND   /* Model */ /*A64-0044*/
                   stat.campaign_fil.netprm  = wdetail.premt         NO-LOCK NO-ERROR.   
             END.
             ELSE DO:
                  FIND LAST stat.campaign_fil USE-INDEX campfil04  WHERE 
                   stat.campaign_fil.camcod = wdetail.packcod   AND /* campaign no */
                   stat.campaign_fil.sclass = wdetail.subclass  AND /* class 110 210 320 */
                   stat.campaign_fil.covcod = wdetail.covcod    AND /* cover 1 2 3 2.1 2.2 3.1 3.2 */
                   stat.campaign_fil.garage = wdetail.garage    AND /* การซ่อม */
                   stat.campaign_fil.maxyea = n_yr              AND /* อายุรถ */
                   stat.campaign_fil.simax  = deci(wdetail.si)  AND  /* ทุน */
                   stat.campaign_fil.makdes = wdetail.brand     AND 
                   (index(wdetail.model,stat.campaign_fil.moddes) <> 0  OR   /* Model */
                   index(stat.campaign_fil.moddes,wdetail.model) <> 0 ) AND   /* Model */ /*A64-0044*/
                   stat.campaign_fil.netprm  = wdetail.premt         NO-LOCK NO-ERROR. 
             END.
             /* add by : A64-0044 */
             IF AVAIL stat.campaign_fil THEN 
                 ASSIGN   wdetail.polmaster = stat.campaign_fil.polmst
                          wdetail.seat41    = stat.campaign_fil.seat41. 
             /* end : A64-0044 */
             ELSE DO: 
                IF deci(wdetail.si) > 1000000 THEN DO:
                    ASSIGN nv_si = 0
                           nv_si = deci(wdetail.si) + 40000 .
                    FIND LAST stat.campaign_fil USE-INDEX campfil04  WHERE 
                     stat.campaign_fil.camcod = wdetail.packcod   AND /* campaign no */
                     stat.campaign_fil.sclass = wdetail.subclass  AND /* class 110 210 320 */
                     stat.campaign_fil.covcod = wdetail.covcod    AND /* cover 1 2 3 2.1 2.2 3.1 3.2 */
                     stat.campaign_fil.garage = wdetail.garage          AND /* การซ่อม */
                     stat.campaign_fil.maxyea = n_yr                    AND /* อายุรถ */
                     stat.campaign_fil.simax  >= deci(wdetail.si)       AND
                     stat.campaign_fil.simax  <= nv_si                  AND
                     stat.campaign_fil.makdes = wdetail.brand     AND 
                     (index(wdetail.model,stat.campaign_fil.moddes) <> 0  OR   /* Model */
                   index(stat.campaign_fil.moddes,wdetail.model) <> 0 ) AND   /* Model */ /*A64-0044*/
                     stat.campaign_fil.netprm   = wdetail.premt           NO-LOCK NO-ERROR.   /* Model */
                    /* add by : A64-0044 */
                    IF AVAIL stat.campaign_fil THEN 
                        ASSIGN   wdetail.polmaster = stat.campaign_fil.polmst
                                 wdetail.seat41    = stat.campaign_fil.seat41. 
                    ELSE ASSIGN wdetail.polmaster = "" . 
                    /* end : A64-0044 */
                END. /* end si > 1000000 */
             END.
             /* ไม่เช็คอายุรถ */
             IF wdetail.polmaster = "" THEN DO:  /*A64-0044*/
               /* A64-0044 */
               n_model = "" .
               IF INDEX(wdetail.model," ") <> 0 THEN ASSIGN n_model = SUBSTR(wdetail.model,1,INDEX(wdetail.model," ") - 1).
               ELSE n_model = TRIM(wdetail.model) .
               /* end : A64-0044 */
               FIND LAST stat.campaign_fil /*USE-INDEX campfil01*/  WHERE 
                    stat.campaign_fil.camcod = wdetail.packcod     AND /* campaign no */
                    stat.campaign_fil.sclass = wdetail.subclass    AND /* class 110 210 320 */
                    stat.campaign_fil.covcod = wdetail.covcod      AND /* cover 1 2 3 2.1 2.2 3.1 3.2 */
                    stat.campaign_fil.garage = wdetail.garage      AND /* การซ่อม */
                    stat.campaign_fil.maxyea = 1                   AND /* อายุรถ */
                    stat.campaign_fil.simax  = deci(wdetail.si)    AND  /* ทุน */
                    stat.campaign_fil.makdes = wdetail.brand       AND 
                    (index(n_model,stat.campaign_fil.moddes) <> 0  OR   /* Model */
                    index(stat.campaign_fil.moddes,n_model) <> 0 ) AND   /* Model */ /*A64-0044*/
                    stat.campaign_fil.netprm  = wdetail.premt         NO-LOCK NO-ERROR. 
                  /* add by : A64-0044 */
                   IF AVAIL stat.campaign_fil THEN 
                       ASSIGN   wdetail.polmaster = stat.campaign_fil.polmst
                                wdetail.seat41    = stat.campaign_fil.seat41. 
                 /* end A64-0044 */
             END.
           END. /* end <> 110 */
           ELSE DO:  /* class 110 */
               RUN proc_campaign110.
           END.
       END. /* end ป.1 */
       ELSE IF (wdetail.covcod = "2.1") OR (wdetail.covcod = "3.1") OR 
               (wdetail.covcod = "2.2") OR (wdetail.covcod = "3.2") THEN DO:
           IF wdetail.subclass <> "110" THEN DO:  /*A64-0044*/
            FIND LAST stat.campaign_fil /*USE-INDEX campfil15*/  WHERE                
                stat.campaign_fil.camcod  =  wdetail.packcod         and       /*campaign */ /*A63-0443*/
                stat.campaign_fil.sclass  =  wdetail.subclass        and       /* class 110 210 320 */
                stat.campaign_fil.covcod  =  wdetail.covcod          and       /* cover 1 2 3 2.1 2.2 3.1 3.2 */
                stat.campaign_fil.garage  =  wdetail.garage          and       /*   ประเภทการซ่อม   */
               (stat.campaign_fil.simin   <= deci(wdetail.siplus)    and       /*   วงเงินทุนประกันต่ำสุด */
                stat.campaign_fil.simax   >= deci(wdetail.siplus))   AND       /*   วงเงินทุนประกันสูงสุด */
                stat.campaign_fil.makdes   = wdetail.brand           AND 
                (index(wdetail.model,stat.campaign_fil.moddes) <> 0  OR   /* Model */
                 index(stat.campaign_fil.moddes,wdetail.model) <> 0 ) AND   /* Model */ /*A64-0044*/
                stat.campaign_fil.netprm   = wdetail.premt           NO-LOCK NO-ERROR.  /* เบี้ยจากไฟล์ */
              /* add by : A64-0044 */
              IF AVAIL stat.campaign_fil THEN 
                 ASSIGN   wdetail.polmaster = stat.campaign_fil.polmst
                          wdetail.seat41    = stat.campaign_fil.seat41. 
              ELSE DO:
                /* Add by : Ranu I. A66-0202 */
                FIND LAST stat.campaign_fil /*USE-INDEX campfil15*/  WHERE                
                 stat.campaign_fil.camcod  =  wdetail.packcod         and       /*campaign */ /*A63-0443*/
                 stat.campaign_fil.sclass  =  wdetail.subclass        and       /* class 110 210 320 */
                 stat.campaign_fil.covcod  =  wdetail.covcod          and       /* cover 1 2 3 2.1 2.2 3.1 3.2 */
                 stat.campaign_fil.garage  =  wdetail.garage          and       /*   ประเภทการซ่อม   */
                (stat.campaign_fil.simin   <= deci(wdetail.siplus)    and       /*   วงเงินทุนประกันต่ำสุด */
                 stat.campaign_fil.simax   >= deci(wdetail.siplus))   AND       /*   วงเงินทุนประกันสูงสุด */
                 stat.campaign_fil.netprm   = wdetail.premt           NO-LOCK NO-ERROR.  /* เบี้ยจากไฟล์ */
                 IF AVAIL stat.campaign_fil THEN DO:
                    ASSIGN   wdetail.polmaster = stat.campaign_fil.polmst
                             wdetail.seat41    = stat.campaign_fil.seat41.
                 END.
                 /* end : Ranu I. A66-0202 */
                 ELSE ASSIGN wdetail.polmaster = "" . 
              END.
             /* end : A64-0044 */
           END.
           /* create by : A64-0044 */
           ELSE DO: /* class 110 */
               IF wdetail.engcc <= 2000 THEN DO:
                    FIND LAST stat.campaign_fil /*USE-INDEX campfil15*/  WHERE                
                     stat.campaign_fil.camcod  =  wdetail.packcod         and       /*campaign */ /*A63-0443*/
                     stat.campaign_fil.sclass  =  wdetail.subclass        and       /* class 110 210 320 */
                     stat.campaign_fil.covcod  =  wdetail.covcod          and       /* cover 1 2 3 2.1 2.2 3.1 3.2 */
                     stat.campaign_fil.garage  =  wdetail.garage          and       /*   ประเภทการซ่อม   */
                     stat.campaign_fil.engine  <= 2000                    AND /* cc */   
                    (stat.campaign_fil.simin   <= deci(wdetail.siplus)    and       /*   วงเงินทุนประกันต่ำสุด */
                     stat.campaign_fil.simax   >= deci(wdetail.siplus))   AND       /*   วงเงินทุนประกันสูงสุด */
                     stat.campaign_fil.makdes   = wdetail.brand           AND 
                     (index(wdetail.model,stat.campaign_fil.moddes) <> 0  OR   /* Model */
                      index(stat.campaign_fil.moddes,wdetail.model) <> 0 ) AND   /* Model */ /*A64-0044*/
                     stat.campaign_fil.netprm   = wdetail.premt           NO-LOCK NO-ERROR.  /* เบี้ยจากไฟล์ */
               END.
               ELSE DO:
                    FIND LAST stat.campaign_fil /*USE-INDEX campfil15*/  WHERE                
                     stat.campaign_fil.camcod  =  wdetail.packcod         and       /*campaign */ /*A63-0443*/
                     stat.campaign_fil.sclass  =  wdetail.subclass        and       /* class 110 210 320 */
                     stat.campaign_fil.covcod  =  wdetail.covcod          and       /* cover 1 2 3 2.1 2.2 3.1 3.2 */
                     stat.campaign_fil.garage  =  wdetail.garage          and       /*   ประเภทการซ่อม   */
                     stat.campaign_fil.engine  > 2000                     AND /* cc */  
                    (stat.campaign_fil.simin   <= deci(wdetail.siplus)    and       /*   วงเงินทุนประกันต่ำสุด */
                     stat.campaign_fil.simax   >= deci(wdetail.siplus))   AND       /*   วงเงินทุนประกันสูงสุด */
                     stat.campaign_fil.makdes   = wdetail.brand           AND 
                     (index(wdetail.model,stat.campaign_fil.moddes) <> 0  OR   /* Model */
                      index(stat.campaign_fil.moddes,wdetail.model) <> 0 ) AND   /* Model */ /*A64-0044*/
                     stat.campaign_fil.netprm   = wdetail.premt           NO-LOCK NO-ERROR.  /* เบี้ยจากไฟล์ */

               END.
               IF AVAIL stat.campaign_fil THEN DO:
                  ASSIGN   wdetail.polmaster = stat.campaign_fil.polmst
                           wdetail.seat41    = stat.campaign_fil.seat41. 
               END.
               ELSE DO: 
                   /* add by : Ranu I. A66-0202 */
                  IF wdetail.engcc <= 2000 THEN DO:
                      FIND LAST stat.campaign_fil /*USE-INDEX campfil15*/  WHERE                
                       stat.campaign_fil.camcod  =  wdetail.packcod         and       /*campaign */ /*A63-0443*/
                       stat.campaign_fil.sclass  =  wdetail.subclass        and       /* class 110 210 320 */
                       stat.campaign_fil.covcod  =  wdetail.covcod          and       /* cover 1 2 3 2.1 2.2 3.1 3.2 */
                       stat.campaign_fil.garage  =  wdetail.garage          and       /*   ประเภทการซ่อม   */
                       stat.campaign_fil.engine  <= 2000                    AND /* cc */   
                      (stat.campaign_fil.simin   <= deci(wdetail.siplus)    and       /*   วงเงินทุนประกันต่ำสุด */
                       stat.campaign_fil.simax   >= deci(wdetail.siplus))   AND       /*   วงเงินทุนประกันสูงสุด */
                       stat.campaign_fil.netprm   = wdetail.premt           NO-LOCK NO-ERROR.  /* เบี้ยจากไฟล์ */
                  END.
                  ELSE DO:
                      FIND LAST stat.campaign_fil /*USE-INDEX campfil15*/  WHERE                
                       stat.campaign_fil.camcod  =  wdetail.packcod         and       /*campaign */ /*A63-0443*/
                       stat.campaign_fil.sclass  =  wdetail.subclass        and       /* class 110 210 320 */
                       stat.campaign_fil.covcod  =  wdetail.covcod          and       /* cover 1 2 3 2.1 2.2 3.1 3.2 */
                       stat.campaign_fil.garage  =  wdetail.garage          and       /*   ประเภทการซ่อม   */
                       stat.campaign_fil.engine  > 2000                     AND /* cc */  
                      (stat.campaign_fil.simin   <= deci(wdetail.siplus)    and       /*   วงเงินทุนประกันต่ำสุด */
                       stat.campaign_fil.simax   >= deci(wdetail.siplus))   AND       /*   วงเงินทุนประกันสูงสุด */
                       stat.campaign_fil.netprm   = wdetail.premt           NO-LOCK NO-ERROR.  /* เบี้ยจากไฟล์ */
                  END.
                  IF AVAIL stat.campaign_fil THEN DO:
                   ASSIGN   wdetail.polmaster = stat.campaign_fil.polmst
                            wdetail.seat41    = stat.campaign_fil.seat41. 
                  END.
                  /* end : Ranu I. A66-0202 */
                  ELSE ASSIGN wdetail.polmaster = "" . 
               END.
           END.
          /* end : A64-0044 */
       END. /* end ป.2+ ป.3+ */
       ELSE DO: /* ป2 ป3 */
           IF wdetail.covcod = "2" THEN DO:
              FIND LAST stat.campaign_fil /*USE-INDEX campfil15*/  WHERE                
                  stat.campaign_fil.camcod  = wdetail.packcod  and       /*campaign */ /*A63-0443*/
                  stat.campaign_fil.sclass  = wdetail.subclass and       /* class 110 210 320 */
                  stat.campaign_fil.covcod  = wdetail.covcod   and       /* cover 1 2 3 2.1 2.2 3.1 3.2 */
                  stat.campaign_fil.makdes  = wdetail.brand     AND 
                  (index(wdetail.model,stat.campaign_fil.moddes) <> 0  OR   /* Model */
                    index(stat.campaign_fil.moddes,wdetail.model) <> 0 ) AND   /* Model */ /*A64-0044*/
                  stat.campaign_fil.netprm  = wdetail.premt           NO-LOCK NO-ERROR.  /* เบี้ยจากไฟล์ */
               /* add by : A64-0044 */
               IF AVAIL stat.campaign_fil THEN DO:
                 ASSIGN   wdetail.polmaster = stat.campaign_fil.polmst
                          wdetail.seat41    = stat.campaign_fil.seat41. 
               END.
               ELSE DO: 
                   /* add by : Ranu I. A66-0202 */
                  FIND LAST stat.campaign_fil  WHERE                
                    stat.campaign_fil.camcod  = wdetail.packcod  and       /*campaign */ /*A63-0443*/
                    stat.campaign_fil.sclass  = wdetail.subclass and       /* class 110 210 320 */
                    stat.campaign_fil.covcod  = wdetail.covcod   and       /* cover 1 2 3 2.1 2.2 3.1 3.2 */
                    stat.campaign_fil.netprm  = wdetail.premt    NO-LOCK NO-ERROR.  /* เบี้ยจากไฟล์ */
                  IF AVAIL stat.campaign_fil THEN DO:
                    ASSIGN   wdetail.polmaster = stat.campaign_fil.polmst
                             wdetail.seat41    = stat.campaign_fil.seat41. 
                  END.
                  /* end : Ranu I. A66-0202 */
                  ELSE ASSIGN wdetail.polmaster = "" . 
               END.
               /* end : A64-0044*/
           END.
           ELSE DO:
                /* add by : Ranu I. A66-0202 */
                  FIND LAST stat.campaign_fil  WHERE                
                    stat.campaign_fil.camcod  = wdetail.packcod  and       /*campaign */ /*A63-0443*/
                    stat.campaign_fil.sclass  = wdetail.subclass and       /* class 110 210 320 */
                    stat.campaign_fil.covcod  = wdetail.covcod   and       /* cover 1 2 3 2.1 2.2 3.1 3.2 */
                    stat.campaign_fil.netprm  = wdetail.premt    NO-LOCK NO-ERROR.  /* เบี้ยจากไฟล์ */
                  IF AVAIL stat.campaign_fil THEN DO:
                    ASSIGN   wdetail.polmaster = stat.campaign_fil.polmst
                             wdetail.seat41    = stat.campaign_fil.seat41. 
                  END.
                  /* end : Ranu I. A66-0202 */
                  ELSE ASSIGN wdetail.polmaster = "" . 
           END.
       END.
       /* A64-0044 */
       IF wdetail.polmaster = "" THEN 
          ASSIGN  wdetail.comment = wdetail.comment + "ไม่พบ Policy Master ตามรายละเอียดของไฟล์นำเข้าในแพ็คเกจ " + wdetail.packcod
                  wdetail.pass    = "N" 
                  wdetail.OK_GEN  = "N".
       /* end : A64-0044 */
     END.
     RELEASE stat.campaign_fil.
END.

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_prmtxt C-Win 
PROCEDURE proc_prmtxt :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
/*Add A65-0271*/
DEFINE VAR nv_prmtxt AS CHAR.                                                           
DEFINE VAR nv_acc1   AS CHAR FORMAT "X(60)". 
DEFINE VAR nv_acc2   AS CHAR FORMAT "X(60)". 
DEFINE VAR nv_acc3   AS CHAR FORMAT "X(60)". 
DEFINE VAR nv_acc4   AS CHAR FORMAT "X(60)". 
DEFINE VAR nv_acc5   AS CHAR FORMAT "X(60)". 
DEFINE VAR nv_acc6   AS CHAR FORMAT "X(60)". 
DEFINE VAR nv_acc7   AS CHAR FORMAT "X(60)". 
DEFINE VAR nv_acc8   AS CHAR FORMAT "X(60)". 
DEFINE VAR nv_acc9   AS CHAR FORMAT "X(60)". 
DEFINE VAR nv_acc10  AS CHAR FORMAT "X(60)". 
/*End A65-0271*/

FIND FIRST wacces WHERE wacces.policy = wdetail.policy NO-LOCK. /*A65-0271*/
IF AVAIL wacces THEN DO: /*A65-0271*/
ASSIGN 
    /*nv_acc6 = IF TRIM(wdetail2.accdata) = "" THEN "" 
              ELSE TRIM(wdetail2.accdata) + " ราคารวมอุปกรณ์เสริม " +  trim(wdetail2.price_acc) + " บาท"*/
    nv_acc1  = ""
    nv_acc2  = ""
    nv_acc3  = ""
    nv_acc4  = ""
    nv_acc5  = ""
    nv_acc6  = "" 
    nv_acc7  = "" 
    nv_acc8  = "" 
    nv_acc9  = "" 
    nv_acc10 = "" 
    nv_acc1  = wacces.accdata1  
    nv_acc2  = wacces.accdata2  
    nv_acc3  = wacces.accdata3  
    nv_acc4  = wacces.accdata4  
    nv_acc5  = wacces.accdata5  
    nv_acc6  = wacces.accdata6  
    nv_acc7  = wacces.accdata7  
    nv_acc8  = wacces.accdata8  
    nv_acc9  = wacces.accdata9
    nv_acc10 = wacces.accdata10.  /*A65-0271*/
END.

/*Begin By Naphasint C. A65-0271*/
IF ra_type = 1  THEN DO:

        IF nv_acc1  <> "" THEN ASSIGN SUBSTRING(sic_bran.uwm301.prmtxt,1,60)    =  nv_acc1.
        IF nv_acc2  <> "" THEN ASSIGN SUBSTRING(sic_bran.uwm301.prmtxt,61,60)   =  nv_acc2.
        IF nv_acc3  <> "" THEN ASSIGN SUBSTRING(sic_bran.uwm301.prmtxt,121,60)  =  nv_acc3.                  
        IF nv_acc4  <> "" THEN ASSIGN SUBSTRING(sic_bran.uwm301.prmtxt,181,60)  =  nv_acc4.                  
        IF nv_acc5  <> "" THEN ASSIGN SUBSTRING(sic_bran.uwm301.prmtxt,241,60)  =  nv_acc5.                  
        IF nv_acc6  <> "" THEN ASSIGN SUBSTRING(sic_bran.uwm301.prmtxt,301,60)  =  nv_acc6.                   
        IF nv_acc7  <> "" THEN ASSIGN SUBSTRING(sic_bran.uwm301.prmtxt,361,60)  =  nv_acc7.                  
        IF nv_acc8  <> "" THEN ASSIGN SUBSTRING(sic_bran.uwm301.prmtxt,421,60)  =  nv_acc8.                  
        IF nv_acc9  <> "" THEN ASSIGN SUBSTRING(sic_bran.uwm301.prmtxt,481,60)  =  nv_acc9.                  
        IF nv_acc10 <> "" THEN ASSIGN SUBSTRING(sic_bran.uwm301.prmtxt,541,60)  =  nv_acc10.
END.
ELSE IF ra_type = 2 THEN DO:

        ASSIGN
            SUBSTRING(sic_bran.uwm301.prmtxt,1,60)   = wacces.accdata1
            SUBSTRING(sic_bran.uwm301.prmtxt,61,60)  = wacces.accdata2
            SUBSTRING(sic_bran.uwm301.prmtxt,121,60) = wacces.accdata3
            SUBSTRING(sic_bran.uwm301.prmtxt,181,60) = wacces.accdata4
            SUBSTRING(sic_bran.uwm301.prmtxt,241,60) = wacces.accdata5
            SUBSTRING(sic_bran.uwm301.prmtxt,301,60) = wacces.accdata6
            SUBSTRING(sic_bran.uwm301.prmtxt,361,60) = wacces.accdata7
            SUBSTRING(sic_bran.uwm301.prmtxt,421,60) = wacces.accdata8
            SUBSTRING(sic_bran.uwm301.prmtxt,481,60) = wacces.accdata9
            SUBSTRING(sic_bran.uwm301.prmtxt,541,60) = wacces.accdata10.
END.
/*End By Naphasint C. A65-0271*/

/*IFnv_acc10 =accdata10  wdetail3.brand_gals    <> "" THEN nv_acc6 = nv_acc6 + " ยี่ห้อเคลือบแก้ว " + TRIM(wdetail3.brand_gals).
/*IF (wdetail3.brand_galsprm <> "" ) THEN nv_acc6 = nv_acc6 + " ราคา " + TRIM(wdetail3.brand_galsprm).*/ /*A59-0118*/
IF (wdetail3.brand_galsprm <> "" ) AND (deci(wdetail3.brand_galsprm) <> 0 ) THEN nv_acc6 = nv_acc6 + " ราคา " + TRIM(wdetail3.brand_galsprm). /*A59-0118*/

loop_chk1:
REPEAT:
    IF (INDEX(nv_acc6," ") <> 0 ) AND LENGTH(nv_acc1 + TRIM(SUBSTR(nv_acc6,1,INDEX(nv_acc6," ")))) <= 60 THEN 
        ASSIGN  nv_acc1 = trim(nv_acc1 + " " + TRIM(SUBSTR(nv_acc6,1,INDEX(nv_acc6," "))))
        nv_acc6 = TRIM(SUBSTR(nv_acc6,INDEX(nv_acc6," "))).
    ELSE LEAVE loop_chk1.
END.
IF nv_acc6 <> "" THEN
loop_chk2:
REPEAT:
    IF (INDEX(nv_acc6," ") <> 0 ) AND LENGTH(nv_acc2 + TRIM(SUBSTR(nv_acc6,1,INDEX(nv_acc6," ")))) <= 60 THEN 
        ASSIGN  nv_acc2 = trim(nv_acc2  + " " + TRIM(SUBSTR(nv_acc6,1,INDEX(nv_acc6," "))))
        nv_acc6 = TRIM(SUBSTR(nv_acc6,INDEX(nv_acc6," "))).
    ELSE LEAVE loop_chk2.
END.
loop_chk3:
REPEAT:
    IF (INDEX(nv_acc6," ") <> 0 ) AND LENGTH(nv_acc3 + TRIM(SUBSTR(nv_acc6,1,INDEX(nv_acc6," ")))) <= 60 THEN 
        ASSIGN  nv_acc3 = trim(nv_acc3  + " " + TRIM(SUBSTR(nv_acc6,1,INDEX(nv_acc6," "))))
        nv_acc6 = TRIM(SUBSTR(nv_acc6,INDEX(nv_acc6," "))).
    ELSE LEAVE loop_chk3.
END.
loop_chk4:
REPEAT:
    IF (INDEX(nv_acc6," ") <> 0 ) AND LENGTH(nv_acc4 + TRIM(SUBSTR(nv_acc6,1,INDEX(nv_acc6," ")))) <= 60 THEN 
        ASSIGN  nv_acc4 = trim(nv_acc4  + " " + TRIM(SUBSTR(nv_acc6,1,INDEX(nv_acc6," "))))
        nv_acc6 = TRIM(SUBSTR(nv_acc6,INDEX(nv_acc6," "))).
    ELSE LEAVE loop_chk4.
END.
loop_chk5:
REPEAT:
    IF (INDEX(nv_acc6," ") <> 0 ) AND LENGTH(nv_acc5 + TRIM(SUBSTR(nv_acc6,1,INDEX(nv_acc6," ")))) <= 60 THEN 
        ASSIGN  nv_acc5 = trim(nv_acc5  + " " + TRIM(SUBSTR(nv_acc6,1,INDEX(nv_acc6," "))))
        nv_acc6 = TRIM(SUBSTR(nv_acc6,INDEX(nv_acc6," "))).
    ELSE LEAVE loop_chk5.
END.
IF      (nv_acc5 <> "") AND (length(nv_acc5 + " " + nv_acc6 ) <= 60 ) THEN 
    ASSIGN nv_acc5 = nv_acc5  + " " + nv_acc6
    nv_acc6 = "" .
ELSE IF (nv_acc4 <> "") AND (length(nv_acc4 + " " + nv_acc6 ) <= 60 ) THEN 
    ASSIGN nv_acc4 = nv_acc4  + " " + nv_acc6 
    nv_acc6 = "" .
ELSE IF (nv_acc3 <> "") AND (length(nv_acc3 + " " + nv_acc6 ) <= 60 ) THEN 
    ASSIGN nv_acc3 = nv_acc3  + " " + nv_acc6
    nv_acc6 = "" .
ELSE IF (nv_acc2 <> "") AND (length(nv_acc2 + " " + nv_acc6 ) <= 60 ) THEN 
    ASSIGN nv_acc2 = nv_acc2  + " " + nv_acc6
    nv_acc6 = "" .
ELSE IF (nv_acc1 <> "") AND (length(nv_acc1 + " " + nv_acc6 ) <= 60 ) THEN
    ASSIGN  nv_acc1 = nv_acc1  + " " + nv_acc6
    nv_acc6 = "" .*/
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_report1 C-Win 
PROCEDURE proc_report1 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DEF VAR NOT_pass AS INTE INIT 0.
nv_row  =  1.
DEF VAR a AS CHAR FORMAT "x(100)" INIT "".
DEF VAR b AS CHAR FORMAT "x(100)" INIT "".
DEF VAR c AS INTE INIT 0.

FOR EACH wdetail WHERE wdetail.PASS <> "Y"  :
       NOT_pass = NOT_pass + 1.
END.
IF NOT_pass > 0 THEN DO:
    OUTPUT STREAM ns1 TO value(fi_output2).
    PUT STREAM ns1
    "riskno      "   "|"    /*1  */
    "num         "   "|"    /*2  */
    "policyno    "   "|"    /*3  */
    "n_branch    "   "|"    /*4  */
    "agent       "   "|"    /*5  */
    "producer    "   "|"    /*6  */
    "n_delercode "   "|"    /*7  */
    "fincode     "   "|"    /*8  */
    "appenno     "   "|"    /*9  */
    "salename    "   "|"    /*10 */
    "srate       "   "|"    /*11 */
    "comdat      "   "|"    /*12 */
    "expdat      "   "|"    /*13 */
    "agreedat    "   "|"    /*14 */
    "firstdat    "   "|"    /*15 */
    "packcod     "   "|"    /*16 */
    "camp_no     "   "|"    /*17 */
    "campen      "   "|"    /*18 */
    "specon      "   "|"    /*19 */
    "product     "   "|"    /*20 */
    "promo       "   "|"    /*21 */
    "rencnt      "   "|"    /*22 */
    "prepol      "   "|"    /*23 */
    "txt1        "   "|"    /*24 */
    "txt2        "   "|"    /*25 */
    "txt3        "   "|"    /*26 */
    "txt4        "   "|"    /*27 */
    "txt5        "   "|"    /*28 */
    "txt6        "   "|"    /*29 */
    "txt7        "   "|"    /*30 */
    "txt8        "   "|"    /*31 */
    "txt9        "   "|"    /*32 */
    "txt10       "   "|"    /*33 */
    "memo1       "   "|"    /*34 */
    "memo2       "   "|"    /*35 */
    "memo3       "   "|"    /*36 */
    "memo4       "   "|"    /*37 */
    "memo5       "   "|"    /*38 */
    "memo6       "   "|"    /*39 */
    "memo7       "   "|"    /*40 */
    "memo8       "   "|"    /*41 */
    "memo9       "   "|"    /*42 */
    "memo10      "   "|"    /*43 */
    "accdata1    "   "|"    /*44 */
    "accdata2    "   "|"    /*45 */
    "accdata3    "   "|"    /*46 */
    "accdata4    "   "|"    /*47 */
    "accdata5    "   "|"    /*48 */
    "accdata6    "   "|"    /*49 */
    "accdata7    "   "|"    /*50 */
    "accdata8    "   "|"    /*51 */
    "accdata9    "   "|"    /*52 */
    "accdata10   "   "|"    /*53 */
    "compul      "   "|"    /*54 */
    "insref      "   "|"    /*55 */
    "instyp      "   "|"    /*56 */
    "inslang     "   "|"    /*57 */
    "tiname      "   "|"    /*58 */
    "insnam      "   "|"    /*59 */
    "lastname    "   "|"    /*60 */
    "icno        "   "|"    /*61 */
    "insbr       "   "|"    /*62 */
    "occup       "   "|"    /*63 */
    "addr        "   "|"    /*64 */
    "tambon      "   "|"    /*65 */
    "amper       "   "|"    /*66 */
    "country     "   "|"    /*67 */
    "post        "   "|"    /*68 */
    "provcod     "   "|"    /*69 */
    "distcod     "   "|"    /*70 */
    "sdistcod    "   "|"    /*71 */
    "ae          "   "|"    /*72 */
    "jtl         "   "|"    /*73 */
    "ts          "   "|"    /*74 */
    "gender      "   "|"    /*75 */
    "tele1       "   "|"    /*76 */
    "tele2       "   "|"    /*77 */
    "mail1       "   "|"    /*78 */
    "mail2       "   "|"    /*79 */
    "mail3       "   "|"    /*80 */
    "mail4       "   "|"    /*81 */
    "mail5       "   "|"    /*82 */
    "mail6       "   "|"    /*83 */
    "mail7       "   "|"    /*84 */
    "mail8       "   "|"    /*85 */
    "mail9       "   "|"    /*86 */
    "mail10      "   "|"    /*87 */
    "fax         "   "|"    /*88 */
    "lineID      "   "|"    /*89 */
    "name2       "   "|"    /*90 */
    "name3       "   "|"    /*91 */
    "benname     "   "|"    /*92 */
    "payercod    "   "|"    /*93 */
    "vatcode     "   "|"    /*94 */
    "instcod1    "   "|"    /*95 */
    "insttyp1    "   "|"    /*96 */
    "insttitle1  "   "|"    /*97 */
    "instname1   "   "|"    /*98 */
    "instlname1  "   "|"    /*99 */
    "instic1     "   "|"    /*100*/
    "instbr1     "   "|"    /*101*/
    "instaddr11  "   "|"    /*102*/
    "instaddr21  "   "|"    /*103*/
    "instaddr31  "   "|"    /*104*/
    "instaddr41  "   "|"    /*105*/
    "instpost1   "   "|"    /*106*/
    "instprovcod1"   "|"    /*107*/
    "instdistcod1"   "|"    /*108*/
    "instsdistcod1 " "|"    /*109*/
    "instprm1    "   "|"    /*110*/
    "instrstp1   "   "|"    /*111*/
    "instrtax1   "   "|"    /*112*/
    "instcomm01  "   "|"    /*113*/
    "instcomm12  "   "|"    /*114*/
    "instcod2    "   "|"    /*115*/
    "insttyp2    "   "|"    /*116*/
    "insttitle2  "   "|"    /*117*/
    "instname2   "   "|"    /*118*/
    "instlname2  "   "|"    /*119*/
    "instic2     "   "|"    /*120*/
    "instbr2     "   "|"    /*121*/
    "instaddr12  "   "|"    /*122*/
    "instaddr22  "   "|"    /*123*/
    "instaddr32  "   "|"    /*124*/
    "instaddr42  "   "|"    /*125*/
    "instpost2   "   "|"    /*126*/
    "instprovcod2"   "|"    /*127*/
    "instdistcod2"   "|"    /*128*/
    "instsdistcod2 " "|"    /*129*/
    "instprm2    "   "|"    /*130*/
    "instrstp2   "   "|"    /*131*/
    "instrtax2   "   "|"    /*132*/
    "instcomm02  "   "|"    /*133*/
    "instcomm22  "   "|"    /*134*/
    "instcod3    "   "|"    /*135*/
    "insttyp3    "   "|"    /*136*/
    "insttitle3  "   "|"    /*137*/
    "instname3   "   "|"    /*138*/
    "instlname3  "   "|"    /*139*/
    "instic3     "   "|"    /*140*/
    "instbr3     "   "|"    /*141*/
    "instaddr13  "   "|"    /*142*/
    "instaddr23  "   "|"    /*143*/
    "instaddr33  "   "|"    /*144*/
    "instaddr43  "   "|"    /*145*/
    "instpost3   "   "|"    /*146*/
    "instprovcod3"   "|"    /*147*/
    "instdistcod3"   "|"    /*148*/
    "instsdistcod3 " "|"    /*149*/
    "instprm3    "   "|"    /*150*/
    "instrstp3   "   "|"    /*151*/
    "instrtax3   "   "|"    /*152*/
    "instcomm03  "   "|"    /*153*/
    "instcomm23  "   "|"    /*154*/
    "covcod      "   "|"    /*155*/
    "garage      "   "|"    /*156*/
    "special     "   "|"    /*157*/
    "inspec      "   "|"    /*158*/
    "class70     "   "|"    /*159*/
    "vehuse      "   "|"    /*160*/
    "redbook     "   "|"    /*161*/
    "brand       "   "|"    /*162*/
    "model       "   "|"    /*163*/
    "submodel    "   "|"    /*164*/
    "caryear     "   "|"    /*165*/
    "chasno      "   "|"    /*166*/
    "eng         "   "|"    /*167*/
    "eng_no2     "   "|"    /*168*/
    "seat        "   "|"    /*169*/
    "engcc       "   "|"    /*170*/
    "weight      "   "|"    /*171*/
    "watt        "   "|"    /*172*/
    "body        "   "|"    /*173*/
    "type        "   "|"    /*174*/
    "re_year     "   "|"    /*175*/
    "vehreg      "   "|"    /*176*/
    "re_country  "   "|"    /*177*/
    "cargrp      "   "|"    /*178*/
    "colorcar    "   "|"    /*179*/
    "fule        "   "|"    /*180*/
    "drivnam     "   "|"    /*181*/
    "ntitle1     "   "|"    /*182*/
    "drivername1 "   "|"    /*183*/
    "dname2      "   "|"    /*184*/
    "dicno       "   "|"    /*185*/
    "dgender1    "   "|"    /*186*/
    "dbirth      "   "|"    /*187*/
    "docoup      "   "|"    /*188*/
    "ddriveno    "   "|"    /*189*/
    "drivexp1    "   "|"    /*190*/
    "dlevel1     "   "|"    /*191*/
    "ntitle2     "   "|"    /*192*/
    "drivername2 "   "|"    /*193*/
    "ddname1     "   "|"    /*194*/
    "ddicno      "   "|"    /*195*/
    "dgender2    "   "|"    /*196*/
    "ddbirth     "   "|"    /*197*/
    "ddocoup     "   "|"    /*198*/
    "dddriveno   "   "|"    /*199*/
    "drivexp2    "   "|"    /*200*/
    "dlevel2     "   "|"    /*201*/
    "ntitle3     "   "|"    /*202*/
    "dname3      "   "|"    /*203*/
    "dlname3     "   "|"    /*204*/
    "dicno3      "   "|"    /*205*/
    "dgender3    "   "|"    /*206*/
    "dbirth3     "   "|"    /*207*/
    "docoup3     "   "|"    /*208*/
    "ddriveno3   "   "|"    /*209*/
    "drivexp3    "   "|"    /*210*/
    "dlevel3     "   "|"    /*211*/
    "ntitle4     "   "|"    /*212*/
    "dname4      "   "|"    /*213*/
    "dlname4     "   "|"    /*214*/
    "dicno4      "   "|"    /*215*/
    "dgender4    "   "|"    /*216*/
    "dbirth4     "   "|"    /*217*/
    "docoup4     "   "|"    /*218*/
    "ddriveno4   "   "|"    /*219*/
    "drivexp4    "   "|"    /*220*/
    "dlevel4     "   "|"    /*221*/
    "ntitle5     "   "|"    /*222*/
    "dname5      "   "|"    /*223*/
    "dlname5     "   "|"    /*224*/
    "dicno5      "   "|"    /*225*/
    "dgender5    "   "|"    /*226*/
    "dbirth5     "   "|"    /*227*/
    "docoup5     "   "|"    /*228*/
    "ddriveno5   "   "|"    /*229*/
    "drivexp5    "   "|"    /*230*/
    "dlevel5     "   "|"    /*231*/
    "baseplus    "   "|"    /*232*/
    "siplus      "   "|"    /*233*/
    "rs10        "   "|"    /*234*/
    "comper      "   "|"    /*235*/
    "comacc      "   "|"    /*236*/
    "deductpd    "   "|"    /*237*/
    "DOD         "   "|"    /*238*/
    "DPD         "   "|"    /*239*/
    "maksi       "   "|"    /*240*/
    "tpfire      "   "|"    /*241*/
    "NO_41       "   "|"    /*242*/
    "ac2         "   "|"    /*243*/
    "ac4         "   "|"    /*244*/
    "ac5         "   "|"    /*245*/
    "ac6         "   "|"    /*246*/
    "ac7         "   "|"    /*247*/
    "NO_42       "   "|"    /*248*/
    "NO_43       "   "|"    /*249*/
    "base        "   "|"    /*250*/
    "unname      "   "|"    /*251*/
    "nname       "   "|"    /*252*/
    "tpbi        "   "|"    /*253*/
    "tppd        "   "|"    /*254*/
    "ry01        "   "|"    /*255*/
    "ry02        "   "|"    /*256*/
    "ry03        "   "|"    /*257*/
    "fleet       "   "|"    /*258*/
    "ncb         "   "|"    /*259*/
    "claim       "   "|"    /*260*/
    "dspc        "   "|"    /*261*/
    "cctv        "   "|"    /*262*/
    "dstf        "   "|"    /*263*/
    "fleetprem   "   "|"    /*264*/
    "ncbprem     "   "|"    /*265*/
    "clprem      "   "|"    /*266*/
    "dspcprem    "   "|"    /*267*/
    "cctvprem    "   "|"    /*268*/
    "dstfprem    "   "|"    /*269*/
    "premt       "   "|"    /*270*/
    "rstp_t      "   "|"    /*271*/
    "rtax_t      "   "|"    /*272*/
    "comper70    "   "|"    /*273*/
    "comprem70   "   "|"    /*274*/
    "agco70      "   "|"    /*275*/
    "comco_per70 "   "|"    /*276*/
    "comco_prem70"   "|"    /*277*/
    "dgpackge    "   "|"    /*278*/
    "danger1     "   "|"    /*279*/
    "danger2     "   "|"    /*280*/
    "dgsi        "   "|"    /*281*/
    "dgrate      "   "|"    /*282*/
    "dgfeet      "   "|"    /*283*/
    "dgncb       "   "|"    /*284*/
    "dgdisc      "   "|"    /*285*/
    "dgwdisc     "   "|"    /*286*/
    "dgatt       "   "|"    /*287*/
    "dgfeetprm   "   "|"    /*288*/
    "dgncbprm    "   "|"    /*289*/
    "dgdiscprm   "   "|"    /*290*/
    "dgWdiscprm  "   "|"    /*291*/
    "dgprem      "   "|"    /*292*/
    "dgrstp_t    "   "|"    /*293*/
    "dgrtax_t    "   "|"    /*294*/
    "dgcomper    "   "|"    /*295*/
    "dgcomprem   "   "|"    /*296*/
    "cltxt       "   "|"    /*297*/
    "clamount    "   "|"    /*298*/
    "faultno     "   "|"    /*299*/
    "faultprm    "   "|"    /*300*/
    "goodno      "   "|"    /*301*/
    "goodprm     "   "|"    /*302*/
    "loss        "   "|"    /*303*/
    "compolusory "   "|"    /*304*/
    "barcode     "   "|"    /*305*/
    "class72     "   "|"    /*306*/
    "dstf72      "   "|"    /*307*/
    "dstfprem72  "   "|"    /*308*/
    "premt72     "   "|"    /*309*/
    "rstp_t72    "   "|"    /*310*/
    "rtax_t72    "   "|"    /*311*/
    "comper72    "   "|"    /*312*/
    "comprem72   "   "|"    /*313*/
    "battno      "   "|"    /*314*/
    "battyr      "   "|"    /*315*/
    "battprice   "   "|"    /*316*/
    "battper     "   "|"    /*317*/
    "battrate    "   "|"    /*318*/
    "battsi      "   "|"    /*319*/
    "battprm     "   "|"    /*320*/
    "chargno     "   "|"    /*321*/
    "chargsi     "   "|"    /*322*/
    "chargrate   "   "|"    /*323*/
    "chargprm    "   "|"    /*324*/
    "Comment    "     SKIP .            
    RUN proc_report1_detail.
END.                                                                                    
OUTPUT STREAM ns1 CLOSE.                                                      
END.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_report1_detail C-Win 
PROCEDURE proc_report1_detail :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes: add by A67-0029      
------------------------------------------------------------------------------*/
DO:
 FOR EACH wdetail WHERE wdetail.PASS <> "Y" NO-LOCK /*BY wdetail.itemno*/ .
    FIND FIRST wtxt   WHERE wtxt.policyno   = wdetail.policyno  NO-LOCK NO-ERROR .
    FIND FIRST wmemo  WHERE wmemo.policyno  = wdetail.policyno  NO-LOCK NO-ERROR .
    FIND FIRST wacces WHERE wacces.policyno = wdetail.policyno  NO-LOCK NO-ERROR .
    FIND FIRST winst  WHERE winst.policyno  = wdetail.policyno  NO-LOCK NO-ERROR .
    FIND FIRST wdrive WHERE wdrive.policy  = wdetail.policyno  NO-LOCK NO-ERROR .
    PUT STREAM ns1
    wdetail.riskno       "|"    /*A64-0355*/  /*1  */  
    wdetail.itemno       "|"                  /*2  */  
    wdetail.policyno FORMAT "x(16)" "|"       /*3  */  
    wdetail.n_branch     "|"                  /*4  */  
    wdetail.agent        "|"                  /*5  */  
    wdetail.producer     "|"                  /*6  */  
    wdetail.n_delercode  "|"                  /*7  */  
    wdetail.fincode      "|"                  /*8  */  
    wdetail.appenno      "|"                  /*9  */  
    wdetail.salename     "|"                  /*10 */  
    wdetail.srate        "|"                  /*11 */  
    wdetail.comdat       "|"                  /*12 */  
    wdetail.expdat       "|"                  /*13 */  
    wdetail.agreedat     "|"                  /*14 */  
    wdetail.firstdat     "|"                  /*15 */  
    wdetail.packcod      "|"                  /*16 */  
    wdetail.camp_no      "|"                  /*17 */  
    wdetail.campen       "|"                  /*18 */  
    wdetail.specon       "|"                  /*19 */  
    wdetail.product      "|"                  /*20 */  
    wdetail.promo        "|"                  /*21 */  
    wdetail.rencnt       "|"                  /*22 */  
    wdetail.prepol       "|"                  /*23 */  
    wtxt.txt1            "|"                  /*24 */  
    wtxt.txt2            "|"                  /*25 */  
    wtxt.txt3            "|"                  /*26 */  
    wtxt.txt4            "|"                  /*27 */  
    wtxt.txt5            "|"                  /*28 */  
    wtxt.txt6            "|"                  /*29 */  
    wtxt.txt7            "|"                  /*30 */  
    wtxt.txt8            "|"                  /*31 */  
    wtxt.txt9            "|"                  /*32 */  
    wtxt.txt10           "|"                  /*33 */  
    wmemo.memo1           "|"                 /*34 */  
    wmemo.memo2           "|"                 /*35 */  
    wmemo.memo3           "|"                 /*36 */  
    wmemo.memo4           "|"                 /*37 */  
    wmemo.memo5           "|"                 /*38 */  
    wmemo.memo6           "|"                 /*39 */  
    wmemo.memo7           "|"                 /*40 */  
    wmemo.memo8           "|"                 /*41 */  
    wmemo.memo9           "|"                 /*42 */  
    wmemo.memo10          "|"                 /*43 */  
    wacces.accdata1       "|"                 /*44 */  
    wacces.accdata2       "|"                 /*45 */  
    wacces.accdata3       "|"                 /*46 */  
    wacces.accdata4       "|"                 /*47 */  
    wacces.accdata5       "|"                 /*48 */  
    wacces.accdata6       "|"                 /*49 */  
    wacces.accdata7       "|"                 /*50 */  
    wacces.accdata8       "|"                 /*51 */  
    wacces.accdata9       "|"                 /*52 */  
    wacces.accdata10      "|"                 /*53 */  
    wdetail.compul        "|"                 /*54 */  
    wdetail.nv_insref     "|" /*A64-0355*/    /*55 */  
    wdetail.instyp        "|"                 /*56 */  
    wdetail.inslang       "|"                 /*57 */  
    wdetail.tiname        "|"                 /*58 */  
    wdetail.insnam        "|"                 /*59 */  
    wdetail.lastname      "|"                 /*60 */  
    wdetail.icno          "|"                 /*61 */  
    wdetail.insbr         "|"                 /*62 */  
    wdetail.occup         "|"                 /*63 */  
    wdetail.addr          "|"                 /*64 */  
    wdetail.tambon        "|"                 /*65 */  
    wdetail.amper         "|"                 /*66 */  
    wdetail.country       "|"                 /*67 */  
    wdetail.post          "|"                 /*68 */  
    wdetail.provcod       "|"                 /*69 */  
    wdetail.distcod       "|"                 /*70 */  
    wdetail.sdistcod      "|"                 /*71 */  
    wdetail.jpae          "|"  /*A64-0355*/   /*72 */  
    wdetail.jpjtl         "|"  /*A64-0355*/   /*73 */  
    wdetail.jpts          "|"  /*A64-0355*/   /*74 */  
    wdetail.gender        "|"                 /*75 */  
    wdetail.tele1         "|"                 /*76 */  
    wdetail.tele2         "|"                 /*77 */  
    wdetail.mail1         "|"                 /*78 */  
    wdetail.mail2         "|"                 /*79 */  
    wdetail.mail3         "|"                 /*80 */  
    wdetail.mail4         "|"                 /*81 */  
    wdetail.mail5         "|"                 /*82 */  
    wdetail.mail6         "|"                 /*83 */  
    wdetail.mail7         "|"                 /*84 */  
    wdetail.mail8         "|"                 /*85 */  
    wdetail.mail9         "|"                 /*86 */  
    wdetail.mail10        "|"                 /*87 */  
    wdetail.fax           "|"                 /*88 */  
    wdetail.lineID        "|"                 /*89 */  
    wdetail.name2         "|"                 /*90 */  
    wdetail.name3         "|"                 /*91 */  
    wdetail.benname       "|"                 /*92 */  
    wdetail.payercod      "|"                 /*93 */  
    wdetail.vatcode       "|"                 /*94 */  
    winst.instcod1        "|"                 /*95 */  
    winst.insttyp1        "|"                 /*96 */  
    winst.insttitle1      "|"                 /*97 */  
    winst.instname1       "|"                 /*98 */  
    winst.instlname1      "|"                 /*99 */  
    winst.instic1         "|"                 /*100*/  
    winst.instbr1         "|"                 /*101*/  
    winst.instaddr11      "|"                 /*102*/  
    winst.instaddr21      "|"                 /*103*/  
    winst.instaddr31      "|"                 /*104*/  
    winst.instaddr41      "|"                 /*105*/  
    winst.instpost1       "|"                 /*106*/  
    winst.instprovcod1    "|"                 /*107*/  
    winst.instdistcod1    "|"                 /*108*/  
    winst.instsdistcod1   "|"                 /*109*/  
    winst.instprm1        "|"                 /*110*/  
    winst.instrstp1       "|"                 /*111*/  
    winst.instrtax1       "|"                 /*112*/  
    winst.instcomm01      "|"                 /*113*/  
    winst.instcomm12      "|"                 /*114*/  
    winst.instcod2        "|"                 /*115*/  
    winst.insttyp2        "|"                 /*116*/  
    winst.insttitle2      "|"                 /*117*/  
    winst.instname2       "|"                 /*118*/  
    winst.instlname2      "|"                 /*119*/  
    winst.instic2         "|"                 /*120*/  
    winst.instbr2         "|"                 /*121*/  
    winst.instaddr12      "|"                 /*122*/  
    winst.instaddr22      "|"                 /*123*/  
    winst.instaddr32      "|"                 /*124*/  
    winst.instaddr42      "|"                 /*125*/  
    winst.instpost2       "|"                 /*126*/  
    winst.instprovcod2    "|"                 /*127*/  
    winst.instdistcod2    "|"                 /*128*/  
    winst.instsdistcod2   "|"                 /*129*/  
    winst.instprm2        "|"                 /*130*/  
    winst.instrstp2       "|"                 /*131*/  
    winst.instrtax2       "|"                 /*132*/  
    winst.instcomm02      "|"                 /*133*/  
    winst.instcomm22      "|"                 /*134*/  
    winst.instcod3        "|"                 /*135*/  
    winst.insttyp3        "|"                 /*136*/  
    winst.insttitle3      "|"                 /*137*/  
    winst.instname3       "|"                 /*138*/  
    winst.instlname3      "|"                 /*139*/  
    winst.instic3         "|"                 /*140*/  
    winst.instbr3         "|"                 /*141*/  
    winst.instaddr13      "|"                 /*142*/  
    winst.instaddr23      "|"                 /*143*/  
    winst.instaddr33      "|"                 /*144*/  
    winst.instaddr43      "|"                 /*145*/  
    winst.instpost3       "|"                 /*146*/  
    winst.instprovcod3    "|"                 /*147*/  
    winst.instdistcod3    "|"                 /*148*/  
    winst.instsdistcod3   "|"                 /*149*/  
    winst.instprm3        "|"                 /*150*/  
    winst.instrstp3       "|"                 /*151*/  
    winst.instrtax3       "|"                 /*152*/  
    winst.instcomm03      "|"                 /*153*/  
    winst.instcomm23      "|"                 /*154*/  
    wdetail.covcod        "|"                 /*155*/  
    wdetail.garage        "|"                 /*156*/  
    wdetail.special       "|"                 /*157*/  
    wdetail.inspec        "|"                 /*158*/  
    wdetail.class70       "|"                 /*159*/  
    wdetail.vehuse        "|"  /* A65-0079*/  /*160*/  
    wdetail.redbook       "|"  /* A65-0079*/  /*161*/  
    wdetail.brand         "|"                 /*162*/  
    wdetail.model         "|"                 /*163*/  
    wdetail.submodel      "|"                 /*164*/  
    wdetail.yrmanu        "|"                 /*165*/  
    wdetail.chasno        "|"                 /*166*/  
    wdetail.eng           "|"                 /*167*/  
    wdetail.eng_no2       "|"                 /*168*/  
    wdetail.seat41        "|"                 /*169*/  
    wdetail.engcc         "|"                 /*170*/  
    wdetail.weight        "|"                 /*171*/  
    wdetail.watt          "|"                 /*172*/  
    wdetail.body          "|"                 /*173*/  
    wdetail.typ           "|"                 /*174*/  
    wdetail.re_year       "|"                 /*175*/  
    wdetail.vehreg        "|"                 /*176*/  
    wdetail.re_country    "|"                 /*177*/  
    wdetail.cargrp        "|"                 /*178*/  
    wdetail.colorcar      "|"                 /*179*/  
    wdetail.fule          "|"                 /*180*/  
    wdetail.drivnam       "|"                 /*181*/  
    wdrive.ntitle1        "|"                 /*182*/  
    wdrive.name1          "|"                 /*183*/  
    wdrive.lname1         "|"                 /*184*/  
    wdrive.dicno1         "|"                 /*185*/  
    wdrive.dgender1       "|"                 /*186*/  
    wdrive.dbirth1        "|"                 /*187*/  
    wdrive.doccup1        "|"                 /*188*/  
    wdrive.ddriveno1      "|"                 /*189*/  
    wdrive.drivexp1       "|"                 /*190*/  
    wdrive.dlevel1        "|"                 /*191*/  
    wdrive.ntitle2        "|"                 /*192*/  
    wdrive.name2          "|"                 /*193*/  
    wdrive.lname2         "|"                 /*194*/  
    wdrive.dicno2         "|"                 /*195*/  
    wdrive.dgender2       "|"                 /*196*/  
    wdrive.dbirth2        "|"                 /*197*/  
    wdrive.doccup2        "|"                 /*198*/  
    wdrive.ddriveno2      "|"                 /*199*/  
    wdrive.drivexp2       "|"                 /*200*/  
    wdrive.dlevel2        "|"                 /*201*/  
    wdrive.ntitle3        "|"                 /*202*/  
    wdrive.name3          "|"                 /*203*/  
    wdrive.lname3         "|"                 /*204*/  
    wdrive.dicno3         "|"                 /*205*/  
    wdrive.dgender3       "|"                 /*206*/  
    wdrive.dbirth3        "|"                 /*207*/  
    wdrive.doccup3        "|"                 /*208*/  
    wdrive.ddriveno3      "|"                 /*209*/  
    wdrive.drivexp3       "|"                 /*210*/  
    wdrive.dlevel3        "|"                 /*211*/  
    wdrive.ntitle4        "|"                 /*212*/  
    wdrive.name4          "|"                 /*213*/  
    wdrive.lname4         "|"                 /*214*/  
    wdrive.dicno4         "|"                 /*215*/  
    wdrive.dgender4       "|"                 /*216*/  
    wdrive.dbirth4        "|"                 /*217*/  
    wdrive.doccup4        "|"                 /*218*/  
    wdrive.ddriveno4      "|"                 /*219*/  
    wdrive.drivexp4       "|"                 /*220*/  
    wdrive.dlevel4        "|"                 /*221*/  
    wdrive.ntitle5        "|"                 /*222*/  
    wdrive.name5          "|"                 /*223*/  
    wdrive.lname5         "|"                 /*224*/  
    wdrive.dicno5         "|"                 /*225*/  
    wdrive.dgender5       "|"                 /*226*/  
    wdrive.dbirth5        "|"                 /*227*/  
    wdrive.doccup5        "|"                 /*228*/  
    wdrive.ddriveno5      "|"                 /*229*/  
    wdrive.drivexp5       "|"                 /*230*/  
    wdrive.dlevel5        "|"                 /*231*/  
    wdetail.baseplus      "|"                 /*232*/  
    wdetail.siplus        "|"                 /*233*/  
    wdetail.rs10          "|"                 /*234*/  
    wdetail.comper      "|"                   /*235*/  
    wdetail.comacc      "|"                   /*236*/  
    wdetail.deductpd      "|"                 /*237*/  
    wdetail.DOD           "|"                 /*238*/  
    wdetail.DPD           "|"                 /*239*/  
    wdetail.maksi         "|"                 /*240*/  
    wdetail.si            "|"                 /*241*/  
    wdetail.NO_411        "|"                 /*242*/  
    wdetail.seat41        "|"                 /*243*/  
    wdetail.NO_412        "|"                 /*244*/  
    wdetail.NO_413        "|"                 /*245*/  
    wdetail.ac6           "|"                 /*246*/  
    wdetail.NO_414        "|"                 /*247*/  
    wdetail.NO_42         "|"                 /*248*/  
    wdetail.NO_43         "|"                 /*249*/  
    wdetail.base          "|"                 /*250*/  
    wdetail.unname        "|"                 /*251*/  
    wdetail.nname         "|"                 /*252*/  
    wdetail.tpbi          "|"                 /*253*/  
    wdetail.tppd          "|"                 /*254*/  
    wdetail.ry01          "|"                 /*255*/  
    wdetail.ry02          "|"                 /*256*/  
    wdetail.ry03          "|"                 /*257*/  
    wdetail.fleet         "|"                 /*258*/  
    wdetail.ncb           "|"                 /*259*/  
    wdetail.claim         "|"                 /*260*/  
    wdetail.dspc          "|"                 /*261*/  
    wdetail.cctv          "|"                 /*262*/  
    wdetail.dstf          "|"                 /*263*/  
    wdetail.fleetprem     "|"                 /*264*/  
    wdetail.ncbprem       "|"                 /*265*/  
    wdetail.clprem        "|"                 /*266*/  
    wdetail.dspcprem      "|"                 /*267*/  
    wdetail.cctvprem      "|"                 /*268*/  
    wdetail.dstfprem      "|"                 /*269*/  
    wdetail.premt         "|"                 /*270*/  
    wdetail.rstp_t        "|"                 /*271*/  
    wdetail.rtax_t        "|"                 /*272*/  
    wdetail.comper70      "|"                 /*273*/  
    wdetail.comprem70     "|"                 /*274*/  
    wdetail.agco70        "|"                 /*275*/  
    wdetail.comco_per70   "|"                 /*276*/  
    wdetail.comco_prem70  "|"                 /*277*/  
    wdetail.dgpackge      "|"                 /*278*/  
    wdetail.danger1       "|"                 /*279*/  
    wdetail.danger2       "|"                 /*280*/  
    wdetail.dgsi          "|"                 /*281*/  
    wdetail.dgrate        "|"                 /*282*/  
    wdetail.dgfeet        "|"                 /*283*/  
    wdetail.dgncb         "|"                 /*284*/  
    wdetail.dgdisc        "|"                 /*285*/  
    wdetail.dgWdisc       "|"                 /*286*/  
    wdetail.dgatt         "|"                 /*287*/  
    wdetail.dgfeetprm     "|"                 /*288*/  
    wdetail.dgncbprm      "|"                 /*289*/  
    wdetail.dgdiscprm     "|"                 /*290*/  
    wdetail.dgWdiscprm    "|"                 /*291*/  
    wdetail.dgprem        "|"                 /*292*/  
    wdetail.dgrstp_t      "|"                 /*293*/  
    wdetail.dgrtax_t      "|"                 /*294*/  
    wdetail.dgcomper      "|"                 /*295*/  
    wdetail.dgcomprem     "|"                 /*296*/  
    wdetail.cltxt         "|"                 /*297*/  
    wdetail.clamount      "|"                 /*298*/  
    wdetail.faultno       "|"                 /*299*/  
    wdetail.faultprm      "|"                 /*300*/  
    wdetail.goodno        "|"                 /*301*/  
    wdetail.goodprm       "|"                 /*302*/  
    wdetail.loss          "|"                 /*303*/  
    wdetail.compolusory   "|"                 /*304*/  
    wdetail.stk           "|"                 /*305*/  
    wdetail.class72       "|"                 /*306*/  
    wdetail.dstf72        "|"                 /*307*/  
    wdetail.dstfprem72    "|"                 /*308*/  
    wdetail.premt72       "|"                 /*309*/  
    wdetail.rstp_t72      "|"                 /*310*/  
    wdetail.rtax_t72      "|"                 /*311*/  
    wdetail.comper72      "|"                 /*312*/  
    wdetail.comprem72     "|"                 /*313*/  
    wdetail.battno       "|"                  /*314*/  
    wdetail.battyr       "|"                  /*315*/  
    wdetail.battprice    "|"                  /*316*/  
    wdetail.battper      "|"                  /*317*/  
    wdetail.battrate     "|"                  /*318*/  
    wdetail.battsi       "|"                  /*319*/  
    wdetail.battprm      "|"                  /*320*/  
    wdetail.chargno      "|"                  /*321*/  
    wdetail.chargsi      "|"                  /*322*/  
    wdetail.chargrate    "|"                  /*323*/  
    wdetail.chargprm     "|"                  /*324*/  
    wdetail.comment       SKIP .
 END.
END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_report2 C-Win 
PROCEDURE proc_report2 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes: add by A67-0029     
------------------------------------------------------------------------------*/
DEF VAR HEAD AS CHAR INIT "Y".
nv_row  =  1.
DEF VAR a AS CHAR FORMAT "x(20)" INIT "".
DEF VAR b AS CHAR FORMAT "x(20)" INIT "".
DEF VAR c AS INTE INIT 0.
DEF VAR d AS INTE INIT 0.
DEF VAR f AS CHAR FORMAT "x(20)" INIT "".
DEF VAR pass AS INTE INIT 0.
FOR EACH  wdetail  WHERE wdetail.PASS = "Y":
        pass = pass + 1.
END.
IF pass > 0 THEN DO:
    OUTPUT STREAM ns2 TO value(fi_output1).
    PUT STREAM NS2
    "riskno      "   "|"    /*1  */
    "num         "   "|"    /*2  */
    "policyno    "   "|"    /*3  */
    "n_branch    "   "|"    /*4  */
    "agent       "   "|"    /*5  */
    "producer    "   "|"    /*6  */
    "n_delercode "   "|"    /*7  */
    "fincode     "   "|"    /*8  */
    "appenno     "   "|"    /*9  */
    "salename    "   "|"    /*10 */
    "srate       "   "|"    /*11 */
    "comdat      "   "|"    /*12 */
    "expdat      "   "|"    /*13 */
    "agreedat    "   "|"    /*14 */
    "firstdat    "   "|"    /*15 */
    "packcod     "   "|"    /*16 */
    "camp_no     "   "|"    /*17 */
    "campen      "   "|"    /*18 */
    "specon      "   "|"    /*19 */
    "product     "   "|"    /*20 */
    "promo       "   "|"    /*21 */
    "rencnt      "   "|"    /*22 */
    "prepol      "   "|"    /*23 */
    "txt1        "   "|"    /*24 */
    "txt2        "   "|"    /*25 */
    "txt3        "   "|"    /*26 */
    "txt4        "   "|"    /*27 */
    "txt5        "   "|"    /*28 */
    "txt6        "   "|"    /*29 */
    "txt7        "   "|"    /*30 */
    "txt8        "   "|"    /*31 */
    "txt9        "   "|"    /*32 */
    "txt10       "   "|"    /*33 */
    "memo1       "   "|"    /*34 */
    "memo2       "   "|"    /*35 */
    "memo3       "   "|"    /*36 */
    "memo4       "   "|"    /*37 */
    "memo5       "   "|"    /*38 */
    "memo6       "   "|"    /*39 */
    "memo7       "   "|"    /*40 */
    "memo8       "   "|"    /*41 */
    "memo9       "   "|"    /*42 */
    "memo10      "   "|"    /*43 */
    "accdata1    "   "|"    /*44 */
    "accdata2    "   "|"    /*45 */
    "accdata3    "   "|"    /*46 */
    "accdata4    "   "|"    /*47 */
    "accdata5    "   "|"    /*48 */
    "accdata6    "   "|"    /*49 */
    "accdata7    "   "|"    /*50 */
    "accdata8    "   "|"    /*51 */
    "accdata9    "   "|"    /*52 */
    "accdata10   "   "|"    /*53 */
    "compul      "   "|"    /*54 */
    "insref      "   "|"    /*55 */
    "instyp      "   "|"    /*56 */
    "inslang     "   "|"    /*57 */
    "tiname      "   "|"    /*58 */
    "insnam      "   "|"    /*59 */
    "lastname    "   "|"    /*60 */
    "icno        "   "|"    /*61 */
    "insbr       "   "|"    /*62 */
    "occup       "   "|"    /*63 */
    "addr        "   "|"    /*64 */
    "tambon      "   "|"    /*65 */
    "amper       "   "|"    /*66 */
    "country     "   "|"    /*67 */
    "post        "   "|"    /*68 */
    "provcod     "   "|"    /*69 */
    "distcod     "   "|"    /*70 */
    "sdistcod    "   "|"    /*71 */
    "ae          "   "|"    /*72 */
    "jtl         "   "|"    /*73 */
    "ts          "   "|"    /*74 */
    "gender      "   "|"    /*75 */
    "tele1       "   "|"    /*76 */
    "tele2       "   "|"    /*77 */
    "mail1       "   "|"    /*78 */
    "mail2       "   "|"    /*79 */
    "mail3       "   "|"    /*80 */
    "mail4       "   "|"    /*81 */
    "mail5       "   "|"    /*82 */
    "mail6       "   "|"    /*83 */
    "mail7       "   "|"    /*84 */
    "mail8       "   "|"    /*85 */
    "mail9       "   "|"    /*86 */
    "mail10      "   "|"    /*87 */
    "fax         "   "|"    /*88 */
    "lineID      "   "|"    /*89 */
    "name2       "   "|"    /*90 */
    "name3       "   "|"    /*91 */
    "benname     "   "|"    /*92 */
    "payercod    "   "|"    /*93 */
    "vatcode     "   "|"    /*94 */
    "instcod1    "   "|"    /*95 */
    "insttyp1    "   "|"    /*96 */
    "insttitle1  "   "|"    /*97 */
    "instname1   "   "|"    /*98 */
    "instlname1  "   "|"    /*99 */
    "instic1     "   "|"    /*100*/
    "instbr1     "   "|"    /*101*/
    "instaddr11  "   "|"    /*102*/
    "instaddr21  "   "|"    /*103*/
    "instaddr31  "   "|"    /*104*/
    "instaddr41  "   "|"    /*105*/
    "instpost1   "   "|"    /*106*/
    "instprovcod1"   "|"    /*107*/
    "instdistcod1"   "|"    /*108*/
    "instsdistcod1 " "|"    /*109*/
    "instprm1    "   "|"    /*110*/
    "instrstp1   "   "|"    /*111*/
    "instrtax1   "   "|"    /*112*/
    "instcomm01  "   "|"    /*113*/
    "instcomm12  "   "|"    /*114*/
    "instcod2    "   "|"    /*115*/
    "insttyp2    "   "|"    /*116*/
    "insttitle2  "   "|"    /*117*/
    "instname2   "   "|"    /*118*/
    "instlname2  "   "|"    /*119*/
    "instic2     "   "|"    /*120*/
    "instbr2     "   "|"    /*121*/
    "instaddr12  "   "|"    /*122*/
    "instaddr22  "   "|"    /*123*/
    "instaddr32  "   "|"    /*124*/
    "instaddr42  "   "|"    /*125*/
    "instpost2   "   "|"    /*126*/
    "instprovcod2"   "|"    /*127*/
    "instdistcod2"   "|"    /*128*/
    "instsdistcod2 " "|"    /*129*/
    "instprm2    "   "|"    /*130*/
    "instrstp2   "   "|"    /*131*/
    "instrtax2   "   "|"    /*132*/
    "instcomm02  "   "|"    /*133*/
    "instcomm22  "   "|"    /*134*/
    "instcod3    "   "|"    /*135*/
    "insttyp3    "   "|"    /*136*/
    "insttitle3  "   "|"    /*137*/
    "instname3   "   "|"    /*138*/
    "instlname3  "   "|"    /*139*/
    "instic3     "   "|"    /*140*/
    "instbr3     "   "|"    /*141*/
    "instaddr13  "   "|"    /*142*/
    "instaddr23  "   "|"    /*143*/
    "instaddr33  "   "|"    /*144*/
    "instaddr43  "   "|"    /*145*/
    "instpost3   "   "|"    /*146*/
    "instprovcod3"   "|"    /*147*/
    "instdistcod3"   "|"    /*148*/
    "instsdistcod3 " "|"    /*149*/
    "instprm3    "   "|"    /*150*/
    "instrstp3   "   "|"    /*151*/
    "instrtax3   "   "|"    /*152*/
    "instcomm03  "   "|"    /*153*/
    "instcomm23  "   "|"    /*154*/
    "covcod      "   "|"    /*155*/
    "garage      "   "|"    /*156*/
    "special     "   "|"    /*157*/
    "inspec      "   "|"    /*158*/
    "class70     "   "|"    /*159*/
    "vehuse      "   "|"    /*160*/
    "redbook     "   "|"    /*161*/
    "brand       "   "|"    /*162*/
    "model       "   "|"    /*163*/
    "submodel    "   "|"    /*164*/
    "caryear     "   "|"    /*165*/
    "chasno      "   "|"    /*166*/
    "eng         "   "|"    /*167*/
    "eng_no2     "   "|"    /*168*/
    "seat        "   "|"    /*169*/
    "engcc       "   "|"    /*170*/
    "weight      "   "|"    /*171*/
    "watt        "   "|"    /*172*/
    "body        "   "|"    /*173*/
    "type        "   "|"    /*174*/
    "re_year     "   "|"    /*175*/
    "vehreg      "   "|"    /*176*/
    "re_country  "   "|"    /*177*/
    "cargrp      "   "|"    /*178*/
    "colorcar    "   "|"    /*179*/
    "fule        "   "|"    /*180*/
    "drivnam     "   "|"    /*181*/
    "ntitle1     "   "|"    /*182*/
    "drivername1 "   "|"    /*183*/
    "dname2      "   "|"    /*184*/
    "dicno       "   "|"    /*185*/
    "dgender1    "   "|"    /*186*/
    "dbirth      "   "|"    /*187*/
    "docoup      "   "|"    /*188*/
    "ddriveno    "   "|"    /*189*/
    "drivexp1    "   "|"    /*190*/
    "dlevel1     "   "|"    /*191*/
    "ntitle2     "   "|"    /*192*/
    "drivername2 "   "|"    /*193*/
    "ddname1     "   "|"    /*194*/
    "ddicno      "   "|"    /*195*/
    "dgender2    "   "|"    /*196*/
    "ddbirth     "   "|"    /*197*/
    "ddocoup     "   "|"    /*198*/
    "dddriveno   "   "|"    /*199*/
    "drivexp2    "   "|"    /*200*/
    "dlevel2     "   "|"    /*201*/
    "ntitle3     "   "|"    /*202*/
    "dname3      "   "|"    /*203*/
    "dlname3     "   "|"    /*204*/
    "dicno3      "   "|"    /*205*/
    "dgender3    "   "|"    /*206*/
    "dbirth3     "   "|"    /*207*/
    "docoup3     "   "|"    /*208*/
    "ddriveno3   "   "|"    /*209*/
    "drivexp3    "   "|"    /*210*/
    "dlevel3     "   "|"    /*211*/
    "ntitle4     "   "|"    /*212*/
    "dname4      "   "|"    /*213*/
    "dlname4     "   "|"    /*214*/
    "dicno4      "   "|"    /*215*/
    "dgender4    "   "|"    /*216*/
    "dbirth4     "   "|"    /*217*/
    "docoup4     "   "|"    /*218*/
    "ddriveno4   "   "|"    /*219*/
    "drivexp4    "   "|"    /*220*/
    "dlevel4     "   "|"    /*221*/
    "ntitle5     "   "|"    /*222*/
    "dname5      "   "|"    /*223*/
    "dlname5     "   "|"    /*224*/
    "dicno5      "   "|"    /*225*/
    "dgender5    "   "|"    /*226*/
    "dbirth5     "   "|"    /*227*/
    "docoup5     "   "|"    /*228*/
    "ddriveno5   "   "|"    /*229*/
    "drivexp5    "   "|"    /*230*/
    "dlevel5     "   "|"    /*231*/
    "baseplus    "   "|"    /*232*/
    "siplus      "   "|"    /*233*/
    "rs10        "   "|"    /*234*/
    "comper      "   "|"    /*235*/
    "comacc      "   "|"    /*236*/
    "deductpd    "   "|"    /*237*/
    "DOD         "   "|"    /*238*/
    "DPD         "   "|"    /*239*/
    "maksi       "   "|"    /*240*/
    "tpfire      "   "|"    /*241*/
    "NO_41       "   "|"    /*242*/
    "ac2         "   "|"    /*243*/
    "ac4         "   "|"    /*244*/
    "ac5         "   "|"    /*245*/
    "ac6         "   "|"    /*246*/
    "ac7         "   "|"    /*247*/
    "NO_42       "   "|"    /*248*/
    "NO_43       "   "|"    /*249*/
    "base        "   "|"    /*250*/
    "unname      "   "|"    /*251*/
    "nname       "   "|"    /*252*/
    "tpbi        "   "|"    /*253*/
    "tppd        "   "|"    /*254*/
    "ry01        "   "|"    /*255*/
    "ry02        "   "|"    /*256*/
    "ry03        "   "|"    /*257*/
    "fleet       "   "|"    /*258*/
    "ncb         "   "|"    /*259*/
    "claim       "   "|"    /*260*/
    "dspc        "   "|"    /*261*/
    "cctv        "   "|"    /*262*/
    "dstf        "   "|"    /*263*/
    "fleetprem   "   "|"    /*264*/
    "ncbprem     "   "|"    /*265*/
    "clprem      "   "|"    /*266*/
    "dspcprem    "   "|"    /*267*/
    "cctvprem    "   "|"    /*268*/
    "dstfprem    "   "|"    /*269*/
    "premt       "   "|"    /*270*/
    "rstp_t      "   "|"    /*271*/
    "rtax_t      "   "|"    /*272*/
    "comper70    "   "|"    /*273*/
    "comprem70   "   "|"    /*274*/
    "agco70      "   "|"    /*275*/
    "comco_per70 "   "|"    /*276*/
    "comco_prem70"   "|"    /*277*/
    "dgpackge    "   "|"    /*278*/
    "danger1     "   "|"    /*279*/
    "danger2     "   "|"    /*280*/
    "dgsi        "   "|"    /*281*/
    "dgrate      "   "|"    /*282*/
    "dgfeet      "   "|"    /*283*/
    "dgncb       "   "|"    /*284*/
    "dgdisc      "   "|"    /*285*/
    "dgwdisc     "   "|"    /*286*/
    "dgatt       "   "|"    /*287*/
    "dgfeetprm   "   "|"    /*288*/
    "dgncbprm    "   "|"    /*289*/
    "dgdiscprm   "   "|"    /*290*/
    "dgWdiscprm  "   "|"    /*291*/
    "dgprem      "   "|"    /*292*/
    "dgrstp_t    "   "|"    /*293*/
    "dgrtax_t    "   "|"    /*294*/
    "dgcomper    "   "|"    /*295*/
    "dgcomprem   "   "|"    /*296*/
    "cltxt       "   "|"    /*297*/
    "clamount    "   "|"    /*298*/
    "faultno     "   "|"    /*299*/
    "faultprm    "   "|"    /*300*/
    "goodno      "   "|"    /*301*/
    "goodprm     "   "|"    /*302*/
    "loss        "   "|"    /*303*/
    "compolusory "   "|"    /*304*/
    "barcode     "   "|"    /*305*/
    "class72     "   "|"    /*306*/
    "dstf72      "   "|"    /*307*/
    "dstfprem72  "   "|"    /*308*/
    "premt72     "   "|"    /*309*/
    "rstp_t72    "   "|"    /*310*/
    "rtax_t72    "   "|"    /*311*/
    "comper72    "   "|"    /*312*/
    "comprem72   "   "|"    /*313*/
    "battno      "   "|"    /*314*/
    "battyr      "   "|"    /*315*/
    "battprice   "   "|"    /*316*/
    "battper     "   "|"    /*317*/
    "battrate    "   "|"    /*318*/
    "battsi      "   "|"    /*319*/
    "battprm     "   "|"    /*320*/
    "chargno     "   "|"    /*321*/
    "chargsi     "   "|"    /*322*/
    "chargrate   "   "|"    /*323*/
    "chargprm    "   "|"    /*324*/  
    " Comment      "     SKIP .            
    RUN proc_report2_detail.
END.                                      

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_report2_Detail C-Win 
PROCEDURE proc_report2_Detail :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DO:
 FOR EACH wdetail WHERE wdetail.PASS = "Y"  NO-LOCK.
    FIND FIRST wtxt   WHERE wtxt.policyno   = wdetail.policyno  NO-LOCK NO-ERROR .
    FIND FIRST wmemo  WHERE wmemo.policyno  = wdetail.policyno  NO-LOCK NO-ERROR .
    FIND FIRST wacces WHERE wacces.policyno = wdetail.policyno  NO-LOCK NO-ERROR .
    FIND FIRST winst  WHERE winst.policyno  = wdetail.policyno  NO-LOCK NO-ERROR .
    FIND FIRST wdrive WHERE wdrive.policy   = wdetail.policyno  NO-LOCK NO-ERROR .
    PUT STREAM ns2
        wdetail.riskno          "|" /*A64-0355*/ /*1  */ 
        wdetail.itemno          "|"              /*2  */ 
        wdetail.policyno FORMAT "x(16)" "|"      /*3  */ 
        wdetail.redbook         "|"              /*4  */ 
        wdetail.n_branch        "|"              /*5  */ 
        wdetail.agent           "|"              /*6  */ 
        wdetail.producer        "|"              /*7  */ 
        wdetail.n_delercode     "|"              /*8  */ 
        wdetail.fincode         "|"              /*9  */ 
        wdetail.appenno         "|"              /*10 */ 
        wdetail.salename        "|"              /*11 */ 
        wdetail.srate           "|"              /*12 */ 
        wdetail.comdat          "|"              /*13 */ 
        wdetail.expdat          "|"              /*14 */ 
        wdetail.agreedat        "|"              /*15 */ 
        wdetail.firstdat        "|"              /*16 */ 
        wdetail.packcod         "|"              /*17 */ 
        wdetail.camp_no         "|"              /*18 */ 
        wdetail.campen          "|"              /*19 */ 
        wdetail.specon          "|"              /*20 */ 
        wdetail.product         "|"              /*21 */ 
        wdetail.promo           "|"              /*22 */ 
        wdetail.rencnt          "|"              /*23 */ 
        wdetail.prepol          "|"              /*24 */ 
        wtxt.txt1               "|"              /*25 */ 
        wtxt.txt2               "|"              /*26 */ 
        wtxt.txt3               "|"              /*27 */ 
        wtxt.txt4               "|"              /*28 */ 
        wtxt.txt5               "|"              /*29 */ 
        wtxt.txt6               "|"              /*30 */ 
        wtxt.txt7               "|"              /*31 */ 
        wtxt.txt8               "|"              /*32 */ 
        wtxt.txt9               "|"              /*33 */ 
        wtxt.txt10              "|"              /*34 */ 
        wmemo.memo1             "|"              /*35 */ 
        wmemo.memo2             "|"              /*36 */ 
        wmemo.memo3             "|"              /*37 */ 
        wmemo.memo4             "|"              /*38 */ 
        wmemo.memo5             "|"              /*39 */ 
        wmemo.memo6             "|"              /*40 */ 
        wmemo.memo7             "|"              /*41 */ 
        wmemo.memo8             "|"              /*42 */ 
        wmemo.memo9             "|"              /*43 */ 
        wmemo.memo10            "|"              /*44 */ 
        wacces.accdata1        "|"               /*45 */ 
        wacces.accdata2        "|"               /*46 */ 
        wacces.accdata3        "|"               /*47 */ 
        wacces.accdata4        "|"               /*48 */ 
        wacces.accdata5        "|"               /*49 */ 
        wacces.accdata6        "|"               /*50 */ 
        wacces.accdata7        "|"               /*51 */ 
        wacces.accdata8        "|"               /*52 */ 
        wacces.accdata9        "|"               /*53 */ 
        wacces.accdata10       "|"               /*54 */ 
        wdetail.compul          "|"              /*55 */ 
        wdetail.nv_insref       "|"              /*56 */ 
        wdetail.instyp          "|"              /*57 */ 
        wdetail.inslang         "|"              /*58 */ 
        wdetail.tiname          "|"              /*59 */ 
        wdetail.insnam          "|"              /*60 */ 
        wdetail.lastname        "|"              /*61 */ 
        wdetail.icno            "|"              /*62 */ 
        wdetail.insbr           "|"              /*63 */ 
        wdetail.occup           "|"              /*64 */ 
        wdetail.addr            "|"              /*65 */ 
        wdetail.tambon          "|"              /*66 */ 
        wdetail.amper           "|"              /*67 */ 
        wdetail.country         "|"              /*68 */ 
        wdetail.post            "|"              /*69 */ 
        wdetail.provcod         "|"              /*70 */ 
        wdetail.distcod         "|"              /*71 */ 
        wdetail.sdistcod        "|"              /*72 */ 
        wdetail.jpae           "|"   /*A64-0355*//*73 */ 
        wdetail.jpjtl          "|"   /*A64-0355*//*74 */ 
        wdetail.jpts           "|"   /*A64-0355*//*75 */ 
        wdetail.gender          "|"              /*76 */ 
        wdetail.tele1           "|"              /*77 */ 
        wdetail.tele2           "|"              /*78 */ 
        wdetail.mail1           "|"              /*79 */ 
        wdetail.mail2           "|"              /*80 */ 
        wdetail.mail3           "|"              /*81 */ 
        wdetail.mail4           "|"              /*82 */ 
        wdetail.mail5           "|"              /*83 */ 
        wdetail.mail6           "|"              /*84 */ 
        wdetail.mail7           "|"              /*85 */ 
        wdetail.mail8           "|"              /*86 */ 
        wdetail.mail9           "|"              /*87 */ 
        wdetail.mail10          "|"              /*88 */ 
        wdetail.fax             "|"              /*89 */ 
        wdetail.lineID          "|"              /*90 */ 
        wdetail.name2           "|"              /*91 */ 
        wdetail.name3           "|"              /*92 */ 
        wdetail.benname         "|"              /*93 */ 
        wdetail.payercod        "|"              /*94 */ 
        wdetail.vatcode         "|"              /*95 */ 
        winst.instcod1        "|"                /*96 */ 
        winst.insttyp1        "|"                /*97 */ 
        winst.insttitle1      "|"                /*98 */ 
        winst.instname1       "|"                /*99 */ 
        winst.instlname1      "|"                /*100*/ 
        winst.instic1         "|"                /*101*/ 
        winst.instbr1         "|"                /*102*/ 
        winst.instaddr11      "|"                /*103*/ 
        winst.instaddr21      "|"                /*104*/ 
        winst.instaddr31      "|"                /*105*/ 
        winst.instaddr41      "|"                /*106*/ 
        winst.instpost1       "|"                /*107*/ 
        winst.instprovcod1    "|"                /*108*/ 
        winst.instdistcod1    "|"                /*109*/ 
        winst.instsdistcod1   "|"                /*110*/ 
        winst.instprm1        "|"                /*111*/ 
        winst.instrstp1       "|"                /*112*/ 
        winst.instrtax1       "|"                /*113*/ 
        winst.instcomm01      "|"                /*114*/ 
        winst.instcomm12      "|"                /*115*/ 
        winst.instcod2        "|"                /*116*/ 
        winst.insttyp2        "|"                /*117*/ 
        winst.insttitle2      "|"                /*118*/ 
        winst.instname2       "|"                /*119*/ 
        winst.instlname2      "|"                /*120*/ 
        winst.instic2         "|"                /*121*/ 
        winst.instbr2         "|"                /*122*/ 
        winst.instaddr12      "|"                /*123*/ 
        winst.instaddr22      "|"                /*124*/ 
        winst.instaddr32      "|"                /*125*/ 
        winst.instaddr42      "|"                /*126*/ 
        winst.instpost2       "|"                /*127*/ 
        winst.instprovcod2    "|"                /*128*/ 
        winst.instdistcod2    "|"                /*129*/ 
        winst.instsdistcod2   "|"                /*130*/ 
        winst.instprm2        "|"                /*131*/ 
        winst.instrstp2       "|"                /*132*/ 
        winst.instrtax2       "|"                /*133*/ 
        winst.instcomm02      "|"                /*134*/ 
        winst.instcomm22      "|"                /*135*/ 
        winst.instcod3        "|"                /*136*/ 
        winst.insttyp3        "|"                /*137*/ 
        winst.insttitle3      "|"                /*138*/ 
        winst.instname3       "|"                /*139*/ 
        winst.instlname3      "|"                /*140*/ 
        winst.instic3         "|"                /*141*/ 
        winst.instbr3         "|"                /*142*/ 
        winst.instaddr13      "|"                /*143*/ 
        winst.instaddr23      "|"                /*144*/ 
        winst.instaddr33      "|"                /*145*/ 
        winst.instaddr43      "|"                /*146*/ 
        winst.instpost3       "|"                /*147*/ 
        winst.instprovcod3    "|"                /*148*/ 
        winst.instdistcod3    "|"                /*149*/ 
        winst.instsdistcod3   "|"                /*150*/ 
        winst.instprm3        "|"                /*151*/ 
        winst.instrstp3       "|"                /*152*/ 
        winst.instrtax3       "|"                /*153*/ 
        winst.instcomm03      "|"                /*154*/ 
        winst.instcomm23      "|"                /*155*/ 
        wdetail.covcod          "|"              /*156*/ 
        wdetail.garage          "|"              /*157*/ 
        wdetail.special         "|"              /*158*/ 
        wdetail.inspec          "|"              /*159*/ 
        wdetail.class70         "|"              /*160*/ 
        wdetail.vehuse          "|"  /*A65-0079*//*161*/ 
        wdetail.redbook         "|"  /*A65-0079*//*162*/ 
        wdetail.brand           "|"              /*163*/ 
        wdetail.model           "|"              /*164*/ 
        wdetail.submodel        "|"              /*165*/ 
        wdetail.yrmanu          "|"              /*166*/ 
        wdetail.chasno          "|"              /*167*/ 
        wdetail.eng             "|"              /*168*/ 
        wdetail.eng_no2         "|"              /*169*/ 
        wdetail.seat41          "|"              /*170*/ 
        wdetail.engcc           "|"              /*171*/ 
        wdetail.weight          "|"              /*172*/ 
        wdetail.watt            "|"              /*173*/ 
        wdetail.body            "|"              /*174*/ 
        wdetail.typ            "|"               /*175*/ 
        wdetail.re_year         "|"              /*176*/ 
        wdetail.vehreg          "|"              /*177*/ 
        wdetail.re_country      "|"              /*178*/ 
        wdetail.cargrp          "|"              /*179*/ 
        wdetail.colorcar        "|"              /*180*/ 
        wdetail.fule            "|"              /*181*/ 
        wdetail.drivnam         "|"              /*182*/ 
        wdrive.ntitle1         "|"               /*183*/ 
        wdrive.name1           "|"               /*184*/ 
        wdrive.lname1          "|"               /*185*/ 
        wdrive.dicno1          "|"               /*186*/ 
        wdrive.dgender1        "|"               /*187*/ 
        wdrive.dbirth1         "|"               /*188*/ 
        wdrive.doccup1         "|"               /*189*/ 
        wdrive.ddriveno1       "|"               /*190*/ 
        wdrive.drivexp1        "|"               /*191*/ 
        wdrive.dlevel1         "|"               /*192*/ 
        wdrive.ntitle2         "|"               /*193*/ 
        wdrive.name2           "|"               /*194*/ 
        wdrive.lname2          "|"               /*195*/ 
        wdrive.dicno2          "|"               /*196*/ 
        wdrive.dgender2        "|"               /*197*/ 
        wdrive.dbirth2         "|"               /*198*/ 
        wdrive.doccup2         "|"               /*199*/ 
        wdrive.ddriveno2       "|"               /*200*/ 
        wdrive.drivexp2        "|"               /*201*/ 
        wdrive.dlevel2         "|"               /*202*/ 
        wdrive.ntitle3         "|"               /*203*/ 
        wdrive.name3           "|"               /*204*/ 
        wdrive.lname3          "|"               /*205*/ 
        wdrive.dicno3          "|"               /*206*/ 
        wdrive.dgender3        "|"               /*207*/ 
        wdrive.dbirth3         "|"               /*208*/ 
        wdrive.doccup3         "|"               /*209*/ 
        wdrive.ddriveno3       "|"               /*210*/ 
        wdrive.drivexp3        "|"               /*211*/ 
        wdrive.dlevel3         "|"               /*212*/ 
        wdrive.ntitle4         "|"               /*213*/ 
        wdrive.name4           "|"               /*214*/ 
        wdrive.lname4          "|"               /*215*/ 
        wdrive.dicno4          "|"               /*216*/ 
        wdrive.dgender4        "|"               /*217*/ 
        wdrive.dbirth4         "|"               /*218*/ 
        wdrive.doccup4         "|"               /*219*/ 
        wdrive.ddriveno4       "|"               /*220*/ 
        wdrive.drivexp4        "|"               /*221*/ 
        wdrive.dlevel4         "|"               /*222*/ 
        wdrive.ntitle5         "|"               /*223*/ 
        wdrive.name5           "|"               /*224*/ 
        wdrive.lname5          "|"               /*225*/ 
        wdrive.dicno5          "|"               /*226*/ 
        wdrive.dgender5        "|"               /*227*/ 
        wdrive.dbirth5         "|"               /*228*/ 
        wdrive.doccup5         "|"               /*229*/ 
        wdrive.ddriveno5       "|"               /*230*/ 
        wdrive.drivexp5        "|"               /*231*/ 
        wdrive.dlevel5         "|"               /*232*/ 
        wdetail.baseplus        "|"              /*233*/ 
        wdetail.siplus          "|"              /*234*/ 
        wdetail.rs10            "|"              /*235*/ 
        wdetail.comper          "|"              /*236*/ 
        wdetail.comacc          "|"              /*237*/ 
        wdetail.deductpd        "|"              /*238*/ 
        wdetail.DOD             "|"              /*239*/ 
        wdetail.DPD             "|"              /*240*/ 
        wdetail.maksi           "|"              /*241*/ 
        wdetail.si              "|"              /*242*/ 
        wdetail.NO_411          "|"              /*243*/ 
        wdetail.seat41          "|"              /*244*/ 
        wdetail.NO_412          "|"              /*245*/ 
        wdetail.NO_413          "|"              /*246*/ 
        wdetail.ac6             "|"              /*247*/ 
        wdetail.NO_414          "|"              /*248*/ 
        wdetail.NO_42           "|"              /*249*/ 
        wdetail.NO_43           "|"              /*250*/ 
        wdetail.base            "|"              /*251*/ 
        wdetail.unname          "|"              /*252*/ 
        wdetail.nname           "|"              /*253*/ 
        wdetail.tpbi            "|"              /*254*/ 
        wdetail.tppd            "|"              /*255*/ 
        wdetail.ry01            "|"              /*256*/ 
        wdetail.ry02            "|"              /*257*/ 
        wdetail.ry03            "|"              /*258*/ 
        wdetail.fleet           "|"              /*259*/ 
        wdetail.ncb             "|"              /*260*/ 
        wdetail.claim           "|"              /*261*/ 
        wdetail.dspc            "|"              /*262*/ 
        wdetail.cctv            "|"              /*263*/ 
        wdetail.dstf            "|"              /*264*/ 
        wdetail.fleetprem       "|"              /*265*/ 
        wdetail.ncbprem         "|"              /*266*/ 
        wdetail.clprem          "|"              /*267*/ 
        wdetail.dspcprem        "|"              /*268*/ 
        wdetail.cctvprem        "|"              /*269*/ 
        wdetail.dstfprem        "|"              /*270*/ 
        wdetail.premt           "|"              /*271*/ 
        wdetail.rstp_t          "|"              /*272*/ 
        wdetail.rtax_t          "|"              /*273*/ 
        wdetail.comper70        "|"              /*274*/ 
        wdetail.comprem70       "|"              /*275*/ 
        wdetail.agco70          "|"              /*276*/ 
        wdetail.comco_per70     "|"              /*277*/ 
        wdetail.comco_prem70    "|"              /*278*/ 
        wdetail.dgpackge        "|"              /*279*/ 
        wdetail.danger1         "|"              /*280*/ 
        wdetail.danger2         "|"              /*281*/ 
        wdetail.dgsi            "|"              /*282*/ 
        wdetail.dgrate          "|"              /*283*/ 
        wdetail.dgfeet          "|"              /*284*/ 
        wdetail.dgncb           "|"              /*285*/ 
        wdetail.dgdisc          "|"              /*286*/ 
        wdetail.dgWdisc          "|"             /*287*/ 
        wdetail.dgatt           "|"              /*288*/ 
        wdetail.dgfeetprm       "|"              /*289*/ 
        wdetail.dgncbprm        "|"              /*290*/ 
        wdetail.dgdiscprm       "|"              /*291*/ 
        wdetail.dgprem          "|"              /*292*/ 
        wdetail.dgrstp_t        "|"              /*293*/ 
        wdetail.dgrtax_t        "|"              /*294*/ 
        wdetail.dgcomper        "|"              /*295*/ 
        wdetail.dgcomprem       "|"              /*296*/ 
        wdetail.cltxt           "|"              /*297*/ 
        wdetail.clamount        "|"              /*298*/ 
        wdetail.faultno         "|"              /*299*/ 
        wdetail.faultprm        "|"              /*300*/ 
        wdetail.goodno          "|"              /*301*/ 
        wdetail.goodprm         "|"              /*302*/ 
        wdetail.loss            "|"              /*303*/ 
        wdetail.compolusory     "|"              /*304*/ 
        wdetail.stk             "|"              /*305*/ 
        wdetail.class72         "|"              /*306*/ 
        wdetail.dstf72          "|"              /*307*/ 
        wdetail.dstfprem72      "|"              /*308*/ 
        wdetail.premt72         "|"              /*309*/ 
        wdetail.rstp_t72        "|"              /*310*/ 
        wdetail.rtax_t72        "|"              /*311*/ 
        wdetail.comper72        "|"              /*312*/ 
        wdetail.comprem72       "|"              /*313*/ 
        wdetail.battno          "|"              /*314*/ 
        wdetail.battyr          "|"              /*315*/ 
        wdetail.battprice       "|"              /*316*/ 
        wdetail.battper         "|"              /*317*/ 
        wdetail.battrate         "|"             /*318*/ 
        wdetail.battsi          "|"              /*319*/ 
        wdetail.battprm         "|"              /*320*/ 
        wdetail.chargno         "|"              /*321*/ 
        wdetail.chargsi         "|"              /*322*/ 
        wdetail.chargrate       "|"              /*323*/ 
        wdetail.chargprm        "|"              /*324*/ 
        wdetail.comment         "|"
        wdetail.pass             SKIP .
 END.
END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE PROC_REPORT3 C-Win 
PROCEDURE PROC_REPORT3 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DEF VAR HEAD AS CHAR INIT "Y".
DEF VAR a AS CHAR FORMAT "x(20)" INIT "".
DEF VAR b AS CHAR FORMAT "x(20)" INIT "".
DEF VAR c AS INTE INIT 0.
DEF VAR d AS INTE INIT 0.
DEF VAR f AS CHAR FORMAT "x(20)" INIT "".
DEF VAR pass AS INTE INIT 0.
def var nv_cnt   as  int  init  0.
DEF VAR nw_icno AS CHAR FORMAT "x(15)" INIT "".

ASSIGN nv_row  =  1.
FOR EACH  wdetail WHERE wdetail.PASS = "Y"  :
  pass = pass + 1.
END. 
IF pass > 0 THEN DO:
    ASSIGN 
        nv_cnt  = 0 
        nv_row  = 1.
    OUTPUT STREAM ns2 TO value(fi_outputpro).
    PUT STREAM ns2 "ID;PND" SKIP.
    PUT STREAM ns2 "C;Y" STRING(nv_row) ";X1;K"  '"' "itemno / เลขรับแจ้ง " '"' SKIP .                                                 
    PUT STREAM ns2 "C;Y" STRING(nv_row) ";X2;K"  '"' "กรมธรรม์"           '"' SKIP.
    PUT STREAM ns2 "C;Y" STRING(nv_row) ";X3;K"  '"' "ประเภทกรมธรรม์"     '"' SKIP.          
    PUT STREAM ns2 "C;Y" STRING(nv_row) ";X4;K"  '"' "สาขา"               '"' SKIP.
    PUT STREAM ns2 "C;Y" STRING(nv_row) ";X5;K"  '"' "Producer "          '"' SKIP.
    PUT STREAM ns2 "C;Y" STRING(nv_row) ";X6;K"  '"' "Agent "             '"' SKIP.
    PUT STREAM ns2 "C;Y" STRING(nv_row) ";X7;K"  '"' "Delaer Code"        '"' SKIP.
    PUT STREAM ns2 "C;Y" STRING(nv_row) ";X8;K"  '"' "Finnace code"       '"' SKIP.
    PUT STREAM ns2 "C;Y" STRING(nv_row) ";X9;K"  '"' "Campaign no"        '"' SKIP.
    PUT STREAM ns2 "C;Y" STRING(nv_row) ";X10;K" '"' "เบี้ย "             '"' SKIP.
    PUT STREAM ns2 "C;Y" STRING(nv_row) ";X11;K" '"' "ทุน"                '"' SKIP.
    PUT STREAM ns2 "C;Y" STRING(nv_row) ";X12;K" '"' "ปีที่จดทะเบียน"     '"' SKIP.                  
    PUT STREAM ns2 "C;Y" STRING(nv_row) ";X13;K" '"' "ปีรถ"               '"' SKIP.                  
    PUT STREAM ns2 "C;Y" STRING(nv_row) ";X14;K" '"' "รุ่น"               '"' SKIP.                  
    PUT STREAM ns2 "C;Y" STRING(nv_row) ";X15;K" '"' "ยี่ห้อ"             '"' SKIP.
    PUT STREAM ns2 "C;Y" STRING(nv_row) ";X16;K" '"' "Redbook "           '"' SKIP.
    PUT STREAM ns2 "C;Y" STRING(nv_row) ";X17;K" '"' "insured code  "     '"' SKIP. 
    PUT STREAM ns2 "C;Y" STRING(nv_row) ";X18;K" '"' "tiname"             '"' SKIP. 
    PUT STREAM ns2 "C;Y" STRING(nv_row) ";X19;K" '"' "insnam"             '"' SKIP. 
    PUT STREAM ns2 "C;Y" STRING(nv_row) ";X20;K" '"' "Lastname"           '"' SKIP .
    PUT STREAM ns2 "C;Y" STRING(nv_row) ";X21;K" '"' "name2"              '"' SKIP. 
    PUT STREAM ns2 "C;Y" STRING(nv_row) ";X22;K" '"' "name3"              '"' SKIP. 
    PUT STREAM ns2 "C;Y" STRING(nv_row) ";X23;K" '"' "icno"               '"' SKIP. 

    FOR EACH  wdetail  WHERE wdetail.PASS = "Y"  :
        ASSIGN nv_cnt  =  nv_cnt  + 1                      
               nv_row  =  nv_row  + 1. 
        PUT STREAM ns2 "C;Y" STRING(nv_row) ";X1;K"  '"'   wdetail.itemno + " / " + wdetail.appenno FORMAT "X(20)"       '"' SKIP.
        PUT STREAM ns2 "C;Y" STRING(nv_row) ";X2;K"  '"'   wdetail.policyno FORMAT "x(16)"     '"' SKIP. 
        PUT STREAM ns2 "C;Y" STRING(nv_row) ";X3;K"  '"'   wdetail.poltyp        '"' SKIP .
        PUT STREAM ns2 "C;Y" STRING(nv_row) ";X4;K"  '"'   wdetail.n_branch      '"' SKIP. 
        PUT STREAM ns2 "C;Y" STRING(nv_row) ";X5;K"  '"'   wdetail.producer      '"' SKIP. 
        PUT STREAM ns2 "C;Y" STRING(nv_row) ";X6;K"  '"'   wdetail.agent         '"' SKIP. 
        PUT STREAM ns2 "C;Y" STRING(nv_row) ";X7;K"  '"'   wdetail.n_delercode   '"' SKIP. 
        PUT STREAM ns2 "C;Y" STRING(nv_row) ";X8;K"  '"'   wdetail.fincode       '"' SKIP. 
        PUT STREAM ns2 "C;Y" STRING(nv_row) ";X9;K"  '"'   wdetail.packcod       '"' SKIP. 
        PUT STREAM ns2 "C;Y" STRING(nv_row) ";X10;K" '"'   wdetail.premt         '"' SKIP. 
        PUT STREAM ns2 "C;Y" STRING(nv_row) ";X11;K"  '"'  wdetail.si            '"' SKIP. 
        PUT STREAM ns2 "C;Y" STRING(nv_row) ";X12;K"  '"'  wdetail.re_year       '"' SKIP. 
        PUT STREAM ns2 "C;Y" STRING(nv_row) ";X13;K"  '"'  wdetail.yrmanu        '"' SKIP.                     
        PUT STREAM ns2 "C;Y" STRING(nv_row) ";X14;K"  '"'  wdetail.model         '"' SKIP.                     
        PUT STREAM ns2 "C;Y" STRING(nv_row) ";X15;K"  '"'  wdetail.brand         '"' SKIP.                     
        PUT STREAM ns2 "C;Y" STRING(nv_row) ";X16;K"  '"'  wdetail.redbook       '"' SKIP.
        PUT STREAM ns2 "C;Y" STRING(nv_row) ";X17;K"  '"'  wdetail.nv_insref     '"' SKIP.
        PUT STREAM ns2 "C;Y" STRING(nv_row) ";X18;K"  '"'  wdetail.tiname        '"' SKIP.
        PUT STREAM ns2 "C;Y" STRING(nv_row) ";X19;K"  '"'  wdetail.insnam        '"' SKIP.
        PUT STREAM ns2 "C;Y" STRING(nv_row) ";X20;K"  '"'  wdetail.lastname      '"' SKIP.
        PUT STREAM ns2 "C;Y" STRING(nv_row) ";X21;K"  '"'  wdetail.name2         '"' SKIP.
        PUT STREAM ns2 "C;Y" STRING(nv_row) ";X22;K"  '"'  wdetail.name3         '"' SKIP. 
        PUT STREAM ns2 "C;Y" STRING(nv_row) ";X23;K"  '"'  wdetail.icno          '"' SKIP.                                                                        
    END.                                                                            
    PUT STREAM ns2 "E".
OUTPUT STREAM ns2 CLOSE.                                                        
END.   /*pass > 0*/
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_reportpolno C-Win 
PROCEDURE proc_reportpolno :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DO:
OUTPUT STREAM ns1 TO value(fi_output1).
PUT STREAM ns1
  "Risk No "                                 "|"        /*1  */    /*A64-0355*/             
  "ItemNo  "                                 "|"        /*2  */ 
  "Policy No (เลขที่กรมธรรม์ภาคสมัครใจ)"     "|"        /*3  */ 
  "Branch (สาขา) "                           "|"        /*4  */ 
  "Agent Code (รหัสตัวแทน) "                 "|"        /*5  */ 
  "Producer Code "                           "|"        /*6  */ 
  "Dealer Code (รหัสดีเลอร์) "               "|"        /*7  */ 
  "Finance Code (รหัสไฟแนนซ์)"               "|"        /*8  */ 
  "Notification Number (เลขที่รับแจ้ง) "     "|"        /*9  */ 
  "Notification Name (ชื่อผู้แจ้ง)     "     "|"        /*10 */ 
  "Short Rate  "                             "|"        /*11 */ 
  "Effective Date (วันที่เริ่มความคุ้มครอง)" "|"        /*12 */ 
  "Expiry Date (วันที่สิ้นสุดความคุ้มครอง) " "|"        /*13 */ 
  "Agree Date "                              "|"        /*14 */ 
  "First Date "                              "|"        /*15 */ 
  "รหัสแพ็กเกจ"                              "|"        /*16 */ 
  "Campaign Code (รหัสแคมเปญ)"               "|"        /*17 */ 
  "Campaign Text"                            "|"        /*18 */ 
  "Spec Con     "                            "|"        /*19 */ 
  "Product Type "                            "|"        /*20 */ 
  "Promotion Code"                           "|"        /*21 */ 
  "Renew Count   "                           "|"        /*22 */ 
  "Previous Policy (เลขทีกรมธรรม์ภาคสมัครใจเดิม)" "|"   /*23 */ 
  "Policy Text 1"           "|"         /*24 */ 
  "Policy Text 2"           "|"         /*25 */ 
  "Policy Text 3"           "|"         /*26 */ 
  "Policy Text 4"           "|"         /*27 */ 
  "Policy Text 5"           "|"         /*28 */ 
  "Policy Text 6"           "|"         /*29 */ 
  "Policy Text 7"           "|"         /*30 */ 
  "Policy Text 8"           "|"         /*31 */ 
  "Policy Text 9"           "|"         /*32 */ 
  "Policy Text 10"          "|"         /*33 */ 
  "Memo Text 1 "            "|"         /*34 */ 
  "Memo Text 2 "            "|"         /*35 */ 
  "Memo Text 3 "            "|"         /*36 */ 
  "Memo Text 4 "            "|"         /*37 */ 
  "Memo Text 5 "            "|"         /*38 */ 
  "Memo Text 6 "            "|"         /*39 */ 
  "Memo Text 7 "            "|"         /*40 */ 
  "Memo Text 8 "            "|"         /*41 */ 
  "Memo Text 9 "            "|"         /*42 */ 
  "Memo Text 10"            "|"         /*43 */ 
  "Accessory Text 1 "       "|"         /*44 */ 
  "Accessory Text 2 "       "|"         /*45 */ 
  "Accessory Text 3 "       "|"         /*46 */ 
  "Accessory Text 4 "       "|"         /*47 */ 
  "Accessory Text 5 "       "|"         /*48 */ 
  "Accessory Text 6 "       "|"         /*49 */ 
  "Accessory Text 7 "       "|"         /*50 */ 
  "Accessory Text 8 "       "|"         /*51 */ 
  "Accessory Text 9 "       "|"         /*52 */ 
  "Accessory Text 10"       "|"         /*53 */ 
  "กรมธรรม์ซื้อควบ (Y/N)"   "|"         /*54 */ 
  "Insured Code"            "|"         /*55 */     /*A64-0355*/  
  "ประเภทบุคคล"             "|"         /*56 */ 
  "ภาษาที่ใช้สร้าง Cilent Code"         "|"         /*57 */ 
  "คำนำหน้า"                "|"         /*58 */ 
  "ชื่อ    "                "|"         /*59 */ 
  "นามสกุล  "               "|"         /*60 */ 
  "เลขที่บัตรประชาชน / เลขที่นิติบุคคล"     "|"         /*61 */ 
  "ลำดับที่สาขา "            "|"         /*62 */ 
  "อาชีพ        "            "|"         /*63 */ 
  "ที่อยู่บรรทัดที่ 1 "      "|"         /*64 */ 
  "ที่อยู่บรรทัดที่ 2 "      "|"         /*65 */ 
  "ที่อยู่บรรทัดที่ 3 "      "|"         /*66 */ 
  "ที่อยู่บรรทัดที่ 4 "      "|"         /*67 */ 
  "รหัสไปรษณีย์ "            "|"         /*68 */ 
  "province code"            "|"         /*69 */ 
  "district code"            "|"         /*70 */ 
  "sub district code  "      "|"         /*71 */ 
  "AE Code "                 "|"         /*72 */     /*A64-0355*/   
  "Japanese Team "           "|"         /*73 */     /*A64-0355*/  
  "TS Code "                 "|"         /*74 */     /*A64-0355*/   
  "Gender (Male/Female/Other)"              "|"         /*75 */ 
  "Telephone 1"     "|"         /*76 */ 
  "Telephone 2"     "|"         /*77 */ 
  "E-Mail 1 "       "|"         /*78 */ 
  "E-Mail 2 "       "|"         /*79 */ 
  "E-Mail 3 "       "|"         /*80 */ 
  "E-Mail 4 "       "|"         /*81 */ 
  "E-Mail 5 "       "|"         /*82 */ 
  "E-Mail 6 "       "|"         /*83 */ 
  "E-Mail 7 "       "|"         /*84 */ 
  "E-Mail 8 "       "|"         /*85 */ 
  "E-Mail 9 "       "|"         /*86 */ 
  "E-Mail 10"       "|"         /*87 */ 
  "Fax      "       "|"         /*88 */ 
  "Line ID  "       "|"         /*89 */ 
  "CareOf1  "       "|"         /*90 */ 
  "CareOf2  "       "|"         /*91 */ 
  "Benefit Name"    "|"         /*92 */ 
  "Payer Code  "    "|"         /*93 */ 
  "VAT Code    "    "|"         /*94 */ 
  "Client Code "    "|"         /*95 */ 
  "ประเภทบุคคล "    "|"         /*96 */ 
  "คำนำหน้า"        "|"         /*97 */ 
  "ชื่อ    "        "|"         /*98 */ 
  "นามสกุล "        "|"         /*99 */ 
  "เลขที่บัตรประชาชน / เลขที่นิติบุคคล"     "|"         /*100*/ 
  "ลำดับที่สาขา      "   "|"         /*101*/ 
  "ที่อยู่บรรทัดที่ 1"   "|"         /*102*/ 
  "ที่อยู่บรรทัดที่ 2"   "|"         /*103*/ 
  "ที่อยู่บรรทัดที่ 3"   "|"         /*104*/ 
  "ที่อยู่บรรทัดที่ 4"   "|"         /*105*/ 
  "รหัสไปรษณีย์      "   "|"         /*106*/ 
  "province code     "   "|"         /*107*/ 
  "district code     "   "|"         /*108*/ 
  "sub district code "   "|"         /*109*/ 
  "เบี้ยก่อนภาษีอากร "   "|"         /*110*/ 
  "อากร              "   "|"         /*111*/ 
  "ภาษี              "   "|"         /*112*/ 
  "คอมมิชชั่น 1      "   "|"         /*113*/ 
  "คอมมิชชั่น 2 (co-broker)" "|"         /*114*/ 
  "Client Code "             "|"         /*115*/ 
  "ประเภทบุคคล "             "|"         /*116*/ 
  "คำนำหน้า    "             "|"         /*117*/ 
  "ชื่อ        "             "|"         /*118*/ 
  "นามสกุล     "             "|"         /*119*/ 
  "เลขที่บัตรประชาชน / เลขที่นิติบุคคล"     "|"         /*120*/ 
  "ลำดับที่สาขา       "      "|"         /*121*/ 
  "ที่อยู่บรรทัดที่ 1 "      "|"         /*122*/ 
  "ที่อยู่บรรทัดที่ 2 "      "|"         /*123*/ 
  "ที่อยู่บรรทัดที่ 3 "      "|"         /*124*/ 
  "ที่อยู่บรรทัดที่ 4 "      "|"         /*125*/ 
  "รหัสไปรษณีย์       "      "|"         /*126*/ 
  "province code      "      "|"         /*127*/ 
  "district code      "      "|"         /*128*/ 
  "sub district code  "      "|"         /*129*/ 
  "เบี้ยก่อนภาษีอากร  "      "|"         /*130*/ 
  "อากร               "      "|"         /*131*/ 
  "ภาษี               "      "|"         /*132*/ 
  "คอมมิชชั่น 1       "      "|"         /*133*/ 
  "คอมมิชชั่น 2 (co-broker)" "|"         /*134*/ 
  "Client Code "             "|"         /*135*/ 
  "ประเภทบุคคล "             "|"         /*136*/ 
  "คำนำหน้า    "             "|"         /*137*/ 
  "ชื่อ        "             "|"         /*138*/ 
  "นามสกุล     "             "|"         /*139*/ 
  "เลขที่บัตรประชาชน / เลขที่นิติบุคคล"     "|"         /*140*/ 
  "ลำดับที่สาขา      "       "|"         /*141*/ 
  "ที่อยู่บรรทัดที่ 1"       "|"         /*142*/ 
  "ที่อยู่บรรทัดที่ 2"       "|"         /*143*/ 
  "ที่อยู่บรรทัดที่ 3"       "|"         /*144*/ 
  "ที่อยู่บรรทัดที่ 4"       "|"         /*145*/ 
  "รหัสไปรษณีย์      "       "|"         /*146*/ 
  "province code     "       "|"         /*147*/ 
  "district code     "       "|"         /*148*/ 
  "sub district code "       "|"         /*149*/ 
  "เบี้ยก่อนภาษีอากร "       "|"         /*150*/ 
  "อากร              "       "|"         /*151*/ 
  "ภาษี              "       "|"         /*152*/ 
  "คอมมิชชั่น 1      "       "|"         /*153*/ 
  "คอมมิชชั่น 2 (co-broker)" "|"         /*154*/ 
  "Cover Type (ประเภทความคุ้มครอง)"         "|"         /*155*/ 
  "Garage (ประเภทการซ่อม ซ่อมอู่/ซ่อมห้าง)" "|"         /*156*/ 
  "Spacial Equipment Flag (A/Blank)"        "|"         /*157*/ 
  "Inspection"                              "|"         /*158*/ 
  "รหัสรถภาคสมัครใจ (110/120/320)"          "|"         /*159*/
  "ลักษณะการใช้รถ"             "|"          /*160*/  /* A64-0355 */
  "Redbook "                   "|"          /*A65-0079*/
  "ยี่ห้อรถ"                   "|"          /*161*/ 
  "ชื่อรุ่นรถ"                 "|"          /*162*/ 
  "ชื่อรุ่นย่อยรถ"             "|"          /*163*/ 
  "ปีรุ่นรถ"                   "|"          /*164*/ 
  "หมายเลขตัวถัง"              "|"          /*165*/ 
  "หมายเลขเครื่อง"             "|"          /*166*/ 
  "หมายเลขเครื่อง 2"           "|"          /*A67-0029*/
  "จำนวนที่นั่ง (รวมผู้ขับขี่)""|"          /*167*/ 
  "ปริมาตรกระบอกสูบ (CC)"      "|"          /*168*/ 
  "น้ำหนัก (ตัน)"              "|"          /*169*/ 
  "Kilowatt"                   "|"          /*170*/ 
  "รหัสแบบตัวถัง"              "|"          /*171*/ 
  "ป้ายแดง (Y/N)"              "|"          /*172*/ 
  "ปีที่จดทะเบียน"             "|"          /*173*/ 
  "เลขทะเบียนรถ"               "|"          /*174*/ 
  "จังหวัดที่จดทะเบียน"        "|"          /*175*/ 
  "Group Car (กลุ่มรถ)"        "|"          /*176*/ 
  "Color (สี)"                 "|"          /*177*/ 
  "Fule (เชื้อเพลิง)"          "|"          /*178*/ 
  "Driver Number"              "|"          /*179*/ 
  "คำนำหน้า"                   "|"          /*180*/ 
  "ชื่อ"                       "|"          /*181*/ 
  "นามสกุล"                    "|"          /*182*/ 
  "เลขที่บัตรประชาชน"          "|"          /*183*/ 
  "เพศ"                        "|"          /*184*/ 
  "วันเกิด"                    "|"          /*185*/ 
  "ชื่ออาชีพ"                  "|"          /*186*/ 
  "เลขที่ใบอนุญาตขับขี่"       "|"          /*187*/ 
  "วันที่ใบอนุญาต หมดอายุ"     "|"  /*A67-0029*/
  "Consent ผู้ขับขี่ 1 "       "|"
  "ระดับพฤติกรรมการขับขี่"     "|"  /*A67-0029*/
  "คำนำหน้า"                   "|"          /*188*/ 
  "ชื่อ"                       "|"          /*189*/ 
  "นามสกุล"                    "|"          /*190*/ 
  "เลขที่บัตรประชาชน"          "|"          /*191*/ 
  "เพศ"                        "|"          /*192*/ 
  "วันเกิด"                    "|"          /*193*/ 
  "ชื่ออาชีพ"                  "|"          /*194*/ 
  "เลขที่ใบอนุญาตขับขี่"       "|"          /*195*/
  "วันที่ใบอนุญาต หมดอายุ"     "|"  /*A67-0029*/
  "Consent ผู้ขับขี่ 2 "       "|"
  "ระดับพฤติกรรมการขับขี่"     "|"  /*A67-0029*/
  /* Add by : A67-0029 */      
  "คำนำหน้า"                   "|"  
  "ชื่อ"                       "|"  
  "นามสกุล"                    "|"  
  "เลขที่บัตรประชาชน"          "|"  
  "เพศ"                        "|"  
  "วันเกิด"                    "|"  
  "ชื่ออาชีพ"                  "|"  
  "เลขที่ใบอนุญาตขับขี่"       "|"  
  "วันที่ใบอนุญาต หมดอายุ"     "|" 
  "Consent ผู้ขับขี่ 3 "       "|"
  "ระดับพฤติกรรมการขับขี่"     "|"  
  "คำนำหน้า"                   "|"  
  "ชื่อ"                       "|"  
  "นามสกุล"                    "|"  
  "เลขที่บัตรประชาชน"          "|"  
  "เพศ"                        "|"  
  "วันเกิด"                    "|"  
  "ชื่ออาชีพ"                  "|"  
  "เลขที่ใบอนุญาตขับขี่"       "|"  
  "วันที่ใบอนุญาต หมดอายุ"     "|"
  "Consent ผู้ขับขี่ 5 "       "|"
  "ระดับพฤติกรรมการขับขี่"     "|" 
  "คำนำหน้า"                   "|"    
  "ชื่อ"                       "|"  
  "นามสกุล"                    "|"  
  "เลขที่บัตรประชาชน"          "|"  
  "เพศ"                        "|"  
  "วันเกิด"                    "|"  
  "ชื่ออาชีพ"                  "|"  
  "เลขที่ใบอนุญาตขับขี่"       "|"  
  "วันที่ใบอนุญาต หมดอายุ"     "|"
  "Consent ผู้ขับขี่ 5 "       "|"
  "ระดับพฤติกรรมการขับขี่"     "|"  
  /* end : A67-0029 */
  "Base Premium Plus"          "|"   /*196*/ 
  "Sum Insured Plus"           "|"   /*197*/ 
  "RS10 Amount"                "|"   /*198*/ 
  "TPBI / person"              "|"   /*199*/ 
  "TPBI / occurrence"          "|"   /*200*/ 
  "TPPD        "               "|"   /*201*/ 
  "Deduct / OD "               "|"   /*202*/ 
  "Deduct / PD "               "|"   /*203*/ 
  "ราคารถยนต์(EV) "            "|"   /*A67-0029 */ 
  "วงเงินทุนประกัน "           "|"   /*204*/ 
  "PA1.1 / driver  "           "|"   /*205*/ 
  "PA1.1 no.of passenger "     "|"   /*206*/ 
  "PA1.1 / passenger     "     "|"   /*207*/ 
  "PA1.2 / driver        "     "|"   /*208*/ 
  "PA1.2 no.of passenger "     "|"   /*209*/ 
  "PA1.2 / passenger     "     "|"   /*210*/ 
  "PA2         "               "|"   /*211*/ 
  "PA3         "               "|"   /*212*/ 
  "Base Premium"               "|"   /*213*/ 
  "Unname      "               "|"   /*214*/ 
  "Name        "               "|"   /*215*/ 
  "TPBI Amount "               "|"   /*216*/ 
  "TPPD Amount "               "|"   /*217*/ 
  "RY01 Amount "               "|"   /*218*/ 
  "RY02 Amount "               "|"   /*219*/ 
  "RY03 Amount "               "|"   /*220*/ 
  "Fleet%      "               "|"   /*221*/ 
  "NCB%        "               "|"   /*222*/ 
  "Load Claim% "               "|"   /*223*/ 
  "Other Disc.%"               "|"   /*224*/ 
  "CCTV%        "              "|"   /*225*/ 
  "Walkin Disc.%"              "|"   /*226*/ 
  "Fleet Amount "              "|"   /*227*/ 
  "NCB Amount   "              "|"   /*228*/ 
  "Load Claim Amount "         "|"   /*229*/ 
  "Other Disc. Amount"         "|"   /*230*/ 
  "CCTV Amount       "         "|"   /*231*/ 
  "Walk in Disc. Amount"       "|"   /*232*/ 
  "เบี้ยสุทธิ "                "|"   /*233*/ 
  "Stamp Duty "                "|"   /*234*/ 
  "VAT        "                "|"   /*235*/ 
  "Commission %"               "|"   /*236*/ 
  "Commission Amount"          "|"   /*237*/ 
  "Agent Code co-broker (รหัสตัวแทน)""|"    /*238*/ 
  "Commission % co-broker"      "|"  /*239*/ 
  "Commission Amount co-broker" "|"  /*240*/ 
  "Package (Attach Coverage)"   "|"  /*241*/ 
  "Dangerous Object 1"          "|"  /*242*/ 
  "Dangerous Object 2"          "|"  /*243*/ 
  "Sum Insured"                 "|"  /*244*/ 
  "Rate%      "                 "|"  /*245*/ 
  "Fleet%     "                 "|"  /*246*/ 
  "NCB%       "                 "|"  /*247*/ 
  "Discount%  "                 "|"  /*248*/ 
  "Walkin Disc.%"               "|"  /*249*/ 
  "Premium Attach Coverage"     "|"  /*250*/ 
  "Discount Fleet"              "|"  /*251*/ 
  "Discount NCB  "              "|"  /*252*/ 
  "Other Discount"              "|"  /*253*/ 
  "Walk in Disc. Amount"        "|"  /*254*/ 
  "Net Premium "                "|"  /*255*/ 
  "Stamp Duty  "                "|"  /*256*/ 
  "VAT         "                "|"  /*257*/ 
  "Commission Amount"           "|"  /*258*/ 
  "Commission Amount co-broker" "|"  /*259*/ 
  "Claim Text  "                "|"  /*260*/ 
  "Claim Amount"                "|"  /*261*/ 
  "Claim Count Fault"           "|"  /*262*/ 
  "Claim Count Fault Amount"    "|"  /*263*/ 
  "Claim Count Good        "    "|"  /*264*/ 
  "Claim Count Good Amount "    "|"  /*265*/ 
  "Loss Ratio % (Not TP)   "    "|"  /*266*/ 
  "Compulsory Policy Number (เลขที่กรมธรรม์ พรบ.)" "|"   /*267*/ 
  "Barcode No."                              "|"         /*268*/ 
  "Compulsory Class (รหัส พรบ.)  "           "|"         /*269*/ 
  "Compulsory Walk In Discount % "           "|"         /*270*/ 
  "Compulsory Walk In Discount Amount"       "|"         /*271*/ 
  "เบี้ยสุทธิ พ.ร.บ. กรณีกรมธรรม์ซื้อควบ"    "|"         /*272*/ 
  "Stamp Duty "        "|"         /*273*/ 
  "VAT        "        "|"         /*274*/ 
  "Commission %"       "|"         /*275*/ 
  "Commission Amount"  "|"         /*276*/
  /* A67-0029 */       
  "เลขที่แบตเตอรี่"    "|"
  "ปีแบตฯ  "           "|"
  "ราคาแบตฯ"           "|"
  "ทุนประกันแบตฯ "     "|"
  "Rate    "           "|"
  "Premium "           "|"
  "เลขที่เครื่องชาร์จ" "|"
  "ราคาเครื่องชาร์จ"   "|"
  "Rate    "           "|"
  "Premium "           "|"
  /* end : A67-0029 */
  "Remark "                                  SKIP .
  RUN proc_reportpolno_2.
END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_reportpolno_2 C-Win 
PROCEDURE proc_reportpolno_2 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DEF VAR n_count AS INT INIT 0.
FOR EACH wdetail NO-LOCK .
    n_count = n_count + 1.
    FIND FIRST wtxt   WHERE wtxt.policyno   = wdetail.policyno  NO-LOCK NO-ERROR .
    FIND FIRST wmemo  WHERE wmemo.policyno  = wdetail.policyno  NO-LOCK NO-ERROR .
    FIND FIRST wacces WHERE wacces.policyno = wdetail.policyno  NO-LOCK NO-ERROR .
    FIND FIRST winst  WHERE winst.policyno  = wdetail.policyno  NO-LOCK NO-ERROR .
    FIND FIRST wdrive WHERE wdrive.policy   = wdetail.policyno  NO-LOCK NO-ERROR . /* A67-0029*/
    
    PUT STREAM ns1 
        wdetail.riskno       "|"    /*A64-0355*/
        wdetail.itemno       "|"
        wdetail.policyno   FORMAT "x(12)"  "|"
        wdetail.n_branch     "|"
        wdetail.agent        "|"
        wdetail.producer     "|"
        wdetail.n_delercode  "|"
        wdetail.fincode      "|"
        wdetail.appenno      "|"
        wdetail.salename     "|"
        wdetail.srate        "|"
        wdetail.comdat       "|"
        wdetail.expdat       "|"
        wdetail.agreedat     "|"
        wdetail.firstdat     "|"
        wdetail.packcod      "|"
        wdetail.camp_no      "|"
        wdetail.campen       "|"
        wdetail.specon       "|"
        wdetail.product      "|"
        wdetail.promo        "|"
        wdetail.rencnt       "|"
        wdetail.prepol       "|"
        wtxt.txt1            "|"
        wtxt.txt2            "|"
        wtxt.txt3            "|"
        wtxt.txt4            "|"
        wtxt.txt5            "|"
        wtxt.txt6            "|"
        wtxt.txt7            "|"
        wtxt.txt8            "|"
        wtxt.txt9            "|"
        wtxt.txt10           "|"
        wmemo.memo1           "|"
        wmemo.memo2           "|"
        wmemo.memo3           "|"
        wmemo.memo4           "|"
        wmemo.memo5           "|"
        wmemo.memo6           "|"
        wmemo.memo7           "|"
        wmemo.memo8           "|"
        wmemo.memo9           "|"
        wmemo.memo10          "|"
        wacces.accdata1       "|"
        wacces.accdata2       "|"
        wacces.accdata3       "|"
        wacces.accdata4       "|"
        wacces.accdata5       "|"
        wacces.accdata6       "|"
        wacces.accdata7       "|"
        wacces.accdata8       "|"
        wacces.accdata9       "|"
        wacces.accdata10      "|"
        wdetail.compul        "|"
        wdetail.nv_insref     "|" /* A64-0355*/
        wdetail.instyp        "|"
        wdetail.inslang       "|"
        wdetail.tiname        "|"
        wdetail.insnam        "|"
        wdetail.lastname      "|"
        wdetail.icno          "|"
        wdetail.insbr         "|"
        wdetail.occup         "|"
        wdetail.addr          "|"
        wdetail.tambon        "|"
        wdetail.amper         "|"
        wdetail.country       "|"
        wdetail.post          "|"
        wdetail.provcod       "|"
        wdetail.distcod       "|"
        wdetail.sdistcod      "|"
        wdetail.jpae          "|"  /*A64-0355*/      
        wdetail.jpjtl         "|"  /*A64-0355*/      
        wdetail.jpts          "|"  /*A64-0355*/      
        wdetail.gender        "|"
        wdetail.tele1         "|"
        wdetail.tele2         "|"
        wdetail.mail1         "|"
        wdetail.mail2         "|"
        wdetail.mail3         "|"
        wdetail.mail4         "|"
        wdetail.mail5         "|"
        wdetail.mail6         "|"
        wdetail.mail7         "|"
        wdetail.mail8         "|"
        wdetail.mail9         "|"
        wdetail.mail10        "|"
        wdetail.fax           "|"
        wdetail.lineID        "|"
        wdetail.name2         "|"
        wdetail.name3         "|"
        wdetail.benname       "|"
        wdetail.payercod      "|"
        wdetail.vatcode       "|"
        winst.instcod1        "|"
        winst.insttyp1        "|"
        winst.insttitle1      "|"
        winst.instname1       "|"
        winst.instlname1      "|"
        winst.instic1         "|"
        winst.instbr1         "|"
        winst.instaddr11      "|"
        winst.instaddr21      "|"
        winst.instaddr31      "|"
        winst.instaddr41      "|"
        winst.instpost1       "|"
        winst.instprovcod1    "|"
        winst.instdistcod1    "|"
        winst.instsdistcod1   "|"
        winst.instprm1        "|"
        winst.instrstp1       "|"
        winst.instrtax1       "|"
        winst.instcomm01      "|"
        winst.instcomm12      "|"
        winst.instcod2        "|"
        winst.insttyp2        "|"
        winst.insttitle2      "|"
        winst.instname2       "|"
        winst.instlname2      "|"
        winst.instic2         "|"
        winst.instbr2         "|"
        winst.instaddr12      "|"
        winst.instaddr22      "|"
        winst.instaddr32      "|"
        winst.instaddr42      "|"
        winst.instpost2       "|"
        winst.instprovcod2    "|"
        winst.instdistcod2    "|"
        winst.instsdistcod2   "|"
        winst.instprm2        "|"
        winst.instrstp2       "|"
        winst.instrtax2       "|"
        winst.instcomm02      "|"
        winst.instcomm22      "|"
        winst.instcod3        "|"
        winst.insttyp3        "|"
        winst.insttitle3      "|"
        winst.instname3       "|"
        winst.instlname3      "|"
        winst.instic3         "|"
        winst.instbr3         "|"
        winst.instaddr13      "|"
        winst.instaddr23      "|"
        winst.instaddr33      "|"
        winst.instaddr43      "|"
        winst.instpost3       "|"
        winst.instprovcod3    "|"
        winst.instdistcod3    "|"
        winst.instsdistcod3   "|"
        winst.instprm3        "|"
        winst.instrstp3       "|"
        winst.instrtax3       "|"
        winst.instcomm03      "|"
        winst.instcomm23      "|"
        wdetail.covcod        "|"
        wdetail.garage        "|"
        wdetail.special       "|"
        wdetail.inspec        "|"
        wdetail.class70       "|"
        wdetail.vehuse        "|"  /*A64-0355*/
        wdetail.redbook       "|"  /*A65-0079*/
        wdetail.brand         "|"
        wdetail.model         "|"
        wdetail.submodel      "|"
        wdetail.yrmanu        "|"
        wdetail.chasno        "|"
        wdetail.eng           "|"
        wdetail.eng_no2       "|" /*A67-0029*/
        wdetail.seat          "|"
        wdetail.engcc         "|"
        wdetail.weight        "|"
        wdetail.watt          "|"
        wdetail.body          "|"
        wdetail.typ           "|"
        wdetail.re_year       "|"
        wdetail.vehreg        "|"
        wdetail.re_country    "|"
        wdetail.cargrp        "|"
        wdetail.colorcar      "|"
        wdetail.fule          "|"
        wdetail.drivnam       "|"
        /* A67-0029 */
        wdrive.ntitle1        "|"
        wdrive.name1          "|"
        wdrive.lname1         "|"
        wdrive.dicno1         "|"
        wdrive.dgender1       "|"
        wdrive.dbirth1        "|"
        wdrive.doccup1        "|"
        wdrive.ddriveno1      "|"
        wdrive.drivexp1       "|"
        wdrive.dconsen1        "|"
        wdrive.dlevel1        "|"
        wdrive.ntitle2        "|"
        wdrive.name2          "|"
        wdrive.lname2         "|"
        wdrive.dicno2         "|"
        wdrive.dgender2       "|"
        wdrive.dbirth2        "|"
        wdrive.doccup2        "|"
        wdrive.ddriveno2      "|"
        wdrive.drivexp2       "|"
        wdrive.dconsen2        "|"
        wdrive.dlevel2        "|"
        wdrive.ntitle3        "|"
        wdrive.name3          "|"
        wdrive.lname3         "|"
        wdrive.dicno3         "|"
        wdrive.dgender3       "|"
        wdrive.dbirth3        "|"
        wdrive.doccup3        "|"
        wdrive.ddriveno3      "|"
        wdrive.drivexp3       "|"
        wdrive.dconsen3        "|"
        wdrive.dlevel3        "|"
        wdrive.ntitle4        "|"
        wdrive.name4          "|"
        wdrive.lname4         "|"
        wdrive.dicno4         "|"
        wdrive.dgender4       "|"
        wdrive.dbirth4        "|"
        wdrive.doccup4        "|"
        wdrive.ddriveno4      "|"
        wdrive.drivexp4       "|"
        wdrive.dconsen4        "|"
        wdrive.dlevel4        "|"
        wdrive.ntitle5        "|"
        wdrive.name5          "|"
        wdrive.lname5         "|"
        wdrive.dicno5         "|"
        wdrive.dgender5       "|"
        wdrive.dbirth5        "|"
        wdrive.doccup5        "|"
        wdrive.ddriveno5      "|"
        wdrive.drivexp5       "|"
        wdrive.dconsen5        "|"
        wdrive.dlevel5        "|"
        /* end A67-0029 */
        wdetail.baseplus      "|"
        wdetail.siplus        "|"
        wdetail.rs10          "|"
        wdetail.comper        "|"
        wdetail.comacc        "|"
        wdetail.deductpd      "|"
        wdetail.DOD           "|"
        wdetail.DPD           "|"
        wdetail.maksi         "|" /*A67-0029*/
        wdetail.si            "|"
        wdetail.NO_411        "|"
        wdetail.seat41        "|"
        wdetail.NO_412        "|"
        wdetail.NO_413        "|"
        wdetail.ac6           "|"
        wdetail.NO_414        "|"
        wdetail.NO_42         "|"
        wdetail.NO_43         "|"
        wdetail.base          "|"
        wdetail.unname        "|"
        wdetail.nname         "|"
        wdetail.tpbi          "|"
        wdetail.tppd          "|"
        wdetail.ry01          "|"
        wdetail.ry02          "|"
        wdetail.ry03          "|"
        wdetail.fleet         "|"
        wdetail.ncb           "|"
        wdetail.claim         "|"
        wdetail.dspc          "|"
        wdetail.cctv          "|"
        wdetail.dstf          "|"
        wdetail.fleetprem     "|"
        wdetail.ncbprem       "|"
        wdetail.clprem        "|"
        wdetail.dspcprem      "|"
        wdetail.cctvprem      "|"
        wdetail.dstfprem      "|"
        wdetail.premt         "|"
        wdetail.rstp_t        "|"
        wdetail.rtax_t        "|"
        wdetail.comper70      "|"
        wdetail.comprem70     "|"
        wdetail.agco70        "|"
        wdetail.comco_per70   "|"
        wdetail.comco_prem70  "|"
        wdetail.dgpackge      "|"
        wdetail.danger1       "|"
        wdetail.danger2       "|"
        wdetail.dgsi          "|"
        wdetail.dgrate        "|"
        wdetail.dgfeet        "|"
        wdetail.dgncb         "|"
        wdetail.dgdisc        "|"
        wdetail.dgWdisc       "|"
        wdetail.dgatt         "|"
        wdetail.dgfeetprm     "|"
        wdetail.dgncbprm      "|"
        wdetail.dgdiscprm     "|"
        wdetail.dgWdiscprm    "|"
        wdetail.dgprem        "|"
        wdetail.dgrstp_t      "|"
        wdetail.dgrtax_t      "|"
        wdetail.dgcomper      "|"
        wdetail.dgcomprem     "|"
        wdetail.cltxt         "|"
        wdetail.clamount      "|"
        wdetail.faultno       "|"
        wdetail.faultprm      "|"
        wdetail.goodno        "|"
        wdetail.goodprm       "|"
        wdetail.loss          "|"
        wdetail.compolusory FORMAT "x(12)"   "|" 
        wdetail.stk           "|"
        wdetail.class72  FORMAT "x(5)"     "|"
        wdetail.dstf72        "|"
        wdetail.dstfprem72    "|"
        wdetail.premt72       "|"
        wdetail.rstp_t72      "|"
        wdetail.rtax_t72      "|"
        wdetail.comper72      "|"
        wdetail.comprem72     "|"
        /* A67-0029 */
        wdetail.battno        "|"
        wdetail.battyr        "|"
        wdetail.battprice     "|"
        wdetail.battsi       "|"
        wdetail.battrate       "|"
        wdetail.battprm       "|"
        wdetail.chargno       "|"
        wdetail.chargsi       "|"
        wdetail.chargrate      "|"
        wdetail.chargprm      "|"
        /* end A67-0029 */
        wdetail.comment        SKIP .
END.
OUTPUT STREAM ns1 CLOSE.

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_runningpol C-Win 
PROCEDURE proc_runningpol :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DO:
    ASSIGN fi_process = "Create data file Load....".
    DISP fi_process WITH FRAM fr_main.
    For each  wdetail :
        DELETE  wdetail.
    End.
    For each  wtxt:
        DELETE  wtxt.
    End.
    For each  wmemo:
        DELETE  wmemo.
    End.
    For each  wacces:
        DELETE  wacces.
    End.
    For each  winst:
        DELETE  winst.
    End.
    /* A67-0029 */
    For each  wdrive:
        DELETE  wdrive.
    End.
    /* end A67-0029 */
    RUN proc_assigndata.
    RUN proc_chkpolicy.
    RUN proc_reportpolno. 
    
    /*OUTPUT STREAM ns1 CLOSE.*/

    MESSAGE "Match data Complete " VIEW-AS ALERT-BOX.

END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_runningpol_2 C-Win 
PROCEDURE proc_runningpol_2 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:  comment by A67-0029     
------------------------------------------------------------------------------*/
DO:
    ASSIGN fi_process = "Create data text file " + wf_chasno + " to wdetail ....." .
    DISP fi_process WITH FRAM fr_main.
    CREATE wdetail.
    CREATE wtxt.
    CREATE wmemo.
    CREATE wacces.
    CREATE winst.
    CREATE wdrive. /*A67-0029*/
    ASSIGN
        wdetail.riskno        =  TRIM(wf_riskno)   /*A64-0355*/
        wdetail.itemno        =  TRIM(wf_num)
        wdetail.policyno      =  "" /*trim(wf_policyno) A64-0355*/       
        wdetail.n_branch      =  trim(wf_n_branch)        
        wdetail.agent         =  trim(wf_agent)           
        wdetail.producer      =  trim(wf_producer)        
        wdetail.n_delercode   =  trim(wf_n_delercode)   
        wdetail.fincode       =  trim(wf_fincode)   
        wdetail.appenno       =  trim(wf_appenno)   
        wdetail.salename      =  trim(wf_salename)   
        wdetail.srate         =  trim(wf_srate ) 
        wdetail.comdat        =  date(wf_comdat)                                        
        wdetail.expdat        =  date(wf_expdat)                                        
        wdetail.agreedat      =  date(wf_agreedat)  
        wdetail.firstdat      =  date(wf_firstdat)  
        wdetail.packcod       =  trim(wf_packcod )   
        wdetail.camp_no       =  trim(wf_camp_no )   
        wdetail.campen        =  trim(wf_campen) 
        wdetail.specon        =  trim(wf_specon) 
        wdetail.product       =  trim(wf_product )   
        wdetail.promo         =  trim(wf_promo )   
        wdetail.rencnt        =  TRIM(wf_rencnt)   
        wdetail.prepol        =  trim(wf_prepol)
        wdetail.compul        =  trim(wf_compul)
        wdetail.nv_insref     =  TRIM(wf_insref)  /*A64-0355*/
        wdetail.instyp        =  trim(wf_instyp) 
        wdetail.inslang       =  trim(wf_inslang )  
        wdetail.tiname        =  trim(wf_tiname) 
        wdetail.insnam        =  trim(wf_insnam) 
        wdetail.lastname      =  trim(wf_lastname)  
        wdetail.icno          =  trim(wf_icno)  
        wdetail.insbr         =  trim(wf_insbr) 
        wdetail.occup         =  trim(wf_occup) 
        wdetail.addr          =  trim(wf_addr)
        wdetail.tambon        =  trim(wf_tambon) 
        wdetail.amper         =  trim(wf_amper) 
        wdetail.country       =  trim(wf_country )  
        wdetail.post          =  trim(wf_post ) 
        wdetail.provcod       =  trim(wf_provcod)  
        wdetail.distcod       =  trim(wf_distcod)  
        wdetail.sdistcod      =  trim(wf_sdistcod) 
        wdetail.jpae          =  trim(wf_ae)     /*A64-0355*/
        wdetail.jpjtl         =  trim(wf_jtl)    /*A64-0355*/
        wdetail.jpts          =  trim(wf_ts)     /*A64-0355*/
        wdetail.gender        =  trim(wf_gender) 
        wdetail.tele1         =  trim(wf_tele1) 
        wdetail.tele2         =  trim(wf_tele2) 
        wdetail.mail1         =  trim(wf_mail1) 
        wdetail.mail2         =  trim(wf_mail2) 
        wdetail.mail3         =  trim(wf_mail3) 
        wdetail.mail4         =  trim(wf_mail4) 
        wdetail.mail5         =  trim(wf_mail5) 
        wdetail.mail6         =  trim(wf_mail6)  
        wdetail.mail7         =  trim(wf_mail7)  
        wdetail.mail8         =  trim(wf_mail8)  
        wdetail.mail9         =  trim(wf_mail9)  
        wdetail.mail10        =  trim(wf_mail10)  
        wdetail.fax           =  trim(wf_fax)  
        wdetail.lineID        =  trim(wf_lineID)  
        wdetail.name2         =  trim(wf_name2 )  
        wdetail.name3         =  trim(wf_name3 )  
        wdetail.benname       =  trim(wf_benname )  
        wdetail.payercod      =  trim(wf_payercod)  
        wdetail.vatcode       =  trim(wf_vatcode )
        wdetail.covcod        =  trim(wf_covcod )  
        wdetail.garage        =  trim(wf_garage )  
        wdetail.special       =  trim(wf_special)  
        wdetail.inspec        =  trim(wf_inspec )  
        wdetail.class70       =  trim(wf_class70)
        wdetail.vehuse        =  TRIM(wf_vehuse)    /*A64-0355*/
        wdetail.redbook       =  TRIM(wf_redbook)  /*A65-0079*/
        wdetail.brand         =  trim(wf_brand)  
        wdetail.model         =  trim(wf_model)  
        wdetail.submodel      =  trim(wf_submodel)  
        wdetail.yrmanu        =  trim(wf_caryear)  
        wdetail.chasno        =  trim(wf_chasno )  
        wdetail.eng           =  trim(wf_eng) 
        wdetail.eng_no2       =  TRIM(wf_eng_no2)    /*A67-0029*/
        wdetail.seat          =  INTE(wf_seat)  
        wdetail.engcc         =  INTE(wf_engcc)  
        wdetail.weight        =  DECI(wf_weight) 
        /*wdetail.watt          =  INTE(wf_watt) */ /*A66-0202*/ 
        wdetail.watt          =  DECI(wf_watt)     /*A66-0202*/ 
        wdetail.body          =  trim(wf_body )  
        wdetail.typ           =  trim(wf_type )  
        wdetail.re_year       =  trim(wf_re_year)  
        wdetail.vehreg        =  trim(wf_vehreg )  
        wdetail.re_country    =  trim(wf_re_country)
        wdetail.cargrp        =  trim(wf_cargrp )   
        wdetail.colorcar      =  trim(wf_colorcar )
        wdetail.fule          =  trim(wf_fule  )   
        wdetail.drivnam       =  trim(wf_drivnam)  
        /* comment by : A67-0029 ...
        wdetail.ntitle1       =  trim(wf_ntitle1)   
        wdetail.drivername1   =  trim(wf_drivername1)
        wdetail.dname2        =  trim(wf_dname2)  
        wdetail.dicno         =  trim(wf_dicno )  
        wdetail.dgender1      =  trim(wf_dgender1)  
        wdetail.dbirth        =  trim(wf_dbirth)  
        wdetail.docoup        =  trim(wf_docoup)  
        wdetail.ddriveno      =  trim(wf_ddriveno)  
        wdetail.ntitle2       =  trim(wf_ntitle2 )  
        wdetail.drivername2   =  trim(wf_drivername2)
        wdetail.ddname1       =  trim(wf_ddname1 )
        wdetail.ddicno        =  trim(wf_ddicno  )
        wdetail.dgender2      =  trim(wf_dgender2)
        wdetail.ddbirth       =  trim(wf_ddbirth )
        wdetail.ddocoup       =  trim(wf_ddocoup )
        wdetail.dddriveno     =  trim(wf_dddriveno)
        ...end A67-0029..*/
        wdetail.baseplus      =  INTE(wf_baseplus)  
        wdetail.siplus        =  int(wf_siplus)
        wdetail.rs10          =  int(wf_rs10)   
        /* comment :  A64-0355
        wdetail.comper        =  int(wf_comper) 
        wdetail.comacc        =  int(wf_comacc) 
        wdetail.deductpd      =  int(wf_deductpd) */
        wdetail.comper        =  if trim(wf_comper)  = "U" then 999999999 else  int(wf_comper)    /*A64-0355*/
        wdetail.comacc        =  if trim(wf_comacc)  = "U" then 999999999 else  int(wf_comacc)    /*A64-0355*/
        wdetail.deductpd      =  if trim(wf_deductpd)= "U" then 999999999 else  int(wf_deductpd)  /*A64-0355*/ 
        wdetail.DOD           =  int(wf_DOD)   
        wdetail.DPD           =  int(wf_DPD)
        wdetail.maksi         =  trim(wf_maksi)  /* A67-0029 */
        wdetail.si            =  int(wf_tpfire) 
        wdetail.NO_411        =  int(wf_NO_41 ) 
        wdetail.seat41        =  int(wf_ac2)   
        wdetail.NO_412        =  int(wf_ac4)   
        wdetail.NO_413        =  int(wf_ac5)   
        wdetail.ac6           =  int(wf_ac6)   
        wdetail.NO_414        =  int(wf_ac7)   
        wdetail.NO_42         =  int(wf_NO_42) 
        wdetail.NO_43         =  int(wf_NO_43) 
        wdetail.base          =  int(wf_base)
        wdetail.unname        =  deci(wf_unname) 
        wdetail.nname         =  deci(wf_nname) 
        wdetail.tpbi          =  deci(wf_tpbi)   
        wdetail.tppd          =  deci(wf_tppd)   
        wdetail.ry01          =  deci(wf_ry01)   
        wdetail.ry02          =  deci(wf_ry02)   
        wdetail.ry03          =  deci(wf_ry03)   
        wdetail.fleet         =  trim(wf_fleet)   
        wdetail.ncb           =  trim(wf_ncb)
        wdetail.claim         =  trim(wf_claim)   
        wdetail.dspc          =  trim(wf_dspc)   
        wdetail.cctv          =  trim(wf_cctv)   
        wdetail.dstf          =  trim(wf_dstf)   
        wdetail.fleetprem     =  deci(wf_fleetprem)
        wdetail.ncbprem       =  deci(wf_ncbprem)   
        wdetail.clprem        =  deci(wf_clprem )   
        wdetail.dspcprem      =  deci(wf_dspcprem) 
        wdetail.cctvprem      =  deci(wf_cctvprem) 
        wdetail.dstfprem      =  deci(wf_dstfprem) 
        wdetail.premt         =  deci(wf_premt )   
        wdetail.rstp_t        =  deci(wf_rstp_t)   
        wdetail.rtax_t        =  deci(wf_rtax_t)   
        wdetail.comper70      =  deci(wf_comper70) 
        wdetail.comprem70     =  deci(wf_comprem70) 
        wdetail.agco70        =  trim(wf_agco70 )  
        wdetail.comco_per70   =  deci(wf_comco_per70) 
        wdetail.comco_prem70  =  deci(wf_comco_prem70)
        wdetail.dgpackge      =  trim(wf_dgpackge)
        wdetail.danger1       =  trim(wf_danger1)   
        wdetail.danger2       =  trim(wf_danger2)   
        wdetail.dgsi          =  inte(wf_dgsi)
        wdetail.dgrate        =  trim(wf_dgrate)   
        wdetail.dgfeet        =  trim(wf_dgfeet)   
        wdetail.dgncb         =  trim(wf_dgncb )   
        wdetail.dgdisc        =  trim(wf_dgdisc)   
        wdetail.dgatt         =  INTE(wf_dgatt)    
        wdetail.dgfeetprm     =  deci(wf_dgfeetprm)
        wdetail.dgncbprm      =  deci(wf_dgncbprm) 
        wdetail.dgdiscprm     =  deci(wf_dgdiscprm) 
        wdetail.dgprem        =  deci(wf_dgprem) 
        wdetail.cltxt         =  trim(wf_cltxt )
        wdetail.clamount      =  inte(wf_clamount)
        wdetail.faultno       =  inte(wf_faultno)  
        wdetail.faultprm      =  inte(wf_faultprm)  
        wdetail.goodno        =  inte(wf_goodno)  
        wdetail.goodprm       =  inte(wf_goodprm)  
        wdetail.loss          =  inte(wf_loss)  
        wdetail.compolusory   =  trim(wf_compolusory)
        wdetail.stk           =  trim(wf_barcode)  
        wdetail.class72       =  trim(wf_class72)  
        wdetail.dstf72        =  trim(wf_dstf72 )  
        wdetail.dstfprem72    =  deci(wf_dstfprem72)
        wdetail.premt72       =  deci(wf_premt72 )  
        wdetail.rstp_t72      =  deci(wf_rstp_t72)  
        wdetail.rtax_t72      =  deci(wf_rtax_t72)  
        wdetail.comper72      =  deci(wf_comper72)  
        wdetail.comprem72     =  deci(wf_comprem72) 
        /* Add by : A67-0029 */
        wdetail.battno        =  trim(wf_battno)   
        wdetail.battyr        =  trim(wf_battyr)   
        wdetail.battprice     =  trim(wf_battprice)
        /*wdetail.battper       =  trim(wf_battper)*/
        wdetail.battrate      =  trim(wf_battrate  )
        wdetail.battsi        =  trim(wf_battsi  )
        wdetail.battprm       =  trim(wf_battprm  )
        wdetail.chargno       =  trim(wf_chargno  )
        wdetail.chargsi       =  trim(wf_chargsi  )
        wdetail.chargrate      =  trim(wf_chargrate)
        wdetail.chargprm      =  trim(wf_chargprm ).
        /* end : A67-0029 */

    IF wdetail.policy = ""  THEN DO:
        IF wdetail.chasno <> ""  THEN assign wdetail.policy = "/" + SUBSTRING(wdetail.chasno,9,LENGTH(wdetail.chasno)).
        ELSE IF wdetail.prepol <> ""  THEN assign wdetail.policy = TRIM(wdetail.prepol) .
        ELSE IF trim(wf_policyno) <> ""  THEN ASSIGN  wdetail.policy = TRIM(wf_policyno) . /*A65-0079*/
        ELSE wdetail.policy = STRING(wdetail.riskno,"999") + "/" + STRING(wdetail.itemno,"999") . /*A65-0079*/
    END.                     
    RUN proc_assigninit70_2.
    IF trim(wdetail.nv_insref) <> ""  THEN RUN proc_chkinscode. /*A64-0355*/
    RELEASE  wdetail.
    RELEASE  wtxt.   
    RELEASE  wmemo.  
    RELEASE  wacces. 
    RELEASE  winst.  
    RELEASE  wdrive. 

    
END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_screen C-Win 
PROCEDURE proc_screen :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
OUTPUT STREAM ns3 TO value(fi_output3).
PUT STREAM NS3   
"IMPORT TEXT FILE FORMAT EMPIRE " SKIP
"             Loaddat : " fi_loaddat    SKIP
"              Branch : " "EM"          SKIP
"       Producer Code : " "EMP0001" SKIP
"          Agent Code : " "EMP0001" SKIP
"  Previous Batch No. : " fi_prevbat   " Batch Year : " fi_bchyr  SKIP
"Input File Name Load : " fi_filename   SKIP
"    Output Data Load : " fi_output1    SKIP
"Output Data Not Load : " fi_output1    SKIP
"     Batch File Name : " fi_output1    SKIP
" policy Import Total : " nv_imppol    "Total Net Premium Imp : " nv_netprm_t " BHT." SKIP
SKIP
SKIP
SKIP
"                             Total Record : " fi_impcnt      "   Total Net Premium : " fi_premtot " BHT." SKIP
"Batch No. : " fi_bchno SKIP
"                           Success Record : " fi_completecnt " Success Net Premium : " fi_premsuc " BHT." .


OUTPUT STREAM ns3 CLOSE.                                                          
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_sic_exp2 C-Win 
PROCEDURE proc_sic_exp2 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
loop_conexp:
REPEAT:
    FORM
        gv_id  LABEL " User Id " colon 35 SKIP
        nv_pwd LABEL " Password" colon 35 BLANK
        WITH FRAME nf00 CENTERED ROW 10 SIDE-LABELS OVERLAY width 80
        TITLE   " Connect DB Expiry System"  . 
    
    /*HIDE ALL NO-PAUSE.*//*note block*/
    STATUS INPUT OFF.
    /*
    {s0/s0sf1.i}
    */
    gv_prgid = "GWNEXP02".
    
    REPEAT:
      pause 0.
      STATUS DEFAULT "F4=EXIT".
      ASSIGN
      gv_id     = ""
      n_user    = "".
      UPDATE gv_id nv_pwd GO-ON(F1 F4) WITH FRAME nf00
      EDITING:
        READKEY.
        IF FRAME-FIELD = "gv_id" AND 
           LASTKEY = KEYCODE("ENTER") OR 
           LASTKEY = KEYCODE("f1") THEN DO:
           
           IF INPUT gv_id = "" THEN DO:
              MESSAGE "User ID. IS NOT BLANK".
              NEXT-PROMPT gv_id WITH FRAME nf00.
              NEXT.
           END.
           gv_id = INPUT gv_id.
    
        END.
        IF FRAME-FIELD = "nv_pwd" AND 
           LASTKEY = KEYCODE("ENTER") OR 
           LASTKEY = KEYCODE("f1") THEN DO:
           
           nv_pwd = INPUT nv_pwd.
        END.      
        APPLY LASTKEY.
      END.
      ASSIGN n_user = gv_id.
    
      IF LASTKEY = KEYCODE("F1") OR LASTKEY = KEYCODE("ENTER") THEN DO:
         CONNECT expiry -H TMSTH -S expiry -ld sic_exp -N tcp -U value(gv_id) -P value(nv_pwd) NO-ERROR.        /*HO*/ /*เปลี้ยนHost DataBase เป็น TMSTH*/
         /*CONNECT expiry -H alpha4 -S expiry -ld sic_exp -N tcp -U value(gv_id) -P value(nv_pwd) NO-ERROR.       /*HO*/ */
         /*CONNECT expiry -H devserver -S expiry  -ld sic_exp -N tcp -U value(gv_id) -P value(nv_pwd) NO-ERROR.  /*db test.*/  */
         
          CLEAR FRAME nf00.
          HIDE FRAME nf00.
          /*RETURN.*/ 
          IF NOT CONNECTED("sic_exp") THEN NEXT loop_conexp.
          ELSE DO:
               LEAVE loop_conexp.
               RETURN.
          END.
       END.
       IF FRAME-FIELD = "gv_id" OR FRAME-FIELD = "nv_pwd" AND LASTKEY = KEYCODE("F4") THEN DO:
            CLEAR FRAME nf00.
            HIDE FRAME nf00.
            LEAVE loop_conexp.
            RETURN.
       END.
    END.
END.

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_susspect C-Win 
PROCEDURE proc_susspect :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DO:
    ASSIGN fi_process = "check supspect " + wdetail.riskno + " " + wdetail.chasno + ".....".
    DISP fi_process WITH FRAM fr_main.

    DEF VAR nv_msgstatus  as char.
    DEF VAR nn_vehreglist as char.
    DEF VAR nn_namelist   as char.
    DEF VAR nn_namelist2  as char.
    DEF VAR nv_chanolist  as char.
    DEF VAR nv_idnolist   as char.
    DEF VAR nv_CheckLog   as LOGICAL.   
    DEF VAR nv_idnolist2  AS CHAR.
    ASSIGN 
        nv_msgstatus   = ""
        nn_vehreglist  = ""
        nn_namelist    = ""
        nn_namelist2   = "" 
        nv_chanolist   = "" 
        nv_idnolist    = "" 
        nv_CheckLog    = YES
        nn_vehreglist  = trim(wdetail.vehreg)  
        nv_chanolist   = trim(wdetail.chasno)  
        nv_idnolist    = trim(wdetail.icno) .

   /* IF R-INDEX(wdetail.insnam," ") <> 0 THEN  */
        ASSIGN
        nn_namelist    = trim(wdetail.insnam)  
        nn_namelist2   = trim(wdetail.lastname).
   /* ELSE ASSIGN
        nn_namelist    = TRIM(wdetail.insnam) 
        nn_namelist2   = "".*/

  
    IF wdetail.vehreg <> "" THEN DO:
        FIND LAST sicuw.uzsusp USE-INDEX uzsusp01    WHERE 
            sicuw.uzsusp.vehreg = nn_vehreglist    NO-LOCK NO-ERROR NO-WAIT.
        IF AVAIL sicuw.uzsusp  THEN DO:
            /*ASSIGN nv_msgstatus    = "รถผู้เอาประกัน ติด suspect ทะเบียน " + nn_vehreglist + " กรุณาติดต่อฝ่ายรับประกัน"*/ /*A66-0202*/
            ASSIGN nv_msgstatus    = "Suspect Code :" + sicuw.uzsusp.suscod + " " + "รถผู้เอาประกัน ติด suspect ทะเบียน " + nn_vehreglist + " กรุณาติดต่อฝ่ายรับประกัน" /*A66-0202*/
                   wdetail.comment = wdetail.comment + "|" + nv_msgstatus  
                   wdetail.pass    = "N"     
                   wdetail.OK_GEN  = "N".
        END.
    END.
    IF (nv_msgstatus = "") AND (nn_namelist <> "") THEN DO:
        FIND LAST sicuw.uzsusp USE-INDEX uzsusp03   WHERE 
            sicuw.uzsusp.fname = nn_namelist           AND 
            sicuw.uzsusp.lname = nn_namelist2          NO-LOCK NO-ERROR NO-WAIT.
        IF AVAIL sicuw.uzsusp  THEN DO:
            /*ASSIGN nv_msgstatus    = "ชื่อผู้เอาประกัน ติด suspect คุณ" + nn_namelist + " " + nn_namelist2 + " กรุณาติดต่อฝ่ายรับประกัน" */ /*A66-0202*/
            ASSIGN nv_msgstatus = "Suspect Code :" + sicuw.uzsusp.suscod + " " + "ชื่อผู้เอาประกัน ติด suspect คุณ" + nn_namelist + " " + nn_namelist2 + " กรุณาติดต่อฝ่ายรับประกัน"  /*A66-0202*/    
                wdetail.comment = wdetail.comment + "|" + nv_msgstatus  
                wdetail.pass    = "N"     
                wdetail.OK_GEN  = "N".
        END.
        ELSE DO:
            FIND LAST sicuw.uzsusp USE-INDEX uzsusp03   WHERE 
                sicuw.uzsusp.fname = nn_namelist  + " " + nn_namelist2        
                NO-LOCK NO-ERROR NO-WAIT.
            IF AVAIL sicuw.uzsusp  THEN DO:
                /*ASSIGN nv_msgstatus    = "ชื่อผู้เอาประกัน ติด suspect คุณ" + nn_namelist + " " + nn_namelist2 + " กรุณาติดต่อฝ่ายรับประกัน"*/ /*A66-0202*/
                ASSIGN nv_msgstatus = "Suspect Code :" + sicuw.uzsusp.suscod + " " + "ชื่อผู้เอาประกัน ติด suspect คุณ" + nn_namelist + " " + nn_namelist2 + " กรุณาติดต่อฝ่ายรับประกัน" /*A66-0202*/
                    wdetail.comment = wdetail.comment + "|" + nv_msgstatus  
                    wdetail.pass    = "N"     
                    wdetail.OK_GEN  = "N".
            END.
        END.
    END.
    IF (nv_msgstatus = "") AND (nv_chanolist <> "") THEN DO:
        FIND LAST sicuw.uzsusp USE-INDEX uzsusp05   WHERE 
            uzsusp.cha_no =  nv_chanolist         NO-LOCK NO-ERROR NO-WAIT.
        IF AVAIL sicuw.uzsusp  THEN DO:
           /* ASSIGN nv_msgstatus = "รถผู้เอาประกัน ติด suspect เลขตัวถัง " + nv_chanolist + " กรุณาติดต่อฝ่ายรับประกัน" *//*A66-0202*/
            ASSIGN nv_msgstatus = "Suspect Code :" + sicuw.uzsusp.suscod + " " + "รถผู้เอาประกัน ติด suspect เลขตัวถัง " + nv_chanolist + " กรุณาติดต่อฝ่ายรับประกัน" /*A66-0202*/
                wdetail.comment = wdetail.comment + "|" + nv_msgstatus  
                wdetail.pass    = "N"     
                wdetail.OK_GEN  = "N".
        END.
    END.
    IF (nv_msgstatus = "") AND (nv_idnolist <> "") THEN DO:
        FIND LAST sicuw.uzsusp USE-INDEX uzsusp08    WHERE 
            sicuw.uzsusp.notes = nv_idnolist   NO-LOCK NO-ERROR NO-WAIT.
        IF AVAIL sicuw.uzsusp  THEN DO:
            /*ASSIGN nv_msgstatus = "ID ผู้เอาประกัน ติด suspect ID: " + nv_idnolist2 + " กรุณาติดต่อฝ่ายรับประกัน" */ /*A66-0202*/
            ASSIGN nv_msgstatus = "Suspect Code :" + sicuw.uzsusp.suscod + " " + "ID ผู้เอาประกัน ติด suspect ID: " + nv_idnolist2 + " กรุณาติดต่อฝ่ายรับประกัน"  /*A66-0202*/
                wdetail.comment = wdetail.comment + "|" + nv_msgstatus  
                wdetail.pass    = "N"     
                wdetail.OK_GEN  = "N".
        END.
        IF nv_msgstatus = "" THEN DO:
            ASSIGN 
                nv_idnolist2 = ""
                nv_idnolist  = REPLACE(nv_idnolist,"-","")
                nv_idnolist  = REPLACE(nv_idnolist," ","")
                nv_idnolist2 = substr(nv_idnolist,1,1)  + "-" +
                               substr(nv_idnolist,2,4)  + "-" +
                               substr(nv_idnolist,6,5)  + "-" +
                               substr(nv_idnolist,11,2) + "-" +
                               substr(nv_idnolist,13)   .

            FIND LAST sicuw.uzsusp USE-INDEX uzsusp08  WHERE 
                sicuw.uzsusp.notes = nv_idnolist2         NO-LOCK NO-ERROR NO-WAIT.
            IF AVAIL sicuw.uzsusp  THEN DO:
                /*ASSIGN nv_msgstatus = "ID ผู้เอาประกัน ติด suspect ID: " + nv_idnolist2 + " กรุณาติดต่อฝ่ายรับประกัน"*/  /*A66-0202*/
                ASSIGN nv_msgstatus = "Suspect Code :" + sicuw.uzsusp.suscod + " " + "ID ผู้เอาประกัน ติด suspect ID: " + nv_idnolist2 + " กรุณาติดต่อฝ่ายรับประกัน"  /*A66-0202*/
                    wdetail.comment = wdetail.comment + "|" + nv_msgstatus  
                    wdetail.pass    = "N"     
                    wdetail.OK_GEN  = "N".
            END.
        END.
    END.
    RELEASE sicuw.uzsusp .

END.

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_TempPolicy C-Win 
PROCEDURE proc_TempPolicy :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
ASSIGN
nv_tmppol    = ""
nv_tmppolrun = nv_tmppolrun + 1
nv_tmppol    = nv_batchno + string(nv_tmppolrun, "999") .
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_updaterenew C-Win 
PROCEDURE proc_updaterenew :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes: add by A67-0029       
------------------------------------------------------------------------------*/
/*A64-0309*/
DEF VAR n_taddress AS CHAR FORMAT "x(150)" INIT "" .
DEF VAR n_name     AS CHAR FORMAT "x(150)" INIT "" .
ASSIGN n_taddress = trim(TRIM(wdetail.addr) + " " + TRIM(wdetail.tambon) + " " + 
                    TRIM(wdetail.amper) + " " + TRIM(wdetail.country) + " " + TRIM(wdetail.post)).
ASSIGN n_name = trim(trim(wdetail.tiname) + " " + TRIM(wdetail.insnam) + " " + TRIM(wdetail.lastname)).
/* end : A64-0309*/
IF  int(wdetail.rencnt)  <> re_rencnt  THEN ASSIGN wdetail.rencnt  = string(re_rencnt) .
IF  wdetail.n_branch    = "" THEN  ASSIGN wdetail.n_branch    = trim(re_branch) .
IF  wdetail.nv_insref   = "" THEN  ASSIGN wdetail.nv_insref   = trim(re_insref).
if  wdetail.agent       = "" THEN  assign wdetail.agent       = trim(re_agent)   .
if  wdetail.producer    = "" THEN  assign wdetail.producer    = trim(re_producer) .
if  wdetail.n_delercode = "" THEN  assign wdetail.n_delercode = trim(re_delercode).
if  wdetail.fincode     = "" THEN  assign wdetail.fincode     = trim(re_fincode)  .
if  wdetail.payercod    = "" THEN  assign wdetail.payercod    = trim(re_payercod) .
if  wdetail.vatcode     = "" THEN  assign wdetail.vatcode     = trim(re_vatcode)  .
IF  wdetail.comdat      = ?  THEN  ASSIGN wdetail.comdat      = date(re_comdat) .     
IF  wdetail.expdat      = ?  THEN  ASSIGN wdetail.expdat      = date(re_expdat) . 
IF  wdetail.firstdat    = ?  THEN  ASSIGN wdetail.firstdat    = DATE(re_firstdat).
IF n_name = "" THEN DO: /* add : A64-0309*/
    IF  wdetail.tiname      = "" then  Assign wdetail.tiname      = trim(re_tiname) . 
    IF  wdetail.insnam      = "" then  Assign wdetail.insnam      = trim(re_insnam) .
    IF  wdetail.lastname    = "" THEN  ASSIGN wdetail.lastname    = trim(re_lastname) .
END.  /* end : A64-0309*/
IF  wdetail.name2       = "" then  Assign wdetail.name2       = trim(re_name2)  . 
IF  wdetail.name3       = "" then  Assign wdetail.name3       = trim(re_name3)  . 
IF  n_taddress = " " THEN DO: /*A64-0309*/
    IF  wdetail.addr        = "" then  Assign wdetail.addr        = trim(re_n_addr1). 
    IF  wdetail.tambon      = "" then  Assign wdetail.tambon      = trim(re_n_addr2). 
    IF  wdetail.amper       = "" then  Assign wdetail.amper       = trim(re_n_addr3). 
    IF  wdetail.country     = "" then  Assign wdetail.country     = trim(re_n_addr4).
    if  wdetail.post        = "" then  assign wdetail.post        = trim(re_post)    . 
END. /*A64-0309*/
if  wdetail.provcod     = "" then  assign wdetail.provcod     = trim(re_provcod) . 
if  wdetail.distcod     = "" then  assign wdetail.distcod     = trim(re_distcod) . 
if  wdetail.sdistcod    = "" then  assign wdetail.sdistcod    = trim(re_sdistcod).
IF  wdetail.covcod      = "T" AND wdetail.class72 = ""  THEN  ASSIGN wdetail.class72 = wdetail.subclass .
IF  wdetail.subclass    = "" THEN DO:
        ASSIGN  wdetail.prempa   = SUBSTR(re_class,1,1)
                wdetail.subclass = substr(re_class,2,LENGTH(re_class))  /*A64-0044*/.
                /*wdetail.subclass = substr(re_class,2,3) */ /*A64-0044*/
END.
IF  wdetail.body     = ""       THEN ASSIGN wdetail.body     =  n_body.
IF  wdetail.weight   = 0        THEN ASSIGN wdetail.weight   =  deci(n_Tonn70). 
IF  wdetail.engcc    = 0        THEN ASSIGN wdetail.engcc    =  int(n_engine). 
IF  wdetail.redbook  = ""       THEN ASSIGN wdetail.redbook  =  nn_redbook.
IF  wdetail.brand    = ""       THEN ASSIGN wdetail.brand    =  IF INDEX(re_moddes," ") <> 0 THEN SUBSTR(re_moddes,1,R-INDEX(re_moddes," ")) ELSE re_moddes.  
IF  wdetail.model    = ""       THEN ASSIGN wdetail.model    =  IF INDEX(re_moddes," ") <> 0 THEN SUBSTR(re_moddes,R-INDEX(re_moddes," ")) ELSE "". 
IF  wdetail.yrmanu   = ""       THEN ASSIGN wdetail.yrmanu   =  re_yrmanu .     
IF  wdetail.seat     = 0        THEN ASSIGN wdetail.seat     =  int(re_seats)  .         
IF  wdetail.vehuse   = ""       THEN ASSIGN wdetail.vehuse   =  re_vehuse .       
IF  wdetail.covcod   = ""       THEN ASSIGN wdetail.covcod   =  re_covcod .       
IF  wdetail.garage   = ""       THEN ASSIGN wdetail.garage   =  re_garage .       
IF  wdetail.vehreg   = ""       THEN ASSIGN wdetail.vehreg   =  re_vehreg .
IF  wdetail.vehreg   = "null"   THEN ASSIGN wdetail.vehreg   =  re_vehreg . /* A64-0355*/
IF  wdetail.chasno   = ""       THEN ASSIGN wdetail.chasno   =  re_cha_no .     
IF  wdetail.eng      = ""       THEN ASSIGN wdetail.eng      =  re_eng_no .
IF  wdetail.cargrp   = ""       THEN ASSIGN wdetail.cargrp   =  re_cargrp .
IF  wdetail.agco     = ""       THEN ASSIGN wdetail.agco     =  re_agco .                                                   /*A64-0355*/
IF  wdetail.agco <> "Null" AND wdetail.agco <> "" AND wdetail.comco_per70 = 0 THEN ASSIGN wdetail.comco_per70 = re_commco . /*A64-0355*/
IF  wdetail.special  = ""       THEN ASSIGN wdetail.special  =  re_acctyp .   /*A66-0202*/
IF  wdetail.watt     = 0        THEN ASSIGN wdetail.watt     =  re_watt.      /*A66-0202*/
IF  deci(wdetail.maksi) = 0     THEN ASSIGN wdetail.maksi    =  string(re_maksi) .     /*A67-0029*/
IF  wdetail.eng_no2  = ""       THEN ASSIGN wdetail.eng_no2  =  re_eng_no2.   /*A67-0029*/
/* Add by : A67-0121 */
if  wdetail.battyr     = ""     THEN ASSIGN wdetail.battyr     =  re_battyr    . 
if  wdetail.battsi     = ""     THEN ASSIGN wdetail.battsi     =  re_battsi    . 
if  wdetail.battprice  = ""     THEN ASSIGN wdetail.battprice  =  re_battprice . 
if  wdetail.battno     = ""     THEN ASSIGN wdetail.battno     =  re_battno    . 
if  wdetail.chargno    = ""     THEN ASSIGN wdetail.chargno    =  re_chargno   . 
if  wdetail.chargsi    = ""     THEN ASSIGN wdetail.chargsi    =  re_chargsi   . 
if  wdetail.battprm    = ""     THEN ASSIGN wdetail.battprm    =  re_battprm   . 
if  wdetail.chargprm   = ""     THEN ASSIGN wdetail.chargprm   =  re_chargprm  . 
/* end A67-0212 */

IF wdetail.poltyp = "V70" THEN DO:
   ASSIGN wdetail.baseplus = re_base3     /* add by : A64-0257 */
   wdetail.base     =  re_baseprm
   wdetail.comper   =  int(re_uom1_v)       
   wdetail.comacc   =  int(re_uom2_v)      
   wdetail.deductpd =  int(re_uom5_v)      
   wdetail.si       =  IF index(wdetail.covcod,".") = 0 THEN INT(re_si) ELSE 0 
   wdetail.siplus   =  IF index(wdetail.covcod,".") <> 0 THEN INT(re_si) ELSE 0
   wdetail.no_411   =  re_41     
   wdetail.no_412   =  re_41    
   wdetail.no_42    =  re_42
   wdetail.no_43    =  re_43
   wdetail.seat41   =  re_seat41 
   wdetail.dod      =  re_dedod 
   wdetail.dpd      =  re_dedpd    
   wdetail.fleet    =  STRING(re_flet_per)     
   wdetail.ncb      =  STRING(re_ncbper)    
   wdetail.dspc     =  STRING(re_dss_per)      
   wdetail.dstf     =  STRING(re_stf_per)      
   wdetail.claim    =  STRING(re_cl_per).  

   IF  wdetail.comper70 = 0    THEN ASSIGN wdetail.comper70 =  re_comm .     /* add by : A64-0257 */
   IF  wdetail.benname  = ""   THEN ASSIGN wdetail.benname  =  re_bennam1.
   /* comment by :A67-0212 ...
    IF  re_driver <> "" AND (TRIM(wdetail.drivnam) = "0" OR trim(wdetail.drivnam) = "" ) THEN DO:
        ASSIGN wdetail.driver  = re_driver 
              wdetail.nname   = re_prmtdriv.
     end . */ 
   /* end : A67-0212 */
   /* add : A67-0212 */
   IF re_chkdriv <> "" THEN DO:
       IF TRIM(wdetail.drivnam) = "0" THEN DO:  /*A67-0212 */
        ASSIGN wdetail.driver  = re_driver 
               wdetail.nname   = re_prmtdriv
               wdetail.drivnam = re_chkdriv. 
       END.
       ELSE IF TRIM(wdetail.drivnam) = " " THEN DO:  /*A67-0212 */
        ASSIGN wdetail.driver  = re_driver 
               wdetail.nname   = re_prmtdriv
               wdetail.drivnam = re_chkdriv. 
       END.
   END.
    /* A67-0212 */
   FIND FIRST wacces WHERE wacces.policy = wdetail.policyno NO-LOCK NO-ERROR NO-WAIT.
   IF AVAIL wacces THEN DO:
       IF wacces.accdata1  = "" AND wacces.accdata2 = "" AND wacces.accdata3 = "" AND 
          wacces.accdata4  = "" AND wacces.accdata5 = "" AND wacces.accdata6 = "" AND 
          wacces.accdata7  = "" AND wacces.accdata8 = "" AND wacces.accdata9 = "" AND 
          wacces.accdata10 = "" THEN DO:
          ASSIGN
              wacces.policyno  =  TRIM(wdetail.policyno)                                                          
              wacces.accdata1  =  IF LENGTH(re_acctxt) >= 60  THEN SUBSTR(re_acctxt,1,60)    ELSE TRIM(re_acctxt) 
              wacces.accdata2  =  IF LENGTH(re_acctxt) >= 61  THEN SUBSTR(re_acctxt,61,60)   ELSE ""              
              wacces.accdata3  =  IF LENGTH(re_acctxt) >= 121 THEN SUBSTR(re_acctxt,121,60)  ELSE ""              
              wacces.accdata4  =  IF LENGTH(re_acctxt) >= 181 THEN SUBSTR(re_acctxt,181,60)  ELSE ""              
              wacces.accdata5  =  IF LENGTH(re_acctxt) >= 241 THEN SUBSTR(re_acctxt,241,60)  ELSE ""              
              wacces.accdata6  =  IF LENGTH(re_acctxt) >= 301 THEN SUBSTR(re_acctxt,301,60)  ELSE ""              
              wacces.accdata7  =  IF LENGTH(re_acctxt) >= 361 THEN SUBSTR(re_acctxt,361,60)  ELSE ""              
              wacces.accdata8  =  IF LENGTH(re_acctxt) >= 421 THEN SUBSTR(re_acctxt,421,60)  ELSE ""              
              wacces.accdata9  =  IF LENGTH(re_acctxt) >= 481 THEN SUBSTR(re_acctxt,481,60)  ELSE ""              
              wacces.accdata10 =  IF LENGTH(re_acctxt) >= 541 THEN SUBSTR(re_acctxt,541,60)  ELSE "".             
       END.

       ELSE IF wacces.accdata1  = "Null" OR wacces.accdata2 = "Null" OR wacces.accdata3 = "Null" OR
               wacces.accdata4  = "Null" OR wacces.accdata5 = "Null" OR wacces.accdata6 = "Null" OR
               wacces.accdata7  = "Null" OR wacces.accdata8 = "Null" OR wacces.accdata9 = "Null" OR
               wacces.accdata10 = "Null" THEN DO:
           ASSIGN
               wacces.policyno  =  TRIM(wdetail.policyno)
               wacces.accdata1  =  FILL(" ",60)          
               wacces.accdata2  =  FILL(" ",60)          
               wacces.accdata3  =  FILL(" ",60)          
               wacces.accdata4  =  FILL(" ",60)          
               wacces.accdata5  =  FILL(" ",60)          
               wacces.accdata6  =  FILL(" ",60)          
               wacces.accdata7  =  FILL(" ",60)          
               wacces.accdata8  =  FILL(" ",60)          
               wacces.accdata9  =  FILL(" ",60)          
               wacces.accdata10 =  FILL(" ",60).         
       END.
       ELSE DO:
           ASSIGN
               wacces.policyno  =  TRIM(wdetail.policyno).

           re_acctxt = "".
           re_acctxt = TRIM(wacces.accdata1) + TRIM(wacces.accdata2) + TRIM(wacces.accdata3) + 
                       TRIM(wacces.accdata4) + TRIM(wacces.accdata5) + TRIM(wacces.accdata6) + 
                       TRIM(wacces.accdata7) + TRIM(wacces.accdata8) + TRIM(wacces.accdata9) +
                       TRIM(wacces.accdata10).

           ASSIGN
               wacces.accdata1  =  IF LENGTH(re_acctxt) >= 60  THEN SUBSTR(re_acctxt,1,60)    ELSE TRIM(re_acctxt) 
               wacces.accdata2  =  IF LENGTH(re_acctxt) >= 61  THEN SUBSTR(re_acctxt,61,60)   ELSE ""              
               wacces.accdata3  =  IF LENGTH(re_acctxt) >= 121 THEN SUBSTR(re_acctxt,121,60)  ELSE ""              
               wacces.accdata4  =  IF LENGTH(re_acctxt) >= 181 THEN SUBSTR(re_acctxt,181,60)  ELSE ""              
               wacces.accdata5  =  IF LENGTH(re_acctxt) >= 241 THEN SUBSTR(re_acctxt,241,60)  ELSE ""              
               wacces.accdata6  =  IF LENGTH(re_acctxt) >= 301 THEN SUBSTR(re_acctxt,301,60)  ELSE ""              
               wacces.accdata7  =  IF LENGTH(re_acctxt) >= 361 THEN SUBSTR(re_acctxt,361,60)  ELSE ""              
               wacces.accdata8  =  IF LENGTH(re_acctxt) >= 421 THEN SUBSTR(re_acctxt,421,60)  ELSE ""              
               wacces.accdata9  =  IF LENGTH(re_acctxt) >= 481 THEN SUBSTR(re_acctxt,481,60)  ELSE ""              
               wacces.accdata10 =  IF LENGTH(re_acctxt) >= 541 THEN SUBSTR(re_acctxt,541,60)  ELSE "". 
       END.
   END.
   IF LENGTH(wdetail.subclass) = 4 AND SUBSTR(wdetail.subclass,4,1) = "E"  THEN DO:   
      ASSIGN wdetail.subclass = "E" + SUBSTR(wdetail.subclass,1,2)
             wdetail.watt     = wdetail.watt * 1.34 .
   END.
   
END.

END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE Proc_usdcod C-Win 
PROCEDURE Proc_usdcod :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DEF VAR nv_age1 AS INT INIT 0.
DEF VAR nv_age2 AS INT INIT 0.
DEFINE  VAR   nv_drivcod1 AS CHARACTER FORMAT "X(4)".
DEFINE  VAR   nv_drivcod2 AS CHARACTER FORMAT "X(4)".
DEF VAR nv_age1rate  LIKE  sicsyac.xmm106.appinc.
DEF VAR nv_age2rate  LIKE  sicsyac.xmm106.appinc.
ASSIGN
  nv_age1  = INTEGER(nv_drivage1)
  nv_age2  = INTEGER(nv_drivage2).
nv_drivcod = "A" + STRING(nv_drivno,"9").
  IF nv_drivno = 1 THEN DO:
    IF nv_age1 LE 50 THEN DO:
      IF nv_age1 LE 35 THEN DO:
        IF nv_age1 LE 24 THEN DO:
          nv_drivcod = nv_drivcod + "24".
        END.
        ELSE nv_drivcod = nv_drivcod + "35".
      END.
      ELSE nv_drivcod = nv_drivcod + "50".
    END.
    ELSE nv_drivcod = nv_drivcod + "99".
  END.
  IF  nv_drivno  = 2  THEN DO:
    IF nv_age1 LE 50 THEN DO:
      IF nv_age1 LE 35 THEN DO:
        IF nv_age1 LE 24 THEN DO:
          nv_drivcod1 = nv_drivcod + "24".
        END.
        ELSE nv_drivcod1 = nv_drivcod + "35".
      END.
      ELSE nv_drivcod1 = nv_drivcod + "50".
    END.
    ELSE nv_drivcod1 = nv_drivcod + "99".
    FIND FIRST sicsyac.xmm106 USE-INDEX xmm10601 WHERE
               sicsyac.xmm106.tariff = nv_tariff   AND
               sicsyac.xmm106.bencod = nv_drivcod1 AND
               sicsyac.xmm106.class  = nv_class    AND
               sicsyac.xmm106.covcod = nv_covcod   AND
               sicsyac.xmm106.key_b  GE nv_key_b   AND
               sicsyac.xmm106.effdat LE nv_comdat
    NO-LOCK NO-ERROR.
    IF AVAIL sicsyac.xmm106 THEN
       nv_age1rate = sicsyac.xmm106.appinc.
    IF nv_age2 LE 50 THEN DO:
      IF nv_age2 LE 35 THEN DO:
        IF nv_age2 LE 24 THEN DO:
          nv_drivcod2 = nv_drivcod + "24".
        END.
        ELSE nv_drivcod2 = nv_drivcod + "35".
      END.
      ELSE nv_drivcod2 = nv_drivcod + "50".
    END.
    ELSE nv_drivcod2 = nv_drivcod + "99".
         
    FIND FIRST sicsyac.xmm106 USE-INDEX xmm10601 WHERE
           sicsyac.xmm106.tariff = nv_tariff   AND
           sicsyac.xmm106.bencod = nv_drivcod2 AND
           sicsyac.xmm106.class  = nv_class    AND
           sicsyac.xmm106.covcod = nv_covcod   AND
           sicsyac.xmm106.key_b  GE nv_key_b   AND
           sicsyac.xmm106.effdat LE nv_comdat
           NO-LOCK NO-ERROR.
    IF AVAIL sicsyac.xmm106 THEN
       nv_age2rate = sicsyac.xmm106.appinc.
    IF   nv_age2rate > nv_age1rate  THEN
         nv_drivcod  = nv_drivcod2.
    ELSE nv_drivcod  = nv_drivcod1.
  END.
  RELEASE sicsyac.xmm106 .
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_uwd100 C-Win 
PROCEDURE proc_uwd100 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
/*create  text (F17) for Query claim....*/
DEFINE VAR nvw_index1      AS INTEGER INIT 0.
DEF BUFFER wf_uwd100 FOR sic_bran.uwd100.
DEF VAR nv_bptr      AS RECID.
DEF VAR nv_fptr      AS RECID.
FOR EACH wuppertxt.
    DELETE wuppertxt.
END.
ASSIGN 
    nv_bptr  = 0
    nv_line1 = 1 
    nv_txt1  = ""
    nv_txt2  = ""
    nv_txt3  = ""  
    nv_txt4  = ""
    nv_txt5  = ""  
    nv_txt1  = IF wdetail.danger1 <> "" THEN "Dangerous Cargo:" + trim(wdetail.danger1) + " " + trim(wdetail.danger2) ELSE ""
    nv_txt2  = ""
    nv_txt3  = ""
    nv_txt4  = ""
    nv_txt5  = "" . 
IF nv_txt1 <> "" THEN DO:
    CREATE wuppertxt.
    ASSIGN 
        wuppertxt.line = nv_line1
        wuppertxt.txt  = nv_txt1.
    nv_line1 = nv_line1 + 1.
END.
FOR EACH wtxt WHERE wtxt.policyno = wdetail.policyno NO-LOCK.
    DO WHILE nv_line1 <= 11:
        CREATE wuppertxt.
        wuppertxt.line = nv_line1.
        IF nv_line1 = 2  THEN wuppertxt.txt  = wtxt.txt1.
        IF nv_line1 = 3  THEN wuppertxt.txt  = wtxt.txt2.
        IF nv_line1 = 4  THEN wuppertxt.txt  = wtxt.txt3.
        IF nv_line1 = 5  THEN wuppertxt.txt  = wtxt.txt4.
        IF nv_line1 = 6  THEN wuppertxt.txt  = wtxt.txt5.
        IF nv_line1 = 7  THEN wuppertxt.txt  = wtxt.txt6.
        IF nv_line1 = 8  THEN wuppertxt.txt  = wtxt.txt7.
        IF nv_line1 = 9  THEN wuppertxt.txt  = wtxt.txt8.
        IF nv_line1 = 10 THEN wuppertxt.txt  = wtxt.txt9.
        IF nv_line1 = 11 THEN wuppertxt.txt  = wtxt.txt10.
        nv_line1 = nv_line1 + 1.
    END.
END.

FIND sic_bran.uwm100 USE-INDEX uwm10001   WHERE 
     sic_bran.uwm100.policy  = wdetail.policyno  AND
     sic_bran.uwm100.rencnt  = n_rencnt      AND
     sic_bran.uwm100.endcnt  = n_endcnt      AND
     sic_bran.uwm100.bchyr   = nv_batchyr    AND
     sic_bran.uwm100.bchno   = nv_batchno    AND
     sic_bran.uwm100.bchcnt  = nv_batcnt     NO-ERROR NO-WAIT.
IF AVAILABLE uwm100 THEN DO:
    FOR EACH wuppertxt NO-LOCK BREAK BY wuppertxt.line:
        IF wuppertxt.txt <> "" THEN DO:  /*-- A58-0419 --*/
            CREATE sic_bran.uwd100.
            ASSIGN
                sic_bran.uwd100.bptr    = nv_bptr
                sic_bran.uwd100.fptr    = 0
                sic_bran.uwd100.policy  = wdetail.policyno
                sic_bran.uwd100.rencnt  = n_rencnt
                sic_bran.uwd100.endcnt  = n_endcnt
                sic_bran.uwd100.ltext   = wuppertxt.txt.
            IF nv_bptr <> 0 THEN DO:
                FIND wf_uwd100 WHERE RECID(wf_uwd100) = nv_bptr.
                wf_uwd100.fptr = RECID(uwd100).
            END.
            IF nv_bptr = 0 THEN  sic_bran.uwm100.fptr01 = RECID(uwd100).
            nv_bptr = RECID(uwd100).
        END.  /*-- A58-0419 --*/
    END.
    RELEASE sic_bran.uwd100.

    IF wdetail.prepol <> ""  THEN DO:
        FOR EACH wuwd100 WHERE wuwd100.policy = TRIM(wdetail.prepol) NO-LOCK BREAK BY wuwd100.lnumber:
            IF wuwd100.ltext <> "" THEN DO:  /*-- A58-0419 --*/
                CREATE sic_bran.uwd100.
                ASSIGN
                    sic_bran.uwd100.bptr    = nv_bptr
                    sic_bran.uwd100.fptr    = 0
                    sic_bran.uwd100.policy  = wdetail.policyno
                    sic_bran.uwd100.rencnt  = n_rencnt
                    sic_bran.uwd100.endcnt  = n_endcnt
                    sic_bran.uwd100.ltext   = wuwd100.ltext.
                IF nv_bptr <> 0 THEN DO:
                    FIND wf_uwd100 WHERE RECID(wf_uwd100) = nv_bptr.
                    wf_uwd100.fptr = RECID(uwd100).
                END.
                IF nv_bptr = 0 THEN  sic_bran.uwm100.fptr01 = RECID(uwd100).
                nv_bptr = RECID(uwd100).
            END.  /*-- A58-0419 --*/
        END.
    END.
    sic_bran.uwm100.bptr01 = nv_bptr.
END. /*uwm100*/
RELEASE sic_bran.uwd100.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_uwd102 C-Win 
PROCEDURE proc_uwd102 :
/*------------------------------------------------------------------------------
  Purpose: Create by A58-0419    
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DEF BUFFER wf_uwd102 FOR sic_bran.uwd102.
DEF VAR nv_bptr      AS RECID.
FOR EACH wuppertxt.
    DELETE wuppertxt.
END.

ASSIGN 
    nv_fptr  = 0
    nv_bptr  = 0
    nv_line1 = 1
    nv_fptr  = sic_bran.uwm100.fptr02
    nv_txt1  = ""  
    nv_txt2  = ""
    nv_txt3  = ""  
    nv_txt4  = ""
    nv_txt5  = "" . 

FOR EACH wmemo WHERE wmemo.policyno = wdetail.policyno NO-LOCK.
    DO WHILE nv_line1 <= 10:
        CREATE wuppertxt.
        wuppertxt.line = nv_line1.
        IF nv_line1 = 1  THEN wuppertxt.txt = wmemo.memo1.
        IF nv_line1 = 2  THEN wuppertxt.txt = wmemo.memo2.
        IF nv_line1 = 3  THEN wuppertxt.txt = wmemo.memo3.
        IF nv_line1 = 4  THEN wuppertxt.txt = wmemo.memo4.
        IF nv_line1 = 5  THEN wuppertxt.txt = wmemo.memo5.
        IF nv_line1 = 6  THEN wuppertxt.txt = wmemo.memo6.
        IF nv_line1 = 7  THEN wuppertxt.txt = wmemo.memo7.
        IF nv_line1 = 8  THEN wuppertxt.txt = wmemo.memo8.
        IF nv_line1 = 9  THEN wuppertxt.txt = wmemo.memo9.
        IF nv_line1 = 10 THEN wuppertxt.txt = wmemo.memo10.
        nv_line1 = nv_line1 + 1.
    END.
END.
/*IF nv_polmaster <> ""  THEN DO:*/ /*A64-0044*/
IF wdetail.polmaster <> ""  THEN DO: /*A64-0044*/
    CREATE wuppertxt.
    ASSIGN wuppertxt.line = nv_line1
           wuppertxt.txt  = "Campaign Policy Master:" + wdetail.polmaster  /*nv_polmaster */ /*A64-0044*/. 
END.

FIND sic_bran.uwm100 USE-INDEX uwm10001   WHERE 
     sic_bran.uwm100.policy  = wdetail.policyno  AND
     sic_bran.uwm100.rencnt  = n_rencnt      AND
     sic_bran.uwm100.endcnt  = n_endcnt      AND
     sic_bran.uwm100.bchyr   = nv_batchyr    AND
     sic_bran.uwm100.bchno   = nv_batchno    AND
     sic_bran.uwm100.bchcnt  = nv_batcnt     NO-ERROR NO-WAIT.
IF AVAILABLE uwm100 THEN DO:
    FOR EACH wuppertxt NO-LOCK BREAK BY wuppertxt.line:
        IF wuppertxt.txt <> "" THEN DO:
            CREATE sic_bran.uwd102.
            ASSIGN
                sic_bran.uwd102.bptr    = nv_bptr
                sic_bran.uwd102.fptr    = 0
                sic_bran.uwd102.policy  = sic_bran.uwm100.policy  
                sic_bran.uwd102.rencnt  = sic_bran.uwm100.rencnt  
                sic_bran.uwd102.endcnt  = sic_bran.uwm100.endcnt  
                sic_bran.uwd102.ltext   = wuppertxt.txt.
            IF nv_bptr <> 0 THEN DO:
                FIND wf_uwd102 WHERE RECID(wf_uwd102) = nv_bptr.
                wf_uwd102.fptr = RECID(sic_bran.uwd102).
            END.
            IF nv_bptr = 0 THEN  sic_bran.uwm100.fptr02 = RECID(uwd102).
            nv_bptr = RECID(sic_bran.uwd102).
        END.
    END.
    RELEASE sic_bran.uwd102.
    IF wdetail.prepol <> "" THEN DO:                             /*A64-0257*/
        /*FOR EACH wuwd102 NO-LOCK BREAK BY wuwd102.lnumber:*/   /*A64-0257*/
        FOR EACH wuwd102 WHERE wuwd102.policy = TRIM(wdetail.prepol) NO-LOCK BREAK BY wuwd102.lnumber: /*A64-0257*/
            IF wuwd102.ltext <> "" THEN DO:
                CREATE sic_bran.uwd102.
                ASSIGN
                    sic_bran.uwd102.bptr    = nv_bptr
                    sic_bran.uwd102.fptr    = 0
                    sic_bran.uwd102.policy  = sic_bran.uwm100.policy  
                    sic_bran.uwd102.rencnt  = sic_bran.uwm100.rencnt  
                    sic_bran.uwd102.endcnt  = sic_bran.uwm100.endcnt  
                    sic_bran.uwd102.ltext   = wuwd102.ltext.
                IF nv_bptr <> 0 THEN DO:
                    FIND wf_uwd102 WHERE RECID(wf_uwd102) = nv_bptr.
                    wf_uwd102.fptr = RECID(sic_bran.uwd102).
                END.
                IF nv_bptr = 0 THEN  sic_bran.uwm100.fptr02 = RECID(uwd102).
                nv_bptr = RECID(sic_bran.uwd102).
            END.
        END.
    END.
    sic_bran.uwm100.bptr02 = nv_bptr.
END. /*uwm100*/
RELEASE sic_bran.uwd102.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_uwd132_Renew C-Win 
PROCEDURE proc_uwd132_Renew :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DEF BUFFER wf_uwd132 FOR sic_bran.uwd132.
DO:
    FIND sic_bran.uwm100 WHERE RECID(sic_bran.uwm100) = s_recid1 NO-WAIT NO-ERROR.
    FIND sic_bran.uwm130 WHERE RECID(sic_bran.uwm130) = s_recid3 NO-WAIT NO-ERROR.
   
    ASSIGN nv_bptr = 0      nv_gapprm   = 0     nv_pdprm    = 0
           /* A64-0309 */ 
           nv_411t = 0      nv_412t = 0
           nv_42t  = 0      nv_43t  = 0.
           /* end : A64-0309 */ 

     FOR EACH wuwd132  WHERE TRIM(wuwd132.prepol)  = TRIM(wdetail.prepol) NO-LOCK.
        FIND sic_bran.uwd132  USE-INDEX uwd13201 WHERE
             sic_bran.uwd132.policy  = sic_bran.uwm100.policy AND
             sic_bran.uwd132.rencnt  = sic_bran.uwm100.rencnt AND
             sic_bran.uwd132.endcnt  = sic_bran.uwm100.endcnt AND
             sic_bran.uwd132.riskgp  = sic_bran.uwm130.riskgp AND
             sic_bran.uwd132.riskno  = sic_bran.uwm130.riskno AND
             sic_bran.uwd132.itemno  = sic_bran.uwm130.itemno AND
             sic_bran.uwd132.bchyr   = nv_batchyr             AND
             sic_bran.uwd132.bchno   = nv_batchno             AND
             sic_bran.uwd132.bchcnt  = nv_batcnt              AND 
             sic_bran.uwd132.bencod  = wuwd132.bencod      NO-ERROR NO-WAIT.
   
            IF NOT AVAILABLE sic_bran.uwd132 THEN DO:
                CREATE sic_bran.uwd132.

               ASSIGN fi_process = "Create data to sic_bran.uwd132  ..." + wdetail.policy .
               DISP fi_process WITH FRAM fr_main. 
               ASSIGN
                  sic_bran.uwd132.bencod  =  wuwd132.bencod 
                  sic_bran.uwd132.benvar  =  wuwd132.benvar 
                  /*sic_bran.uwd132.rate    =  0.00 */                    
                  sic_bran.uwd132.gap_ae  =  wuwd132.gap_ae    /*A64-0355*/             
                  sic_bran.uwd132.gap_c   =  wuwd132.gap_c                    
                  /*sic_bran.uwd132.dl1_c   =  0.00 */                   
                  /*sic_bran.uwd132.dl2_c   =  0.00 */                   
                  /*sic_bran.uwd132.dl3_c   =  0.00 */                   
                  sic_bran.uwd132.pd_aep  =  wuwd132.pd_aep   /*A64-0355*/                
                  sic_bran.uwd132.prem_c  =  wuwd132.prem_c                   
                  sic_bran.uwd132.fptr    =  0                  
                  sic_bran.uwd132.bptr    =  nv_bptr                   
                  sic_bran.uwd132.policy  =  sic_bran.uwm100.policy 
                  sic_bran.uwd132.rencnt  =  sic_bran.uwm100.rencnt                    
                  sic_bran.uwd132.endcnt  =  sic_bran.uwm100.endcnt                    
                  sic_bran.uwd132.riskgp  =  sic_bran.uwm130.riskgp                 
                  sic_bran.uwd132.riskno  =  sic_bran.uwm130.riskno                 
                  sic_bran.uwd132.itemno  =  sic_bran.uwm130.itemno                 
                  /*sic_bran.uwd132.rateae  =  "A"   */              
                  sic_bran.uwd132.bchyr   =  nv_batchyr                   
                  sic_bran.uwd132.bchno   =  nv_batchno 
                  sic_bran.uwd132.bchcnt  =  nv_batcnt.
               
                  nv_gapprm = nv_gapprm + wuwd132.gap_c .
                  nv_pdprm  = nv_pdprm  + wuwd132.prem_C.
                /*
               IF sic_bran.uwd132.bencod = "SI"   THEN ASSIGN sic_bran.uwd132.benvar = nv_sivar .
               IF INDEX(sic_bran.uwd132.bencod,"SI2") <> 0  THEN ASSIGN sic_bran.uwd132.benvar = nv_sivar3 .
               IF INDEX(sic_bran.uwd132.bencod,"SI3") <> 0  THEN ASSIGN sic_bran.uwd132.benvar = nv_sivar3 .
               IF sic_bran.uwd132.bencod = "BI1"  THEN ASSIGN sic_bran.uwd132.benvar = nv_bipvar.
               IF sic_bran.uwd132.bencod = "BI2"  THEN ASSIGN sic_bran.uwd132.benvar = nv_biavar.
               IF sic_bran.uwd132.bencod = "PD"   THEN ASSIGN sic_bran.uwd132.benvar = nv_pdavar.*/
               /* add by : Ranu I. A64-0309 05/08/2021 */
               IF sic_bran.uwd132.bencod = "411"  THEN ASSIGN  nv_411t = wuwd132.prem_C  .
               IF sic_bran.uwd132.bencod = "412"  THEN ASSIGN  nv_412t = wuwd132.prem_C  .
               IF sic_bran.uwd132.bencod = "42"   THEN ASSIGN  nv_42t  = wuwd132.prem_C  .
               IF sic_bran.uwd132.bencod = "43"   THEN ASSIGN  nv_43t  = wuwd132.prem_C  .
               /* end A64-0309 */
               IF sic_bran.uwd132.bencod = "dspc" THEN ASSIGN nv_dss_per  = DECI(SUBSTRING(sic_bran.uwd132.benvar,31,30)).
               IF sic_bran.uwd132.bencod = "NCB"  THEN ASSIGN nv_ncbper   = DECI(SUBSTRING(sic_bran.uwd132.benvar,31,30)).
               /* add by : A64-0355 */
               IF sic_bran.uwd132.bencod = "dspc" THEN DO:
                   ASSIGN 
                       SUBSTRING(sic_bran.uwd132.benvar,1,30)  = "     Discount Special % =     "
                       SUBSTRING(sic_bran.uwd132.benvar,31,30) = STRING(nv_dss_per) .
               END.
               /* end A64-0355 */
               If nv_ncbper  <> 0 Then do:
                   Find LAST sicsyac.xmm104 Use-index xmm10401 Where
                       sicsyac.xmm104.tariff = nv_tariff           AND
                       sicsyac.xmm104.class  = nv_class            AND 
                       sicsyac.xmm104.covcod = nv_covcod           AND 
                       sicsyac.xmm104.ncbper   = INTE(nv_ncbper) No-lock no-error no-wait.
                   IF not avail  sicsyac.xmm104  Then do:
                       Message " This NCB Step not on NCB Rates file xmm104. " View-as alert-box.
                       ASSIGN wdetail.pass    = "N"
                           wdetail.comment = wdetail.comment + "| This NCB Step not on NCB Rates file xmm104. ".
                   END.
                   ELSE ASSIGN nv_ncbper = xmm104.ncbper   
                               nv_ncbyrs = xmm104.ncbyrs.
               END.
               Else do:  
                   ASSIGN nv_ncbyrs =   0
                          nv_ncbper =   0
                          nv_ncb    =   0.
               END.

               ASSIGN   
                sic_bran.uwm301.ncbper   = nv_ncbper
                sic_bran.uwm301.ncbyrs   = nv_ncbyrs .

               IF nv_bptr <> 0 THEN DO:
                   FIND wf_uwd132 WHERE RECID(wf_uwd132) = nv_bptr.
                       wf_uwd132.fptr = RECID(sic_bran.uwd132).
               END.
               IF nv_bptr = 0 THEN sic_bran.uwm130.fptr03  =  RECID(sic_bran.uwd132).
               nv_bptr = RECID(sic_bran.uwd132).

            END.
        END.
        RUN proc_chkRY. /*A64-0309*/

    sic_bran.uwm130.bptr03  = nv_bptr. 
    RELEASE sic_bran.uwd132.

END.
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_var C-Win 
PROCEDURE proc_var :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
ASSIGN
    /* nv_camptyp =  "NORM"*/
    s_riskgp   =   0                     s_riskno       =  1
    s_itemno   =   1                     nv_undyr       =  String(Year(today),"9999")   
    n_rencnt   =   0                     n_endcnt       =  0.
    
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

&ANALYZE-SUSPEND _UIB-CODE-BLOCK _PROCEDURE proc_wgw72013 C-Win 
PROCEDURE proc_wgw72013 :
/*------------------------------------------------------------------------------
  Purpose:     
  Parameters:  <none>
  Notes:       
------------------------------------------------------------------------------*/
DEFINE INPUT        PARAMETER  nv_rec100  AS RECID     NO-UNDO.
DEFINE INPUT        PARAMETER  nv_red132  AS RECID     NO-UNDO.
DEFINE INPUT        PARAMETER  nvtariff   AS CHARACTER NO-UNDO.
DEF            VAR n_dcover   AS   INT FORMAT "99999" INITIAL[0].
DEF            VAR n_dyear    AS   INT FORMAT "99999" INITIAL[0].
DEF            VAR nvyear     AS   INT FORMAT "99999" INITIAL[0].
DEF            VAR n_day1     AS   INT FORMAT "99"    INITIAL[31].
DEF            VAR n_mon1     AS   INT FORMAT "99"    INITIAL[12].
DEF            VAR n_ddyr     AS   INT FORMAT "9999"  INITIAL[0].
DEF            VAR n_ddyr1    AS   INT FORMAT "9999"  INITIAL[0].
DEF            VAR n_dmonth   AS   INT FORMAT "99999" INITIAL[0].
DEF            VAR n_orgnap   LIKE sic_bran.uwd132.gap_c  NO-UNDO.
DEF            VAR s_curbil   LIKE sic_bran.uwm100.curbil NO-UNDO.
def              var  n_total   as deci  no-undo.
FIND sic_bran.uwm100 WHERE RECID(sic_bran.uwm100) EQ nv_rec100 NO-WAIT NO-ERROR.
FIND sic_bran.uwd132 WHERE RECID(sic_bran.uwd132) EQ nv_red132 NO-WAIT NO-ERROR.
s_curbil = sic_bran.uwm100.curbil.
n_orgnap = sic_bran.uwd132.gap_c.
IF sic_bran.uwm100.expdat EQ ? OR  sic_bran.uwm100.comdat EQ ? THEN sic_bran.uwd132.prem_c = n_orgnap.
IF nvtariff = "Z" OR nvtariff = "X" THEN DO:
   sic_bran.uwd132.prem_c = n_orgnap.
END.
ELSE DO:
  IF sic_bran.uwm100.expdat NE ? AND sic_bran.uwm100.comdat NE ? THEN DO:
    ASSIGN n_dcover = 0
           n_dyear  = 0
           nvyear   = 0
           n_dmonth = 0.
                IF ( DAY(sic_bran.uwm100.comdat)     =   DAY(sic_bran.uwm100.expdat)    AND
                   MONTH(sic_bran.uwm100.comdat)     = MONTH(sic_bran.uwm100.expdat)    AND
                    YEAR(sic_bran.uwm100.comdat) + 1 =  YEAR(sic_bran.uwm100.expdat) )  OR
                   ( DAY(sic_bran.uwm100.comdat)     =   29                             AND
                   MONTH(sic_bran.uwm100.comdat)     =   02                             AND
                     DAY(sic_bran.uwm100.expdat)     =   01                             AND
                   MONTH(sic_bran.uwm100.expdat)     =   03                             AND
                    YEAR(sic_bran.uwm100.comdat) + 1 =  YEAR(sic_bran.uwm100.expdat) )
                THEN DO:
                  n_dcover = 365.
                END.
                ELSE DO:
                  n_dcover = (sic_bran.uwm100.expdat  - sic_bran.uwm100.comdat ) + 1 .     /*    =  366  วัน */
                END.
    FIND sicsyac.xmm031 USE-INDEX xmm03101 WHERE
         sicsyac.xmm031.poltyp EQ sic_bran.uwm100.poltyp
    NO-LOCK NO-ERROR.
    IF AVAILABLE sicsyac.xmm031 THEN DO:
       IF n_dcover = 365  THEN   
      n_ddyr   = YEAR(TODAY).
      n_ddyr1  = n_ddyr + 1.
      n_dyear  = 365.   
      FIND sicsyac.xmm105 USE-INDEX xmm10501      WHERE
           sicsyac.xmm105.tariff EQ nvtariff      AND
           sicsyac.xmm105.bencod EQ sic_bran.uwd132.bencod
      NO-LOCK NO-ERROR.
      IF  sic_bran.uwm100.short = NO OR sicsyac.xmm105.shorta = NO THEN DO:
          sic_bran.uwd132.prem_c = (n_orgnap * n_dcover) / n_dyear .  
      END.
      ELSE DO:
        FIND FIRST sicsyac.xmm127 USE-INDEX xmm12701     WHERE
                   sicsyac.xmm127.poltyp =  sic_bran.uwm100.poltyp AND
                   sicsyac.xmm127.daymth =  YES                    AND
                   sicsyac.xmm127.nodays GE n_dcover
        NO-LOCK NO-ERROR.
        IF AVAILABLE sicsyac.xmm127 THEN DO:
           sic_bran.uwd132.prem_c =  (n_orgnap * sicsyac.xmm127.short) / 100 .
        END.
        ELSE DO:
          IF YEAR(sic_bran.uwm100.expdat) <> YEAR(sic_bran.uwm100.comdat) THEN DO:
            nvyear = YEAR(sic_bran.uwm100.expdat) - YEAR(sic_bran.uwm100.comdat).
            IF nvyear > 1 THEN
               n_dmonth = (12 - MONTH(sic_bran.uwm100.comdat) +
                                MONTH(sic_bran.uwm100.expdat) + 1) + ((nvyear - 1) * 12).
            ELSE
               n_dmonth =  12 - MONTH(sic_bran.uwm100.comdat) +
                                MONTH(sic_bran.uwm100.expdat) + 1.
          END.
          ELSE n_dmonth = MONTH(sic_bran.uwm100.expdat) - MONTH(sic_bran.uwm100.comdat) + 1.
          FIND FIRST sicsyac.xmm127 USE-INDEX xmm12701      WHERE
                     sicsyac.xmm127.poltyp =  sic_bran.uwm100.poltyp AND
                     sicsyac.xmm127.daymth =  NO            AND
                     sicsyac.xmm127.nodays GE n_dmonth
          NO-LOCK NO-ERROR.
          IF AVAILABLE xmm127 THEN DO:
             sic_bran.uwd132.prem_c = (n_orgnap * sicsyac.xmm127.short) / 100.
             HIDE MESSAGE NO-PAUSE.
             PAUSE.
          END.
          ELSE DO:
             sic_bran.uwd132.prem_c =  (n_orgnap * n_dcover) / n_dyear.
          END.

        END.
      END.
      IF s_curbil = "BHT" THEN  sic_bran.uwd132.prem_c = sic_bran.uwd132.prem_c.
    END.
  END.
END.
RELEASE sicsyac.xmm127 .
END PROCEDURE.

/* _UIB-CODE-BLOCK-END */
&ANALYZE-RESUME

